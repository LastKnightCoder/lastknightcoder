<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>Coder</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="">
    <meta name="description" content="人生天地间，忽如远行客">
<meta property="og:type" content="website">
<meta property="og:title" content="Coder">
<meta property="og:url" content="https://lastknightcoder.gitee.io/">
<meta property="og:site_name" content="Coder">
<meta property="og:description" content="人生天地间，忽如远行客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="熊滔">
<meta name="twitter:card" content="summary">
    
        <link rel="alternate" type="application/atom+xml" title="Coder" href="https://lastknightcoder.gitee.io/atom.xml">
    
    <link rel="shortcut icon" href="https://lastknightcoder.gitee.io/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu"  >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(https://lastknightcoder.gitee.io/img/brand.jpg)">
      <div class="brand">
        <a href="https://lastknightcoder.gitee.io/" class="avatar waves-effect waves-circle waves-light">
          <img src="https://lastknightcoder.gitee.io/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">熊滔</h5>
          <a href="mailto:2223106858@qq.com" title="2223106858@qq.com" class="mail">2223106858@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect active">
              <a href="https://lastknightcoder.gitee.io/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://lastknightcoder.gitee.io/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://lastknightcoder.gitee.io/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://lastknightcoder.gitee.io/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/LastKnightCoder" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Coder</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header index-header">

    <div class="container fade-scale">
        <h1 class="title">Coder</h1>
        <h5 class="subtitle">
            
                
            
        </h5>
    </div>

    


</header>

<div class="container body-wrap">

    <ul class="post-list">
    
        <li class="post-list-item fade">
            <article id="post-数据结构--Java描述"
  class="article-card article-type-post" itemprop="blogPost">

    <div class="post-meta">
        <time class="post-time" title="2020-05-06 12:18:53" datetime="2020-05-06T04:18:53.566Z"  itemprop="datePublished">2020-05-06</time>

        


    </div>

    


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="https://lastknightcoder.gitee.io/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84--Java%E6%8F%8F%E8%BF%B0/">数据结构--Java描述</a>
    </h3>
  




    <div class="post-content" id="post-content" itemprop="postContent">

    
        <p>本篇文章是为了记录自己在学习数据结构时的笔记，会对常见的数据结构做基本的介绍以及使用Java语言进行实现。包括</p>
<ul>
<li>动态数组</li>
<li>栈</li>
<li>队列</li>
<li>链表</li>
<li>二分搜索树</li>
<li>优先队列和堆</li>
<li>线段树</li>
<li><code>Trie</code></li>
<li>并查集</li>
<li><code>AVL</code> 树</li>
<li>红黑树</li>
<li>哈希表</li>
</ul>
<h2 id="动态数组"><a href="#动态数组" class="headerlink" title="动态数组"></a>动态数组</h2><h3 id="API介绍"><a href="#API介绍" class="headerlink" title="API介绍"></a>API介绍</h3><p>数组是一种根据下标操作的数据结构，它的查询速度很快，但是它有缺点，那就是数组的容量一旦在创建时确定，就不能进行更改，所以为了克服这一缺点，我们实现一个自己的数组，并除此以外，还会实现一些方法，包括以下</p>
<ul>
<li><code>add(int index, E e)</code><ul>
<li>向指定 index 添加元素 e</li>
</ul>
</li>
<li><code>get(int index)</code><ul>
<li>获得指定 index 的元素</li>
</ul>
</li>
<li><code>remove(int index)</code><ul>
<li>删除指定 index 的元素并返回该元素</li>
</ul>
</li>
<li><code>set(int index, E e)</code><ul>
<li>更改 index 处的元素为 e</li>
</ul>
</li>
<li><code>getSize()</code><ul>
<li>返回数组中元素的个数</li>
</ul>
</li>
<li><code>contains(E e)</code><ul>
<li>查询数组是否包含元素 e</li>
</ul>
</li>
<li><code>isEmpty()</code><ul>
<li>查看数组是否为空(是否有元素)</li>
</ul>
</li>
<li><code>find(E e)</code><ul>
<li>返回数组中元素 e 第一次出现的 index，若没有元素 e，则返回 -1</li>
</ul>
</li>
</ul>
<p>新建一个 Array 类，它含有两个私有成员变量</p>
<ul>
<li><code>E[] data</code><ul>
<li>用以保存数据</li>
</ul>
</li>
<li><code>int size</code><ul>
<li>用以记录数组中元素的个数</li>
</ul>
</li>
</ul>
<p>除此以外还有两个构造方法</p>
<ul>
<li><code>Array(int capacity)</code><ul>
<li>设定数组的容量</li>
</ul>
</li>
<li><code>Array()</code><ul>
<li>容量默认为 10</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Array</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> E[] data;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Array</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">        data = (E[]) <span class="keyword">new</span> Object[capacity];</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Array</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我们来实现上面提到的方法。</p>
<h3 id="方法实现"><a href="#方法实现" class="headerlink" title="方法实现"></a>方法实现</h3><p>首先来实现 <code>getSize()</code> 方法，这个是返回数组元素的个数的，我们直接返回 <code>size</code> 即可</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>isEmpty()</code> 是为了查看数组中是否还有元素，如果 <code>size</code> 为 0 的话说明数组为空，所以我们返回 <code>size == 0</code> 即可</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在来实现 <code>add(int index, E e)</code> 方法，该方法的实现是将 <code>index</code> 后面的元素都向后移动一位，然后在 <code>index</code> 处插入元素 <code>e</code></p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr01.png"/>
</center>


<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, E e)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//对inex进行验证 如果不符合规范则抛出异常</span></span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; size) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//将元素向后移动</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = size; i &gt; index; i--) &#123;</span><br><span class="line">        data[i] = data[i - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//在index处插入元素e</span></span><br><span class="line">    data[index] = e;</span><br><span class="line">    <span class="comment">//数组中元素个数+1</span></span><br><span class="line">    size++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根据这个方法，我们可以很快的实现 <code>addFirst(E e)</code> 和 <code>addLast(E e)</code> 方法，这两个方法一个是在数组头添加元素，一个是在数组的末尾添加一个元素</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addLast</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//在index = size处添加元素 即在数组末尾添加一个元素</span></span><br><span class="line">    add(size,e);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFirst</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//在index = 0处添加一个元素 即在数组头添加一个元素</span></span><br><span class="line">    add(<span class="number">0</span>,e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面来实现 <code>remove(int index)</code> 方法，该方法是删除 <code>index</code> 处的元素，并将该元素返回，以添加的操作相反，删除是将后面的元素向前移动，覆盖掉 <code>index</code> 处的元素即可删除</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr02.png"/>
</center>


<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//参数检查</span></span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= size) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获得index处的元素用以返回</span></span><br><span class="line">    E e = data[index];</span><br><span class="line">    <span class="comment">//将元素从后向前移一个</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = index; i &lt; size - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        data[i] = data[i+<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//数组中元素个数-1</span></span><br><span class="line">    size --;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//返回删除的元素</span></span><br><span class="line">    <span class="keyword">return</span> e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同理，根据这个方法我们可以快速的实现 <code>removeLast()</code> 和 <code>removeFirst()</code> 方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">removeLast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> remove(size -<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">removeFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> remove(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以添加一个删除指定元素的方法 <code>removeElement(E e)</code>，我们会遍历数组，如果发现有元素等于该元素，那么删除该元素并退出方法，所以这个方法只删除第一个元素 <code>e</code>，并不是数组所有的元素 <code>e</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeElement</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//遍历数组</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">        <span class="comment">//如果找到等于该元素的元素</span></span><br><span class="line">        <span class="keyword">if</span> (e.equals(data[i])) &#123;</span><br><span class="line">            <span class="comment">//删除该元素</span></span><br><span class="line">            remove(i);</span><br><span class="line">            <span class="comment">//退出方法</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面实现 <code>contains(E e)</code> 方法，这个方法的思路同删除指定元素相似，遍历数组，如果找到元素与指定元素相同，那么返回 <code>true</code>，如果遍历完数组还没有找到与之相等的元素，那么返回 <code>false</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//遍历数组</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">        <span class="comment">//如果找到元素，那么返回true</span></span><br><span class="line">        <span class="keyword">if</span> (data[i].equals(e)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果遍历完所有数组没有找到，那么返回false</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>find(E e)</code> 方法的实现也是遍历数组，如果找到了元素，那么返回下标，如果遍历完数组都没有找到，那么返回 <code>-1</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//遍历数组</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">        <span class="comment">//找到元素则返回下标</span></span><br><span class="line">        <span class="keyword">if</span> (data[i].equals(e)) &#123;</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果遍历完数组都没有找到，返回-1</span></span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面实现 <code>get(int index)</code> 和 <code>set(int index, E e)</code>，这两个方法的实现及其简单，直接上代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= size) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> data[index];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= size) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    data[index] = e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以根据 <code>get</code> 方法实现 <code>getLast()</code>和 <code>getFirst()</code> 方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">getFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> get(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">getLast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> get(size - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我们已经实现了 <code>API</code> 中提到的所有的方法，但是我们还是没有解决数组容量固定的问题，为了解决这个问题，我们需要实现一个 <code>resize(int newCapacity)</code>，它的作用是改变数组的容量大小，这样当数组的容量不足时，我们调用该方法就可以将数组进行扩容，或者当数组中有大量空间空闲时，我们可以缩小数组的容量，代码如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">resize</span><span class="params">(<span class="keyword">int</span> newCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//创建一个新容量的数组</span></span><br><span class="line">    E[] temp = (E[]) <span class="keyword">new</span> Object[newCapacity];</span><br><span class="line">    <span class="comment">//将数组中的数据全部放入新数组中</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i =<span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">        temp[i] = data[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//改变数组指针指向</span></span><br><span class="line">    data = temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我们改变 <code>add(int index, E e)和remove(int index)</code> 方法，我们会在添加元素和删除元素时检查数组的容量，以便对数组进行扩容或者缩容</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; size) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果数组容量满了 那么将数组的容量扩为原来的两倍</span></span><br><span class="line">    <span class="keyword">if</span> (size == data.length) &#123;</span><br><span class="line">        resize(data.length * <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = size; i &gt; index; i--) &#123;</span><br><span class="line">        data[i] = data[i - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    data[index] = e;</span><br><span class="line">    size++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= size) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    E e = data[index];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = index; i &lt; size - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        data[i] = data[i+<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    size --;</span><br><span class="line">    <span class="comment">//如果数组中的元素个数为数组容量的1/4，那么容量变为原来的1/2</span></span><br><span class="line">    <span class="comment">//思考一下为什么是1/4 提示：复杂度震荡</span></span><br><span class="line">    <span class="keyword">if</span> (size == data.length/<span class="number">4</span>) &#123;</span><br><span class="line">        resize(data.length/<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为了方便的打印 <code>Array</code> 类，我们重写 <code>toString()</code> 方法如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    StringBuilder str = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    str.append(<span class="string">"size "</span> + size);</span><br><span class="line">    str.append(<span class="string">" capacity "</span> + data.length);</span><br><span class="line">    str.append(<span class="string">"\n["</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i == size - <span class="number">1</span>) &#123;</span><br><span class="line">            str.append(data[i].toString());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            str.append(data[i].toString() + <span class="string">", "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    str.append(<span class="string">"]"</span>);</span><br><span class="line">    <span class="keyword">return</span> str.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至此，我们已经完全实现了 <code>Array</code>，它的容量没有限制，并且提供了很多的方法供用户调用，我们将使用该类来实现其它的基本的数据结构。下面贴出完整的代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Array</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> E[] data;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Array</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">        data = (E[]) <span class="keyword">new</span> Object[capacity];</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Array</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addLast</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        add(size,e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFirst</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        add(<span class="number">0</span>,e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, E e)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; size) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (size == data.length) &#123;</span><br><span class="line">            resize(data.length * <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = size; i &gt; index; i--) &#123;</span><br><span class="line">            data[i] = data[i - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        data[index] = e;</span><br><span class="line">        size++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">removeLast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> remove(size -<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">removeFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> remove(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= size) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        E e = data[index];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = index; i &lt; size - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            data[i] = data[i+<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        size --;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (size == data.length/<span class="number">4</span>) &#123;</span><br><span class="line">            resize(data.length/<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeElement</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (e.equals(data[i])) &#123;</span><br><span class="line">                remove(i);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (data[i].equals(e)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (data[i].equals(e)) &#123;</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">resize</span><span class="params">(<span class="keyword">int</span> newCapacity)</span> </span>&#123;</span><br><span class="line">        E[] temp = (E[]) <span class="keyword">new</span> Object[newCapacity];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i =<span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            temp[i] = data[i];</span><br><span class="line">        &#125;</span><br><span class="line">        data = temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= size) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> data[index];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">getFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">getLast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> get(size - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= size) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        data[index] = e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuilder str = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"></span><br><span class="line">        str.append(<span class="string">"size "</span> + size);</span><br><span class="line">        str.append(<span class="string">" capacity "</span> + data.length);</span><br><span class="line">        str.append(<span class="string">"\n["</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == size - <span class="number">1</span>) &#123;</span><br><span class="line">                str.append(data[i].toString());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                str.append(data[i].toString() + <span class="string">", "</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        str.append(<span class="string">"]"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> str.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h2><p>栈是一种先进后出的结构，比如你放书会把书放在最上面，最先放的书在最下面，而你拿书却是从最上面拿，最后放的最先拿到，栈正是怎么一种结构，我们规定最上面的位置叫做栈顶，我们向栈中添加元素是添加到栈顶，向栈中取出元素是从栈顶取出的，我们先来定义一个 <code>Stack</code> 接口，里面规定了一个栈包含的操作</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Stack</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//向栈中压入一个元素</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(E e)</span></span>;</span><br><span class="line">    <span class="comment">//将栈顶元素弹出</span></span><br><span class="line">    <span class="function">E <span class="title">pop</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//栈是否为空</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//获得栈中元素的个数</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//获得栈顶元素</span></span><br><span class="line">    <span class="function">E <span class="title">peek</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面我们将使用上面实现的 <code>Array</code> 来实现一个 <code>ArrayStack</code>，我们把数组的最后位置定义为栈顶</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayStack</span>&lt;<span class="title">E</span>&gt; <span class="keyword">implements</span> <span class="title">Stack</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Array&lt;E&gt; data;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ArrayStack</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">        data = <span class="keyword">new</span> Array&lt;&gt;(capacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ArrayStack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        data = <span class="keyword">new</span> Array&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        data.addLast(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data.removeLast();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data.getSize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">peek</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data.getLast();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuilder res = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        res.append(<span class="string">"Stack: "</span>);</span><br><span class="line">        res.append(<span class="string">"["</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; data.getSize(); i++) &#123;</span><br><span class="line">            res.append(data.get(i));</span><br><span class="line">            <span class="keyword">if</span> (i != data.getSize()-<span class="number">1</span>) &#123;</span><br><span class="line">                res.append(<span class="string">", "</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        res.append(<span class="string">"] top"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的代码极其的简单，只要仔细的阅读就可以完全的理解，这里不多做解释。</p>
<p>下面介绍一个有关于栈的题目，此题来自于<a href="https://leetcode-cn.com/problems/valid-parentheses" target="_blank" rel="noopener">LeetCode第20题</a></p>
<blockquote>
<p>给定一个只包括 <code>&#39;(&#39;</code>，<code>&#39;)&#39;</code>，<code>&#39;{&#39;</code>，<code>&#39;}&#39;</code>，<code>&#39;[&#39;</code>，<code>&#39;]&#39;</code> 的字符串，判断字符串是否有效。有效字符串需满足：</p>
<ol>
<li>左括号必须用相同类型的右括号闭合。</li>
<li>左括号必须以正确的顺序闭合。</li>
</ol>
<p>注意空字符串可被认为是有效字符串。</p>
</blockquote>
<p>这道题的解题思路是，如果遇到左括号<code>&#39;(&#39;, &#39;[&#39;, &#39;{&#39;</code>，那么将左括号压入栈中，如果遇到右括号，那么将栈顶的左括号弹出，判断两个括号是否匹配，如果不匹配返回 <code>fasle</code>，如果匹配进行下一轮，最后如果字符串遍历完毕，如果栈为空说明匹配成功，如果栈不为空，所以左边的括号多匹配失败，代码如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建一个空栈</span></span><br><span class="line">        Stack&lt;Character&gt; stack = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//遍历字符串</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">char</span> c = s.charAt(i);</span><br><span class="line">            <span class="comment">//如果是左括号，则压入栈中</span></span><br><span class="line">            <span class="keyword">if</span> (c == <span class="string">'('</span> || c == <span class="string">'['</span> || c == <span class="string">'&#123;'</span>) &#123;</span><br><span class="line">                stack.push(c);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//如果是右括号 先判断栈是否为空</span></span><br><span class="line">                <span class="keyword">if</span> (stack.isEmpty()) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">				</span><br><span class="line">                <span class="comment">//获得栈顶的左括号</span></span><br><span class="line">                <span class="keyword">char</span> charTop = stack.pop();</span><br><span class="line">                <span class="comment">//下面三种皆为不匹配的情况</span></span><br><span class="line">                <span class="keyword">if</span> (c == <span class="string">')'</span> &amp;&amp; charTop != <span class="string">'('</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (c == <span class="string">']'</span> &amp;&amp; charTop != <span class="string">'['</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (c == <span class="string">'&#125;'</span> &amp;&amp; charTop != <span class="string">'&#123;'</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//这里不能直接返回true 要根据栈是否为空决定返回值</span></span><br><span class="line">        <span class="keyword">return</span> stack.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h2><p>队列是一种先进先出的结构，假设你在排队，那么最先排队的人最先得到服务。我们只能从队尾添加元素，从队首取出元素。老规矩，我们首先规定一下队列 <code>Queue</code> 的 <code>API</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Queue</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//向队列中添加一个元素</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">enqueue</span><span class="params">(E e)</span></span>;</span><br><span class="line">    <span class="comment">//从队列中取出一个元素</span></span><br><span class="line">    <span class="function">E <span class="title">dequeue</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//获得队首的元素</span></span><br><span class="line">    <span class="function">E <span class="title">getFront</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//获取队列中元素的个数</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//判断队列是否为空</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="数组队列"><a href="#数组队列" class="headerlink" title="数组队列"></a>数组队列</h3><p> 现在我们将使用动态数组 <code>Array</code> 类来实现队列，实现的逻辑也十分的简单，如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayQueue</span>&lt;<span class="title">E</span>&gt; <span class="keyword">implements</span> <span class="title">Queue</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Array&lt;E&gt; array;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ArrayQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        array = <span class="keyword">new</span> Array&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ArrayQueue</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">        array = <span class="keyword">new</span> Array&lt;&gt;(capacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">enqueue</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        array.addLast(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">dequeue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> array.removeFirst();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">getFront</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> array.getFirst();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> array.getSize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> array.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuilder res = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        res.append(<span class="string">"Queue: "</span>);</span><br><span class="line">        res.append(<span class="string">"front ["</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.getSize(); i++) &#123;</span><br><span class="line">            res.append(array.get(i));</span><br><span class="line">            <span class="keyword">if</span> (i != array.getSize()-<span class="number">1</span>) &#123;</span><br><span class="line">                res.append(<span class="string">", "</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        res.append(<span class="string">"] tail"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意上面我们的 <code>dequeue</code> 操作是调用了动态数组的 <code>removeFirst</code> 操作，这个操作需要遍历整个数组将元素向前移动，所以该操作是 <code>O(n)</code> 的。</p>
<h3 id="循环队列"><a href="#循环队列" class="headerlink" title="循环队列"></a>循环队列</h3><p>上面队列的 <code>dequeue</code> 操作是 <code>O(n)</code> 级别的，这是因为上面会将数组整体向前移一位，但是如果我们不这么做，而是增加一个变量 <code>front</code> 来记录队首的位置，这样我们只要将 <code>front</code> 向前移一位即可，这样的操作就是 <code>O(1)</code> 级别的</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr03.png"/>
</center>


<p>这样做的同时，我们发现，如果当 <code>tail</code> 来到数组的末尾，按道理应该将数组进行扩容，但是 <code>front</code> 前面还有空间</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr04.png"/>
</center>


<p>这个时候我们应当将 <code>tail</code> 移动到数组头去</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr05.png"/>
</center>


<p>这时 <code>tail</code> 的计算公式不再是简单的 <code>tail = tail + 1</code>，而是 <code>tail = (tail + 1) % data.length</code>，如果不理解这个式子，就想象一下时钟，11 点向前一步就是 12 点，也可以称为是 0 点，这个时候时钟的计算公式为 <code>(11 + 1) % 12</code>。因为这种循环的特性，我们把这种实现方式称为循环队列。这次我们实现队列不在使用上面的动态数组，有了上面实现栈和队列的经验，想必可以容易理解下面的代码(在关键的步骤给予注释)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoopQueue</span>&lt;<span class="title">E</span>&gt; <span class="keyword">implements</span> <span class="title">Queue</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> front;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> tail;</span><br><span class="line">    <span class="comment">//队列中元素的个数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">    <span class="comment">//底层实现的数组</span></span><br><span class="line">    <span class="keyword">private</span> E[] data;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//构造方法初始化</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoopQueue</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">        data = (E[]) <span class="keyword">new</span> Object[capacity];</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">        front = <span class="number">0</span>;</span><br><span class="line">        tail = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//默认容量为10</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoopQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">enqueue</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//首先判断数组是不是满了，如果是那么就进行扩容</span></span><br><span class="line">        <span class="keyword">if</span> (size == data.length) &#123;</span><br><span class="line">            resize(<span class="number">2</span> * data.length);</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//向队尾添加元素</span></span><br><span class="line">        data[tail] = e;</span><br><span class="line">        <span class="comment">//tail向后移动 不是简单的+1 上面已有解释</span></span><br><span class="line">        tail = (tail +<span class="number">1</span>) % data.length;</span><br><span class="line">        size++;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//数组伸缩操作，已接触过</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">resize</span><span class="params">(<span class="keyword">int</span> newCapacity)</span> </span>&#123;</span><br><span class="line">        E[] temp = (E[]) <span class="keyword">new</span> Object[newCapacity];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i =<span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="comment">//这里我们将队列的头对应到新数组的开头</span></span><br><span class="line">            temp[i] = data[(front + i)%data.length];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//重新记录front和tail的位置</span></span><br><span class="line">        front = <span class="number">0</span>;</span><br><span class="line">        tail = size;</span><br><span class="line">        data = temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">dequeue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//如果队列为空，抛出异常</span></span><br><span class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"队列为空"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//获得出队的元素</span></span><br><span class="line">        E e = data[front];</span><br><span class="line">        data[front] = <span class="keyword">null</span>;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//front向前移动(带循环)</span></span><br><span class="line">        front = (front + <span class="number">1</span>) % data.length;</span><br><span class="line">        size--;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//缩容操作，不做解释</span></span><br><span class="line">        <span class="keyword">if</span> (size == data.length / <span class="number">4</span>) &#123;</span><br><span class="line">            resize(data.length / <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">getFront</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"队列为空"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> data[front];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuilder str = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        str.append(<span class="string">"Queue: size "</span> + size);</span><br><span class="line">        str.append(<span class="string">" capacity "</span> + data.length);</span><br><span class="line">        str.append(<span class="string">"\nfront ["</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == size - <span class="number">1</span>) &#123;</span><br><span class="line">                str.append(data[(front + i) % data.length].toString());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                str.append(data[(front + i) % data.length].toString() + <span class="string">", "</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        str.append(<span class="string">"] tail"</span>);</span><br><span class="line">        <span class="keyword">return</span> str.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这次我们得到的 <code>dequeue</code> 操作就是 <code>O(1)</code> 的了(严格的讲均摊复杂度为 <code>O(1)</code>，因为里面 <code>resize()</code> 复杂度是 <code>O(n)</code> 的)。</p>
<h2 id="链表"><a href="#链表" class="headerlink" title="链表"></a>链表</h2><p>链表是一种非常重要的线性数据结构，我们在实现栈和队列时使用的是动态数组实现的，这个动态数组是针对用户而言是动态的，实际上底层是静态的，是通过 <code>resize()</code> 操作去解决容量问题的。而链表则是一种真正的动态数据结构，它是这么一种数据结构，我们把数据存储在一个节点(Node)中，一个节点一般包含两部分的内容，一个是存储的数据，一个是它要指向的下一个节点</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> E e;</span><br><span class="line">    <span class="keyword">private</span> Node next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一个节点指向一个节点，所以最后看起来就像是一个链，我们把这种数据结构称为链表</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr06.png"/>
</center>



<p>最后一个节点的下一个节点为 <code>NULL</code>，表示后面没有节点了。它是一个真正的动态的数据结构，不需要处理容量的问题。但是它也有缺点，它没有数组那样快的查询能力，它要查询某个节点的数据，只能通过头结点一直寻找下来(后面我们将看到)，所以它的查询速度比数组慢。</p>
<h3 id="链表实现"><a href="#链表实现" class="headerlink" title="链表实现"></a>链表实现</h3><p>现在我们将实现这么一个结构，首先设计好节点类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedList</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//我们将Node设置为LinkedList的私有内部类</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> E e;</span><br><span class="line">        <span class="keyword">public</span> Node next;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(E e, Node next)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.e = e;</span><br><span class="line">            <span class="keyword">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>(e, <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>(<span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> e.toString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们要想向链表中添加(或其他操作)元素，不可避免的要遍历链表(因为链表不能通过索引访问，只能通过前面的节点找到后面的节点)，而要遍历链表，我们就要将链表的头存储起来，这样才能遍历链表，我们将链表的头称为 <code>head</code></p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr07.png"/>
</center>



<p>同时我们使用变量 <code>size</code> 来记录链表中元素的个数</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedList</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//为了节省篇幅，Node类不再展示，下同</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//头结点</span></span><br><span class="line">    <span class="keyword">private</span> Node head;</span><br><span class="line">    <span class="comment">//链表中元素的个数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        head = <span class="keyword">null</span>;</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我们实现两个简单的方法 <code>getSize()</code> 和 <code>isEmpty()</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="添加元素"><a href="#添加元素" class="headerlink" title="添加元素"></a>添加元素</h4><h5 id="向链表头添加元素"><a href="#向链表头添加元素" class="headerlink" title="向链表头添加元素"></a>向链表头添加元素</h5><center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr08.png"/>
</center>



<p>首先将要插入的新节点指向 <code>head</code>，然后将 <code>head</code> 设置为新节点，实现如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFirst</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//体会一下这条语句的意思</span></span><br><span class="line">    head = <span class="keyword">new</span> Node(e,head);</span><br><span class="line">    size++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="在链表的中间添加一个元素"><a href="#在链表的中间添加一个元素" class="headerlink" title="在链表的中间添加一个元素"></a>在链表的中间添加一个元素</h5><center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr09.png"/>
</center>



<p>比如现在往节点 1 后面插入一个元素，首先将新节点指向节点 2，然后节点 1 指向新节点，实现如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; size) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果是头结点需要单独处理</span></span><br><span class="line">    <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">        addFirst(e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//prev代表要插入位置的前一个节点</span></span><br><span class="line">    Node prev = head;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        prev = prev.next;</span><br><span class="line">    &#125;</span><br><span class="line">    prev.next = <span class="keyword">new</span> Node(e, prev.next);</span><br><span class="line">    size++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="向链表的尾部添加一个元素"><a href="#向链表的尾部添加一个元素" class="headerlink" title="向链表的尾部添加一个元素"></a>向链表的尾部添加一个元素</h5><p>直接复用上面的代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addLast</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    add(size, e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="虚拟头结点"><a href="#虚拟头结点" class="headerlink" title="虚拟头结点"></a>虚拟头结点</h4><p>我们在向链表中添加元素时，因为 <code>head</code> 前面没有节点，所以我们在添加元素时会对 <code>head</code> 进行单独的处理，为了不使 <code>head</code> 具有特殊性，我们在链表的最头部添加一个虚拟头结点，里面不存储元素，它的存在是为了使得操作链表方便</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr10.png"/>
</center>



<p>现在我们修改上面的 <code>head</code> 为 <code>dummyHead</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedList</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment">//虚拟结点</span></span><br><span class="line">    <span class="keyword">private</span> Node dummyHead;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//这里修改了</span></span><br><span class="line">        dummyHead = <span class="keyword">new</span> Node(<span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//直接调用add方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFirst</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        add(<span class="number">0</span>,e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; size) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//不需要对head进行单独的处理了</span></span><br><span class="line">        <span class="comment">//index - 1修改为了index</span></span><br><span class="line">        Node prev = dummyHead;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">            prev = prev.next;</span><br><span class="line">        &#125;</span><br><span class="line">        prev.next = <span class="keyword">new</span> Node(e, prev.next);</span><br><span class="line">        size++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addLast</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        add(size, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="获得某个索引的值"><a href="#获得某个索引的值" class="headerlink" title="获得某个索引的值"></a>获得某个索引的值</h4><p>实现的思路同 <code>add</code> 很像，不过这里我们找的不是前一个节点，而是当前的节点</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= size) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//cur代表当前节点</span></span><br><span class="line">    Node cur = dummyHead.next;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">        cur = cur.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (E) cur.e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>基于这个方法，我们可以很快的实现 <code>getFirst()</code> 和 <code>getLast()</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">getFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> get(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">getLast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> get(size - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="更新某个索引的值"><a href="#更新某个索引的值" class="headerlink" title="更新某个索引的值"></a>更新某个索引的值</h4><p>实现的思路完全是同 <code>get()</code> 方法，直接上代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= size) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    Node cur = dummyHead.next;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">        cur = cur.next;</span><br><span class="line">    &#125;</span><br><span class="line">    cur.e = e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="查找链表是否存在元素e"><a href="#查找链表是否存在元素e" class="headerlink" title="查找链表是否存在元素e"></a>查找链表是否存在元素e</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//从当前节点开始，一直遍历到最后一个节点</span></span><br><span class="line">    <span class="keyword">for</span> (Node cur = dummyHead.next; cur != <span class="keyword">null</span>; cur = cur.next) &#123;</span><br><span class="line">        <span class="keyword">if</span> (cur.e.equals(e)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="删除链表中的元素"><a href="#删除链表中的元素" class="headerlink" title="删除链表中的元素"></a>删除链表中的元素</h4><center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr11.png"/>
</center>



<p>上图已详细说明了操作的步骤，这里直接贴上代码实现</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= size) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//获得要删除节点的前一个节点</span></span><br><span class="line">    Node prev = dummyHead;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">        prev = prev.next;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//图示的操作</span></span><br><span class="line">    Node delNode = prev.next;</span><br><span class="line">    prev.next = delNode.next;</span><br><span class="line">    delNode.next = <span class="keyword">null</span>;</span><br><span class="line">    size--;</span><br><span class="line">    <span class="keyword">return</span> (E) delNode.e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根据上面的方法，可以很快的实现 <code>removeFirst()</code> 和 <code>removeLast()</code> 方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">removeFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> remove(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">removeLast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> remove(size - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="toString()"></a>toString()</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    StringBuilder res = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    </span><br><span class="line">    Node cur = dummyHead.next;</span><br><span class="line">    <span class="comment">//你可以使用上面的for循环</span></span><br><span class="line">    <span class="keyword">while</span> (cur != <span class="keyword">null</span>) &#123;</span><br><span class="line">        res.append(cur + <span class="string">"-&gt;"</span>);</span><br><span class="line">        cur = cur.next;</span><br><span class="line">    &#125;</span><br><span class="line">    res.append(<span class="string">"NULL"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> res.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="全部代码"><a href="#全部代码" class="headerlink" title="全部代码"></a>全部代码</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedList</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> E e;</span><br><span class="line">        <span class="keyword">public</span> Node next;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(E e, Node next)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.e = e;</span><br><span class="line">            <span class="keyword">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>(e, <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>(<span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> e.toString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node dummyHead;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        dummyHead = <span class="keyword">new</span> Node(<span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFirst</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        add(<span class="number">0</span>,e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; size) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Node prev = dummyHead;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">            prev = prev.next;</span><br><span class="line">        &#125;</span><br><span class="line">        prev.next = <span class="keyword">new</span> Node(e, prev.next);</span><br><span class="line">        size++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addLast</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        add(size, e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= size) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Node cur = dummyHead.next;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">            cur = cur.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (E) cur.e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">getFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">getLast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> get(size - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= size) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Node cur = dummyHead.next;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">            cur = cur.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        cur.e = e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Node cur = dummyHead.next; cur != <span class="keyword">null</span>; cur = cur.next) &#123;</span><br><span class="line">            <span class="keyword">if</span> (cur.e.equals(e)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= size) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Node prev = dummyHead;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">            prev = prev.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Node delNode = prev.next;</span><br><span class="line">        prev.next = delNode.next;</span><br><span class="line">        delNode.next = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        size--;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (E) delNode.e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">removeFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> remove(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">removeLast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> remove(size - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuilder res = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"></span><br><span class="line">        Node cur = dummyHead.next;</span><br><span class="line">        <span class="keyword">while</span> (cur != <span class="keyword">null</span>) &#123;</span><br><span class="line">            res.append(cur + <span class="string">"-&gt;"</span>);</span><br><span class="line">            cur = cur.next;</span><br><span class="line">        &#125;</span><br><span class="line">        res.append(<span class="string">"NULL"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用链表实现栈"><a href="#使用链表实现栈" class="headerlink" title="使用链表实现栈"></a>使用链表实现栈</h3><p>由于链表的 <code>addFirst()</code> 和 <code>removeFirst()</code> 的操作都是 <code>O(1)</code>，所以我们使用链表头作为栈顶，具体的实现逻辑如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedListStack</span>&lt;<span class="title">E</span>&gt; <span class="keyword">implements</span> <span class="title">Stack</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> LinkedList&lt;E&gt; linkedList;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedListStack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        linkedList = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        linkedList.addFirst(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> linkedList.removeFirst();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> linkedList.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> linkedList.getSize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">peek</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> linkedList.getFirst();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuilder res = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        res.append(<span class="string">"Stack: top "</span>);</span><br><span class="line">        res.append(linkedList);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用链表实现队列"><a href="#使用链表实现队列" class="headerlink" title="使用链表实现队列"></a>使用链表实现队列</h3><p>我们之前使用数组实现队列，由于它的 <code>dequeue</code> 操作是 <code>O(n)</code> 级别的，所以我们使用 <code>front</code> 来标记队首，使用循环队列设计，同样的在链表中从链表尾部删除或增加元素都是 <code>O(n)</code> 级别的，为了解决这一个问题，我们决定在链表的尾部增加一个 <code>tail</code> 变量来标记，从而使得在尾部增加元素是 <code>O(1)</code> 级别的</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr12.png"/>
</center>



<p>另外考虑在尾部删除一个元素是 <code>O(1)</code> 的吗? 答案是不是。因为我们删除一个节点需要知道该节点的前一个节点，而知道 <code>tail</code> 节点是无法知道 <code>tail</code> 的前一个节点的，我们还是要遍历。所以我们在 <code>head</code> 端删除元素，在 <code>tail</code> 端添加元素，并且由于只涉及到头部和尾部的操作，所以我们也不需要添加虚拟头结点了</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr13.png"/>
</center>



<p>下面就是实现的代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedListQueue</span>&lt;<span class="title">E</span>&gt; <span class="keyword">implements</span> <span class="title">Queue</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> E e;</span><br><span class="line">        <span class="keyword">public</span> Node next;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(E e, Node next)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.e = e;</span><br><span class="line">            <span class="keyword">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>(e, <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>(<span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> e.toString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node head;</span><br><span class="line">    <span class="keyword">private</span> Node tail;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedListQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        head = <span class="keyword">null</span>;</span><br><span class="line">        tail = <span class="keyword">null</span>;</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">enqueue</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//队列为空时，tail和head都为null 添加元素后二者都指向第一个元素</span></span><br><span class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</span><br><span class="line">            tail = <span class="keyword">new</span> Node(e);</span><br><span class="line">            head = tail;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            tail.next = <span class="keyword">new</span> Node(e);</span><br><span class="line">            tail = tail.next;</span><br><span class="line">        &#125;</span><br><span class="line">        size++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">dequeue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"队列为空"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Node delNode = head;</span><br><span class="line">        head = head.next;</span><br><span class="line">        delNode.next = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        size--;</span><br><span class="line">        <span class="comment">//如果队列为空了，此时tail指向的是delNode，此时应该让tail为null</span></span><br><span class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</span><br><span class="line">            tail = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (E) delNode.e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">getFront</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"队列为空"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (E) head.e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuilder res = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"></span><br><span class="line">        res.append(<span class="string">"Queue: front "</span>);</span><br><span class="line"></span><br><span class="line">        Node cur = head;</span><br><span class="line">        <span class="keyword">while</span> (cur != <span class="keyword">null</span>) &#123;</span><br><span class="line">            res.append(cur + <span class="string">"-&gt;"</span>);</span><br><span class="line">            cur = cur.next;</span><br><span class="line">        &#125;</span><br><span class="line">        res.append(<span class="string">"NULL tail"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二分搜索树"><a href="#二分搜索树" class="headerlink" title="二分搜索树"></a>二分搜索树</h2><p>什么是树结构</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr16.png"/>
</center>



<p>当你把上面的图倒过来看，就像是一棵树，所以我们把这种结构称为是树结构。那为什么要使用树结构，因为树结构在生活中很常见，如文件夹的组织方式，又或者如公司职能的组织方式，这些都是树结构的例子。为什么会使用树结构呢? 原因就是因为高效。</p>
<h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>同链表一样，它也是一种动态的数据结构，链表中的节点是指向一个节点，而二叉树是指向两个节点，我们把这两个节点称为左子树和右子树，又或者称为左孩子和右孩子。如下图表示的就是二叉树</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr16.png"/>
</center>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">    E e;</span><br><span class="line">    Node left;</span><br><span class="line">    Node right;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>根节点<ul>
<li>最顶部的那个节点，如上图中 28 就是根节点</li>
<li>二叉树具有唯一的一个根节点</li>
</ul>
</li>
<li>叶子节点<ul>
<li>没有孩子的节点，如上图的最后一行都是叶子节点</li>
</ul>
</li>
<li>二叉树的每个节点最多有两个孩子，最多有一个父亲</li>
</ul>
<p>那是什么是二分搜索树，首先二分搜索树是二叉树，它满足这样的特点，对于每个节点</p>
<ul>
<li>大于左子树所有节点的值</li>
<li>小于右子树所有节点的值</li>
</ul>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr16.png"/>
</center>



<p>可以验算，上面的这棵树满足二分搜索树的性质，所以这棵树是二分搜索树。下面我们来实现二分搜索树中节点有关代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BST</span>&lt;<span class="title">E</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">E</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> E e;</span><br><span class="line">        <span class="keyword">public</span> Node left;</span><br><span class="line">        <span class="keyword">public</span> Node right;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.e = e;</span><br><span class="line">            left = <span class="keyword">null</span>;</span><br><span class="line">            right = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> e.toString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根节点</span></span><br><span class="line">    <span class="keyword">private</span> Node root;</span><br><span class="line">    <span class="comment">//树中元素的个数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BST</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        root = <span class="keyword">null</span>;</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><h4 id="添加元素-1"><a href="#添加元素-1" class="headerlink" title="添加元素"></a>添加元素</h4><center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr17x.png"/>
</center>



<p>上图想必已经将添加元素的规则说的很详细了，所以这里直接上代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">        root = <span class="keyword">new</span> Node(e);</span><br><span class="line">        size++;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        add(root, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Node node, E e)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//递归终止条件</span></span><br><span class="line">    <span class="keyword">if</span> (e.equals(node.e)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.compareTo(node.e) &lt; <span class="number">0</span> &amp;&amp; node.left == <span class="keyword">null</span>) &#123;</span><br><span class="line">        node.left = <span class="keyword">new</span> Node(e);</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.compareTo(node.e) &gt; <span class="number">0</span> &amp;&amp; node.right == <span class="keyword">null</span>) &#123;</span><br><span class="line">        node.right = <span class="keyword">new</span> Node(e);</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (e.compareTo(node.e) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        add(node.left, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (e.compareTo(node.e) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        add(node.right, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其实上面的代码还可以改进，因为我们在 <code>add(E e)</code> 中对 <code>root</code> 为根节点进行了单独的考虑，其实可以不再这里考虑，因为通过上面的规则知道，当一个节点为 <code>null</code> 时，不管它是根节点还是左右孩子，新加入的节点都将取代这个 <code>null</code> 节点</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr18.png"/>
</center>



<p>所以我们优化上面的代码如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    root = add(root, e);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">add</span><span class="params">(Node node, E e)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//这里返回的Node所指的语义是node所代表的根节点</span></span><br><span class="line">    <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Node(e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (e.compareTo(node.e) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//如果比根节点小，对左子树进行更新</span></span><br><span class="line">        node.left = add(node.left, e);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.compareTo(node.e) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//如果比根节点大，对右子树进行更新</span></span><br><span class="line">        node.right = add(node.right,e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//等于的话什么都不做</span></span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="查询操作"><a href="#查询操作" class="headerlink" title="查询操作"></a>查询操作</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> contains(root, e);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Node node, E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (e.equals(node.e)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.compareTo(node.e) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> contains(node.left, e);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> contains(node.right,e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="二叉树的遍历"><a href="#二叉树的遍历" class="headerlink" title="二叉树的遍历"></a>二叉树的遍历</h4><p>对于某个数据结构的遍历就是将该数据结构中所有的元素都访问一遍，分为三类</p>
<ul>
<li>前序遍历<ul>
<li>父节点在访问左子树之前访问</li>
</ul>
</li>
<li>中序遍历<ul>
<li>父节点在访问左子树之后，在访问右子树之前访问</li>
</ul>
</li>
<li>后序遍历<ul>
<li>父节点在访问右子树之后访问</li>
</ul>
</li>
</ul>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr19.png"/>
</center>



<h5 id="前序遍历"><a href="#前序遍历" class="headerlink" title="前序遍历"></a>前序遍历</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    preOrder(root);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">preOrder</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//先访问父节点</span></span><br><span class="line">    System.out.println(node);</span><br><span class="line">    preOrder(node.left);</span><br><span class="line">    preOrder(node.right);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="中序遍历"><a href="#中序遍历" class="headerlink" title="中序遍历"></a>中序遍历</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    inOrder(root);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">inOrder</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    inOrder(node.left);</span><br><span class="line">    System.out.println(node);</span><br><span class="line">    inOrder(node.right);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>中序遍历的结果是元素从小到大排序。</p>
<h5 id="后序遍历"><a href="#后序遍历" class="headerlink" title="后序遍历"></a>后序遍历</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    postOrder(root);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">postOrder</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    postOrder(node.left);</span><br><span class="line">    postOrder(node.right);</span><br><span class="line">    System.out.println(node);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>后序遍历的一个应用是内存释放，我们必须先把左右孩子的内存释放完才能释放该节点的内存。</p>
<h5 id="前序遍历的非递归实现"><a href="#前序遍历的非递归实现" class="headerlink" title="前序遍历的非递归实现"></a>前序遍历的非递归实现</h5><center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr20.png"/>
</center>



<p>代码实现</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preOrderNR</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//非递归写法</span></span><br><span class="line">    <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//这里的Stack是上面自己写的Stack</span></span><br><span class="line">    Stack&lt;Node&gt; stack = <span class="keyword">new</span> ArrayStack&lt;&gt;();</span><br><span class="line">    stack.push(root);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">        Node top = stack.pop();</span><br><span class="line">        System.out.println(top);</span><br><span class="line">        <span class="keyword">if</span> (top.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">            stack.push(top.right);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (top.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">            stack.push(top.left);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="层序遍历"><a href="#层序遍历" class="headerlink" title="层序遍历"></a>层序遍历</h5><center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr21.png"/>
</center>



<p>代码实现</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">levelOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Queue&lt;Node&gt; queue = <span class="keyword">new</span> LoopQueue&lt;&gt;();</span><br><span class="line">    queue.enqueue(root);</span><br><span class="line">    <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">        Node front = queue.dequeue();</span><br><span class="line">        System.out.println(front);</span><br><span class="line">        <span class="keyword">if</span> (front.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">            queue.enqueue(front.left);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (front.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">            queue.enqueue(front.right);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="删除元素"><a href="#删除元素" class="headerlink" title="删除元素"></a>删除元素</h4><p>在二分搜索树中删除一个节点是比较复杂的，我们首先从最简单的情况开始，删除二分搜索树中的最小值和最大值，首先是如何找到最大值和最小值</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr22.png"/>
</center>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">minimum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"树为空"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> minimum(root).e;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">minimum</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (node.left == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> minimum(node.left);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">maximum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"树为空"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> maximum(root).e;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">maximum</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (node.right == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> maximum(node.right);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>找到了之后如何删除呢</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr23.png"/>
</center>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">removeMin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    E ret = minimum();</span><br><span class="line">    root = removeMin(root);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">removeMin</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (node.left == <span class="keyword">null</span>) &#123;</span><br><span class="line">        Node rightNode = node.right;</span><br><span class="line">        node.right = <span class="keyword">null</span>;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> rightNode;</span><br><span class="line">    &#125;</span><br><span class="line">    node.left = removeMin(node.left);</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">removeMax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    E ret = maximum();</span><br><span class="line">    root = removeMax(root);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">removeMax</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (node.right == <span class="keyword">null</span>) &#123;</span><br><span class="line">        Node leftNode = node.left;</span><br><span class="line">        node.left = <span class="keyword">null</span>;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> leftNode;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    node.right = removeMax(node.right);</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在讲解如何删除二分搜搜数中的任意一个节点</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr24.png"/>
</center>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    root = remove(root, e);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">remove</span><span class="params">(Node node, E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (e.equals(node.e)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (node.right == <span class="keyword">null</span>) &#123;</span><br><span class="line">            Node leftNode = node.left;</span><br><span class="line">            node.left = <span class="keyword">null</span>;</span><br><span class="line">            size--;</span><br><span class="line">            <span class="keyword">return</span> leftNode;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (node.left == <span class="keyword">null</span>) &#123;</span><br><span class="line">            Node rightNode = node.right;</span><br><span class="line">            node.right = <span class="keyword">null</span>;</span><br><span class="line">            size--;</span><br><span class="line">            <span class="keyword">return</span> rightNode;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Node successor = minimum(node.right);</span><br><span class="line">            successor.right = removeMin(node.right);<span class="comment">//为什么这条语句必须在前面???</span></span><br><span class="line">            successor.left = node.left;</span><br><span class="line">            node.left = node.right = <span class="keyword">null</span>;</span><br><span class="line">            <span class="comment">//size--; 在removeMin中已经维护size了</span></span><br><span class="line">            <span class="keyword">return</span> successor;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.compareTo(node.e) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        node.left = remove(node.left, e);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        node.right = remove(node.right, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面说的是取右子树中的最小值，你也可以考虑取左子树中的最大值，道理都是一样的。</p>
<h4 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BST</span>&lt;<span class="title">E</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">E</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> E e;</span><br><span class="line">        <span class="keyword">public</span> Node left;</span><br><span class="line">        <span class="keyword">public</span> Node right;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.e = e;</span><br><span class="line">            left = <span class="keyword">null</span>;</span><br><span class="line">            right = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> e.toString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根节点</span></span><br><span class="line">    <span class="keyword">private</span> Node root;</span><br><span class="line">    <span class="comment">//树中元素的个数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BST</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        root = <span class="keyword">null</span>;</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        root = add(root, e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">add</span><span class="params">(Node node, E e)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//这里返回语义指的的是node所代表的根节点</span></span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            size++;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Node(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (e.compareTo(node.e) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//如果比根节点小，对左子树进行更新</span></span><br><span class="line">            node.left = add(node.left, e);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.compareTo(node.e) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//如果比根节点大，对右子树进行更新</span></span><br><span class="line">            node.right = add(node.right,e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//等于的话什么都不做</span></span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> contains(root, e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Node node, E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (e.equals(node.e)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.compareTo(node.e) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> contains(node.left, e);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> contains(node.right,e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//前序遍历</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        preOrder(root);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">preOrder</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(node);</span><br><span class="line">        preOrder(node.left);</span><br><span class="line">        preOrder(node.right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preOrderNR</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//非递归写法</span></span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Stack&lt;Node&gt; stack = <span class="keyword">new</span> ArrayStack&lt;&gt;();</span><br><span class="line">        stack.push(root);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">            Node top = stack.pop();</span><br><span class="line">            System.out.println(top);</span><br><span class="line">            <span class="keyword">if</span> (top.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">                stack.push(top.right);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (top.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">                stack.push(top.left);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//中序遍历</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        inOrder(root);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">inOrder</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        inOrder(node.left);</span><br><span class="line">        System.out.println(node);</span><br><span class="line">        inOrder(node.right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//后序遍历</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        postOrder(root);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">postOrder</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        postOrder(node.left);</span><br><span class="line">        postOrder(node.right);</span><br><span class="line">        System.out.println(node);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">levelOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Queue&lt;Node&gt; queue = <span class="keyword">new</span> LoopQueue&lt;&gt;();</span><br><span class="line">        queue.enqueue(root);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">            Node front = queue.dequeue();</span><br><span class="line">            System.out.println(front);</span><br><span class="line">            <span class="keyword">if</span> (front.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">                queue.enqueue(front.left);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (front.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">                queue.enqueue(front.right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">minimum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"树为空"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> minimum(root).e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">minimum</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node.left == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> minimum(node.left);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">maximum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"树为空"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maximum(root).e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">maximum</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node.right == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maximum(node.right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">removeMin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        E ret = minimum();</span><br><span class="line">        root = removeMin(root);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">removeMin</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node.left == <span class="keyword">null</span>) &#123;</span><br><span class="line">            Node rightNode = node.right;</span><br><span class="line">            node.right = <span class="keyword">null</span>;</span><br><span class="line">            size--;</span><br><span class="line">            <span class="keyword">return</span> rightNode;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        node.left = removeMin(node.left);</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">removeMax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        E ret = maximum();</span><br><span class="line">        root = removeMax(root);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">removeMax</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node.right == <span class="keyword">null</span>) &#123;</span><br><span class="line">            Node leftNode = node.left;</span><br><span class="line">            node.left = <span class="keyword">null</span>;</span><br><span class="line">            size--;</span><br><span class="line">            <span class="keyword">return</span> leftNode;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        node.right = removeMax(node.right);</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        root = remove(root, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">remove</span><span class="params">(Node node, E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (e.equals(node.e)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (node.right == <span class="keyword">null</span>) &#123;</span><br><span class="line">                Node leftNode = node.left;</span><br><span class="line">                node.left = <span class="keyword">null</span>;</span><br><span class="line">                size--;</span><br><span class="line">                <span class="keyword">return</span> leftNode;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (node.left == <span class="keyword">null</span>) &#123;</span><br><span class="line">                Node rightNode = node.right;</span><br><span class="line">                node.right = <span class="keyword">null</span>;</span><br><span class="line">                size--;</span><br><span class="line">                <span class="keyword">return</span> rightNode;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Node successor = minimum(node.right);</span><br><span class="line">                successor.right = removeMin(node.right);<span class="comment">//为什么这条语句必须在前面???</span></span><br><span class="line">                successor.left = node.left;</span><br><span class="line">                node.left = node.right = <span class="keyword">null</span>;</span><br><span class="line">                <span class="comment">//size--; 在removeMin中已经维护size了</span></span><br><span class="line">                <span class="keyword">return</span> successor;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.compareTo(node.e) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            node.left = remove(node.left, e);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            node.right = remove(node.right, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="优先队列和堆"><a href="#优先队列和堆" class="headerlink" title="优先队列和堆"></a>优先队列和堆</h2><p>普通队列：先进先出，就像是我们在银行办业务或者是在超市买东西，但是考虑在医院，有病人有突发情况，这个时候容不得他去排队挂号了，这时他的优先级是比较高的，所以他需要得到优先的处理，像这种队列中的元素具有优先级的队列，我们把它称之为优先队列。在游戏中我们也会设置优先攻击血量最低的怪或者距离最近的怪，这时候血量和距离就成为了判断优先级的标准；在操作系统的任务调度，我们为程序分配 CPU，内存等等资源，并不是先到先得的，也是根据程序的优先级来进行分配的。</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr25.png"/>
</center>



<h3 id="堆的结构"><a href="#堆的结构" class="headerlink" title="堆的结构"></a>堆的结构</h3><p>这里的堆指的是二叉堆，它满足以下的性质</p>
<ul>
<li>二叉堆是一棵完全二叉树<ul>
<li>把元素顺序排列成树的形状</li>
</ul>
</li>
</ul>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr26.png"/>
</center>



<ul>
<li>堆中某个节点的值总是不大于其父亲节点的值(最大堆，相应也可以定义最小堆)</li>
</ul>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr27.png"/>
</center>



<p>如果我们使用数组去实现堆</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr28.png"/>
</center>



<p>上面的序号表示的是在数组中的下标，我们发现如果父节点的下标为 <code>i</code>，那么左孩子的下标就为 <code>2i + 1</code>，右孩子的下标为 <code>2i + 2</code>，所以可以很快的根据父节点的下标得到左右孩子的下标，如果知道左右孩子的下标 <code>i</code>，那么 <code>(i - 1)/2</code> 就可以得到父节点的下标(整数除法，小数部分会被舍去)。这个结论可以使用数学归纳法进行证明，但不是这里的重点，所以不多做阐述。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MaxHeap</span>&lt;<span class="title">E</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">E</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Array&lt;E&gt; data;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MaxHeap</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">        data = <span class="keyword">new</span> Array&lt;&gt;(capacity);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MaxHeap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        data = <span class="keyword">new</span> Array&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data.getSize();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//根据左右孩子的下标获得父亲节点的下标</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">parent</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (index - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//根据父节点的下标获得左孩子的下标</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">leftChild</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * index + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//根据父节点的下标获得右孩子的下标</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">rightChild</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * index + <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="堆的实现"><a href="#堆的实现" class="headerlink" title="堆的实现"></a>堆的实现</h3><h4 id="向堆中添加元素"><a href="#向堆中添加元素" class="headerlink" title="向堆中添加元素"></a>向堆中添加元素</h4><center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr29.png"/>
</center>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; <span class="number">0</span> || i &gt;= size() || j &lt; <span class="number">0</span> || j &gt;= size()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    E temp = data.get(i);</span><br><span class="line">    data.set(i, data.get(j));</span><br><span class="line">    data.set(j, temp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    data.addLast(e);</span><br><span class="line">    siftUp(data.getSize() - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">siftUp</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//index不是根节点(根节点不要上浮了) 并且孩子比父亲大</span></span><br><span class="line">    <span class="keyword">while</span> (index != <span class="number">0</span> &amp;&amp; data.get(index).compareTo(data.get(parent(index))) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        swap(index, parent(index));</span><br><span class="line">        index = parent(index);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="向堆中取出最大元素"><a href="#向堆中取出最大元素" class="headerlink" title="向堆中取出最大元素"></a>向堆中取出最大元素</h4><center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr30.png"/>
</center>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">findMax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"堆为空"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> data.get(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">extractMax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    E ret = findMax();</span><br><span class="line">    swap(<span class="number">0</span>,data.getSize() - <span class="number">1</span>);</span><br><span class="line">    data.removeLast();</span><br><span class="line">    siftDown(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">siftDown</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//没有孩子时，下沉结束</span></span><br><span class="line">    <span class="keyword">while</span> (leftChild(index) &lt; size()) &#123;</span><br><span class="line">        <span class="keyword">int</span> max = leftChild(index);</span><br><span class="line">        <span class="keyword">int</span> rightIndex = rightChild(index);</span><br><span class="line">        <span class="keyword">if</span> (rightIndex &lt; size()) &#123;</span><br><span class="line">            max = data.get(max).compareTo(data.get(rightIndex)) &gt; <span class="number">0</span> ? max : rightIndex;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//最大孩子比父节点小时，下沉结束</span></span><br><span class="line">        <span class="keyword">if</span> (data.get(max).compareTo(data.get(index)) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        swap(max,index);</span><br><span class="line">        index = max;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="replace"><a href="#replace" class="headerlink" title="replace"></a>replace</h4><p><code>replace</code> 操作指的是从堆中取出元素，并向堆中添加一个元素，实现的方法为</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr31.png"/>
</center>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//取出堆中的最大元素，并添加一个新元素e</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">replace</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    E ret = findMax();</span><br><span class="line">    data.set(<span class="number">0</span>,e);</span><br><span class="line">    siftDown(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="heapify"><a href="#heapify" class="headerlink" title="heapify"></a>heapify</h4><p><code>heapify</code> 是指将任意一个数组整理成堆的形状，</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr32.png"/>
</center>



<p>我们把这个方法做成一个构造函数</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">MaxHeap</span><span class="params">(E[] arr)</span> </span>&#123;</span><br><span class="line">    data = <span class="keyword">new</span> Array&lt;&gt;(arr.length);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">        data.addLast(arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = parent(data.getSize() -<span class="number">1</span>); i &gt;=<span class="number">0</span>; i--) &#123;</span><br><span class="line">        siftDown(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="完整代码-1"><a href="#完整代码-1" class="headerlink" title="完整代码"></a>完整代码</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MaxHeap</span>&lt;<span class="title">E</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">E</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Array&lt;E&gt; data;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MaxHeap</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">        data = <span class="keyword">new</span> Array&lt;&gt;(capacity);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MaxHeap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        data = <span class="keyword">new</span> Array&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MaxHeap</span><span class="params">(E[] arr)</span> </span>&#123;</span><br><span class="line">        data = <span class="keyword">new</span> Array&lt;&gt;(arr.length);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">            data.addLast(arr[i]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = parent(data.getSize() -<span class="number">1</span>); i &gt;=<span class="number">0</span>; i--) &#123;</span><br><span class="line">            siftDown(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data.getSize();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据左右孩子的下标获得父亲节点的下标</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">parent</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (index - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//根据父节点的下标获得左孩子的下标</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">leftChild</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * index + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//根据父节点的下标获得右孩子的下标</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">rightChild</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * index + <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="number">0</span> || i &gt;= size() || j &lt; <span class="number">0</span> || j &gt;= size()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        E temp = data.get(i);</span><br><span class="line">        data.set(i, data.get(j));</span><br><span class="line">        data.set(j, temp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        data.addLast(e);</span><br><span class="line">        siftUp(data.getSize() - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">siftUp</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//index不是根节点(根节点不要上浮了) 并且孩子比父亲大</span></span><br><span class="line">        <span class="keyword">while</span> (index != <span class="number">0</span> &amp;&amp; data.get(index).compareTo(data.get(parent(index))) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            swap(index, parent(index));</span><br><span class="line">            index = parent(index);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">findMax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"堆为空"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> data.get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">extractMax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        E ret = findMax();</span><br><span class="line">        swap(<span class="number">0</span>,data.getSize() - <span class="number">1</span>);</span><br><span class="line">        data.removeLast();</span><br><span class="line">        siftDown(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">siftDown</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//没有孩子时，下沉结束</span></span><br><span class="line">        <span class="keyword">while</span> (leftChild(index) &lt; size()) &#123;</span><br><span class="line">            <span class="keyword">int</span> max = leftChild(index);</span><br><span class="line">            <span class="keyword">int</span> rightIndex = rightChild(index);</span><br><span class="line">            <span class="keyword">if</span> (rightIndex &lt; size()) &#123;</span><br><span class="line">                max = data.get(max).compareTo(data.get(rightIndex)) &gt; <span class="number">0</span> ? max : rightIndex;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//最大孩子比父节点小时，下沉结束</span></span><br><span class="line">            <span class="keyword">if</span> (data.get(max).compareTo(data.get(index)) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            swap(max,index);</span><br><span class="line">            index = max;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//取出堆中的最大元素，并添加一个新元素e</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">replace</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        E ret = findMax();</span><br><span class="line"></span><br><span class="line">        data.set(<span class="number">0</span>,e);</span><br><span class="line">        siftDown(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="基于堆的优先队列"><a href="#基于堆的优先队列" class="headerlink" title="基于堆的优先队列"></a>基于堆的优先队列</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PriorityQueue</span>&lt;<span class="title">E</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">E</span>&gt;&gt; <span class="keyword">implements</span> <span class="title">Queue</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> MaxHeap&lt;E&gt; maxHeap;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PriorityQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        maxHeap = <span class="keyword">new</span> MaxHeap&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">enqueue</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        maxHeap.add(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">dequeue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> maxHeap.extractMax();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">getFront</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> maxHeap.findMax();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> maxHeap.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> maxHeap.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="线段树"><a href="#线段树" class="headerlink" title="线段树"></a>线段树</h2><p>对于有一类的问题，我们主要关心的是线段(区间)，比如说查询一个区间 <code>[i, j]</code> 内的最大值，最小值等等。假设你有一个网站，你想查询某年(或某年以后)的用户访问量，消费最多的用户等等，这些都是在某个区间内进行查询，一般线段树的区间是固定的，不包含删除和添加的操作，只有查询和更新的操作</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr33.png"/>
</center>



<h3 id="线段树的表示"><a href="#线段树的表示" class="headerlink" title="线段树的表示"></a>线段树的表示</h3><center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr34.png"/>
</center>



<p>现在如果假设有n个元素，用数组存储的话，需要多少空间呢</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr35.png"/>
</center>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SegmentTree</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> E[] tree;</span><br><span class="line">    <span class="keyword">private</span> E[] data;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SegmentTree</span><span class="params">(E[] arr)</span> </span>&#123;</span><br><span class="line">        data = (E[]) <span class="keyword">new</span> Object[arr.length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">            data[i] = arr[i];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        tree = (E[]) <span class="keyword">new</span> Object[<span class="number">4</span> * data.length];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data.length;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= data.length) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> data[index];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">leftChild</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * index + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">rightChild</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * index + <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实现-1"><a href="#实现-1" class="headerlink" title="实现"></a>实现</h3><h4 id="创建线段树"><a href="#创建线段树" class="headerlink" title="创建线段树"></a>创建线段树</h4><p>下面就要根据数组来创建一棵线段树，我们的方法先创建下面的子线段树，然后由这些子线段树合并成大的线段树，以此类推</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr36.png"/>
</center>



<p>在合并左右子树的过程中，我们不能写死合并的过程，具体怎么合并应该由业务决定，由用户去决定如何合并，所以合并的过程我们写一个接口，具体的实现由用户去实现</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Merger</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">merge</span><span class="params">(E a, E b)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后我们在构造方法中添加创建线段树的过程(为了创建线段树，增加了一个辅助方法)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> Merger&lt;E&gt; merger;</span><br><span class="line"><span class="comment">//merger由用户传入 用户决定如何合并</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">SegmentTree</span><span class="params">(E[] arr, Merger&lt;E&gt; merger)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.merger = merger;</span><br><span class="line">    </span><br><span class="line">    data = (E[]) <span class="keyword">new</span> Object[arr.length];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">        data[i] = arr[i];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    tree = (E[]) <span class="keyword">new</span> Object[<span class="number">4</span> * data.length];</span><br><span class="line">    <span class="comment">//构造线段树 创建根节点为0，范围为[0,data.length - 1]的线段树</span></span><br><span class="line">    buildSegmentTree(<span class="number">0</span>, <span class="number">0</span>, data.length - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//在treeIndex创建一棵[l,r]的线段树</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">buildSegmentTree</span><span class="params">(<span class="keyword">int</span> treeIndex, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">        tree[treeIndex] = data[l];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//l != r 那么就要创建子树的线段树</span></span><br><span class="line">    <span class="keyword">int</span> leftTreeIndex = leftChild(treeIndex);</span><br><span class="line">    <span class="keyword">int</span> rightTreeIndex = rightChild(treeIndex);</span><br><span class="line">    <span class="keyword">int</span> mid = l + (r - l) / <span class="number">2</span>; <span class="comment">//(l +r) / 2中l + r可能会大于int表示的范围从而溢出</span></span><br><span class="line">    buildSegmentTree(leftTreeIndex, l, mid);</span><br><span class="line">    buildSegmentTree(rightTreeIndex, mid + <span class="number">1</span>, r);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//融合的方法由用户传入</span></span><br><span class="line">    tree[treeIndex] = merger.merge(tree[leftTreeIndex],tree[rightTreeIndex]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为了方便我们打印出线段树，我们实现一个 <code>toString()</code> 方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    StringBuilder res = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    res.append(<span class="string">"["</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tree.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (tree[i] != <span class="keyword">null</span>) &#123;</span><br><span class="line">            res.append(tree[i]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.append(<span class="string">"null"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (i != tree.length - <span class="number">1</span>) &#123;</span><br><span class="line">            res.append(<span class="string">", "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    res.append(<span class="string">"]"</span>);</span><br><span class="line">    <span class="keyword">return</span> res.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h4><center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr37.png"/>
</center>



<p>实现代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">query</span><span class="params">(<span class="keyword">int</span> queryL, <span class="keyword">int</span> queryR)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (queryL &lt; <span class="number">0</span> || queryL &gt;= data.length</span><br><span class="line">            || queryR &lt; <span class="number">0</span> || queryR &gt;= data.length</span><br><span class="line">            || queryL &gt; queryR) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> query(<span class="number">0</span>, <span class="number">0</span>, data.length - <span class="number">1</span>, queryL, queryR);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> E <span class="title">query</span><span class="params">(<span class="keyword">int</span> treeIndex, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> queryL, <span class="keyword">int</span> queryR)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == queryL &amp;&amp; r == queryR) &#123;</span><br><span class="line">        <span class="keyword">return</span> tree[treeIndex];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> leftChildIndex = leftChild(treeIndex);</span><br><span class="line">    <span class="keyword">int</span> rightChildIndex = rightChild(treeIndex);</span><br><span class="line">    <span class="keyword">int</span> mid = l + (r - l) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (queryL &gt;= mid + <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> query(rightChildIndex, mid+<span class="number">1</span>, r, queryL, queryR);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (queryR &lt;= mid) &#123;</span><br><span class="line">        <span class="keyword">return</span> query(leftChildIndex, l, mid, queryL, queryR);</span><br><span class="line">    &#125;</span><br><span class="line">    E leftResult = query(leftChildIndex, l, mid, queryL, mid);</span><br><span class="line">    E rightResult = query(rightChildIndex, mid + <span class="number">1</span>, r, mid + <span class="number">1</span>, queryR);</span><br><span class="line">    <span class="keyword">return</span> merger.merge(leftResult, rightResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= data.length) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    set(<span class="number">0</span>, <span class="number">0</span>, data.length - <span class="number">1</span>, index, e);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> treeIndex, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> index, E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">        tree[treeIndex] = e;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> leftChildIndex = leftChild(treeIndex);</span><br><span class="line">    <span class="keyword">int</span> rightChildIndex = rightChild(treeIndex);</span><br><span class="line">    <span class="keyword">int</span> mid = l + (r - l) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (index &gt;= mid + <span class="number">1</span>) &#123;</span><br><span class="line">        set(rightChildIndex, mid+<span class="number">1</span>, r, index, e);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        set(leftChildIndex, l, mid, index, e);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    tree[treeIndex] = merger.merge(tree[leftChildIndex], tree[rightChildIndex]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="完整代码-2"><a href="#完整代码-2" class="headerlink" title="完整代码"></a>完整代码</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SegmentTree</span>&lt;<span class="title">E</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> E[] tree;</span><br><span class="line">    <span class="keyword">private</span> E[] data;</span><br><span class="line">    <span class="keyword">private</span> Merger&lt;E&gt; merger;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SegmentTree</span><span class="params">(E[] arr, Merger&lt;E&gt; merger)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.merger = merger;</span><br><span class="line"></span><br><span class="line">        data = (E[]) <span class="keyword">new</span> Object[arr.length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">            data[i] = arr[i];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        tree = (E[]) <span class="keyword">new</span> Object[<span class="number">4</span> * data.length];</span><br><span class="line">        buildSegmentTree(<span class="number">0</span>, <span class="number">0</span>, data.length - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//在treeIndex创建一棵[l,r]的线段树</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">buildSegmentTree</span><span class="params">(<span class="keyword">int</span> treeIndex, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">            tree[treeIndex] = data[l];</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> leftTreeIndex = leftChild(treeIndex);</span><br><span class="line">        <span class="keyword">int</span> rightTreeIndex = rightChild(treeIndex);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> mid = l + (r - l) / <span class="number">2</span>; <span class="comment">//(l +r) / 2中l + r可能会大于int表示的范围从而溢出</span></span><br><span class="line">        buildSegmentTree(leftTreeIndex, l, mid);</span><br><span class="line">        buildSegmentTree(rightTreeIndex, mid + <span class="number">1</span>, r);</span><br><span class="line"></span><br><span class="line">        tree[treeIndex] = merger.merge(tree[leftTreeIndex],tree[rightTreeIndex]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">query</span><span class="params">(<span class="keyword">int</span> queryL, <span class="keyword">int</span> queryR)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (queryL &lt; <span class="number">0</span> || queryL &gt;= data.length</span><br><span class="line">                || queryR &lt; <span class="number">0</span> || queryR &gt;= data.length</span><br><span class="line">                || queryL &gt; queryR) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> query(<span class="number">0</span>, <span class="number">0</span>, data.length - <span class="number">1</span>, queryL, queryR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> E <span class="title">query</span><span class="params">(<span class="keyword">int</span> treeIndex, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> queryL, <span class="keyword">int</span> queryR)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l == queryL &amp;&amp; r == queryR) &#123;</span><br><span class="line">            <span class="keyword">return</span> tree[treeIndex];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> leftChildIndex = leftChild(treeIndex);</span><br><span class="line">        <span class="keyword">int</span> rightChildIndex = rightChild(treeIndex);</span><br><span class="line">        <span class="keyword">int</span> mid = l + (r - l) / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (queryL &gt;= mid + <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> query(rightChildIndex, mid+<span class="number">1</span>, r, queryL, queryR);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (queryR &lt;= mid) &#123;</span><br><span class="line">            <span class="keyword">return</span> query(leftChildIndex, l, mid, queryL, queryR);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        E leftResult = query(leftChildIndex, l, mid, queryL, mid);</span><br><span class="line">        E rightResult = query(rightChildIndex, mid + <span class="number">1</span>, r, mid + <span class="number">1</span>, queryR);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> merger.merge(leftResult, rightResult);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= data.length) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        set(<span class="number">0</span>, <span class="number">0</span>, data.length - <span class="number">1</span>, index, e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> treeIndex, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> index, E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">            tree[treeIndex] = e;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> leftChildIndex = leftChild(treeIndex);</span><br><span class="line">        <span class="keyword">int</span> rightChildIndex = rightChild(treeIndex);</span><br><span class="line">        <span class="keyword">int</span> mid = l + (r - l) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (index &gt;= mid + <span class="number">1</span>) &#123;</span><br><span class="line">            set(rightChildIndex, mid+<span class="number">1</span>, r, index, e);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            set(leftChildIndex, l, mid, index, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        tree[treeIndex] = merger.merge(tree[leftChildIndex], tree[rightChildIndex]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data.length;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= data.length) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> data[index];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">leftChild</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * index + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">rightChild</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * index + <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuilder res = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        res.append(<span class="string">"["</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tree.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (tree[i] != <span class="keyword">null</span>) &#123;</span><br><span class="line">                res.append(tree[i]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                res.append(<span class="string">"null"</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (i != tree.length - <span class="number">1</span>) &#123;</span><br><span class="line">                res.append(<span class="string">", "</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        res.append(<span class="string">"]"</span>);</span><br><span class="line">        <span class="keyword">return</span> res.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Trie"><a href="#Trie" class="headerlink" title="Trie"></a>Trie</h2><p><code>Trie</code> 树又称为字典树、前缀树。如果我们使用一般树结构去查询一个数据集里的单词，它的复杂度是 <code>O(log n)</code>，但是如果我们使用 <code>Trie</code> 去查询单词的话，查询的复杂度只与单词的长度有关，与数据的规模无关。比如对于一个 $2^{20}$ 规模的数据集，我们去查一个单词 <code>&quot;word&quot;</code>，一般树的复杂度为 <code>O(20)</code>，而 <code>Trie</code> 树的复杂度为 <code>O(4)</code>，其中 4 是单词的长度，所以 <code>Trie</code> 树是一种很高效的查询字符串的树结构。</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr38.png"/>
</center>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> c;</span><br><span class="line">    Node next[<span class="number">26</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是这样考虑忽略了大小写，并且没有考虑一些特殊的字符，如 <code>@</code> 等符号或标点符号。所以我们每个节点不再是静态的指向 26 个节点，而是动态的指向若干个节点</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> c;</span><br><span class="line">    Map&lt;Character,Node&gt; next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>另外我们通过某个字符来到一个节点，可以通过 <code>Map</code>已经知道了，所以我们不必存储这个字符</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">    Map&lt;Character,Node&gt; next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr39.png"/>
</center>



<p>另外通过叶子节点是无法区别单词的结尾的，因为有的单词可能为某个单词的前缀，如 <code>&quot;pan&quot;</code> 为 <code>&quot;panda&quot;</code> 的前缀，所以我们要增加一个变量 <code>isWord</code> 来表示是否是单词的结尾</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.TreeMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Trie</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">boolean</span> isWord;</span><br><span class="line">        <span class="keyword">public</span> TreeMap&lt;Character,Node&gt; next;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(<span class="keyword">boolean</span> isWord)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.isWord = isWord;</span><br><span class="line">            next = <span class="keyword">new</span> TreeMap&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>(<span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node root;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Trie</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        root = <span class="keyword">new</span> Node();</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实现-2"><a href="#实现-2" class="headerlink" title="实现"></a>实现</h3><h4 id="添加单词"><a href="#添加单词" class="headerlink" title="添加单词"></a>添加单词</h4><center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr40.png"/>
</center>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String word)</span> </span>&#123;</span><br><span class="line">    Node cur = root;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; word.length(); i++) &#123;</span><br><span class="line">        <span class="keyword">char</span> c = word.charAt(i);</span><br><span class="line">        <span class="comment">//判断是否有指向这个字符的节点</span></span><br><span class="line">        <span class="keyword">if</span> (cur.next.get(c) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//没有则新建一个节点</span></span><br><span class="line">            cur.next.put(c, <span class="keyword">new</span> Node());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//移动到这个节点</span></span><br><span class="line">        cur = cur.next.get(c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//遍历完毕，判断这个节点是否被标记为单词的结尾 如果没有则标记并且维护size++</span></span><br><span class="line">    <span class="keyword">if</span> (!cur.isWord) &#123;</span><br><span class="line">        cur.isWord = <span class="keyword">true</span>;</span><br><span class="line">        size++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="查询单词"><a href="#查询单词" class="headerlink" title="查询单词"></a>查询单词</h4><p>查询单词的逻辑与添加单词的逻辑高度重复，如果在查询过程中遇到没有指向该字符的节点，则直接返回 <code>false</code>，如果遍历完毕都没有发生上面的情况，则判断该节点是否被标记为单词的结尾，如果没有则返回 <code>false</code>，否则返回 <code>true</code>。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(String word)</span> </span>&#123;</span><br><span class="line">    Node cur = root;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; word.length(); i++) &#123;</span><br><span class="line">        <span class="keyword">char</span> c = word.charAt(i);</span><br><span class="line">        <span class="keyword">if</span> (cur.next.get(c) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cur = cur.next.get(c);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> cur.isWord;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="前缀搜索"><a href="#前缀搜索" class="headerlink" title="前缀搜索"></a>前缀搜索</h4><p>查询是否包含某个前缀，与 <code>contains()</code> 方法几乎一样，不过最后不用判断是否是单词结尾，直接返回 <code>true</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPrefix</span><span class="params">(String prefix)</span> </span>&#123;</span><br><span class="line">    Node cur = root;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; prefix.length(); i++) &#123;</span><br><span class="line">        <span class="keyword">char</span> c = prefix.charAt(i);</span><br><span class="line">        <span class="keyword">if</span> (cur.next.get(c) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cur = cur.next.get(c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="简单字符匹配"><a href="#简单字符匹配" class="headerlink" title="简单字符匹配"></a>简单字符匹配</h3><p>对于字符串中的字符 <code>.</code> 规定它可以匹配任意的字符，那么这样的一个匹配算法如何写，如果我们遇到的字符不是 <code>.</code> 的话，逻辑和上面一样，如果遇到的是<code>.</code>的话，我们就要去搜索该节点中所有的分叉(子树)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">match</span><span class="params">(String word)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> match(root, word, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">match</span><span class="params">(Node node, String word, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//递归终止条件</span></span><br><span class="line">    <span class="keyword">if</span> (index == word.length()) &#123;</span><br><span class="line">        <span class="keyword">return</span> node.isWord;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">char</span> c = word.charAt(index);</span><br><span class="line">    <span class="comment">//如果不是.</span></span><br><span class="line">    <span class="keyword">if</span> (c != <span class="string">'.'</span>) &#123;</span><br><span class="line">        <span class="comment">//没有指向该字符的节点 返回false</span></span><br><span class="line">        <span class="keyword">if</span> (node.next.get(c) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//否则继续匹配</span></span><br><span class="line">            <span class="keyword">return</span> match(node.next.get(c), word, index + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//如果是. 去该节点的所有分叉中搜索</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">char</span> nextChar : node.next.keySet()) &#123;</span><br><span class="line">            <span class="comment">//如果有任一个分叉匹配到了，则返回true</span></span><br><span class="line">            <span class="keyword">if</span> (match(node.next.get(nextChar), word, index + <span class="number">1</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//说明上面的没有一个匹配成功了，返回fasle</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="全部代码-1"><a href="#全部代码-1" class="headerlink" title="全部代码"></a>全部代码</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.TreeMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Trie</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">boolean</span> isWord;</span><br><span class="line">        <span class="keyword">public</span> TreeMap&lt;Character,Node&gt; next;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(<span class="keyword">boolean</span> isWord)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.isWord = isWord;</span><br><span class="line">            next = <span class="keyword">new</span> TreeMap&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>(<span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node root;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Trie</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        root = <span class="keyword">new</span> Node();</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String word)</span> </span>&#123;</span><br><span class="line">        Node cur = root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; word.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">char</span> c = word.charAt(i);</span><br><span class="line">            <span class="keyword">if</span> (cur.next.get(c) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                cur.next.put(c, <span class="keyword">new</span> Node());</span><br><span class="line">            &#125;</span><br><span class="line">            cur = cur.next.get(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!cur.isWord) &#123;</span><br><span class="line">            cur.isWord = <span class="keyword">true</span>;</span><br><span class="line">            size++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(String word)</span> </span>&#123;</span><br><span class="line">        Node cur = root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; word.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">char</span> c = word.charAt(i);</span><br><span class="line">            <span class="keyword">if</span> (cur.next.get(c) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            cur = cur.next.get(c);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cur.isWord;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPrefix</span><span class="params">(String prefix)</span> </span>&#123;</span><br><span class="line">        Node cur = root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; prefix.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">char</span> c = prefix.charAt(i);</span><br><span class="line">            <span class="keyword">if</span> (cur.next.get(c) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            cur = cur.next.get(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">match</span><span class="params">(String word)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> match(root, word, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">match</span><span class="params">(Node node, String word, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//递归终止条件</span></span><br><span class="line">        <span class="keyword">if</span> (index == word.length()) &#123;</span><br><span class="line">            <span class="keyword">return</span> node.isWord;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">char</span> c = word.charAt(index);</span><br><span class="line">        <span class="keyword">if</span> (c != <span class="string">'.'</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (node.next.get(c) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> match(node.next.get(c), word, index + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">char</span> nextChar : node.next.keySet()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (match(node.next.get(nextChar), word, index + <span class="number">1</span>)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//说明上面的没有一个匹配成功了</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="并查集"><a href="#并查集" class="headerlink" title="并查集"></a>并查集</h2><p>我们之前遇到的树结构都是由父亲指向孩子，但是并查集不一样，它是由孩子指向父亲的一种结构，并查集结构可以非常高效的回答连接问题(Connectivity Problem)，它可以很快的判断网络中节点的连接状态。并查集主要支持两个动作</p>
<ul>
<li><code>union(p, q)</code><ul>
<li>将元素 <code>p, q</code> 连接起来</li>
</ul>
</li>
<li><code>isConnected(p, q)</code><ul>
<li>判断元素 <code>p, q</code> 是否是连接的，即是否所属一个集合</li>
</ul>
</li>
</ul>
<p>这里先给出并查集的接口，后面我们将实现多个版本的并查集</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UF</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isConnected</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unionElements</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Quick-Find"><a href="#Quick-Find" class="headerlink" title="Quick Find"></a>Quick Find</h3><center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr41.png"/>
</center>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//第一版的并查集</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnionFind1</span> <span class="keyword">implements</span> <span class="title">UF</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] id;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UnionFind1</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">        id = <span class="keyword">new</span> <span class="keyword">int</span>[size];</span><br><span class="line"></span><br><span class="line">        <span class="comment">//这时id全部为0，相当于在一个集合中 一开始应该全部不在一个集合中</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; id.length; i++) &#123;</span><br><span class="line">            id[i] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//找到元素p所属的集合</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (p &lt; <span class="number">0</span> || p &gt;= id.length) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> id[p];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isConnected</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> find(p) == find(q);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unionElements</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (find(p) == find(q)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; id.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (id[i] == find(p)) &#123;</span><br><span class="line">                id[i] = find(q);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Quick-Union"><a href="#Quick-Union" class="headerlink" title="Quick Union"></a>Quick Union</h3><center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr42.png"/>
</center>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//第二版的并查集</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnionFind2</span> <span class="keyword">implements</span> <span class="title">UF</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] parent;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UnionFind2</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">        parent = <span class="keyword">new</span> <span class="keyword">int</span>[size];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parent.length; i++) &#123;</span><br><span class="line">            parent[i] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> parent.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= parent.length) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (index != parent[index]) &#123;</span><br><span class="line">            index = parent[index];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isConnected</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> find(p) == find(q);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unionElements</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> pRoot = find(p);</span><br><span class="line">        <span class="keyword">int</span> qRoot = find(q);</span><br><span class="line">        <span class="keyword">if</span> (pRoot == qRoot) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            parent[pRoot] = parent[qRoot];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="基于rank的优化"><a href="#基于rank的优化" class="headerlink" title="基于rank的优化"></a>基于rank的优化</h3><center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr43.png"/>
</center>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//第三版的并查集</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnionFind3</span> <span class="keyword">implements</span> <span class="title">UF</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] parent;</span><br><span class="line">    <span class="comment">//记录根节点的高度</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] rank;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UnionFind3</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">        parent = <span class="keyword">new</span> <span class="keyword">int</span>[size];</span><br><span class="line">        rank = <span class="keyword">new</span> <span class="keyword">int</span>[size];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parent.length; i++) &#123;</span><br><span class="line">            parent[i] = i;</span><br><span class="line">            rank[i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> parent.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= parent.length) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (index != parent[index]) &#123;</span><br><span class="line">            index = parent[index];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isConnected</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> find(p) == find(q);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unionElements</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> pRoot = find(p);</span><br><span class="line">        <span class="keyword">int</span> qRoot = find(q);</span><br><span class="line">        <span class="keyword">if</span> (pRoot == qRoot) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (rank[pRoot] &lt;= rank[qRoot])&#123;</span><br><span class="line">            parent[pRoot] = parent[qRoot];</span><br><span class="line">            <span class="comment">//只要在两个数的高度相等的时候 树的高度才会增加</span></span><br><span class="line">            <span class="keyword">if</span> (rank[pRoot] == rank[qRoot]) &#123;</span><br><span class="line">                rank[qRoot]++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            parent[qRoot] = parent[pRoot];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="路径压缩"><a href="#路径压缩" class="headerlink" title="路径压缩"></a>路径压缩</h3><center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr44.png"/>
</center>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//第四版的并查集</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnionFind4</span> <span class="keyword">implements</span> <span class="title">UF</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] parent;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] rank;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UnionFind4</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">        parent = <span class="keyword">new</span> <span class="keyword">int</span>[size];</span><br><span class="line">        rank = <span class="keyword">new</span> <span class="keyword">int</span>[size];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parent.length; i++) &#123;</span><br><span class="line">            parent[i] = i;</span><br><span class="line">            rank[i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> parent.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= parent.length) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (index != parent[index]) &#123;</span><br><span class="line">            <span class="comment">//只添加了这一行代码</span></span><br><span class="line">            parent[index] = parent[parent[index]];</span><br><span class="line">            index = parent[index];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isConnected</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> find(p) == find(q);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unionElements</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> pRoot = find(p);</span><br><span class="line">        <span class="keyword">int</span> qRoot = find(q);</span><br><span class="line">        <span class="keyword">if</span> (pRoot == qRoot) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//这时rank不代表高度 因为在路径压缩时没有维护rank</span></span><br><span class="line">        <span class="comment">//但是整体上rank还是能够表示大小关系的</span></span><br><span class="line">        <span class="keyword">if</span> (rank[pRoot] &lt;= rank[qRoot])&#123;</span><br><span class="line">            parent[pRoot] = parent[qRoot];</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (rank[pRoot] == rank[qRoot]) &#123;</span><br><span class="line">                rank[qRoot]++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            parent[qRoot] = parent[pRoot];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr45.png"/>
</center>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//第五版的并查集</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnionFind5</span> <span class="keyword">implements</span> <span class="title">UF</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] parent;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] rank;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UnionFind5</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">        parent = <span class="keyword">new</span> <span class="keyword">int</span>[size];</span><br><span class="line">        rank = <span class="keyword">new</span> <span class="keyword">int</span>[size];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parent.length; i++) &#123;</span><br><span class="line">            parent[i] = i;</span><br><span class="line">            rank[i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> parent.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= parent.length) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//修改了这里</span></span><br><span class="line">        <span class="keyword">if</span> (index != parent[index]) &#123;</span><br><span class="line">            parent[index] = find(parent[index]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> parent[index];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isConnected</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> find(p) == find(q);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unionElements</span><span class="params">(<span class="keyword">int</span> p, <span class="keyword">int</span> q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> pRoot = find(p);</span><br><span class="line">        <span class="keyword">int</span> qRoot = find(q);</span><br><span class="line">        <span class="keyword">if</span> (pRoot == qRoot) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (rank[pRoot] &lt;= rank[qRoot])&#123;</span><br><span class="line">            parent[pRoot] = parent[qRoot];</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (rank[pRoot] == rank[qRoot]) &#123;</span><br><span class="line">                rank[qRoot]++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            parent[qRoot] = parent[pRoot];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第五版的效率不一定比第四版的好，因为第四版最后也可能做到”扁平化”，并且第五版的递归操作比较耗时。</p>
<h2 id="AVL树"><a href="#AVL树" class="headerlink" title="AVL树"></a>AVL树</h2><h3 id="概念及实现"><a href="#概念及实现" class="headerlink" title="概念及实现"></a>概念及实现</h3><p>我们在研究二分搜索树时发现，如果我们将数据顺序添加进树中时，它有会退化成一棵链表，即所有的元素都添加到一个孩子上，这样树结构的优势就体现不出来，为了不使左右孩子的高度相差太大，我们需要对树进行调整，使树达到平衡，成为一棵平衡二叉树，<code>AVL</code> 就是一种经典的平衡二叉树</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr46.png"/>
</center>



<p>在 <code>AVL</code> 中，我们定义的平衡二叉树为，对于任意一个节点，左子树和右子树的高度相差不能超过 1。</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr47.png"/>
</center>



<p>我们为每一个节点标注好高度值，计算方法为取左右子树高度较高的高度，然后 +1</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr48.png"/>
</center>



<p>然后我们还有记录节点左右子树的高度差，我们称之为平衡因子(规定用左子树的高度-右子树的高度)</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr49.png"/>
</center>



<p>由于我们只是在添加元素和删除元素时对树进行调整，其余的代码同二分搜索树是相同的，所以就不贴出所有的代码，只给出不同的代码，首先我们需要在 <code>Node</code> 类中添加一个 <code>height</code> 变量来记录高度</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> E e;</span><br><span class="line">    <span class="keyword">public</span> Node left;</span><br><span class="line">    <span class="keyword">public</span> Node right;</span><br><span class="line">    <span class="comment">//高度</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> height;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.e = e;</span><br><span class="line">        left = <span class="keyword">null</span>;</span><br><span class="line">        right = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">//高度初始为1</span></span><br><span class="line">        height = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> e.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>新增加一个获得某节点高度的函数和平衡因子的函数</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getHeight</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> node.height;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getBalanceFactor</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> getHeight(node.left) - getHeight(node.right);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有了这些因素，我们一般需要在添加元素时进行维护，重新计算高度和平衡因子，从而进行调整</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">add</span><span class="params">(Node node, E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Node(e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (e.compareTo(node.e) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        node.left = add(node.left, e);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.compareTo(node.e) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        node.right = add(node.right,e);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//更新高度</span></span><br><span class="line">    node.height = Math.max(getHeight(node.left),getHeight(node.right)) + <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//计算平衡因子</span></span><br><span class="line">    <span class="keyword">int</span> balanceFactor = getBalanceFactor(node);</span><br><span class="line">    <span class="keyword">if</span> (Math.abs(balanceFactor) &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">//进行调整</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们后面的内容主要是如何调整，后面所以只给出如何调整的代码，在学如何调整之前，我们来写两个辅助函数来判断这棵树是不是二分搜索树和 <code>AVL</code> 树，因为如果我们的代码有问题的话，有可能破坏二分搜索树的性质，这样有利于我们检查，那怎么检查一棵树是不是二分搜索树，我们根据二分搜索树的性质，它的中序遍历的结果是从小到大的特性，我们重写中序遍历为</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isBST</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ArrayList&lt;E&gt; arrayList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    inOrder(root, arrayList);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; arrayList.size(); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arrayList.get(i-<span class="number">1</span>).compareTo(arrayList.get(i)) &gt; <span class="number">0</span>) </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">inOrder</span><span class="params">(Node node, ArrayList&lt;E&gt; arrayList)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    inOrder(node.left, arrayList);</span><br><span class="line">    arrayList.add(node.e);</span><br><span class="line">    inOrder(node.right, arrayList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我们判断这棵树是不是平衡二叉树</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isBalanced</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> isBalanced(root);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//判断某个节点是不是平衡</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isBalanced</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> balanceFactor = getBalanceFactor(node);</span><br><span class="line">    <span class="keyword">if</span> (Math.abs(balanceFactor) &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> isBalanced(node.left) &amp;&amp; isBalanced(node.right);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面对不平衡的四种情形进行讨论，并给出调整方法</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr50.png"/>
</center>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 对节点y进行向右旋转操作，返回旋转后新的根节点x</span></span><br><span class="line"><span class="comment">//        y                              x</span></span><br><span class="line"><span class="comment">//       / \                           /   \</span></span><br><span class="line"><span class="comment">//      x   T4     向右旋转 (y)        z     y</span></span><br><span class="line"><span class="comment">//     / \       - - - - - - - -&gt;    / \   / \</span></span><br><span class="line"><span class="comment">//    z   T3                       T1  T2 T3 T4</span></span><br><span class="line"><span class="comment">//   / \</span></span><br><span class="line"><span class="comment">// T1   T2</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">rightRotate</span><span class="params">(Node y)</span> </span>&#123;</span><br><span class="line">    Node x = y.left;</span><br><span class="line">    Node T3 = x.right;</span><br><span class="line">    x.right = y;</span><br><span class="line">    y.left = T3;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//更新x和y的高度值 先更新y的，因为y是x的右孩子，x的更新取决于y</span></span><br><span class="line">    y.height = Math.max(getHeight(y.left), getHeight(y.right)) + <span class="number">1</span>;</span><br><span class="line">    x.height = Math.max(getHeight(x.left), getHeight(x.right)) + <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 对节点y进行向左旋转操作，返回旋转后新的根节点x</span></span><br><span class="line"><span class="comment">//    y                             x</span></span><br><span class="line"><span class="comment">//  /  \                          /   \</span></span><br><span class="line"><span class="comment">// T4   x      向左旋转 (y)       y     z</span></span><br><span class="line"><span class="comment">//     / \   - - - - - - - -&gt;   / \   / \</span></span><br><span class="line"><span class="comment">//   T3  z                     T4 T3 T1 T2</span></span><br><span class="line"><span class="comment">//      / \</span></span><br><span class="line"><span class="comment">//     T1 T2</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">leftRotate</span><span class="params">(Node y)</span> </span>&#123;</span><br><span class="line">    Node x = y.right;</span><br><span class="line">    Node T3 = x.left;</span><br><span class="line">    x.left = y;</span><br><span class="line">    y.right = T3;</span><br><span class="line">    </span><br><span class="line">    y.height = Math.max(getHeight(y.left), getHeight(y.right)) + <span class="number">1</span>;</span><br><span class="line">    x.height = Math.max(getHeight(x.left), getHeight(x.right)) + <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    root = add(root, e);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">add</span><span class="params">(Node node, E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Node(e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (e.compareTo(node.e) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        node.left = add(node.left, e);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.compareTo(node.e) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        node.right = add(node.right,e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//更新高度</span></span><br><span class="line">    node.height = Math.max(getHeight(node.left),getHeight(node.right)) + <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//计算平衡因子</span></span><br><span class="line">    <span class="keyword">int</span> balanceFactor = getBalanceFactor(node);</span><br><span class="line">    <span class="comment">//调整</span></span><br><span class="line">    <span class="keyword">if</span> (balanceFactor &gt; <span class="number">1</span> &amp;&amp; getBalanceFactor(node.left) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> rightRotate(node);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (balanceFactor &lt; -<span class="number">1</span> &amp;&amp; getBalanceFactor(node.right) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> leftRotate(node);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (balanceFactor &gt; <span class="number">1</span> &amp;&amp; getBalanceFactor(node.left) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        node.left = leftRotate(node.left);</span><br><span class="line">        <span class="keyword">return</span> rightRotate(node);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (balanceFactor &lt; -<span class="number">1</span> &amp;&amp; getBalanceFactor(node.right) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        node.right = rightRotate(node.right);</span><br><span class="line">        <span class="keyword">return</span> leftRotate(node);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    root = remove(root, e);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">remove</span><span class="params">(Node node, E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Node retNode;</span><br><span class="line">    <span class="keyword">if</span> (e.equals(node.e)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (node.right == <span class="keyword">null</span>) &#123;</span><br><span class="line">            Node leftNode = node.left;</span><br><span class="line">            node.left = <span class="keyword">null</span>;</span><br><span class="line">            size--;</span><br><span class="line">            retNode = leftNode;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (node.left == <span class="keyword">null</span>) &#123;</span><br><span class="line">            Node rightNode = node.right;</span><br><span class="line">            node.right = <span class="keyword">null</span>;</span><br><span class="line">            size--;</span><br><span class="line">            retNode = rightNode;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Node successor = minimum(node.right);</span><br><span class="line">            <span class="comment">////由于removeMin没有维持balance，所以我们复用remove</span></span><br><span class="line">            successor.right = remove(node.right,successor.e);</span><br><span class="line">            successor.left = node.left;</span><br><span class="line">            node.left = node.right = <span class="keyword">null</span>;</span><br><span class="line">            </span><br><span class="line">            retNode = successor;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.compareTo(node.e) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        node.left = remove(node.left, e);</span><br><span class="line">        retNode = node;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        node.right = remove(node.right, e);</span><br><span class="line">        retNode = node;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//否则retNode.height会有空指针异常</span></span><br><span class="line">    <span class="keyword">if</span> (retNode == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//更新高度</span></span><br><span class="line">    retNode.height = Math.max(getHeight(retNode.left),getHeight(retNode.right)) + <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//计算平衡因子</span></span><br><span class="line">    <span class="keyword">int</span> balanceFactor = getBalanceFactor(retNode);</span><br><span class="line">    <span class="keyword">if</span> (balanceFactor &gt; <span class="number">1</span> &amp;&amp; getBalanceFactor(retNode.left) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> rightRotate(retNode);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (balanceFactor &lt; -<span class="number">1</span> &amp;&amp; getBalanceFactor(retNode.right) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> leftRotate(retNode);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (balanceFactor &gt; <span class="number">1</span> &amp;&amp; getBalanceFactor(retNode.left) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        retNode.left = leftRotate(retNode.left);</span><br><span class="line">        <span class="keyword">return</span> rightRotate(retNode);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (balanceFactor &lt; -<span class="number">1</span> &amp;&amp; getBalanceFactor(retNode.right) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        retNode.right = rightRotate(retNode.right);</span><br><span class="line">        <span class="keyword">return</span> leftRotate(retNode);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> retNode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="完整代码-3"><a href="#完整代码-3" class="headerlink" title="完整代码"></a>完整代码</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AVLTree</span>&lt;<span class="title">E</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">E</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> E e;</span><br><span class="line">        <span class="keyword">public</span> Node left;</span><br><span class="line">        <span class="keyword">public</span> Node right;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">int</span> height;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.e = e;</span><br><span class="line">            left = <span class="keyword">null</span>;</span><br><span class="line">            right = <span class="keyword">null</span>;</span><br><span class="line">            height = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> e.toString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根节点</span></span><br><span class="line">    <span class="keyword">private</span> Node root;</span><br><span class="line">    <span class="comment">//树中元素的个数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AVLTree</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        root = <span class="keyword">null</span>;</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getHeight</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> node.height;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getBalanceFactor</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> getHeight(node.left) - getHeight(node.right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isBST</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ArrayList&lt;E&gt; arrayList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        inOrder(root, arrayList);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; arrayList.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (arrayList.get(i-<span class="number">1</span>).compareTo(arrayList.get(i)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">inOrder</span><span class="params">(Node node, ArrayList&lt;E&gt; arrayList)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        inOrder(node.left, arrayList);</span><br><span class="line">        arrayList.add(node.e);</span><br><span class="line">        inOrder(node.right, arrayList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isBalanced</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isBalanced(root);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//判断某个节点是不是平衡</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isBalanced</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> balanceFactor = getBalanceFactor(node);</span><br><span class="line">        <span class="keyword">if</span> (Math.abs(balanceFactor) &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> isBalanced(node.left) &amp;&amp; isBalanced(node.right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">rightRotate</span><span class="params">(Node y)</span> </span>&#123;</span><br><span class="line">        Node x = y.left;</span><br><span class="line">        Node T3 = x.right;</span><br><span class="line">        x.right = y;</span><br><span class="line">        y.left = T3;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//更新x和y的高度值 先更新y的，因为y是x的右孩子，x的更新取决于y</span></span><br><span class="line">        y.height = Math.max(getHeight(y.left), getHeight(y.right)) + <span class="number">1</span>;</span><br><span class="line">        x.height = Math.max(getHeight(x.left), getHeight(x.right)) + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">leftRotate</span><span class="params">(Node y)</span> </span>&#123;</span><br><span class="line">        Node x = y.right;</span><br><span class="line">        Node T3 = x.left;</span><br><span class="line">        x.left = y;</span><br><span class="line">        y.right = T3;</span><br><span class="line"></span><br><span class="line">        y.height = Math.max(getHeight(y.left), getHeight(y.right)) + <span class="number">1</span>;</span><br><span class="line">        x.height = Math.max(getHeight(x.left), getHeight(x.right)) + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        root = add(root, e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">add</span><span class="params">(Node node, E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            size++;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Node(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (e.compareTo(node.e) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            node.left = add(node.left, e);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.compareTo(node.e) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            node.right = add(node.right,e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//更新高度</span></span><br><span class="line">        node.height = Math.max(getHeight(node.left),getHeight(node.right)) + <span class="number">1</span>;</span><br><span class="line">        <span class="comment">//计算平衡因子</span></span><br><span class="line">        <span class="keyword">int</span> balanceFactor = getBalanceFactor(node);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (balanceFactor &gt; <span class="number">1</span> &amp;&amp; getBalanceFactor(node.left) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> rightRotate(node);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (balanceFactor &lt; -<span class="number">1</span> &amp;&amp; getBalanceFactor(node.right) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> leftRotate(node);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (balanceFactor &gt; <span class="number">1</span> &amp;&amp; getBalanceFactor(node.left) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            node.left = leftRotate(node.left);</span><br><span class="line">            <span class="keyword">return</span> rightRotate(node);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (balanceFactor &lt; -<span class="number">1</span> &amp;&amp; getBalanceFactor(node.right) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            node.right = rightRotate(node.right);</span><br><span class="line">            <span class="keyword">return</span> leftRotate(node);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> contains(root, e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Node node, E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (e.equals(node.e)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.compareTo(node.e) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> contains(node.left, e);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> contains(node.right,e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> E <span class="title">minimum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"树为空"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> minimum(root).e;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">minimum</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node.left == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> minimum(node.left);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        root = remove(root, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">remove</span><span class="params">(Node node, E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Node retNode;</span><br><span class="line">        <span class="keyword">if</span> (e.equals(node.e)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (node.right == <span class="keyword">null</span>) &#123;</span><br><span class="line">                Node leftNode = node.left;</span><br><span class="line">                node.left = <span class="keyword">null</span>;</span><br><span class="line">                size--;</span><br><span class="line">                retNode = leftNode;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (node.left == <span class="keyword">null</span>) &#123;</span><br><span class="line">                Node rightNode = node.right;</span><br><span class="line">                node.right = <span class="keyword">null</span>;</span><br><span class="line">                size--;</span><br><span class="line">                retNode = rightNode;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Node successor = minimum(node.right);</span><br><span class="line">                successor.right = remove(node.right,successor.e);<span class="comment">//由于removeMin没有维持balance，所以我们用remove</span></span><br><span class="line">                successor.left = node.left;</span><br><span class="line">                node.left = node.right = <span class="keyword">null</span>;</span><br><span class="line">                <span class="comment">//size--; 在removeMin中已经维护size了</span></span><br><span class="line">                retNode = successor;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.compareTo(node.e) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            node.left = remove(node.left, e);</span><br><span class="line">            retNode = node;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            node.right = remove(node.right, e);</span><br><span class="line">            retNode = node;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//否则retNode.height会有空指针异常</span></span><br><span class="line">        <span class="keyword">if</span> (retNode == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//更新高度</span></span><br><span class="line">        retNode.height = Math.max(getHeight(retNode.left),getHeight(retNode.right)) + <span class="number">1</span>;</span><br><span class="line">        <span class="comment">//计算平衡因子</span></span><br><span class="line">        <span class="keyword">int</span> balanceFactor = getBalanceFactor(retNode);</span><br><span class="line">        <span class="keyword">if</span> (balanceFactor &gt; <span class="number">1</span> &amp;&amp; getBalanceFactor(retNode.left) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> rightRotate(retNode);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (balanceFactor &lt; -<span class="number">1</span> &amp;&amp; getBalanceFactor(retNode.right) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> leftRotate(retNode);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (balanceFactor &gt; <span class="number">1</span> &amp;&amp; getBalanceFactor(retNode.left) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            retNode.left = leftRotate(retNode.left);</span><br><span class="line">            <span class="keyword">return</span> rightRotate(retNode);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (balanceFactor &lt; -<span class="number">1</span> &amp;&amp; getBalanceFactor(retNode.right) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            retNode.right = rightRotate(retNode.right);</span><br><span class="line">            <span class="keyword">return</span> leftRotate(retNode);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> retNode;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="红黑树"><a href="#红黑树" class="headerlink" title="红黑树"></a>红黑树</h2><h3 id="2-3树"><a href="#2-3树" class="headerlink" title="2-3树"></a>2-3树</h3><p>2-3树的节点它可以有一个元素，也可以有两个元素，它也满足二分搜索树的性质</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr51.png"/>
</center>



<p>我们把含有两个孩子的节点称为 2 节点，含有 3 个孩子的节点称为 3 节点</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr52.png"/>
</center>


<p><code>2-3</code> 树是一种绝对平衡的树，所谓绝对平衡的树指的是从根节点到任意一个叶子节点，所经过的节点是都是相同的。那么 <code>2-3</code> 树是怎么做到的呢? </p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr53.png"/>
</center>



<h3 id="红黑树与2-3树的等价性"><a href="#红黑树与2-3树的等价性" class="headerlink" title="红黑树与2-3树的等价性"></a>红黑树与2-3树的等价性</h3><p>由于我们一般每个节点都是表示一个数据的，<code>2-3</code> 树有点难以实现，所以有人发明一种树叫做红黑树，它可以说是 <code>2-3</code> 树的等价，那么它树如何等价的呢?</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr54.png"/>
</center>



<p>上图想必很清楚的描述了等价的过程</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr55.png"/>
</center>



<p>现在我们来实现一下上面描述的红黑树，大部分的代码都是和二分搜索树是重合的，只是在添加时有调整，另外这里我们不牵涉到从红黑树中删除元素，因为太复杂了(其实是我不会)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedBlackTree</span>&lt;<span class="title">E</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">E</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//规定红色为true 黑色为false</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">boolean</span> RED = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">boolean</span> BLACK = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> E e;</span><br><span class="line">        <span class="keyword">public</span> Node left;</span><br><span class="line">        <span class="keyword">public</span> Node right;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">boolean</span> color;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.e = e;</span><br><span class="line">            left = <span class="keyword">null</span>;</span><br><span class="line">            right = <span class="keyword">null</span>;</span><br><span class="line">            <span class="comment">//我们在2-3树中添加节点时 永远是和别的节点融合 所以默认为红色</span></span><br><span class="line">            color = RED;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> e.toString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node root;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RedBlackTree</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        root = <span class="keyword">null</span>;</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        root = add(root, e);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// 判断节点node的颜色</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isRed</span><span class="params">(Node node)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(node == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> BLACK;</span><br><span class="line">        <span class="keyword">return</span> node.color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">add</span><span class="params">(Node node, E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            size++;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Node(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (e.compareTo(node.e) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            node.left = add(node.left, e);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.compareTo(node.e) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            node.right = add(node.right,e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> contains(root, e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Node node, E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (e.equals(node.e)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.compareTo(node.e) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> contains(node.left, e);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> contains(node.right,e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="红黑树的性质"><a href="#红黑树的性质" class="headerlink" title="红黑树的性质"></a>红黑树的性质</h3><p>在了解了红黑树与 <code>2-3</code> 等价以后，我们来看红黑树满足哪些性质</p>
<ul>
<li>每个节点或者是红色的，或者的是黑色的</li>
<li>根节点是黑色的</li>
</ul>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr56.png"/>
</center>



<ul>
<li>每一个叶子节点(最后的空节点是黑色的)<ul>
<li>因为红色节点只存在于 3 节点中，而所有的叶子节点都是 2 节点</li>
</ul>
</li>
<li>如果一个节点是红色的，那么它的所有孩子节点都是黑色的</li>
</ul>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr57.png"/>
</center>



<ul>
<li>从任意一个节点到黑色节点，经过的黑色节点是一样的<ul>
<li>因为 <code>2-3</code> 树到所有叶子节点的距离都是一样的，而经过的节点，不管是 2 节点还是 3 节点，都包括一个黑色节点，所以经过的黑色节点是一样的</li>
</ul>
</li>
</ul>
<h3 id="向红黑树中添加元素"><a href="#向红黑树中添加元素" class="headerlink" title="向红黑树中添加元素"></a>向红黑树中添加元素</h3><p>因为根节点是黑色的，所以我们在添加完元素后需要将根节点变为黑色</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    root = add(root, e);</span><br><span class="line">    </span><br><span class="line">    root.color = BLACK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在添加元素到红黑树中时，可能会破坏红黑树的规则，这时就需要红黑树进行自我调整，我们就来看一下添加过程会碰到的所有情形，以及处理方法</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr58.png"/>
</center>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//   node                     x</span></span><br><span class="line"><span class="comment">//  /   \     左旋转         /  \</span></span><br><span class="line"><span class="comment">// T1   x   ---------&gt;   node   T3</span></span><br><span class="line"><span class="comment">//     / \              /   \</span></span><br><span class="line"><span class="comment">//    T2 T3            T1   T2</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">leftRotate</span><span class="params">(Node node)</span></span>&#123;</span><br><span class="line">    Node x = node.right;</span><br><span class="line">    <span class="comment">// 左旋转</span></span><br><span class="line">    node.right = x.left;</span><br><span class="line">    x.left = node;</span><br><span class="line">    x.color = node.color;</span><br><span class="line">    node.color = RED;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr63.png"/>
</center>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 颜色翻转</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">flipColors</span><span class="params">(Node node)</span></span>&#123;</span><br><span class="line">    node.color = RED;</span><br><span class="line">    node.left.color = BLACK;</span><br><span class="line">    node.right.color = BLACK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr64.png"/>
</center>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//     node                   x</span></span><br><span class="line"><span class="comment">//    /   \     右旋转       /  \</span></span><br><span class="line"><span class="comment">//   x    T2   -------&gt;   y   node</span></span><br><span class="line"><span class="comment">//  / \                       /  \</span></span><br><span class="line"><span class="comment">// y  T1                     T1  T2</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">rightRotate</span><span class="params">(Node node)</span></span>&#123;</span><br><span class="line">    Node x = node.left;</span><br><span class="line">    <span class="comment">// 右旋转</span></span><br><span class="line">    node.left = x.right;</span><br><span class="line">    x.right = node;</span><br><span class="line">    x.color = node.color;</span><br><span class="line">    node.color = RED;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr65.png"/>
</center>



<p>对上面的情况进行总结</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr62.png"/>
</center>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">add</span><span class="params">(Node node, E e)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Node(e);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (e.compareTo(node.e) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        node.left = add(node.left, e);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.compareTo(node.e) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        node.right = add(node.right,e);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (isRed(node.right) &amp;&amp; !isRed(node.left))</span><br><span class="line">        node = leftRotate(node);</span><br><span class="line">    <span class="keyword">if</span> (isRed(node.left) &amp;&amp; isRed(node.left.left))</span><br><span class="line">        node = rightRotate(node);</span><br><span class="line">    <span class="keyword">if</span> (isRed(node.left) &amp;&amp; isRed(node.right))</span><br><span class="line">        flipColors(node);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="完整代码-4"><a href="#完整代码-4" class="headerlink" title="完整代码"></a>完整代码</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedBlackTree</span>&lt;<span class="title">E</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">E</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//规定红色为true 黑色为false</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">boolean</span> RED = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">boolean</span> BLACK = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> E e;</span><br><span class="line">        <span class="keyword">public</span> Node left;</span><br><span class="line">        <span class="keyword">public</span> Node right;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">boolean</span> color;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.e = e;</span><br><span class="line">            left = <span class="keyword">null</span>;</span><br><span class="line">            right = <span class="keyword">null</span>;</span><br><span class="line">            <span class="comment">//我们在2-3树中添加节点时 永远是和别的节点融合 所以默认为红色</span></span><br><span class="line">            color = RED;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> e.toString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Node root;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RedBlackTree</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        root = <span class="keyword">null</span>;</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isRed</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> BLACK;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> node.color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//   node                     x</span></span><br><span class="line">    <span class="comment">//  /   \     左旋转         /  \</span></span><br><span class="line">    <span class="comment">// T1   x   ---------&gt;   node   T3</span></span><br><span class="line">    <span class="comment">//     / \              /   \</span></span><br><span class="line">    <span class="comment">//    T2 T3            T1   T2</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">leftRotate</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        Node x = node.right;</span><br><span class="line">        node.right = x.left;</span><br><span class="line">        x.left = node;</span><br><span class="line"></span><br><span class="line">        x.color = node.color;</span><br><span class="line">        node.color = RED;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//     node                   x</span></span><br><span class="line">    <span class="comment">//    /   \     右旋转       /  \</span></span><br><span class="line">    <span class="comment">//   x    T2   -------&gt;   y   node</span></span><br><span class="line">    <span class="comment">//  / \                       /  \</span></span><br><span class="line">    <span class="comment">// y  T1                     T1  T2</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">rightRotate</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        Node x = node.left;</span><br><span class="line">        node.left = x.right;</span><br><span class="line">        x.right = node;</span><br><span class="line"></span><br><span class="line">        x.color = node.color;</span><br><span class="line">        node.color = RED;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">flipColors</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        node.color = RED;</span><br><span class="line">        node.left.color = BLACK;</span><br><span class="line">        node.right.color = BLACK;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        root = add(root, e);</span><br><span class="line"></span><br><span class="line">        root.color = BLACK;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">add</span><span class="params">(Node node, E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            size++;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Node(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (e.compareTo(node.e) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            node.left = add(node.left, e);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.compareTo(node.e) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            node.right = add(node.right,e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isRed(node.right) &amp;&amp; !isRed(node.left))</span><br><span class="line">            node = leftRotate(node);</span><br><span class="line">        <span class="keyword">if</span> (isRed(node.left) &amp;&amp; isRed(node.left.left))</span><br><span class="line">            node = rightRotate(node);</span><br><span class="line">        <span class="keyword">if</span> (isRed(node.left) &amp;&amp; isRed(node.right))</span><br><span class="line">            flipColors(node);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> contains(root, e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Node node, E e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (e.equals(node.e)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.compareTo(node.e) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> contains(node.left, e);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> contains(node.right,e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="哈希表"><a href="#哈希表" class="headerlink" title="哈希表"></a>哈希表</h2><p>我们通过将我们要查找的某种数据类型转化为一个索引 <code>index</code>，然后通过索引去数组中查找，这时它的复杂度就是 <code>O(1)</code> 级别的。而将某个数据类型转化为索引的函数我们就称为是哈希函数，比如说将 26 个小写字母转化为索引，我们可以这么写</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">index = ch - <span class="string">'a'</span>;</span><br></pre></td></tr></table></figure>

<p>这样就建立起了一一对应的关系，但是并不是所有的对应关系都是一一对应的，因为数组的容量是有限的，而输入的范围可能是无穷的，所以很有可能不同的键对应着同一个索引，比如说键是字符串，因为字符串的组合方式是非常的多，可以看做是无穷的，我们不可能去开辟一个无穷的空间去与这些字符串一一对应，所以不同的字符串生成的索引很有可能会有冲突，我们称这种情况为哈希冲突。由于上面讲到的哈希冲突，所以我们要设计好哈希函数(<code>hashCode()</code>)使得发生哈希冲突的可能性小，即使哈希函数产生的哈希值均匀的分布在数组中。</p>
<h3 id="哈希函数的设计"><a href="#哈希函数的设计" class="headerlink" title="哈希函数的设计"></a>哈希函数的设计</h3><p>哈希函数应该满足上面提到的：哈希函数产生的哈希值均匀的分布在数组中。数据的类型五花八门，对于特殊的领域有特殊领域的哈希函数的设计方式，甚至还有专门的论文，说这么多就是想说哈希函数的设计十分的复杂，在这里我们只提最简单的一种，哈希函数的设计应该满足</p>
<ul>
<li>一致性<ul>
<li>如果 <code>a == b</code>，那么 <code>hashCode(a) == hashCode(b)</code></li>
</ul>
</li>
<li>高效性<ul>
<li>计算迅速</li>
</ul>
</li>
<li>均匀性<ul>
<li>输出尽可能均匀</li>
</ul>
</li>
</ul>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr66.png"/>
</center>



<p>由于 <code>Java</code> 中基本数据类型和字符串类型有默认的 <code>hashCode()</code> 计算，所以我们就用 <code>Java</code> 自带的 <code>hashCode</code> 计算基本数据类型和字符串的哈希值，而对于引用类型 <code>Java</code> 是根据地址计算的哈希值，所以可能会出现问题，需要我们自己自定义规则，比如对于一个 <code>Student</code> 类，我们规定学号以及姓名相同(不区分大小写)就是同一个学生，所以根据一致性原则，它们应该产生相同的哈希值，但是由于 <code>Java</code> 默认是根据地址产生哈希值，由于二者的地址是不同的，所以产生的哈希值有极大的概率是不同的，所以我们需要自己创建哈希函数。</p>
<h3 id="链地址法"><a href="#链地址法" class="headerlink" title="链地址法"></a>链地址法</h3><p>现在我们来演示往哈希表中添加元素的步骤</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr67.png"/>
</center>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.TreeMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashTable</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//数组中存储的是TreeMap这种查找表</span></span><br><span class="line">    <span class="keyword">private</span> TreeMap&lt;K, V&gt;[] hashTable;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> M;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashTable</span><span class="params">(<span class="keyword">int</span> M)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.M = M;</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">        hashTable = <span class="keyword">new</span> TreeMap[M];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; hashTable.length; i++) &#123;</span><br><span class="line">            hashTable[i] = <span class="keyword">new</span> TreeMap&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashTable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="number">97</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//得到在数组中的索引</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(K key)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//与0x7fffffff是为了消除负数</span></span><br><span class="line">        <span class="keyword">return</span> (key.hashCode() &amp; <span class="number">0x7fffffff</span>) % M;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        TreeMap&lt;K, V&gt; map = hashTable[hash(key)];</span><br><span class="line">        <span class="comment">//先查看已经是否有这个键了</span></span><br><span class="line">        <span class="keyword">if</span> (map.containsKey(key)) &#123;</span><br><span class="line">            <span class="comment">//有则更新</span></span><br><span class="line">            map.put(key, value);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//没有则进行添加，并维护size</span></span><br><span class="line">            map.put(key, value);</span><br><span class="line">            size++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">remove</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        V ret = <span class="keyword">null</span>;</span><br><span class="line">        TreeMap&lt;K, V&gt; map = hashTable[hash(key)];</span><br><span class="line">        <span class="comment">//如果包含键则删除，没有返回null</span></span><br><span class="line">        <span class="keyword">if</span> (map.containsKey(key)) &#123;</span><br><span class="line">            ret = map.remove(key);</span><br><span class="line">            size--;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        TreeMap&lt;K, V&gt; map = hashTable[hash(key)];</span><br><span class="line">        <span class="comment">//没有该键抛出异常</span></span><br><span class="line">        <span class="keyword">if</span> (!map.containsKey(key)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"键不存在"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        map.put(key,value);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//直接得到相应的TreeMap，然后去查，TreeMap有检查步骤</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(K key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> hashTable[hash(key)].get(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/datastr68.png"/>
</center>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.TreeMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashTable</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> upperTol = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> lowerTol = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> initCapacity = <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//数组中存储的是TreeMap这种查找表</span></span><br><span class="line">    <span class="keyword">private</span> TreeMap&lt;K, V&gt;[] hashTable;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> M;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashTable</span><span class="params">(<span class="keyword">int</span> M)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//只显示改变的内容</span></span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        hashTable = <span class="keyword">new</span> TreeMap[initCapacity];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (size &gt;= upperTol * M) &#123;</span><br><span class="line">            resize(<span class="number">2</span> * M);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">remove</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (size &lt; M * lowerTol &amp;&amp; M / <span class="number">2</span> &gt;= initCapacity) &#123;</span><br><span class="line">            resize(M / <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">resize</span><span class="params">(<span class="keyword">int</span> newM)</span> </span>&#123;</span><br><span class="line">        TreeMap&lt;K,V&gt;[] newHashTable = <span class="keyword">new</span> TreeMap[newM];</span><br><span class="line"></span><br><span class="line">        <span class="comment">//后面要更新M，但是还需要旧M遍历数组</span></span><br><span class="line">        <span class="keyword">int</span> oldM = M;</span><br><span class="line">        <span class="comment">//由于后面要重新计算下标，所以这里要更新M</span></span><br><span class="line">        M = newM;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; oldM; i++) &#123;</span><br><span class="line">            TreeMap&lt;K, V&gt; map = hashTable[i];</span><br><span class="line">            <span class="keyword">for</span> (K key: map.keySet()) &#123;</span><br><span class="line">                <span class="comment">//重新计算下标并赋值</span></span><br><span class="line">                newHashTable[hash(key)].put(key, map.get(key));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        hashTable = newHashTable;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是我们发现每次我们都扩容为 <code>2 \* M</code>，这时 <code>M</code> 就不是一个素数了，为了解决这一个问题，我们准备一个素数表，让 <code>M</code> 取素数表中的值，每次扩容 <code>M</code> 在素数表中的索引 <code>+1</code>，缩容 <code>-1</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.TreeMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashTable</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//素数表</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span>[] capacity = &#123;&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> upperTol = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> lowerTol = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">int</span> capacityIndex = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//数组中存储的是TreeMap这种查找表</span></span><br><span class="line">    <span class="keyword">private</span> TreeMap&lt;K, V&gt;[] hashTable;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> M;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashTable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.M = capacity[capacityIndex];</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">        hashTable = <span class="keyword">new</span> TreeMap[M];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; hashTable.length; i++) &#123;</span><br><span class="line">            hashTable[i] = <span class="keyword">new</span> TreeMap&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        <span class="keyword">if</span> (size &gt;= upperTol * M &amp;&amp; capacityIndex + <span class="number">1</span> &lt; size) &#123;</span><br><span class="line">            capacityIndex++;</span><br><span class="line">            resize(capacity[capacityIndex]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">remove</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (size &lt; M * lowerTol &amp;&amp; capacityIndex - <span class="number">1</span> &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            capacityIndex--;</span><br><span class="line">            resize(capacity[capacityIndex]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="完整代码-5"><a href="#完整代码-5" class="headerlink" title="完整代码"></a>完整代码</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.TreeMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashTable</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span>[] capacity = &#123;&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> upperTol = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> lowerTol = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">int</span> capacityIndex = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//数组中存储的是TreeMap这种查找表</span></span><br><span class="line">    <span class="keyword">private</span> TreeMap&lt;K, V&gt;[] hashTable;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> M;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashTable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.M = capacity[capacityIndex];</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">        hashTable = <span class="keyword">new</span> TreeMap[M];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; hashTable.length; i++) &#123;</span><br><span class="line">            hashTable[i] = <span class="keyword">new</span> TreeMap&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//得到在数组中的索引</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(K key)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//与0x7fffffff是为了消除负数</span></span><br><span class="line">        <span class="keyword">return</span> (key.hashCode() &amp; <span class="number">0x7fffffff</span>) % M;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        TreeMap&lt;K, V&gt; map = hashTable[hash(key)];</span><br><span class="line">        <span class="comment">//先查看已经是否有这个键了</span></span><br><span class="line">        <span class="keyword">if</span> (map.containsKey(key)) &#123;</span><br><span class="line">            <span class="comment">//有则更新</span></span><br><span class="line">            map.put(key, value);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//没有则进行添加，并维护size</span></span><br><span class="line">            map.put(key, value);</span><br><span class="line">            size++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (size &gt;= upperTol * M &amp;&amp; capacityIndex + <span class="number">1</span> &lt; capacity.length) &#123;</span><br><span class="line">            capacityIndex++;</span><br><span class="line">            resize(capacity[capacityIndex]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">remove</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        V ret = <span class="keyword">null</span>;</span><br><span class="line">        TreeMap&lt;K, V&gt; map = hashTable[hash(key)];</span><br><span class="line">        <span class="comment">//如果包含键则删除，没有返回null</span></span><br><span class="line">        <span class="keyword">if</span> (map.containsKey(key)) &#123;</span><br><span class="line">            ret = map.remove(key);</span><br><span class="line">            size--;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (size &lt; M * lowerTol &amp;&amp; capacityIndex - <span class="number">1</span> &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            capacityIndex--;</span><br><span class="line">            resize(capacity[capacityIndex]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        TreeMap&lt;K, V&gt; map = hashTable[hash(key)];</span><br><span class="line">        <span class="comment">//没有该键抛出异常</span></span><br><span class="line">        <span class="keyword">if</span> (!map.containsKey(key)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"键不存在"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        map.put(key,value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//直接得到相应的TreeMap，然后去查，TreeMap有检查步骤</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(K key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> hashTable[hash(key)].get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">resize</span><span class="params">(<span class="keyword">int</span> newM)</span> </span>&#123;</span><br><span class="line">        TreeMap&lt;K,V&gt;[] newHashTable = <span class="keyword">new</span> TreeMap[newM];</span><br><span class="line"></span><br><span class="line">        <span class="comment">//后面要更新M，但是还需要旧M遍历数组</span></span><br><span class="line">        <span class="keyword">int</span> oldM = M;</span><br><span class="line">        <span class="comment">//由于后面要重新计算下标，所以这里要更新M</span></span><br><span class="line">        M = newM;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; oldM; i++) &#123;</span><br><span class="line">            TreeMap&lt;K, V&gt; map = hashTable[i];</span><br><span class="line">            <span class="keyword">for</span> (K key: map.keySet()) &#123;</span><br><span class="line">                <span class="comment">//重新计算下标并赋值</span></span><br><span class="line">                newHashTable[hash(key)].put(key, map.get(key));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        hashTable = newHashTable;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li><a href="https://coding.imooc.com/class/chapter/207.html" target="_blank" rel="noopener">玩转数据结构</a></li>
</ul>

    

        <a href="https://lastknightcoder.gitee.io/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84--Java%E6%8F%8F%E8%BF%B0/" class="post-more waves-effect waves-button">
            阅读全文…
        </a>
    </div>
    
</article>

        </li>
    
        <li class="post-list-item fade">
            <article id="post-Ajax跨域"
  class="article-card article-type-post" itemprop="blogPost">

    <div class="post-meta">
        <time class="post-time" title="2020-04-22 00:00:00" datetime="2020-04-21T16:00:00.000Z"  itemprop="datePublished">2020-04-22</time>

        
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="https://lastknightcoder.gitee.io/categories/Web/">Web</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="https://lastknightcoder.gitee.io/categories/Web/JavaScript/">JavaScript</a></li></ul></li></ul>



    </div>

    


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="https://lastknightcoder.gitee.io/Ajax%E8%B7%A8%E5%9F%9F/">Ajax跨域</a>
    </h3>
  




    <div class="post-content" id="post-content" itemprop="postContent">

    
        <h2 id="同源策略"><a href="#同源策略" class="headerlink" title="同源策略"></a>同源策略</h2><p>什么是同源策略：同 <code>domain</code>(或<code>IP</code>)，同端口，同协议视为同一个域，一个域内的脚本仅仅具有本域内的权限，可以理解为本域脚本只能读写本域内的资源，而无法访问其它域的资源，这种安全限制称为同源策略。我们看几个例子判断两个链接是否是同源</p>
<table>
<thead>
<tr>
<th><code>url1</code></th>
<th><code>url2</code></th>
<th>是否同源</th>
<th>原因</th>
</tr>
</thead>
<tbody><tr>
<td><a href="http://example.com:8080" target="_blank" rel="noopener">http://example.com:8080</a></td>
<td><a href="http://example.com:80" target="_blank" rel="noopener">http://example.com:80</a></td>
<td>否</td>
<td>端口不同</td>
</tr>
<tr>
<td><a href="http://example.com:8080" target="_blank" rel="noopener">http://example.com:8080</a></td>
<td><a href="https://example.com:8080" target="_blank" rel="noopener">https://example.com:8080</a></td>
<td>否</td>
<td>协议不同</td>
</tr>
<tr>
<td><a href="http://www.baidu.com" target="_blank" rel="noopener">http://www.baidu.com</a></td>
<td><a href="http://www.taobao.com" target="_blank" rel="noopener">http://www.taobao.com</a></td>
<td>否</td>
<td>域名不同</td>
</tr>
<tr>
<td><a href="http://127.0.0.1:8080" target="_blank" rel="noopener">http://127.0.0.1:8080</a></td>
<td><a href="http://localhost:8080" target="_blank" rel="noopener">http://localhost:8080</a></td>
<td>否</td>
<td>域名与域名对应的IP地址不同源</td>
</tr>
<tr>
<td><a href="http://example.com:8000/a.js" target="_blank" rel="noopener">http://example.com:8000/a.js</a></td>
<td><a href="http://example.com:8000/b.js" target="_blank" rel="noopener">http://example.com:8000/b.js</a></td>
<td>是</td>
<td>协议，域名，端口相同，子域名不同</td>
</tr>
</tbody></table>
<p>我们首先启动一个 <code>Node</code> 程序作为服务端，启动在本地的 <code>4000</code> 端口，如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer();</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">'request'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.end(<span class="string">'hello world'</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">4000</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'服务启动在4000端口...'</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>现在我们同时在本地的 <code>5501</code> 端口启动一个静态服务器显示网页，在网页中我们发起一个 <code>ajax</code> 请求，向本地的 <code>4000</code> 端口请求数据，即我们刚刚搭的 Node 程序</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">if</span> (xhr.readyState == <span class="number">4</span> &amp;&amp; xhr.status == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(xhr.responseText);</span><br><span class="line">    &#125; </span><br><span class="line"> &#125;</span><br><span class="line"> xhr.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.error(<span class="string">'出错了'</span>)</span><br><span class="line"> &#125;</span><br><span class="line">xhr.open(<span class="string">'get'</span>, <span class="string">'http://127.0.0.1:4000'</span>);</span><br><span class="line">xhr.send(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<p>这个时候我们打开控制台，发现给出这样的错误信息</p>
<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/Snipaste_2020-04-21_21-23-10.png"/>
</center>

<p>因为网页的地址 <code>http://127.0.0.1:5501</code> 与服务器的地址 <code>http://127.0.0.1:4000</code> 它们的域名是不同的，所以它们是不同源的，所以这个请求是跨域的请求，而浏览器是不允许跨域请求的。那么浏览器为什么会提出同源策略，这是出于安全的考虑。同源策略包括两种：</p>
<ol>
<li><code>DOM</code> 同源策略：禁止对不同源页面 <code>DOM</code> 进行操作，这里主要场景是 <code>iframe</code> 跨域的情况，不同域名的 <code>iframe</code> 是限制互相访问的</li>
<li><code>XMLHttpRequest</code> 同源策略：禁止使用 <code>xhr</code> 对象向不同源的服务器地址发起 <code>HTTP</code> 请求</li>
</ol>
<p>在这里我们只关注 <code>ajax</code> 跨域，我们来看一下如果没有同源策略会有什么危害：</p>
<ol>
<li>用户登录了自己的银行页面 <a href="http://mybank.com，http://mybank.com" target="_blank" rel="noopener">http://mybank.com，http://mybank.com</a> 向用户的 <code>cookie</code> 中添加用户标识</li>
<li>用户浏览了恶意页面 <a href="http://evil.com，执行了页面中的恶意" target="_blank" rel="noopener">http://evil.com，执行了页面中的恶意</a> <code>AJAX</code> 请求代码</li>
<li><a href="http://evil.com" target="_blank" rel="noopener">http://evil.com</a> 向 <a href="http://mybank.com" target="_blank" rel="noopener">http://mybank.com</a> 发起 <code>AJAX HTTP</code> 请求，请求会默认把 <a href="http://mybank.com" target="_blank" rel="noopener">http://mybank.com</a> 对应 <code>cookie</code> 也同时发送过去</li>
<li>银行页面从发送的 <code>cookie</code> 中提取用户标识，验证用户无误，<code>response</code> 中返回请求数据，此时数据就泄露了</li>
<li>而且由于 <code>Ajax</code> 在后台执行，用户无法感知这一过程</li>
</ol>
<p>所以有了同源策略我们才能够安全的上网，但是很多时候我们还是有跨域的需求的，并且现在随着前后端分离的流行，前端与后端的不同源是很有可能，所以迫切需要解决这个问题，下面就介绍两种跨域的方法。</p>
<h2 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h2><p>同源策略提升了 <code>Web</code> 前端的安全性，但牺牲了 <code>Web</code> 拓展上的灵活性。设想若把 <code>html</code>、<code>js</code>、<code>css</code>、<code>flash</code>、<code>image</code> 等文件全部布置在一台服务器上，小网站这样凑活还行，大中网站如果这样做服务器根本受不了的。所以，<strong>现代浏览器在安全性和可用性之间选择了一个平衡点。在遵循同源策略的基础上，选择性地为同源策略开放了后门，</strong> 例如 <code>img</code> <code>script</code> <code>style</code> 等标签，都允许垮域引用资源，严格说这都是不符合同源要求的。</p>
<p>正是利用 <code>script</code> 等标签引用的资源没有同源策略的限制，我们可以通过 <code>script</code> 向服务器发送请求，而服务器返回一个回调，将数据作为参数返回，可能你现在不能明白是什么意思，看下面的代码，我们在页面中添加下面的内容</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">getData</span><span class="params">(data)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(data);</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="actionscript">    <span class="comment">// 创建一个 script 标签用以请求数据</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> scriptElement = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span></span><br><span class="line"><span class="actionscript">    <span class="comment">// 设置请求的地址 并且设置了回调函数</span></span></span><br><span class="line"><span class="actionscript">    scriptElement.src = <span class="string">'http://127.0.0.1:4000?callback=getData'</span>;</span></span><br><span class="line"><span class="actionscript">    <span class="comment">// 这一步很重要，不设置的话浏览器会报错 Uncaught SyntaxError: Unexpected identifier</span></span></span><br><span class="line"><span class="actionscript">    scriptElement.setAttribute(<span class="string">'type'</span>, <span class="string">'text/javascript'</span>);</span></span><br><span class="line"><span class="actionscript">    <span class="comment">// 将这个 script 标签添加到 body 中</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.getElementsByTagName(<span class="string">'body'</span>)[<span class="number">0</span>].appendChild(scriptElement);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Node 服务端的代码</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer();</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">'request'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> qs = querystring.parse(req.url.split(<span class="string">'?'</span>)[<span class="number">1</span>]); <span class="comment">// 解析请求参数</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> data = <span class="string">"Hello World"</span>; <span class="comment">// 返回的数据</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 一定要在 $&#123;data&#125; 两端加上双引号，否则浏览器得到的是 getData(Hello World)会报错</span></span><br><span class="line">    res.end(<span class="string">`<span class="subst">$&#123;qs.callback&#125;</span>("<span class="subst">$&#123;data&#125;</span>")`</span>); <span class="comment">// 即getData(data)</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">4000</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'服务启动在4000端口...'</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>结果如下</p>
<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/Snipaste_2020-04-21_23-04-21.png"/>
</center>



<p>我来理一下上面的步骤</p>
<ol>
<li><p>首先创建了一个函数 <code>getData</code>，该函数的作用是用来处理数据的，接收的那个参数就是数据</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建一个 <code>script</code> 标签，并且设置了请求的地址，以及将处理数据函数的名称即 <code>getData</code> 作为参数传入</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">script.src = <span class="string">'http://127.0.0.1:4000?callback=getData'</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>服务器接到请求，将要返回的数据作为传入的回调函数的参数传入</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">res.end(<span class="string">`<span class="subst">$&#123;qs.callback&#125;</span>("<span class="subst">$&#123;data&#125;</span>")`</span>); <span class="comment">// 即getData(data)</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>script</code> 标签得到服务器返回的数据，即 <code>getData(&quot;Hello World&quot;)</code>，然后执行，这样数据 <code>Hello World</code> 就作为参数传递给了 <code>getData()</code></p>
</li>
</ol>
<blockquote>
<p>优点：</p>
<ul>
<li>使用简便，没有兼容性问题，是目前最流行的跨域方法</li>
</ul>
<p>缺点：</p>
<ul>
<li>只支持 <code>GET</code> 请求，并且代码是从其他域得到的，不排除可能有恶意代码，所以使用该方法，服务端必须确保值得信任</li>
<li>要确定 <code>JSONP</code> 请求失败并不容易</li>
</ul>
</blockquote>
<h2 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h2><p><code>CORS</code>(<code>Cross-origin resource sharing</code>，跨域资源共享) 是一个 <code>W3C</code> 标准，定义了在必须访问跨域资源时，浏览器与服务器应该如何沟通。<code>CORS</code> 背后的基本思想，就是使用自定义的 <code>HTTP</code> 头部让浏览器与服务器进行沟通，从而决定请求或响应是应该成功，还是应该失败。<code>CORS</code> 需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，<code>IE</code> 浏览器不能低于 <code>IE10</code>。</p>
<p>对于开发者来说，我们只要正常的发出 <code>ajax</code> 请求即可，与之前没有任何区别，如</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">if</span> (xhr.readyState == <span class="number">4</span> &amp;&amp; xhr.status == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(xhr.responseText);</span><br><span class="line">    &#125; </span><br><span class="line"> &#125;</span><br><span class="line"> xhr.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.error(<span class="string">'出错了'</span>)</span><br><span class="line"> &#125;</span><br><span class="line">xhr.open(<span class="string">'get'</span>, <span class="string">'http://127.0.0.1:4000'</span>);</span><br><span class="line">xhr.send(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<p>但是在服务端，我们要设置一下信赖的请求来源，如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer();</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">'request'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 表示来自 http://127.0.0.1:5501 的请求可以拿到数据</span></span><br><span class="line">    res.setHeader(<span class="string">'Access-Control-Allow-Origin'</span>, <span class="string">'http://127.0.0.1:5501'</span>)</span><br><span class="line">    res.end(<span class="string">'hello world'</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">4000</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'服务启动在4000端口...'</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>除了可以设置请求来源，还可以设置允许的方法，允许的头部等等</p>
<table>
<thead>
<tr>
<th>响应头</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>Access-Control-Allow-Origin</td>
<td>设置允许的请求来源，如果允许任意来源，可以设置为 <code>*</code></td>
</tr>
<tr>
<td>Access-Control-Allow-Methods</td>
<td>允许的方法，多个以逗号分隔，如 <code>GET</code>, <code>POST</code></td>
</tr>
<tr>
<td>Access-Control-Allow-Headers</td>
<td>允许的请求头，多个以逗号分隔</td>
</tr>
</tbody></table>
<p>浏览器将 <code>CORS</code> 请求分为两类，分别为简单请求和非简单请求。如果满足以下两类请求，就是简单请求</p>
<ol>
<li>请求方法是以下三种方法之一：<ul>
<li><code>GET</code></li>
<li><code>POST</code></li>
<li><code>HEAD</code></li>
</ul>
</li>
<li>HTTP的头信息不超出以下几种字段：<ul>
<li><code>Accept</code></li>
<li><code>Accept-Language</code></li>
<li><code>Content-Language</code></li>
<li><code>Last-Event-ID</code></li>
<li><code>Content-Type</code>：只限于三个值 <code>application/x-www-form-urlencoded</code>、<code>multipart/form-data</code>、<code>text/plain</code></li>
</ul>
</li>
</ol>
<p>如果不满足以上的两大条件，那么就是非简单请求，而浏览器对于简单请求和非简单请求的处理是不一样的。</p>
<p><strong>简单请求</strong></p>
<ol>
<li><p>在请求中需要附加一个额外的 <code>Origin</code> 头部，其中包含请求页面的源信息（协议、域名和端口），以便服务器根据这个头部信息来决定是否给予响应。例如：<code>Origin: http://127.0.0.1:5501</code></p>
</li>
<li><p>如果服务器认为这个请求可以接受，就在 <code>Access-Control-Allow-Origin</code> 头部中回发相同的源信息(如果是公共资源，可以回发 <code>*</code>)，例如：<code>Access-Control-Allow-Origin：http://127.0.0.1:5501</code></p>
</li>
<li><p>没有这个头部或者有这个头部但源信息不匹配，浏览器就会驳回请求，注意，请求和响应都不包含 <code>cookie</code> 信息</p>
</li>
<li><p>如果需要包含 <code>cookie</code> 信息，<code>ajax</code> 请求需要设置 <code>xhr</code> 的属性 <code>withCredentials</code> 为 <code>true</code>，服务器需要设置响应头部 <code>Access-Control-Allow-Credentials: true</code></p>
</li>
</ol>
<p><strong>非简单请求</strong></p>
<p>非简单请求可能对服务器数据产生副作用，浏览器必须首先使用 <code>OPTIONS</code> 方法发起一个预检请求(<code>preflight request</code>)，从而获知服务端是否允许该跨域请求，</p>
<ul>
<li><code>Origin</code>：与简单的请求相同</li>
<li><code>Access-Control-Request-Method</code>: 请求自身使用的方法</li>
<li><code>Access-Control-Request-Headers</code>: (可选)自定义的头部信息，多个头部以逗号分隔</li>
</ul>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Origin</span>: http://127.0.0.1:5501</span><br><span class="line"><span class="attribute">Access-Control-Request-Method</span>: POST</span><br><span class="line"><span class="attribute">Access-Control-Request-Headers</span>: NCZ</span><br></pre></td></tr></table></figure>

<p>发送这个请求后，服务器可以决定是否允许这种类型的请求，一旦服务器通过 <code>Preflight</code> 请求，允许该请求之后，以后每次浏览器正常的 <code>CORS</code> 请求，就都跟简单请求一样了。</p>
<blockquote>
<p>优点：</p>
<ul>
<li><code>CORS</code> 通信与同源的 <code>AJAX</code> 通信没有差别，代码完全一样，容易维护</li>
<li>支持所有类型的 <code>HTTP</code> 请求</li>
</ul>
<p>缺点：</p>
<ul>
<li>存在兼容性问题，特别是 <code>IE10</code> 以下的浏览器</li>
<li>第一次发送非简单请求时会多一次请求</li>
</ul>
</blockquote>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li><a href="https://zhuanlan.zhihu.com/p/28562290" target="_blank" rel="noopener">跨域的那些事儿</a></li>
<li><a href="https://juejin.im/post/5ba1d4fe6fb9a05ce873d4ad" target="_blank" rel="noopener">浏览器同源策略及跨域的解决方法</a></li>
</ul>

    

        <a href="https://lastknightcoder.gitee.io/Ajax%E8%B7%A8%E5%9F%9F/" class="post-more waves-effect waves-button">
            阅读全文…
        </a>
    </div>
    
    <div class="post-footer">
        
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="https://lastknightcoder.gitee.io/tags/Ajax/" rel="tag">Ajax</a></li></ul>

    </div>
    
</article>

        </li>
    
        <li class="post-list-item fade">
            <article id="post-JavaScript柯里化"
  class="article-card article-type-post" itemprop="blogPost">

    <div class="post-meta">
        <time class="post-time" title="2020-04-21 00:00:00" datetime="2020-04-20T16:00:00.000Z"  itemprop="datePublished">2020-04-21</time>

        
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="https://lastknightcoder.gitee.io/categories/Web/">Web</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="https://lastknightcoder.gitee.io/categories/Web/JavaScript/">JavaScript</a></li></ul></li></ul>



    </div>

    


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="https://lastknightcoder.gitee.io/JavaScript%E6%9F%AF%E9%87%8C%E5%8C%96/">JavaScript柯里化</a>
    </h3>
  




    <div class="post-content" id="post-content" itemprop="postContent">

    
        <h2 id="柯里化介绍"><a href="#柯里化介绍" class="headerlink" title="柯里化介绍"></a>柯里化介绍</h2><p>函数柯里化指的是函数处理一部分的参数，然后返回一个函数来处理剩余的参数，如比如有一个加法函数如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line">add(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>

<p>现在如果这个函数被柯里化，那么我们可以如下使用</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> increment = add(<span class="number">1</span>); <span class="comment">// 接收第一个参数，返回一个函数处理第二个参数</span></span><br><span class="line">increment(<span class="number">2</span>); <span class="comment">// 3</span></span><br><span class="line">increment(<span class="number">4</span>); <span class="comment">// 5</span></span><br></pre></td></tr></table></figure>

<h2 id="柯里化实现"><a href="#柯里化实现" class="headerlink" title="柯里化实现"></a>柯里化实现</h2><p>现在怎么实现这种效果，如果只是针对上面的加法函数，那么可以如下实现</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">y</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x + y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是这种方法明显只对加法函数有效，我们现在是想设计一个函数，它接收一个函数为参数，作用就是把这个函数柯里化，并将这个柯里化的函数返回，比如</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">curryAdd = curry(add); <span class="comment">// 接收add函数，将函数add柯里化</span></span><br><span class="line"><span class="keyword">const</span> increment = curryAdd(<span class="number">1</span>);</span><br><span class="line">increment(<span class="number">2</span>); <span class="comment">// 3</span></span><br><span class="line">increment(<span class="number">4</span>); <span class="comment">// 5</span></span><br></pre></td></tr></table></figure>

<p>首先实现一个简单版本的</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curry</span>(<span class="params">fn, ...args1</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">...args2</span>) </span>&#123;</span><br><span class="line">        fn(...args1, ...args2)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是这个函数明显有一个缺陷，那就是只能传入两次参数，怎么解决，肯定使用递归了</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curry</span>(<span class="params">fn, ...args1</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (fn.length == args1.length) &#123;</span><br><span class="line">        <span class="keyword">return</span> fn(...args1);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">...args2</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> curry(fn, ...args1, ...args2)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的函数首先判断接收的参数的个数与函数要求参数的个数是否相同，如果相同则直接执行函数，否则返回一个函数来处理剩下的参数，这样就可以实现函数的柯里化。</p>
<h2 id="柯里化应用举例"><a href="#柯里化应用举例" class="headerlink" title="柯里化应用举例"></a>柯里化应用举例</h2><p>现在来看一下柯里化有什么用处，假设有一个 <code>ajax</code> 请求的函数如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">type, url, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    xhr.onReadystateChange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    xhr.open(type, url);</span><br><span class="line">    xhr.send(data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我们将这个函数柯里化</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> curriedAjax = curry(ajax);</span><br><span class="line"><span class="keyword">let</span> post = curriedAjax(<span class="string">'post'</span>);</span><br></pre></td></tr></table></figure>

<p>我们向 <code>curriedAjax</code> 传入一个参数 <code>post</code>，得到一个函数，这个函数的作用是用来发 <code>post</code> 请求的，我们每次发 <code>post</code> 请求时，只需要使用 <code>post</code> 方法即可，这样函数的复用性有了极大的增强，我们可以继续传入参数</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> postGoogle = post(<span class="string">'https://www.google.com'</span>);</span><br></pre></td></tr></table></figure>

<p>我们又得到了一个函数，该函数的作用是向 <code>https://www.google.com</code> 发送 <code>post</code> 请求，函数的复用性又进一步的提升。</p>
<blockquote>
<p>使用过jQuery的都知道，可以使用<code>$.ajax()</code>这样的通用方法，但是也有<code>$.get()</code>和<code>$.post()</code>这样的语法糖，但是<code>jQuery</code>底部是不是这样实现的就不得而知了。</p>
</blockquote>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li><a href="https://juejin.im/post/5af13664f265da0ba266efcf" target="_blank" rel="noopener">大佬，JavaScript 柯里化，了解一下</a></li>
<li><a href="https://github.com/mqyqingfeng/Blog/issues/42" target="_blank" rel="noopener">JavaScript专题之函数柯里化</a></li>
</ul>

    

        <a href="https://lastknightcoder.gitee.io/JavaScript%E6%9F%AF%E9%87%8C%E5%8C%96/" class="post-more waves-effect waves-button">
            阅读全文…
        </a>
    </div>
    
    <div class="post-footer">
        
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="https://lastknightcoder.gitee.io/tags/JavaScript-%E6%9F%AF%E9%87%8C%E5%8C%96/" rel="tag">JavaScript 柯里化</a></li></ul>

    </div>
    
</article>

        </li>
    
        <li class="post-list-item fade">
            <article id="post-JavaScript闭包"
  class="article-card article-type-post" itemprop="blogPost">

    <div class="post-meta">
        <time class="post-time" title="2020-04-18 00:00:00" datetime="2020-04-17T16:00:00.000Z"  itemprop="datePublished">2020-04-18</time>

        
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="https://lastknightcoder.gitee.io/categories/Web/">Web</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="https://lastknightcoder.gitee.io/categories/Web/JavaScript/">JavaScript</a></li></ul></li></ul>



    </div>

    


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="https://lastknightcoder.gitee.io/JavaScript%E9%97%AD%E5%8C%85/">JavaScript闭包</a>
    </h3>
  




    <div class="post-content" id="post-content" itemprop="postContent">

    
        <h2 id="JavaScript的作用域"><a href="#JavaScript的作用域" class="headerlink" title="JavaScript的作用域"></a>JavaScript的作用域</h2><p><code>JavaScript</code> 的作用域有两种</p>
<ul>
<li>全局作用域</li>
<li>函数作用域</li>
</ul>
<p>与其他语言不同的是，<code>JavaScript</code> 没有块级作用域，参考以下程序</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(x); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>

<p>上面的变量 <code>x</code> 定义在 <code>if</code> 的语句块中，在其他的语言中，<code>x</code> 在语句块外是访问不到的，但是由于 <code>JavaScript</code> 没有块级作用域，所以变量 <code>x</code> 是全局变量，所以在语句块外也可以被访问到。</p>
<blockquote>
<p>注意：</p>
<p>上面的讨论是基于 <code>ES5</code> 的，在 <code>ES6</code> 中，通过关键字 <code>let</code> 或 <code>const</code> 声明的变量，可以实现块级作用域的效果</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> x = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(x); <span class="comment">// not defined</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="JavaScript-作用域链"><a href="#JavaScript-作用域链" class="headerlink" title="JavaScript 作用域链"></a>JavaScript 作用域链</h2><p><code>JavaScript</code> 作用域链指的是查找变量的顺序，比如下面的程序</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> i = <span class="number">2</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> i = <span class="number">3</span>;</span><br><span class="line">        <span class="built_in">console</span>.log(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    bar();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo(); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>

<p>在上面的程序中，我们在 <code>bar()</code> 函数中访问了变量 <code>i</code>，这时 <code>bar()</code> 会先在 <code>bar()</code> 函数内部查找是否有变量 <code>i</code>，如果没有，则会去 <code>bar()</code> 函数的上一级作用域即 <code>foo()</code> 函数中寻找，如果还没有，则会去全局作用域寻找，如果没有找到，则会报错变量未定义，所以上述 <code>bar()</code> 函数的作用域链为</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bar --&gt; foo --&gt; 全局作用域</span><br></pre></td></tr></table></figure>

<p>编译器会根据作用域链去寻找变量，如果没有找到则会报错。</p>
<h2 id="闭包介绍"><a href="#闭包介绍" class="headerlink" title="闭包介绍"></a>闭包介绍</h2><p>什么是闭包，简单的说就是允许函数访问并操作函数外部的变量，只要该变量处于该函数的作用域链中，比如</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> func = foo();</span><br><span class="line">func(); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>

<p>函数 <code>foo()</code> 返回了一个函数，返回的这个函数中访问了变量 <code>x</code>，根据我们的讲解，会根据这个函数的作用域链去寻找这个变量 <code>x</code>，该匿名函数定义时的作用域链</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">返回的匿名函数 --&gt; foo --&gt; 全局作用域</span><br></pre></td></tr></table></figure>

<p>所以当执行该匿名函数时，会根据上述的作用域链去寻找变量 <code>x</code>，会在 <code>foo</code> 中找到变量 <code>x</code>，所以输出的结果是 <code>1</code>。</p>
<p>你可能会有这样的疑惑，当执行完函数 <code>foo()</code> 后，变量 <code>x</code> 不是应该已经被销毁了吗，为什么还能够被访问。之所以会有这样的想法，可能是受其他编程语言的影响，如 <code>C</code>，<code>Java</code> 等，但是要明白 <code>JavaScript</code> 与这些编程语言不同，至少 <code>Java</code> 不能够返回函数，因为返回的函数还保存着对变量 <code>x</code> 的引用，所以变量 <code>x</code> 在执行完 <code>foo()</code> 之后是不会被清除的，这就是还能够访问 <code>x</code> 的原因。</p>
<p>那接下来看一个例子，看看你是否明白了闭包</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(i);</span><br><span class="line">    &#125;, i * <span class="number">100</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的程序的效果是延时 <code>i * 100 ms</code> 打印输出 <code>i</code>，你可能希望得到下面这样的输出</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">9</span></span><br></pre></td></tr></table></figure>

<p>但是真正的结果是</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>这是因为 <code>setTimeout</code> 是一个异步函数，当执行 <code>setTimeout</code> 时，并不会立即执行传入的回调函数，这些回调函数等到延迟时间到了以后，会将这些回调函数放入事件队列中，简单来说，当执行到 <code>setTimeout</code> 函数时，不会有任何的阻碍直接进入下一轮循环，等到循环执行完毕，编译器会取出事件队列中的函数执行(这些回调函数并不是执行到 <code>setTimeout</code> 方法时立即被添加到事件队列中的，而是等到设定的延迟时间后再添加到事件队列中的)，所以当执行这些回调函数时，循环已经执行完毕，变量 <code>i</code> 的值已经变为了 <code>10</code>，这些回调函数根据它的作用域链找到的变量 <code>i</code> 的值就全部是 <code>10</code> 了。</p>
<h2 id="闭包实现私有变量"><a href="#闭包实现私有变量" class="headerlink" title="闭包实现私有变量"></a>闭包实现私有变量</h2><p>在 <code>JavaScript</code> 中是没有关键字去声明私有变量的，但是我们可以通过闭包来实现这样的效果，如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name = <span class="string">'ninja'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.setName = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">        name = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.getName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> Person();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(person.name); <span class="comment">// 访问不到 undefined</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(person.getName()); <span class="comment">// ninja</span></span><br><span class="line">person.setName(<span class="string">'dummy'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(person.getName()); <span class="comment">// dummy</span></span><br></pre></td></tr></table></figure>

<p>通过闭包，<code>setName</code> 和 <code>getName</code> 可以对 <code>name</code> 进行访问和操作，但是却不能够被实例变量 <code>person</code> 访问到，因为 <code>name</code> 并不是 <code>person</code> 的属性，这样我们就实现了私有变量。</p>
<h2 id="闭包处理回调函数"><a href="#闭包处理回调函数" class="headerlink" title="闭包处理回调函数"></a>闭包处理回调函数</h2><p>假设有这么一个动画函数</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> tick = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">animateIt</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> element = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">    <span class="keyword">var</span> timer = setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (tick &lt; <span class="number">100</span>) &#123;</span><br><span class="line">            element.style.left = element.style.top = tick + <span class="string">"px"</span>;</span><br><span class="line">            tick++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            clearInterval(timer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="number">10</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该函数实现在 <code>1s</code> 将元素向下和向右平移 <code>100px</code>，如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"box1"</span>).addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    animateIt(<span class="string">"box1"</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/202004172341.gif"/>
</center>

<p>但是当我们同时对两个元素使用动画时，由于二者共享变量 <code>tick</code>，则会导致二者的动画状态发生冲突，所以我们改动如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">animateIt</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> tick = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> element = <span class="built_in">document</span>.getElementById(id);</span><br><span class="line">    <span class="keyword">var</span> timer = setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (tick &lt; <span class="number">100</span>) &#123;</span><br><span class="line">            element.style.left = element.style.top = tick + <span class="string">"px"</span>;</span><br><span class="line">            tick++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            clearInterval(timer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"box1"</span>).addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    animateIt(<span class="string">"box1"</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"box2"</span>).addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    animateIt(<span class="string">"box2"</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>我们将 <code>tick</code> 定义在函数内，由于闭包，<code>setInteval</code> 中的回调函数可以访问到tick，并且两个不同<code>id</code> 元素的<code>tick</code>是不同的，不会相互干扰</p>
<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/202004080010.gif"/>
</center>




    

        <a href="https://lastknightcoder.gitee.io/JavaScript%E9%97%AD%E5%8C%85/" class="post-more waves-effect waves-button">
            阅读全文…
        </a>
    </div>
    
    <div class="post-footer">
        
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="https://lastknightcoder.gitee.io/tags/JavaScript-%E9%97%AD%E5%8C%85/" rel="tag">JavaScript 闭包</a></li></ul>

    </div>
    
</article>

        </li>
    
        <li class="post-list-item fade">
            <article id="post-从尾到头打印链表"
  class="article-card article-type-post" itemprop="blogPost">

    <div class="post-meta">
        <time class="post-time" title="2020-04-15 00:00:00" datetime="2020-04-14T16:00:00.000Z"  itemprop="datePublished">2020-04-15</time>

        
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="https://lastknightcoder.gitee.io/categories/%E5%89%91%E6%8C%87offer/">剑指offer</a></li></ul>



    </div>

    


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="https://lastknightcoder.gitee.io/%E4%BB%8E%E5%B0%BE%E5%88%B0%E5%A4%B4%E6%89%93%E5%8D%B0%E9%93%BE%E8%A1%A8/">从尾到头打印链表</a>
    </h3>
  




    <div class="post-content" id="post-content" itemprop="postContent">

    
        <blockquote>
<p>题目：输入一个链表的头节点，从尾到头反过来打印出每个节点的值。链表节点定义如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ListNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> value;</span><br><span class="line">    <span class="keyword">private</span> ListNode next;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ListNode</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>如果只是反过来打印节点的值，那么很简单，只要遍历链表，将节点的值 <code>push</code> 到一个栈里面，因为栈的特点是后进先出，所以最后我们遍历栈，达到的效果就是将链表从尾到头打印，如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printListReverse</span><span class="params">(ListNode root)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Stack&lt;Integer&gt; stack = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">    ListNode cur = root;</span><br><span class="line">    <span class="comment">// 遍历链表 将值添加到栈中</span></span><br><span class="line">    <span class="keyword">while</span> (cur != <span class="keyword">null</span>) &#123;</span><br><span class="line">        stack.push(cur.value);</span><br><span class="line">        cur = cur.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 遍历栈 打印栈头的值</span></span><br><span class="line">    <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">        System.out.println(stack.pop());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>另外一种方法就是使用递归，对于任意一个节点，反过来打印即先打印下一个节点，然后在打印当前节点，如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printListReverse2</span><span class="params">(ListNode root)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 既是递归退出的条件 也是对传入的链表进行检查</span></span><br><span class="line">    <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    printListReverse2(root.next);</span><br><span class="line">    System.out.println(root.value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


    

        <a href="https://lastknightcoder.gitee.io/%E4%BB%8E%E5%B0%BE%E5%88%B0%E5%A4%B4%E6%89%93%E5%8D%B0%E9%93%BE%E8%A1%A8/" class="post-more waves-effect waves-button">
            阅读全文…
        </a>
    </div>
    
    <div class="post-footer">
        
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="https://lastknightcoder.gitee.io/tags/%E5%89%91%E6%8C%87offer-%E9%93%BE%E8%A1%A8/" rel="tag">剑指offer 链表</a></li></ul>

    </div>
    
</article>

        </li>
    
        <li class="post-list-item fade">
            <article id="post-二维数组中的查找"
  class="article-card article-type-post" itemprop="blogPost">

    <div class="post-meta">
        <time class="post-time" title="2020-04-12 00:00:00" datetime="2020-04-11T16:00:00.000Z"  itemprop="datePublished">2020-04-12</time>

        
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="https://lastknightcoder.gitee.io/categories/%E5%89%91%E6%8C%87offer/">剑指offer</a></li></ul>



    </div>

    


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="https://lastknightcoder.gitee.io/%E4%BA%8C%E7%BB%B4%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E6%9F%A5%E6%89%BE/">二维数组中的查找</a>
    </h3>
  




    <div class="post-content" id="post-content" itemprop="postContent">

    
        <blockquote>
<p>题目：在一个二维数组中，每一行都按照从左到右递增的顺序排序，每一列都按照从上到下递增的顺序排序。请完成一个函数，输入这样的一个二维数组和一个整数，判断数组中是否含有该整数。</p>
</blockquote>
<p>首先将这个二维数组看做是一个矩阵，考虑这么一个思路，首先在矩阵中选取一个数，如果要查找的数大于这个数，那么该数应该在选取数字的下方或者右方，如果该数小于选取的数，那么这个数应该在选取数字的上方或者左方，无论怎样，查找的数都会在选取位置的两个区域都出现，并且这两个区域有重叠的部分，这使得问题较为复杂，</p>
<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/202004121814.png"/>
</center>


<p>现在不妨换一种思路，我们从右上角开始进行查找，如果查找的数比右上角的数小，那么该数只可能在左方，如果查找的数比右上角大，那么该数只可能在下方，查找的数都只会在一个区域出现，要么在左方，要么在下方，每一次查找都会使得查找的区域变小，下面以查找数字<code>5</code>为例</p>
<center>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/202004121702.png"/>
</center>

<p>代码如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">findInMatrix</span><span class="params">(<span class="keyword">int</span>[][] matrix, <span class="keyword">int</span> number)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获得矩阵的行数和列数</span></span><br><span class="line">        <span class="keyword">int</span> rows = matrix.length;</span><br><span class="line">        <span class="keyword">int</span> columns = matrix[<span class="number">0</span>].length;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (matrix != <span class="keyword">null</span> &amp;&amp; rows &gt; <span class="number">0</span> &amp;&amp; columns &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 从右上角开始查找</span></span><br><span class="line">            <span class="keyword">int</span> row = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">int</span> column = columns - <span class="number">1</span>;</span><br><span class="line">            <span class="comment">// 继续查找的条件</span></span><br><span class="line">            <span class="keyword">while</span> (row &lt; rows &amp;&amp; columns &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (matrix[row][column] == number) &#123;</span><br><span class="line">                    <span class="comment">// 找到退出while循环</span></span><br><span class="line">                    found = <span class="keyword">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (matrix[row][column] &gt; number) &#123;</span><br><span class="line">                    <span class="comment">// 比右上角小 在左方</span></span><br><span class="line">                    column--;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 否则比右上角大 在下方</span></span><br><span class="line">                    row++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> found;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[][] matrix = &#123;&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;, &#123;<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>&#125;, &#123;<span class="number">3</span>, <span class="number">6</span>, <span class="number">9</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> found = findInMatrix(matrix, <span class="number">2</span>);</span><br><span class="line">        System.out.println(found);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


    

        <a href="https://lastknightcoder.gitee.io/%E4%BA%8C%E7%BB%B4%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E6%9F%A5%E6%89%BE/" class="post-more waves-effect waves-button">
            阅读全文…
        </a>
    </div>
    
    <div class="post-footer">
        
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="https://lastknightcoder.gitee.io/tags/%E6%95%B0%E7%BB%84%E6%9F%A5%E6%89%BE/" rel="tag">数组查找</a></li></ul>

    </div>
    
</article>

        </li>
    
        <li class="post-list-item fade">
            <article id="post-jQuery系统教程"
  class="article-card article-type-post" itemprop="blogPost">

    <div class="post-meta">
        <time class="post-time" title="2020-04-07 23:00:00" datetime="2020-04-07T15:00:00.000Z"  itemprop="datePublished">2020-04-07</time>

        
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="https://lastknightcoder.gitee.io/categories/Web/">Web</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="https://lastknightcoder.gitee.io/categories/Web/JavaScript/">JavaScript</a></li></ul></li></ul>



    </div>

    


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="https://lastknightcoder.gitee.io/jQuery%E7%B3%BB%E7%BB%9F%E6%95%99%E7%A8%8B/">jQuery系统教程</a>
    </h3>
  




    <div class="post-content" id="post-content" itemprop="postContent">

    
        <p>本篇文章是在完整学习 <code>jQuery</code> 以后，系统整理的教程，大纲如下</p>
<ul>
<li><code>jQuery</code> 的核心函数 <code>$, jQuery</code></li>
<li>操作 <code>jQuery</code> 集合</li>
<li>操作 <code>DOM</code> 元素的属性和类属性</li>
<li>操作样式</li>
<li>操作 <code>DOM</code> 元素(添加，删除…)</li>
<li><code>jQuery</code> 事件</li>
<li><code>jQuery</code> 显示与隐藏</li>
<li><code>jQuery</code> 动画</li>
<li><code>jQuery</code> 扩展及实用函数</li>
<li><code>Ajax</code></li>
</ul>
<h2 id="jQuery核心函数"><a href="#jQuery核心函数" class="headerlink" title="jQuery核心函数"></a>jQuery核心函数</h2><p><code>jQuery</code> 这个库中最重要的就是它提供的核心函数 <code>jQuery()</code> ，它提供了非常强大的功能，因为这个函数用的十分的频繁，所以提供了 <code>jQuery()</code> 的别名，那就是 <code>$()</code> ，在后面的演示中都将会以 <code>$</code> 为例，现在我们来看一下该核心函数提供了哪些功能</p>
<ul>
<li>选择多个 <code>DOM</code> 元素</li>
<li>将 <code>HTML</code> 字符串得解析为一个 <code>DOM</code> 元素</li>
<li>作为入口函数</li>
<li>将 <code>DOM</code> 元素转换为 <code>jQuery</code> 集合</li>
</ul>
<p>上面有些名词可能没有听过，这里只是感性了解一下，下面就具体讲解。</p>
<h3 id="选择元素"><a href="#选择元素" class="headerlink" title="选择元素"></a>选择元素</h3><p>考虑下面的 <code>DOM</code> 结构</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"box"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果使用原生的 <code>JavaScript</code> 选择上面的元素的写法如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"box"</span>);</span><br><span class="line"><span class="built_in">document</span>.getElementsByClassName(<span class="string">"container"</span>)[<span class="number">0</span>];</span><br><span class="line"><span class="built_in">document</span>.getElementsByTagName(<span class="string">"p"</span>)[<span class="number">0</span>];</span><br></pre></td></tr></table></figure>

<p>而现在使用 <code>$()</code> 函数，为其传入 <code>CSS</code> 的选择器即可选中元素</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"#box"</span>);</span><br><span class="line">$(<span class="string">".container"</span>);</span><br><span class="line">$(<span class="string">"p"</span>);</span><br></pre></td></tr></table></figure>

<p>使用 <code>$()</code> 得到的是一个集合，即使使用了 <code>id</code> 选择器 <code>#box</code> ，得到也是一个只有一个元素的集合，如下</p>
<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/Snipaste_2020-04-07_17-26-17.png"/>
</center>

<p>我们把它称为 <code>jQuery</code> 对象或者 <code>jQuery</code> 集合，在下面我将不会区分二者，可能会混合使用，请注意。由上可见， <code>jQuery</code> 对象的结构像是一个数组，但它不是真正的数组，因为他不是 <code>Array</code> 的实例，只是使用对象来模拟数组， <code>jQuery</code> 对象中的元素(借用数组的概念)是被选择的 <code>DOM</code> 元素。 <code>jQuery</code> 的核心函数支持几乎所有的 <code>CSS</code> 选择器，如</p>
<ul>
<li><p>属性选择器</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">input</span><span class="selector-attr">[value]</span> <span class="comment">/* 选择有 value 属性的 input 标签 */</span></span><br><span class="line"><span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">'text'</span>]</span> <span class="comment">/* 选择 type 为 text 的 input 标签 */</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-attr">[href^=<span class="string">'http://'</span>]</span> <span class="comment">/* 选择 href 以 http:// 开头的 a 标签 */</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-attr">[href$=<span class="string">'pdf'</span>]</span> <span class="comment">/* 选择 href 以 pdf 结尾的 a 标签 */</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-attr">[href*=<span class="string">'jquery'</span>]</span> <span class="comment">/* 选择 href 属性包含 jquery 的 a 标签 */</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>伪类选择器</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:first</span></span><br><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">:odd</span></span><br><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">:even</span></span><br><span class="line"><span class="selector-tag">ul</span> <span class="selector-tag">li</span><span class="selector-pseudo">:last-child</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>过滤器</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-pseudo">:animated</span> <span class="comment">/* 处于动画状态的元素 */</span></span><br><span class="line"><span class="selector-pseudo">:checkbox</span> <span class="comment">/* 相当于 input[type='chexkbox'] */</span></span><br><span class="line"><span class="selector-pseudo">:checked</span> <span class="comment">/* 选择处于选中状态的多选框或单选框 */</span></span><br><span class="line"><span class="selector-pseudo">:disabled</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
<li><p>…</p>
</li>
</ul>
<p>选择器十分的多，由于重点不在于选择器，另外这个也没有什么原理可讲，也就是 <code>API</code> 的使用，随着使用 <code>jQuery</code> 的增多，自然会掌握，所以这里就点到即止。</p>
<h3 id="将-HTML-字符串转化为-jQuery-对象"><a href="#将-HTML-字符串转化为-jQuery-对象" class="headerlink" title="将 HTML 字符串转化为 jQuery 对象"></a>将 HTML 字符串转化为 jQuery 对象</h3><p>这里首先解释一下什么叫做 HTML 字符串，不给出具体的定义，很好理解，形如下面的字符串就叫做 HTML 字符串</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">"&lt;p&gt;123&lt;/p&gt;"</span></span><br><span class="line"><span class="string">"&lt;h1&gt;一级标题&lt;/h1&gt;"</span></span><br></pre></td></tr></table></figure>

<p>当我们向 <code>jQuery</code> 的核心函数传递这样的字符串时，核心函数会将该字符串解析得到一个 <code>jQuery</code> 对象，如</p>
<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/Snipaste_2020-04-07_17-49-32.png"/>
</center>

<h3 id="作为入口函数"><a href="#作为入口函数" class="headerlink" title="作为入口函数"></a>作为入口函数</h3><p>因为我们一般会在 <code>JavaScript</code> 中操作 <code>DOM</code> ，所以我们一般会等到 <code>DOM</code> 树渲染完毕之后再去执行 <code>JavaScript</code> 代码，所以我们一般把 <code>script</code> 标签放在 <code>body</code> 元素的最后面，或者将代码放在 <code>window.onload</code> 中，如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 要执行的代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>onload</code> 方法会在 <code>DOM</code> 树渲染完毕，并且外部资源如图片等等加载完毕后会执行，虽然能够满足我们的需求，但是在等待静态资源加载的时候，用户是不能与页面进行交互的，这时用户就会感觉页面卡死了，体验感十分不好。我们只是希望在 <code>DOM</code> 树渲染完毕后就执行代码，那么可以使用 <code>ready()</code> 函数，如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 要执行的代码</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这里要执行的代码在 <code>DOM</code> 树渲染完毕后即可执行，而不必等到资源加载完毕。上面的写法可以简写为</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 要执行的代码</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="将-DOM-元素转化为-jQuery-对象"><a href="#将-DOM-元素转化为-jQuery-对象" class="headerlink" title="将 DOM 元素转化为 jQuery 对象"></a>将 DOM 元素转化为 jQuery 对象</h3><p>为核心函数传入 <code>DOM</code> 元素，会返回一个 <code>jQuery</code>对象，该对象包含了这个 <code>DOM</code> 元素，如下</p>
<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/Snipaste_2020-04-07_18-42-49.png"/>
</center>

<p>将 <code>DOM</code> 元素转化为 <code>jQuery</code> 对象可以使用 <code>jQuery</code> 对象原型上的方法，这些方法想较于原生方法方便很多。</p>
<blockquote>
<p>如何将 <code>jQuery</code> 对象转化为DOM元素呢? 我们知道 <code>jQuery</code> 对象的结构是类似于数组，其中的每一个元素都是 <code>DOM</code> 对象，我们可以使用下标的方式获取 <code>DOM</code> 元素，如下两种方法都是可以的</p>
<ul>
<li><code>jQuery对象[index]</code></li>
<li><code>jQuery对象.get(index)</code>，该方法可以接受负数，表示倒数</li>
</ul>
</blockquote>
<h2 id="操作-jQuery-集合"><a href="#操作-jQuery-集合" class="headerlink" title="操作 jQuery 集合"></a>操作 jQuery 集合</h2><p>在本节会使用 <code>jQuery</code> 集合这一叫法，因为往里面添加元素或者删除元素等等操作，集合的叫法比对象的叫法更加的符合。如果不做说明，下面操作的<code>DOM</code>为以下</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"box"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="添加元素"><a href="#添加元素" class="headerlink" title="添加元素"></a>添加元素</h3><p>使用 <code>jQuery</code> 集合调用 <code>add</code> 方法为集合添加元素， <code>add</code> 方法可以接收不同类型的参数，如下</p>
<ul>
<li><code>jQuery</code> 选择器：将与 <code>jQuery</code> 选择器匹配的所有 <code>DOM</code> 元素添加到集合中</li>
<li><code>DOM</code> 元素或 DOM 元素组成的数组：将 <code>DOM</code> 元素或数组中的元素添加到集合中</li>
<li><code>HTML</code> 字符串：将 <code>HTML</code> 字符串解析为 <code>DOM</code> 元素后添加到集合中</li>
</ul>
<p>该方法会返回一个新的 <code>jQuery</code> 集合，例子如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> collection = $(<span class="string">"#box"</span>);</span><br><span class="line">collection = collection.add(<span class="string">".container"</span>); <span class="comment">// 添加一个 jQuery 选择器</span></span><br><span class="line">collection = collection.add(<span class="built_in">document</span>.getElementsByTagName(<span class="string">"p"</span>)[<span class="number">0</span>]); <span class="comment">// 添加一个 DOM 元素</span></span><br><span class="line">collection = collection.add(<span class="string">"&lt;h1&gt;123&lt;/h1&gt;"</span>); <span class="comment">// 添加一个 HTML 字符串</span></span><br><span class="line"><span class="built_in">console</span>.dir(collection);</span><br></pre></td></tr></table></figure>

<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/Snipaste_2020-04-07_19-33-07.png"/>
</center>

<h3 id="过滤元素"><a href="#过滤元素" class="headerlink" title="过滤元素"></a>过滤元素</h3><p>过滤集合中的元素有两种方法，一个是 <code>not</code>，一个是 <code>filter</code>，两个方法的侧重点不同， <code>not</code> 方法会删除掉集合中符合条件的元素，返回新集合；而 <code>filter</code> 的语义是保留集合中符合条件的元素，返回一个新集合。二者接收的参数同 <code>add</code> 方法一样，除此之外，还可以接受一个函数，集合中的每一个元会素调用该函数，根据函数的返回值来决定元素的去留，比如对于 <code>not</code> 方法，如果函数返回 <code>true</code>，则删除此元素，对于 <code>filter</code> 则相反，如果返回 <code>true</code>，则保留此元素。这些传入的函数中的上下文(也就是 <code>this</code>)指向调用该函数的元素。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> collection = $(<span class="string">"#box"</span>);</span><br><span class="line">collection = collection.add(<span class="string">".container"</span>); <span class="comment">// 添加一个 jQuery 选择器</span></span><br><span class="line">collection = collection.add(<span class="built_in">document</span>.getElementsByTagName(<span class="string">"p"</span>)[<span class="number">0</span>]); <span class="comment">// 添加一个 DOM 元素</span></span><br><span class="line">collection = collection.add(<span class="string">"&lt;h1&gt;123&lt;/h1&gt;"</span>); <span class="comment">// 添加一个 HTML 字符串</span></span><br><span class="line">collection = collection.not(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $(<span class="keyword">this</span>).html() === <span class="string">"123"</span>; <span class="comment">// 删除掉 html 内容为 123 的，也就是 h1 标签</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.dir(collection);</span><br></pre></td></tr></table></figure>

<p>根据上面的代码，此时集合中只有三个元素，将 <code>h1</code> 元素滤除了</p>
<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/Snipaste_2020-04-07_19-48-05.png"/>
</center>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> collection = $(<span class="string">"#box"</span>);</span><br><span class="line">collection = collection.add(<span class="string">".container"</span>); <span class="comment">// 添加一个 jQuery 选择器</span></span><br><span class="line">collection = collection.add(<span class="built_in">document</span>.getElementsByTagName(<span class="string">"p"</span>)[<span class="number">0</span>]); <span class="comment">// 添加一个 DOM 元素</span></span><br><span class="line">collection = collection.add(<span class="string">"&lt;h1&gt;123&lt;/h1&gt;"</span>); <span class="comment">// 添加一个 HTML 字符串</span></span><br><span class="line">collection = collection.filter(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $(<span class="keyword">this</span>).html() === <span class="string">"123"</span>; <span class="comment">// 保留 html 内容为 123 的，也就是 h1 标签</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.dir(collection);</span><br></pre></td></tr></table></figure>

<p>将上面的 <code>not</code> 改为 <code>filter</code>，这时集合里面就只有一个元素，那就是 <code>h1</code> 元素</p>
<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/Snipaste_2020-04-07_19-50-33.png"/>
</center>

<blockquote>
<p>通过上面几个方法的学习，我们知道这些方法返回的都是一个新的 <code>jQuery</code> 集合，这意味着可以接着<code>.</code>，如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> collection = $(<span class="string">"#box"</span>)</span><br><span class="line">                    .add(<span class="string">".container"</span>)</span><br><span class="line">                    .add(<span class="built_in">document</span>.getElementsByTagName(<span class="string">"p"</span>)[<span class="number">0</span>])</span><br><span class="line">                    .add(<span class="string">"&lt;h1&gt;123&lt;/h1&gt;"</span>)</span><br><span class="line">                    .filter(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> $(<span class="keyword">this</span>).html() === <span class="string">"123"</span>;</span><br><span class="line">                    &#125;);</span><br></pre></td></tr></table></figure>

<p>这样写起来明显比上面写起来爽多了，这种写法叫做链式编程，像链子一样，一个接着一个。</p>
</blockquote>
<h3 id="遍历集合"><a href="#遍历集合" class="headerlink" title="遍历集合"></a>遍历集合</h3><p>使用 <code>each</code> 方法遍历集合，该方法接收一个函数，集合中的每一个元素都会调用 <code>each</code> 中传入的函数，该函数的上下文会被设定为该元素，如</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log($(<span class="keyword">this</span>).html())</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/Snipaste_2020-04-07_20-44-18.png"/>
</center>

<h3 id="集合查找"><a href="#集合查找" class="headerlink" title="集合查找"></a>集合查找</h3><ul>
<li><p><code>is(selector)</code>：判断是否集合中是否包含与选择器匹配的元素，包含返回 <code>true</code>，否则返回 <code>false</code></p>
</li>
<li><p><code>has(test)</code>：<code>test</code> 可以为选择器，也可以为 <code>DOM</code> 元素，它判断的是集合中的元素的后代中是否包含与 <code>test</code> 匹配的元素，如果集合中某元素 <code>e</code> 的后代包含与 <code>test</code> 匹配的元素，则将元素 <code>e</code> 添加到新的集合中，最后返回该集合，如</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).has(<span class="string">"ol"</span>); <span class="comment">// $("div")中有两个元素，只有第一个div元素的后代有ol元素，所以返回的新的集合中包含一个元素，是第一个div元素</span></span><br><span class="line">$(<span class="string">"div"</span>).has(<span class="string">"li"</span>); <span class="comment">// 两个元素的后代都有li元素，所以新集合中的元素与原集合相同</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>find(selector)</code>：该方法会遍历集合中的所有元素，在这些元素的后代找到匹配 <code>selector</code> 的元素，然后将这些匹配的元素添加到一个新的集合中，并返回该新的集合</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).find(<span class="string">"img"</span>) <span class="comment">// 在所有div标签中找到img标签，返回这些img标签组成的集合</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="转换集合"><a href="#转换集合" class="headerlink" title="转换集合"></a>转换集合</h3><p><code>jQuery</code> 对象有一个 <code>map</code> 方法，该方法与数组的 <code>map</code> 方法一样，接收一个回调函数，集合中的每一个元素都会调用该函数，该函数的返回值会被添加到新的集合中并返回(如果返回的是 <code>null</code> 或者 <code>undefined</code> 则不会添加到新的集合中)，该函数有两个参数，第一个参数是元素在集合中的下标，第二个参数是调用该函数的元素。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).map(<span class="function"><span class="keyword">function</span>(<span class="params">index, element</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> index;</span><br><span class="line">    <span class="comment">// get()方法会将集合转变为一个真正的数组</span></span><br><span class="line">&#125;).get().join(<span class="string">", "</span>); <span class="comment">//"0, 1, 2, 3, 4"</span></span><br></pre></td></tr></table></figure>

<h2 id="操作-DOM-元素的属性和类属性"><a href="#操作-DOM-元素的属性和类属性" class="headerlink" title="操作 DOM 元素的属性和类属性"></a>操作 DOM 元素的属性和类属性</h2><h3 id="操作属性"><a href="#操作属性" class="headerlink" title="操作属性"></a>操作属性</h3><p>我们可以使用<code>attr()</code>方法方便的操作 <code>DOM</code> 元素的属性</p>
<ul>
<li><p><code>attr(name, value)</code>：为名字为 <code>name</code> 的属性设置值为 <code>value</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).attr(<span class="string">"id"</span>, <span class="string">"box"</span>); <span class="comment">// 将所有 div 标签的 id 设置为 box</span></span><br></pre></td></tr></table></figure>

<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/Snipaste_2020-04-07_21-14-36.png"/>
</center>
</li>
<li><p><code>attr(name)</code>：获取集合中第一个元素中属性名字为 <code>name</code> 的值</p>
</li>
<li><p><code>attr(attributes)</code>：以对象的形式来设置属性值</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">".attr"</span>).attr(&#123;</span><br><span class="line">    title: <span class="string">"cat"</span>, <span class="comment">// 设置 title 属性为 cat</span></span><br><span class="line">    id: <span class="string">"cat"</span> <span class="comment">// 设置 id 属性为 cat</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>removeAttr(name)</code>：删除指定名称的属性</p>
</li>
</ul>
<blockquote>
<p>经过测试，发现 <code>attr()</code> 方法可以设置任意属性的值(我的意思是指即使这些属性是不存在的，比如  <code>dog</code> 也可以设置，而这些不存在的属性称为自定义属性)，比如</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">attr(<span class="string">"dog"</span>, <span class="string">"dog"</span>); <span class="comment">// 为 dog 属性设置值为 dog</span></span><br></pre></td></tr></table></figure>

<p>上面的 <code>dog</code> 就是自定义的属性名。在 <code>HTML5</code> 中建议自定义属性名以 <code>data-</code> 开头，如 <code>data-dog</code>， <code>HTML5</code> 会将 <code>data-</code> 开头的属性名添加到 <code>dataset</code> 的对象中，我们可以通过</p>
<ul>
<li><p><code>dataset[&quot;属性名&quot;]</code></p>
</li>
<li><p><code>dataset.属性名</code></p>
</li>
</ul>
<p>的方式访问，这时的属性名不需要加上 <code>data-</code> 前缀，如</p>
<ul>
<li><p><code>dataset[&quot;dog&quot;]</code></p>
</li>
<li><p><code>dataset.dog</code></p>
</li>
</ul>
<p>如果属性名之间使用 <code>-</code> 连接，如 <code>data-my-name</code>，则访问时需要使用驼峰命名法访问，即</p>
<ul>
<li><p><code>dataset[&quot;myName&quot;]</code></p>
</li>
<li><p><code>dataset.myName</code></p>
</li>
</ul>
</blockquote>
<h4 id="在新的页面打开标签"><a href="#在新的页面打开标签" class="headerlink" title="在新的页面打开标签"></a>在新的页面打开标签</h4><p>现在使用 <code>attr()</code> 方法来做几个例子，第一个要求页面内的链接都要在新的页面打开，做法就是将 <code>a</code> 标签的 <code>target</code> 属性设置为 <code>_blank</code> ，这种事情当然可以在写的时候就写好，但是有两个问题</p>
<ul>
<li><p>首先这个工作是重复性的工作，每写一个 <code>a</code> 都要重复同样的事情，既累又不够优雅</p>
</li>
<li><p>如果页面内的链接是用户加入的呢，比如百科，这时打开的链接就不一定是在新的页面打开了</p>
</li>
</ul>
<p>所以我们可以使用 <code>attr()</code> 批量设置 <code>a</code> 标签的 <code>target</code> 属性为 <code>_blank</code> ，但是并不是所有的 <code>a</code> 标签，因为有的 <code>a</code> 标签是在页面内跳转的，我们并不需要在新的页面内打开，所以应该设置 <code>href</code> 属性以 <code>http://</code> 开头的 <code>a</code> 标签在新的页面打开</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"a[href^='http://']"</span>).attr(<span class="string">"target"</span>, <span class="string">"_blank"</span>)</span><br></pre></td></tr></table></figure>

<h4 id="解决双重提交"><a href="#解决双重提交" class="headerlink" title="解决双重提交"></a>解决双重提交</h4><p>在提交表单时，有的时候由于不能够及时给予用户反馈，导致用户不确定是否提交成功，用户会多次点击提交按钮，这样会给服务器端带来麻烦，我们在捕获 <code>submit</code> 事件时，当用户第一次提交时，我们接着将 <code>disabled</code> 属性设置为 <code>true</code> (或者为 <code>disabled</code> )，如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 绑定表单的提交事件</span></span><br><span class="line">$(<span class="string">"form"</span>).submit(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// :submit 表示 type 为 submit 的元素</span></span><br><span class="line">    <span class="comment">// 提交之后将submit按钮设置为disabled</span></span><br><span class="line">    $(<span class="string">":submit"</span>, <span class="keyword">this</span>).attr(<span class="string">"disabled"</span>, <span class="string">"disabled"</span>) </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在上面中设置 <code>disabled</code> 属性时，<code>disabled</code> 属性的值不重要，重点是设置了 <code>disabled</code> 这个属性，所以即使将它设置为空字符串 <code>&quot;&quot;</code>，它也是生效的，如果想 <code>disabled</code> 属性设置为不生效，那么就将它的值设置为 <code>false</code> (注意不要设置为字符串 <code>&quot;false&quot;</code> )，下面的写法作用是一样的，都是使得 <code>disabled</code> 生效</p>
<ul>
<li><p><code>attr(&quot;disabled&quot;, &quot;disabled&quot;)</code></p>
</li>
<li><p><code>attr(&quot;disabled&quot;, &quot;&quot;)</code></p>
</li>
<li><p><code>attr(&quot;disabled&quot;, &quot;false&quot;)</code></p>
</li>
<li><p><code>attr(&quot;disabled&quot;, true)</code></p>
</li>
</ul>
<p>只有将 <code>disabled</code> 设置为布尔值 <code>false</code> 才会使得 <code>disabled</code> 失效</p>
<ul>
<li><strong><code>attr(&quot;disabled&quot;, false)</code></strong></li>
</ul>
</blockquote>
<h3 id="操作类属性"><a href="#操作类属性" class="headerlink" title="操作类属性"></a>操作类属性</h3><p>为什么类属性要单独拿出来呢? 假设有这么一个需求，为所有的 <code>div</code> 标签添加一个类 <code>box</code>，那下面这样的写法对不对</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).attr(<span class="string">"class"</span>, <span class="string">"box"</span>);</span><br></pre></td></tr></table></figure>

<p>上面的写法是错误的，因为上面的写法是为 <code>class</code> 属性赋值为 <code>box</code>，但是之前的类属性就会被覆盖掉，我们想做的仅仅是添加的操作，所以我们需要知道之前的类属性是什么，所以正确的写法如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获得原来的类名列表 转化为数组</span></span><br><span class="line"><span class="keyword">const</span> classList = $(<span class="string">"div"</span>).attr(<span class="string">"class"</span>).split(<span class="string">" "</span>);</span><br><span class="line"><span class="comment">// 将要添加的类名添加到数组中</span></span><br><span class="line">classList.push(<span class="string">"box"</span>);</span><br><span class="line"><span class="comment">// 将数组中的元素以空格拼接为一个字符串</span></span><br><span class="line"><span class="keyword">const</span> newClassList = classList.join(<span class="string">" "</span>);</span><br><span class="line"><span class="comment">// 设置class属性</span></span><br><span class="line">$(<span class="string">"div"</span>).attr(<span class="string">"class"</span>, newClassList);</span><br></pre></td></tr></table></figure>

<p>经过千辛万苦终于添加了一个类，考虑到这样的操作很频繁，所以最好将上面的操作抽象为一个方法，而 <code>jQuery</code> 为我们做了这件事情：</p>
<ul>
<li><p><code>addClass(names)</code></p>
<ul>
<li><p><code>names</code> 可以是单个类名，也可以是一个以空格分隔的字符串表示的多个类名</p>
</li>
<li><p><code>names</code> 还可以是一个函数，函数的返回值作为单个类名或者多个类名，这个函数会传入两个参数，元素的下标(元素在 <code>jQuery</code> 集合中的下标)和当前类名的值</p>
</li>
</ul>
</li>
<li><p><code>removeClass(names)</code></p>
<ul>
<li>参数同 <code>addClass</code> ，作用是删除单个或多个类名</li>
</ul>
</li>
<li><p><code>toggleClass(names)</code></p>
<ul>
<li><p>该函数的作用是切换类名，什么意思呢? 比如如果该元素存在 <code>names</code> 指定的类，则删除掉指定的类，如果不存在指定的类，则添加指定的类</p>
</li>
<li><p>参数同上</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">addClass(<span class="string">"box"</span>); <span class="comment">// 为元素添加 box 类</span></span><br><span class="line">addClass(<span class="function"><span class="keyword">function</span>(<span class="params">index, value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// index 是元素在 jQuery 中的下标</span></span><br><span class="line">    <span class="comment">// value 是元素当前类名的值</span></span><br><span class="line">    <span class="comment">// return "active big" </span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"box"</span>; <span class="comment">// 返回值将会被作为类名添加</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">removeClass(<span class="string">"box"</span>); <span class="comment">// 删除该元素 box 类</span></span><br><span class="line"></span><br><span class="line">toggleClass(<span class="string">"box"</span>); <span class="comment">// 如果存在 box 类，则删除 box 类，如果不存在 box 类，则添加 box 类</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>hasClass(name)</code><ul>
<li>判断是否包含类名为 <code>name</code> 的类，包含则返回 <code>true</code>，否则返回 <code>false</code></li>
</ul>
</li>
</ul>
<blockquote>
<p><code>HTML5</code> 其实也提供了原生的操作类的方法，每个元素都有一个 <code>classList</code> 对象，它的原型对象提供了操作类名的方法</p>
<ul>
<li><p><code>classList.add()</code>：为元素添加<strong>一个</strong>类</p>
</li>
<li><p><code>classList.remove()</code>：为元素删除指定的类</p>
</li>
<li><p><code>classList.toggle()</code>：切换指定的类，存在则移除，不存在则添加</p>
</li>
<li><p><code>classList.contains()</code>：判断是否存在指定的类，存在返回 <code>true</code>，反之返回 <code>false</code></p>
</li>
</ul>
<p>据我试验所知，上面的每次操作只能对一个类操作，意思就是不能同时添加多个类或删除。</p>
</blockquote>
<h2 id="操作样式"><a href="#操作样式" class="headerlink" title="操作样式"></a>操作样式</h2><p>使用 <code>css()</code> 方法来设置样式，使用的方法与 <code>attr()</code> 类似</p>
<ul>
<li><code>css(name, value)</code>：设置样式 <code>name</code> 为 <code>value</code></li>
<li><code>css(properties)</code>：传入一个对象，通过对象来设置样式</li>
<li><code>css(name)</code>：获得样式，如果是含有多个元素的 <code>jQuery</code> 集合调用此方法，那么返回的是第一个元素的计算样式值</li>
</ul>
<p>看一个例子，有下面的 <code>div</code> 标签</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>现为它设置高度和宽度</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).css(&#123;</span><br><span class="line">    width: <span class="string">"100px"</span>,</span><br><span class="line">    height: <span class="string">"100px"</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>css(name, value)：其中 <code>value</code> 可以是一个函数，该函数的返回值将作为 <code>value</code> 值，这个函数会接收两个参数，第一个参数是元素在 <code>jQuery</code> 集合中的位置，第二个参数是样式当前的值，同时函数的内部上下文 <code>this</code> 指向当前元素</p>
</blockquote>
<h3 id="获取元素宽度"><a href="#获取元素宽度" class="headerlink" title="获取元素宽度"></a>获取元素宽度</h3><p>下面我们来获取某元素的 <code>width</code> 值</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).css(<span class="string">"width"</span>); <span class="comment">// 100px</span></span><br></pre></td></tr></table></figure>

<p>得到的结果是一个一个字符串，而不是数字，很多时候我们是希望得到数字用来计算或者其他用途，所以如果想得到数字的话就需要对字符串进行解析，但是 <code>jQuery</code> 有考虑这一方面，我们可以很方便的使用 <code>width(), height()</code> 方法获得数字的结果，如</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).width(); <span class="comment">// 100</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里的 <code>width</code> 的大小是设置样式时的大小吗? 比如</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用 <code>width()</code> 方法得到的数字是100吗? 为什么在这里我会提出这么一个疑问，因为这里设置的 <code>width</code> 不一定是标签的内容宽度，也可能包括 <code>padding, border</code> (当 <code>box-sizing</code> 设置为 <code>border-box</code> 时)，所以这里的 <code>width</code> 得到的是 <code>content-width</code> 还是在 <code>style</code> 标签中设置的 <code>width</code> ，我们设置 <code>div</code> 的样式为</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个时候在 <code>style</code> 里面设置的 <code>width</code> 为 <code>100</code> ，但是实际的 <code>content-width</code> 应该是 <code>80</code> ，我们来看一下 <code>width()</code> 方法得到的结果是多少</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).width(); <span class="comment">// 80</span></span><br></pre></td></tr></table></figure>

<p>上面得到的结果是 <code>80</code> ，所以 <code>width()</code> 方法得到的宽度是 <code>content-width</code> ，即是实际内容的宽度， <code>height()</code> 方法也是同理。</p>
</blockquote>
<p>除了可以使用 <code>width()</code> 方法获得元素的宽度以外，还可以设置元素的宽度</p>
<ul>
<li><code>width(value)</code><ul>
<li><code>value</code> 的值可以是一个数字，单位默认为 <code>px</code></li>
<li>也可以是带单位的字符串(如果没有指定单位，则默认为 <code>px</code>)</li>
<li>还可以是一个函数，函数的返回值作为要设置的值，该函数的上下文(<code>this</code>)是该元素</li>
</ul>
</li>
</ul>
<blockquote>
<p>这里又有一个疑问，如果我设定宽度，那么这里的宽度我设定的是内容宽度 <code>conetnt-width</code> 还是元素的 <code>width</code> 样式，这里我们还是以上面的 <code>div</code> 为例</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里我们设定 <code>width</code> 为 <code>200</code> ，然后通过 <code>width()</code> 方法获得宽度，如果得到的值是 <code>200</code> ，那说明设定的是 <code>content-width</code> ，如果得到的是 <code>180</code> ，说明设定的是 <code>width</code> 样式的值</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).width(<span class="number">200</span>);</span><br><span class="line"><span class="built_in">console</span>.log($(<span class="string">"div"</span>).width()); <span class="comment">// 200</span></span><br></pre></td></tr></table></figure>

<p>得到的结果是 <code>200</code> ，说明设定的是 <code>content-width</code> 。</p>
</blockquote>
<blockquote>
<p>在这里我突然又有一个想法，那就是 <code>css(&quot;width&quot;)</code> 与 <code>width()</code> 得到的结果是相同的吗，还是以上面的 <code>div</code> 为例</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log($(<span class="string">"div"</span>).width()); <span class="comment">// 80</span></span><br><span class="line"><span class="built_in">console</span>.log($(<span class="string">"div"</span>).css(<span class="string">"width"</span>)); <span class="comment">// 100px</span></span><br></pre></td></tr></table></figure>

<p>惊讶的发现二者得到的结果是在数值上是不一样的，可见使用 <code>css(&quot;width&quot;)</code> 获得的是 <code>width</code> 样式的值，那么使用 <code>css(&quot;width&quot;, 200)</code> 设定的是 <code>width</code> 样式的值吗，测试一下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).css(<span class="string">"width"</span>, <span class="number">200</span>);</span><br><span class="line"><span class="built_in">console</span>.log($(<span class="string">"div"</span>).width()); <span class="comment">// 180</span></span><br><span class="line"><span class="built_in">console</span>.log($(<span class="string">"div"</span>).css(<span class="string">"width"</span>)); <span class="comment">// 200px</span></span><br></pre></td></tr></table></figure>

<p>果然 <code>css()</code> 方法设置的值也是 <code>width</code> 样式的值，所以这里总结一下：</p>
<ul>
<li><code>width()</code>(<code>height()</code>)方法设定或者获取的值是指<strong>内容的宽度(高度)</strong></li>
<li><code>css()</code> 设定或获取的宽度(高度)是指样式里面的 <code>width</code> 值的大小</li>
<li>在 <code>box-sizing</code> 为 <code>content-box</code> 下二者得到的数值结果是一样的，但是在 <code>box-sizing</code> 为 <code>border-box</code> 的情况下，由于 <code>padding</code> 和 <code>border</code> 的影响，二者的结果是不同的(在 <code>padding</code> 和 <code>border</code> 为 <code>0</code> 的情况下是相同的)。</li>
</ul>
</blockquote>
<blockquote>
<p>经过一次实践，我发现上面的描述也不太准确，<code>css(&quot;width&quot;)</code>与<code>width()</code>方法获得的值符合上面情况的条件是，它的大小没有超过它父元素的大小，如果超过了，那么<code>css(&quot;width&quot;)</code>就是父元素的<code>width</code>样式的大小，而<code>width()</code>方法的大小我觉得很复杂，还不知道怎么计算，自己动手试试吧。</p>
</blockquote>
<p>除了 <code>width()</code> 和 <code>height()</code> 方法，<code>jQuery</code> 还提供了特别的方法来获得特殊的宽度和高度</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>innerwidth()</code></td>
<td>内容宽度+内边距宽度</td>
</tr>
<tr>
<td><code>innerHeight()</code></td>
<td>同上</td>
</tr>
<tr>
<td><code>outerWidth(margin)</code></td>
<td><ul><li>margin为false时，内容宽度 + 内边距宽度 + 边框宽度</li><li>margin为true时，再加上外边距的宽度</li></ul></td>
</tr>
<tr>
<td><code>outerHeight(margin)</code></td>
<td>同上</td>
</tr>
</tbody></table>
<h3 id="获取元素位置"><a href="#获取元素位置" class="headerlink" title="获取元素位置"></a>获取元素位置</h3><h4 id="offset"><a href="#offset" class="headerlink" title="offset"></a>offset</h4><p><code>offset()</code>，获取元素离文档原点的距离，返回一个对象，里面有 <code>left</code> 和 <code>top</code> 两个属性，表示离文档原点经过测试，应该是元素的 <code>border</code> 的左上角离文档原点的距离，考虑下面的 <code>html</code> 和 <code>css</code></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>offset<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcss.com/jquery/3.4.1/jquery.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        body &#123;</span><br><span class="line"><span class="css">            <span class="selector-tag">margin</span>: 0; <span class="comment">/* body有8px的margin */</span></span></span><br><span class="line">            padding: 0;</span><br><span class="line">        &#125;</span><br><span class="line">        div &#123;</span><br><span class="line">            margin-top: 100px;</span><br><span class="line">            margin-left: 100px;</span><br><span class="line">            padding-left: 100px;</span><br><span class="line">            padding-top: 100px;</span><br><span class="line">            width: 100px;</span><br><span class="line">            height: 100px;</span><br><span class="line">            border: 100px solid red;</span><br><span class="line">            background-color: pink;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/Snipaste_2020-03-30_16-13-37.png"/>
</center>

<p>来测试一下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">console</span>.log($(<span class="string">"div"</span>).offset()); <span class="comment">// &#123;top: 100, left: 100&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="position"><a href="#position" class="headerlink" title="position"></a>position</h4><p>另一个获取位置有关信息的是 <code>position()</code> ，它是获得与它元素左上角之间的距离，这个父元素是它所有父元素中使用了定位 <code>position</code> 且离他最近的父元素，虽然有点拗口，不过使用过绝对定位的话，就会很容易明白，因为它与绝对定位的规则是一样的。</p>
<blockquote>
<p>经过我的实验，发现这个距离不是边框与边框的距离，而是子元素 margin 离父元素 padding 之间的距离</p>
</blockquote>
<p>考虑下面这么一个<code>HTML</code></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>position<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcss.com/jquery/3.4.1/jquery.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        body &#123;</span><br><span class="line">            font-size: 10px;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-class">.container</span> &#123;</span></span><br><span class="line">            margin: 100px;</span><br><span class="line">            background-color: grey;</span><br><span class="line">            width: 400px;</span><br><span class="line">            height: 400px;</span><br><span class="line">            position: relative;</span><br><span class="line"><span class="css">            <span class="selector-tag">overflow</span>: <span class="selector-tag">hidden</span>; <span class="comment">/* 防止外边距塌陷，下同 */</span></span></span><br><span class="line"><span class="css">            <span class="selector-tag">border</span>: 2<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#cccccc</span>;</span></span><br><span class="line">            padding: 10px;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-class">.outer</span> &#123;</span></span><br><span class="line">            width: 200px;</span><br><span class="line">            height: 200px;</span><br><span class="line">            margin: 60px;</span><br><span class="line">            background-color: greenyellow;</span><br><span class="line">            overflow: hidden;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.inner</span> &#123;</span></span><br><span class="line">            width: 100px;</span><br><span class="line">            height: 100px;</span><br><span class="line">            background-color: pink;</span><br><span class="line">            margin: 20px;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"outer"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inner"</span>&gt;</span></span><br><span class="line">                </span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log($(<span class="string">".inner"</span>).position()); <span class="comment">// outer的margin + container的padding = 70</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log($(<span class="string">".outer"</span>).position()); <span class="comment">// container的padding = 10</span></span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/Snipaste_2020-03-30_16-51-37.png"/>
</center>


<h2 id="操作-DOM-元素"><a href="#操作-DOM-元素" class="headerlink" title="操作 DOM 元素"></a>操作 DOM 元素</h2><h3 id="设置-html-内容以及文本内容"><a href="#设置-html-内容以及文本内容" class="headerlink" title="设置 html 内容以及文本内容"></a>设置 html 内容以及文本内容</h3><ul>
<li><code>html()</code>：获取jQuery集合中第一个元素的 <code>html</code> 内容</li>
<li><code>html(content)</code>：将传入的 <code>HTML</code> 片段，设置 <code>jQuery</code> 集合中元素的 <code>HTML</code> 内容</li>
<li><code>text()</code>：获得 <code>jQuery</code> 集合中所有元素的文本内容拼接的字符串</li>
<li><code>text(content)</code>：将 <code>jQuery</code> 集合元素的文本内容设置为传入的值</li>
</ul>
<blockquote>
<p><code>content</code> 可以为字符串，也可以是一个函数，函数的返回值作为要设置的内容，函数接受两个参数，第一个参数是元素在 <code>jQuery</code> 集合中的位置，第二个参数是当前<code>html</code>(<code>text</code>)的值。</p>
</blockquote>
<h3 id="追加元素"><a href="#追加元素" class="headerlink" title="追加元素"></a>追加元素</h3><ul>
<li><code>append(content)</code>：将 <code>content</code> 追加元素内容的最后面(子元素级别)</li>
<li><code>prepend(content)</code>：将 <code>content</code> 追加元素内容的最前面</li>
<li><code>before(content)</code>：将 <code>content</code> 追加到元素的前面(兄弟元素级别)</li>
<li><code>after(content)</code>：将 <code>content</code> 追加到元素的后面</li>
</ul>
<blockquote>
<p><code>content</code> 的值可以为字符串，元素，jQuery集合，函数，函数的返回值将被添加，函数将接受两个参数，元素的下标和原先的内容。</p>
<p>如果选择现有的DOM元素添加到某元素的最后，那么这是一个移动操作，而不是一个复制操作，比如有这么一个结构</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>执行下面的语句</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).append($(<span class="string">"p"</span>));</span><br></pre></td></tr></table></figure>

<p>得到的结果是</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>而不是</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果<code>jQuery</code>集合中有多个元素，那么被添加的元素会复制多份，添加到这些元素内容的后面(如果添加的是<code>DOM</code>中已有的元素，也是移动操作)，其它的操作(<code>prepend</code>…)也是同理。</p>
</blockquote>
<ul>
<li><code>appendTo(target)</code></li>
<li><code>prependTo(target)</code></li>
<li><code>insertBefore(target)</code></li>
<li><code>insertAfter(target)</code></li>
</ul>
<p>这些方法的作用同上面介绍的是个方法是一一对应的，不过是主动变为了被动，如</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).append(content); <span class="comment">// 向div中添加content</span></span><br><span class="line">$(<span class="string">"div"</span>).appendTo(target); <span class="comment">// 将div添加到target中</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>target</code> 只能为元素或者字符串</p>
</blockquote>
<h3 id="删除元素"><a href="#删除元素" class="headerlink" title="删除元素"></a>删除元素</h3><ul>
<li><code>remove(selector)</code>：删除 <code>jQuery</code> 集合中的元素，<code>selector</code> 是一个可选的选择器，用来进一步筛选要删除的元素，被删除的元素会放入一个新的 <code>jQuery</code> 集合中返回，所以被删除的元素可以继续插入到 <code>DOM</code> 中，但是这个时候之前绑定的事件和数据全部被删除了。</li>
<li><code>empty()</code>：删除 <code>DOM</code> 元素中的内容，与 <code>remove</code> 不同， <code>remove</code> 是删除这个 <code>DOM</code> 元素，包括这个元素包括的内容，但是 <code>empty</code> 只是清除该 <code>DOM</code> 元素的内容。</li>
<li><code>detach(selector)</code>：该方法的作用与 <code>remove</code> 是一样的，但是保留绑定的事件和绑定的数据。</li>
</ul>
<h3 id="复制元素"><a href="#复制元素" class="headerlink" title="复制元素"></a>复制元素</h3><ul>
<li><code>clone(cloneHandler)</code>：复制 <code>jQuery</code> 集合中的元素，生成一个新的 <code>jQuery</code> 集合返回。 <code>cloneHandler</code> 如果为 <code>true</code>，那么就会复制绑定的事件，如果为 <code>false</code> 就不会复制绑定的事件</li>
</ul>
<h3 id="替换元素"><a href="#替换元素" class="headerlink" title="替换元素"></a>替换元素</h3><ul>
<li><code>replaceWith(content)</code>：使用 <code>content</code> 去替换 <code>jQuery</code> 集合中的元素，返回被替换的元素， <code>content</code> 可以是字符串，元素和函数，函数的返回值作为替换的内容，函数的上下文被设置为当前的元素，不传递任何的参数；如果 <code>content</code> 是已经在<code>DOM</code>中的元素，那么就相当于是移动到 <code>jQuery</code> 集合中元素的位置，如果 <code>jQuery</code> 集合中有多个元素，会复制多个 <code>content</code> 副本</li>
<li><code>replaceAll(selector)</code>：使用 <code>jQuery</code> 集合中的所有元素去替换匹配 <code>selector</code> 的元素，如果<code>jQuery</code>集合中的元素是已经在 <code>DOM</code> 中的元素，那么就相当于将符合 <code>selector</code> 的元素删除，然后将 <code>jQuery</code> 集合中的元素移动到这里，如果符合 <code>selector</code> 的元素有多个，那么会复制多个 <code>jQuery</code> 集合的副本移动</li>
</ul>
<h3 id="处理表单元素"><a href="#处理表单元素" class="headerlink" title="处理表单元素"></a>处理表单元素</h3><ul>
<li><p><code>val()</code>：获得集合中第一个元素的 <code>value</code> 值，如果该元素是一个可以多选的元素，那么返回所有选择项组成数组(比如<code>&lt;select mupltiple=&quot;mupltiple&quot;&gt;&lt;/select&gt;</code>)</p>
<blockquote>
<p>如果第一个元素不是表单元素，则会返回空字符串</p>
</blockquote>
</li>
<li><p><code>val(value)</code>：设置集合中表单元素的 <code>value</code> 值</p>
<blockquote>
<p>value值也可以是函数，函数的返回值作为被设置的内容，函数接收两个参数，元素的下标和当前的value值</p>
</blockquote>
</li>
<li><p><code>val(values)</code>：使得多选框，单选框，或者<code>select</code>元素中的可选项中，如果这些选项的值在<code>values</code>中，则它变为选中状态</p>
</li>
</ul>
<h2 id="jQuery-事件"><a href="#jQuery-事件" class="headerlink" title="jQuery 事件"></a>jQuery 事件</h2><h3 id="绑定事件"><a href="#绑定事件" class="headerlink" title="绑定事件"></a>绑定事件</h3><p><code>jQuery</code> 使用 <code>on</code> 方法绑定事件，如下</p>
<ul>
<li><code>on(eventType, childSelector, data, listener)</code><ul>
<li><code>eventType</code>，必需，要绑定的事件的类型，如 <code>click</code></li>
<li><code>childSelector</code>，可选，规定把事件绑定到子元素上</li>
<li><code>data</code>，可选，规定传递到函数的额外数据</li>
<li><code>listener</code>，可选，规定事件发生时运行的函数</li>
</ul>
</li>
</ul>
<p><code>on</code> 方法除了给已经存在于<code>DOM</code>中的元素绑定事件以外，还可以给现在还不存在于 <code>DOM</code> 中但是未来会添加到 <code>DOM</code> 中的元素绑定事件，如</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>此时 <code>DOM</code> 中只有 <code>div</code> 标签，这时我想给未来会被添加到 <code>DOM</code> 中的 <code>p</code> 标签绑定点击事件</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"p"</span>).appendTo($(<span class="string">"div"</span>)); <span class="comment">// 将p标签添加到div中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 为div标签中的p标签绑定事件，即使p标签一开始并不在DOM中，也可以绑定成功</span></span><br><span class="line">$(<span class="string">"div"</span>).on(<span class="string">"click"</span>, <span class="string">"p"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>使用 <code>one()</code> 绑定事件，该事件在执行完一次后会被删除</p>
<ul>
<li><code>one(eventType, data, listener)</code><ul>
<li>各参数的含义与 <code>on</code> 是一致的</li>
</ul>
</li>
</ul>
<p>除了可以使用上面的方法绑定事件以外，<code>jQuery</code> 还提供了十分方便的绑定特定事件方法，如</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 为div标签绑定点击事件</span></span><br><span class="line">$(<span class="string">"div"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这样直接以事件的名字绑定事件，既方便，语义又明确，支持这种方式的 <code>eventTypeName</code> 如下</p>
<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/Snipaste_2020-03-31_22-38-08.png"/>
</center>
### 解绑事件

<ul>
<li><code>off(event, selector, listener)</code>：移除通过 <code>on</code> 方法绑定的事件</li>
</ul>
<h3 id="触发事件"><a href="#触发事件" class="headerlink" title="触发事件"></a>触发事件</h3><ul>
<li><code>trigger(event, data)</code><ul>
<li>这个方法是用来触发事件的，比如 <code>$(&quot;#foo&quot;).trigger(&quot;click&quot;)</code> 会触发 <code>id</code> 为 <code>foo</code> 的点击事件</li>
<li><code>data</code> 是可选参数，是传递给事件处理的额外参数，它是一个数组或者对象</li>
</ul>
</li>
</ul>
<blockquote>
<p>来解释一下 <code>data</code>，加入在绑定事件时需要额外的参数，如</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 需要额外的参数a, b</span></span><br><span class="line">$(<span class="string">"#foo"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params">event, a, b</span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这时我们在触发事件时就需要传入额外的参数</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"#foo"</span>).trigger(<span class="string">"click"</span>, [<span class="string">"foo"</span>, <span class="string">"bar"</span>])</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li><p><code>triggerHandler(event, data)</code></p>
<ul>
<li><code>triggerHandler</code> 的作用与 <code>trigger</code> 类似，不过有几点不同</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li><p><code>.triggerHandler()</code> 方法并不会触发事件的默认行为(例如，表单提交)。</p>
</li>
<li><p><code>.trigger()</code> 会影响所有与 <code>jQuery</code> 对象相匹配的元素，而 <code>.triggerHandler()</code> 仅影响第一个匹配到的元素。</p>
</li>
<li><p>使用 <code>.triggerHandler()</code> 创建的事件，并不会在 <code>DOM</code> 树中向上冒泡。</p>
</li>
<li><p><code>.triggerHandler()</code> 返回最后一个处理的事件的返回值，而不是 <code>jQuery</code> 集合，即不能进行链式调用</p>
</li>
</ul>
</blockquote>
<p>除了上述的方法外，<code>jQuery</code> 还提供了可以直接通过名字直接触发事件，如</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"#foo"</span>).click() <span class="comment">// 触发点击事件</span></span><br></pre></td></tr></table></figure>

<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/Snipaste_2020-03-31_23-03-06.png"/>
</center>
### 其他事件

<ul>
<li><p><code>toggle(listener1, listener2, ...)</code></p>
<ul>
<li>当点击元素时会依次触发事件</li>
<li>比如第一次点击触发 <code>listener1</code> ，第二次点击触发 <code>listener2</code> ，以此类推，如果 <code>toggle</code> 中的事件触发完了，那么会循环触发</li>
</ul>
</li>
<li><p><code>hover(enterHandle, leaveHadnler)</code></p>
<ul>
<li>当鼠标进入元素时触发 <code>enterHandle</code> ，离开元素时触发 <code>leaveHadnler</code></li>
</ul>
</li>
<li><p><code>hover(handler)</code></p>
<ul>
<li>当鼠标进入元素以及离开元素时均会触发 <code>handler</code></li>
</ul>
</li>
</ul>
<h3 id="Event实例"><a href="#Event实例" class="headerlink" title="Event实例"></a>Event实例</h3><p>我们向元素绑定事件时，会向监听器(绑定的处理函数)传入一个 <code>event</code> 对象，那么 <code>event</code> 对象中有什么信息可以为我们所用呢?</p>
<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/Snipaste_2020-03-31_23-14-09.png"/>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/Snipaste_2020-03-31_23-14-50.png"/>
</center>
## jQuery 显示与隐藏

<h3 id="显示和隐藏元素"><a href="#显示和隐藏元素" class="headerlink" title="显示和隐藏元素"></a>显示和隐藏元素</h3><ul>
<li><code>hide()</code>：隐藏元素</li>
<li><code>show()</code>：显示元素</li>
</ul>
<blockquote>
<p>隐藏元素是将元素的 <code>display</code> 属性设置为 <code>none</code>，而显示属性会将 <code>display</code> 属性设置为与隐藏前的 <code>display</code> 相同，比如在隐藏前某元素的 <code>display</code> 为 <code>block</code>， <code>hide</code> 会将 <code>dispaly</code> 设置为 <code>none</code>，<code>show</code> 会将 <code>display</code> 设置为与之前相同为 <code>block</code>。</p>
</blockquote>
<ul>
<li><code>toggle()</code>：切换，如果为显示，则隐藏，如果隐藏，则显示</li>
</ul>
<h3 id="显示隐藏动画"><a href="#显示隐藏动画" class="headerlink" title="显示隐藏动画"></a>显示隐藏动画</h3><p>上面的方法其实还可以接受两个参数</p>
<ul>
<li><code>hide(speed, callback)</code><ul>
<li><code>speed</code> 用来规定隐藏的速度，默认是没有动画效果的，元素瞬间消失，可以传入数字，单位是毫秒，也可以传入以下预定义的字符串，<code>slow, normal, fast</code></li>
<li><code>callback</code> 是动画执行完毕后会执行的回调函数</li>
</ul>
</li>
</ul>
<blockquote>
<p>同理，<code>show()</code> 和<code>toggle()</code> 也由这两个参数，与<code>hide()</code> 的用法一模一样，所以不再赘述。</p>
</blockquote>
<p>假设有一个 <code>div</code> 标签，当我们点击它时，它会先隐藏，会显示</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="string">"div"</span>).hide(<span class="string">"slow"</span>).show(<span class="string">"fast"</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/202004011056.gif"/>
</center>

<p>除了上面方法显示和隐藏元素以外，<code>jQuery</code> 还提供了很多的方法，如</p>
<blockquote>
<p>淡入淡出(只改变元素的不透明度)：</p>
<ul>
<li><code>fadeIn(speed, callback)</code></li>
<li><code>fadeOut(speed, callback)</code></li>
<li><code>fadeTo(speed, opacity, callback)</code>：逐渐改变元素的透明度到设定的opacity</li>
</ul>
<p>我们在使用 <code>hide</code> 或者 <code>show</code> 时，除了改变透明度以外，还会改变高度和宽度，而 <code>fade...</code> 方法只会改变不透明度，当 <code>opacity</code> 为 <code>0</code> 时，将 <code>display</code> 设置为 <code>none</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> $(<span class="string">"div"</span>).fadeOut(<span class="string">"slow"</span>).fadeIn(<span class="string">"fast"</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<center>
 <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/202004011103.gif"/>
</center>

<p>滑入滑出：</p>
<ul>
<li><code>slideDown(speed, callback)</code>：改变元素的垂直尺寸，使元素逐渐显示出来</li>
<li><code>slideUp(speed, callback)</code>：改变元素的垂直尺寸，使元素逐渐消失</li>
<li><code>slideToggle(speed, callback)</code>：隐藏则显示，显示则隐藏</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> $(<span class="string">"div"</span>).slideUp(<span class="string">"slow"</span>).slideDown(<span class="string">"fast"</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<center>
 <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/202004011106.gif"/>
</center>
</blockquote>
<h2 id="jQuery-动画"><a href="#jQuery-动画" class="headerlink" title="jQuery 动画"></a>jQuery 动画</h2><ul>
<li><code>animate(properties, duration, easing, callback)</code><ul>
<li><code>properties</code>：元素最后达到的 <code>CSS</code> 状态</li>
<li><code>duration</code>：持续时间</li>
<li><code>easing</code>：动画曲线，<code>jQuery</code> 提供两个函数曲线 <code>linear</code> 和 <code>swing</code></li>
<li><code>callback</code>：动画执行完毕后的会执行的回调函数</li>
</ul>
</li>
</ul>
<p>我们通过给定希望元素最后能够达到的 <code>CSS</code> 状态，比如位置的变化，宽高的变化，而 <code>jQuery</code> 会自动根据持续的时间以及初始的状态计算出中间的过程，也就是帧，如</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="string">"div"</span>).animate(&#123;</span><br><span class="line">        width: <span class="string">"200px"</span></span><br><span class="line">    &#125;, <span class="number">500</span>, <span class="string">"swing"</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/202004011118.gif"/>
</center>

<h3 id="自定义缩放动画"><a href="#自定义缩放动画" class="headerlink" title="自定义缩放动画"></a>自定义缩放动画</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).hover(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 鼠标放上去时，放大两倍</span></span><br><span class="line">    $(<span class="string">"div"</span>).animate(&#123;</span><br><span class="line">        width: $(<span class="keyword">this</span>).width() * <span class="number">2</span>,</span><br><span class="line">        height: $(<span class="keyword">this</span>).height() * <span class="number">2</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="comment">// 离开时恢复原样</span></span><br><span class="line">    $(<span class="string">"div"</span>).animate(&#123;</span><br><span class="line">        width: $(<span class="keyword">this</span>).width() / <span class="number">2</span>,</span><br><span class="line">        height: $(<span class="keyword">this</span>).height() / <span class="number">2</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/202004011122.gif"/>
</center>

<h3 id="自定义掉落动画"><a href="#自定义掉落动画" class="headerlink" title="自定义掉落动画"></a>自定义掉落动画</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="keyword">this</span>).css(&#123;</span><br><span class="line">        position: <span class="string">"relative"</span></span><br><span class="line">    &#125;).animate(&#123;</span><br><span class="line">        opacity: <span class="number">0</span>,</span><br><span class="line">        <span class="comment">// 计算要下降的高度</span></span><br><span class="line">        top: $(<span class="built_in">window</span>).height() - $(<span class="keyword">this</span>).height() - $(<span class="keyword">this</span>).position().top</span><br><span class="line">    &#125;, <span class="string">"slow"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 因为 opacity 为 0 只是不可见，但是仍然占据位置，所以最后要hide隐藏一下</span></span><br><span class="line">        <span class="comment">// 可以将 opacity 最后的状态设置为 hide，那么这个回调函数可以省略</span></span><br><span class="line">        $(<span class="keyword">this</span>).hide()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/202004011129.gif"/>
</center>

<blockquote>
<p>将 <code>$.fx.off</code> 设置为 <code>true</code> 会禁用动画</p>
</blockquote>
<h2 id="jQuery扩展及实用函数"><a href="#jQuery扩展及实用函数" class="headerlink" title="jQuery扩展及实用函数"></a>jQuery扩展及实用函数</h2><h3 id="jQuery与其他库并存"><a href="#jQuery与其他库并存" class="headerlink" title="jQuery与其他库并存"></a>jQuery与其他库并存</h3><ul>
<li><code>$.noConflict()</code>：将 <code>$</code> 控制权给其他库，在执行该行代码后不能使用 <code>$</code>，只能使用 <code>jQuery</code></li>
</ul>
<h3 id="jQuery实用函数"><a href="#jQuery实用函数" class="headerlink" title="jQuery实用函数"></a>jQuery实用函数</h3><ul>
<li><code>$.trim(value)</code>：去除字符串前后的空白字符(不仅仅是空格，还有回车等等)</li>
<li><code>$.each(container, callback)</code>：会为 <code>container</code> (数组|对象)中的每个元素调用 <code>callback</code>，<code>callback</code> 的参数就是 <code>container</code> 中的每个元素</li>
<li><code>$.grep(array, callback, invert)</code>：为数组中的每个元素调用 <code>callback</code>，根据 <code>callback</code> 的返回值决定是否将元素添加到新的数组，如果 <code>invert</code> 为 <code>true</code>，那么 <code>callback</code> 返回 <code>false</code> 则将元素添加到新数组，反之若 <code>invert</code> 为 <code>false</code>，则 <code>callback</code> 返回 <code>true</code> 则将元素添加到新的数组，最后将新数组返回</li>
<li><code>$.map(array, callback)</code>：这个方法不想多解释</li>
<li><code>$.inArray(value, array)</code>：方法 <code>value</code> 在 <code>array</code> 中第一次出现的下标</li>
<li><code>$.makeArray(object)</code>：将一个伪数组转换为一个真正的数组</li>
<li><code>$.unique(array)</code>：返回 <code>array</code> 中不重复的元素组成的数组</li>
<li><code>$.merge(array1, array2)</code>：将第二个数组合并到第一个数组中，并返回第一个数组</li>
</ul>
<blockquote>
<p>上面的方法大多数 <code>JavaScript</code> 已经有原生的实现了</p>
</blockquote>
<h3 id="扩展jQuery"><a href="#扩展jQuery" class="headerlink" title="扩展jQuery"></a>扩展jQuery</h3><p><code>$.fn.xxx</code>：该方法会被添加到 <code>jQuery</code> 对象的原型上，通过这种方法可以扩展 <code>jQuery</code></p>
<h2 id="Ajax"><a href="#Ajax" class="headerlink" title="Ajax"></a>Ajax</h2><h3 id="启动一个Node来进行服务端测试"><a href="#启动一个Node来进行服务端测试" class="headerlink" title="启动一个Node来进行服务端测试"></a>启动一个Node来进行服务端测试</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer();</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">'request'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 处理跨域 允许http://127.0.0.1:5500跨域请求 因为我在这个地址访问页面</span></span><br><span class="line">    res.setHeader(<span class="string">'Access-Control-Allow-Origin'</span>, <span class="string">'http://127.0.0.1:5500'</span>);</span><br><span class="line">    res.end(<span class="string">"Hello World"</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">4000</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"服务启动在4000端口"</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="回顾Ajax"><a href="#回顾Ajax" class="headerlink" title="回顾Ajax"></a>回顾Ajax</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">    &lt;script src="https:/</span><span class="regexp">/cdn.bootcss.com/</span>jquery/<span class="number">3.4</span><span class="number">.1</span>/jquery.js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;button&gt;发送请求&lt;/button&gt;</span></span><br><span class="line"><span class="string">    &lt;ul&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;/ul&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;script&gt;</span></span><br><span class="line"><span class="string">        $("</span>button<span class="string">").click(function () &#123;</span></span><br><span class="line"><span class="string">            let xhr = new XMLHttpRequest();</span></span><br><span class="line"><span class="string">            // 设置请求方法和请求路径</span></span><br><span class="line"><span class="string">            xhr.open("</span>GET<span class="string">", "</span>http:<span class="comment">//localhost:4000");</span></span><br><span class="line">            </span><br><span class="line">        	<span class="comment">// 监听onreadystatechange，当readyState改变时会触发此函数</span></span><br><span class="line">            xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="comment">// readyState为4表示处理请求完成</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.readyState == <span class="number">4</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">this</span>.status &gt;= <span class="number">200</span> &amp;&amp; <span class="keyword">this</span>.status &lt; <span class="number">300</span>) &#123;</span><br><span class="line">                        <span class="comment">// 成功</span></span><br><span class="line">                        $(<span class="string">"ul"</span>).append(<span class="string">`&lt;li&gt;<span class="subst">$&#123;<span class="keyword">this</span>.responseText&#125;</span>&lt;/li&gt;`</span>)</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// 失败</span></span><br><span class="line">                        alert(<span class="string">"失败"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 发送的请求体数据 get方法不传参数，或者传入null</span></span><br><span class="line">            xhr.send();</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面的代码是当点击<code>button</code>时发送一个<code>ajax</code>请求，并且获得的内容添加到<code>ul</code>中，效果如下</p>
<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/202004011240.gif"/>
</center>
`XMLHttpRequest` 对象拥有的属性和方法为

<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/Snipaste_2020-04-01_12-44-51.png"/>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/Snipaste_2020-04-01_12-44-55.png"/>
</center>

<h3 id="jQuery-发起-Ajax-请求"><a href="#jQuery-发起-Ajax-请求" class="headerlink" title="jQuery 发起 Ajax 请求"></a>jQuery 发起 Ajax 请求</h3><ul>
<li><p><code>get(url, parameters, callback, type)</code></p>
<ul>
<li><code>url</code>：请求的路径</li>
<li><code>parameters</code>：请求参数，会被拼接到 <code>url</code> 后</li>
<li><code>callback</code>：请求成功后调用的函数</li>
<li><code>type</code>：以何种方式处理响应数据，如 <code>html</code>，<code>json</code></li>
</ul>
</li>
<li><p><code>getJSON(url, parameters, callback)</code>：相当于是 <code>get(url, parameters, callback, type)</code> 中 <code>type</code> 为 <code>json</code> 的快捷写法</p>
</li>
<li><p><code>post(url, parameters, callback, type)</code>：同 <code>get</code>，不过请求的方法是 <code>POST</code>，而且请求数据是放在请求体中的</p>
</li>
<li><p><code>ajax(options)</code>：</p>
<ul>
<li>用传入的选项来控制 <code>ajax</code> 请求，该方法可以控制发送 <code>ajax</code> 请求的各种细节</li>
</ul>
</li>
</ul>
<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/Snipaste_2020-04-01_13-11-00.png"/>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/Snipaste_2020-04-01_13-11-13.png"/>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/Snipaste_2020-04-01_13-11-23.png"/>
<img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/Snipaste_2020-04-01_13-11-31.png"/>
</center>


<p><code>jQuery</code> 的 <code>ajax</code> 方法为我们提供了这么多可选项，如果没有设置一些选项的话，就会使用默认值，使用 <code>ajaxSetup</code> 方法来设置默认值</p>
<ul>
<li><code>ajaxSetup(options)</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.ajaxSetup(&#123;</span><br><span class="line">    type: <span class="string">'POST'</span>,</span><br><span class="line">    timeout: <span class="number">5000</span>,</span><br><span class="line">    dataType: <span class="string">'html'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>那么后面的每个 <code>ajax</code> 调用都会使用这些默认值(<code>$.get()</code> 的 <code>HTTP</code> 方法不会被改为 <code>POST</code>)。</p>

    

        <a href="https://lastknightcoder.gitee.io/jQuery%E7%B3%BB%E7%BB%9F%E6%95%99%E7%A8%8B/" class="post-more waves-effect waves-button">
            阅读全文…
        </a>
    </div>
    
    <div class="post-footer">
        
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="https://lastknightcoder.gitee.io/tags/jQuery-JavaScript/" rel="tag">jQuery JavaScript</a></li></ul>

    </div>
    
</article>

        </li>
    
        <li class="post-list-item fade">
            <article id="post-使用before和after实现一个hover遮罩效果"
  class="article-card article-type-post" itemprop="blogPost">

    <div class="post-meta">
        <time class="post-time" title="2020-04-05 00:00:00" datetime="2020-04-04T16:00:00.000Z"  itemprop="datePublished">2020-04-05</time>

        
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="https://lastknightcoder.gitee.io/categories/Web/">Web</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="https://lastknightcoder.gitee.io/categories/Web/CSS/">CSS</a></li></ul></li></ul>



    </div>

    


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="https://lastknightcoder.gitee.io/%E4%BD%BF%E7%94%A8before%E5%92%8Cafter%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAhover%E9%81%AE%E7%BD%A9%E6%95%88%E6%9E%9C/">使用before和after实现一个hover遮罩效果</a>
    </h3>
  




    <div class="post-content" id="post-content" itemprop="postContent">

    
        <p>今天开始学习<code>CSS</code>效果，记录一下，成品如下</p>
<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/202004030004.gif"/>
</center>

<p>实现的思路很简单，使用到了<code>::before</code>和<code>::after</code>两个伪元素，默认两个伪元素的<code>width</code>为<code>0</code>，<code>height</code>与父元素的高度相同，当鼠标放上去时，伪元素的<code>width</code>变为<code>100%</code>，注意到两个伪元素变化的方向不一样，因为<code>::before</code>被设置为了</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">top</span>: 0;</span><br><span class="line"><span class="selector-tag">left</span>: 0;</span><br></pre></td></tr></table></figure>

<p>而<code>::after</code>被设置为</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">bottom</span>: 0;</span><br><span class="line"><span class="selector-tag">right</span>: 0;</span><br></pre></td></tr></table></figure>

<p><code>talk is cheap, show me the code</code>，直接上代码吧</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;!<span class="selector-tag">DOCTYPE</span> <span class="selector-tag">html</span>&gt;</span><br><span class="line">&lt;html lang="en"&gt;</span><br><span class="line">&lt;<span class="selector-tag">head</span>&gt;</span><br><span class="line">    &lt;meta charset="UTF-8"&gt;</span><br><span class="line">    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">    &lt;<span class="selector-tag">style</span>&gt;</span><br><span class="line">        <span class="selector-tag">html</span>,</span><br><span class="line">        <span class="selector-tag">body</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-tag">a</span> &#123;</span><br><span class="line">            <span class="attribute">font-size</span>: <span class="number">50px</span>;</span><br><span class="line">            <span class="attribute">display</span>: block;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">line-height</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">margin</span>: auto;</span><br><span class="line">            <span class="attribute">text-decoration</span>: none;</span><br><span class="line">            <span class="attribute">text-align</span>: center;</span><br><span class="line">            <span class="attribute">text-transform</span>: uppercase;</span><br><span class="line">            <span class="attribute">color</span>: <span class="number">#666</span>;</span><br><span class="line">            <span class="attribute">border</span>: <span class="number">1px</span> solid black;</span><br><span class="line">            <span class="attribute">position</span>: absolute;</span><br><span class="line">            <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">font-family</span>: Arial, Helvetica, sans-serif;</span><br><span class="line">            <span class="attribute">transition</span>: all <span class="number">0.5s</span>;</span><br><span class="line">            <span class="attribute">z-index</span>: <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-tag">a</span><span class="selector-pseudo">::before</span>,</span><br><span class="line">        <span class="selector-tag">a</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">            <span class="attribute">content</span>: <span class="string">""</span>;</span><br><span class="line">            <span class="attribute">display</span>: block;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">position</span>: absolute;</span><br><span class="line">            <span class="attribute">background</span>: <span class="number">#333</span>;</span><br><span class="line">            <span class="attribute">transition</span>: all <span class="number">0.5s</span>;</span><br><span class="line">            <span class="attribute">z-index</span>: -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-tag">a</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">            <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="selector-tag">a</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">            <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">            <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">::before</span>,</span><br><span class="line">        <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;<span class="selector-tag">body</span>&gt;</span><br><span class="line">    &lt;a href="#"&gt;Move&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>上面的代码不难理解，就一个地方需要注意的是，在<code>a</code>标签中设置了</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">margin</span>: <span class="selector-tag">auto</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">position</span>: <span class="selector-tag">absolute</span>;</span><br><span class="line"><span class="selector-tag">top</span>: 0;</span><br><span class="line"><span class="selector-tag">left</span>: 0;</span><br><span class="line"><span class="selector-tag">bottom</span>: 0;</span><br><span class="line"><span class="selector-tag">right</span>: 0;</span><br></pre></td></tr></table></figure>

<p>这样的写法，这样做的目的是使得<code>a</code>标签在<code>body</code>中居中显示，因为设置了定位的属性</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">top</span>: 0;</span><br><span class="line"><span class="selector-tag">left</span>: 0;</span><br><span class="line"><span class="selector-tag">bottom</span>: 0;</span><br><span class="line"><span class="selector-tag">right</span>: 0;</span><br></pre></td></tr></table></figure>

<p>四个都为0，要达到这样的效果，设置<code>margin</code>为<code>auto</code>会为<code>a</code>元素四周充满外边距，如下</p>
<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/20200403002007.png"/>
</center>

<p>这样就可以到居中的效果。</p>

    

        <a href="https://lastknightcoder.gitee.io/%E4%BD%BF%E7%94%A8before%E5%92%8Cafter%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAhover%E9%81%AE%E7%BD%A9%E6%95%88%E6%9E%9C/" class="post-more waves-effect waves-button">
            阅读全文…
        </a>
    </div>
    
    <div class="post-footer">
        
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="https://lastknightcoder.gitee.io/tags/CSS/" rel="tag">CSS</a></li></ul>

    </div>
    
</article>

        </li>
    
        <li class="post-list-item fade">
            <article id="post-数组中的重复的数字"
  class="article-card article-type-post" itemprop="blogPost">

    <div class="post-meta">
        <time class="post-time" title="2020-04-04 00:00:00" datetime="2020-04-03T16:00:00.000Z"  itemprop="datePublished">2020-04-04</time>

        
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="https://lastknightcoder.gitee.io/categories/%E5%89%91%E6%8C%87offer/">剑指offer</a></li></ul>



    </div>

    


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="https://lastknightcoder.gitee.io/%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E7%9A%84%E6%95%B0%E5%AD%97/">数组中的重复的数字</a>
    </h3>
  




    <div class="post-content" id="post-content" itemprop="postContent">

    
        <blockquote>
<p>题目一：找出数组中重复的数字</p>
<p>在一个长度为n的数组里的所有数组都在 0~n-1 的范围内。数组中某些数字是重复的，但不知道有几个数字重复了，也不知道每个数字重复了几次。请找出数组中任意一个重复的数字。例如，如果输入长度为7的数组{2, 3, 1, 0, 2, 5, 3}，那么对应的输出是重复的数组2或者3。</p>
</blockquote>
<p>考虑如果没有数组中没有重复的数字，那么排序后会有<code>arr[i] = i</code>(因为元素在 0~n-1 的范围内)，那么现在我们遍历数组，让第<code>i</code>个位置的元素的值为<code>i</code>(从0开始)，做法是当<code>arr[i] != i</code>的时候，与第<code>arr[i]</code>的位置进行交换，这样可以使得第<code>arr[i]</code>个位置上的数是<code>arr[i]</code>，即<code>arr[arr[i]] = arr[i]</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> temp = arr[i];</span><br><span class="line">arr[i] = arr[temp];</span><br><span class="line">arr[temp] = temp;</span><br></pre></td></tr></table></figure>

<p>如果有重复的数，由于<code>arr[arr[i]]</code>位置上的数已经被占了，所以这个时候我们就知道有重复的数，算法如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test01</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">duplicate</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (arr.length &lt;= <span class="number">0</span> || arr == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">            <span class="keyword">while</span>(arr[i] != i) &#123;</span><br><span class="line">                <span class="keyword">if</span> (arr[arr[i]] == arr[i]) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                swap(arr, i, arr[i]);</span><br><span class="line">                printArr(arr);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> temp = arr[i];</span><br><span class="line">        arr[i] = arr[j];</span><br><span class="line">        arr[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printArr</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line">        System.out.print(<span class="string">"["</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">            System.out.print(arr[i]);</span><br><span class="line">            <span class="keyword">if</span>(i != arr.length - <span class="number">1</span>) &#123;</span><br><span class="line">                System.out.print(<span class="string">", "</span>); </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"]"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] arr = &#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>&#125;;</span><br><span class="line">        <span class="comment">// int[] arr = &#123;7, 5, 6, 3, 4, 1, 0, 2&#125;;</span></span><br><span class="line">        <span class="keyword">boolean</span> duplicated = duplicate(arr);</span><br><span class="line">        System.out.println(duplicated);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>题目二：不修改数组找出重复的数字</p>
<p>在一个长度为 n+1 的数组里的所有数字都在 1~n 的范围内，所以数组中至少有一个数字是重复的。请找出数组中任意一个重复的数字，但不能修改输入的数组。例如，如果输入长度为8的数组{2, 3, 5, 4, 3, 2, 6, 7}，那么对应的输出是重复的数字2或者3。</p>
</blockquote>
<p>该算法有两种思路，第一种需要大小为 n+1 的辅助数组，我们遍历数组，将数组中的元素都复制到辅助数组中，原则如下，假设要复制的元素为m，那么将该数复制到辅助数组中下标为m的位置，这样很容易知道哪个元素重复了。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test02</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">duplicate</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> N = arr.length;</span><br><span class="line">        <span class="keyword">int</span>[] helpArr = <span class="keyword">new</span> <span class="keyword">int</span>[N];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (arr[i] == helpArr[arr[i]]) &#123;</span><br><span class="line">                <span class="keyword">return</span> arr[i];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                helpArr[arr[i]] = arr[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] arr = &#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">7</span>&#125;;</span><br><span class="line">        <span class="keyword">int</span> num = duplicate(arr);</span><br><span class="line">        System.out.println(num); <span class="comment">// 3</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>另一种思路是二分查找，首先我们将数字分成两半，比如 1~m 和 m+1~n，接着我们在数组中统计数字在 1~m 区间中的个数，如果数量大于 m ，那么就说明在 1~m 中有重复的数字，否则在 m+1~n 中有重复的数字，假设在 1~m 中有重复的数字，那么继续分成两半，如此往复，直到两边只有一个元素，代码如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test03</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">duplicate</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> start = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> end = arr.length - <span class="number">1</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (end &gt;= start) &#123;</span><br><span class="line">            <span class="keyword">int</span> middle = start + (end - start) / <span class="number">2</span>;</span><br><span class="line">            <span class="comment">// 获得数字范围在[start, middle]范围内的数目</span></span><br><span class="line">            <span class="keyword">int</span> countNum = count(arr, start, middle);</span><br><span class="line">            <span class="keyword">if</span> (start == end) &#123;</span><br><span class="line">                <span class="keyword">if</span>(countNum &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> start;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 如果范围只剩最后一个元素，但是数目不大于1，说明没有重复的</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (countNum &gt; (middle - start + <span class="number">1</span>)) &#123;</span><br><span class="line">                <span class="comment">// 在[start, middle]中继续找</span></span><br><span class="line">                end = middle;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 在[middle + 1, end]中继续找</span></span><br><span class="line">                start = middle + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 统计数组中数字范围在[start, end]范围内的数目</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">count</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (start &lt;= arr[i] &amp;&amp; arr[i] &lt;= end) &#123;</span><br><span class="line">                count++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] arr = &#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">7</span>&#125;;</span><br><span class="line">        <span class="keyword">int</span> num = duplicate(arr);</span><br><span class="line">        System.out.println(num); <span class="comment">// 3</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


    

        <a href="https://lastknightcoder.gitee.io/%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E7%9A%84%E6%95%B0%E5%AD%97/" class="post-more waves-effect waves-button">
            阅读全文…
        </a>
    </div>
    
    <div class="post-footer">
        
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="https://lastknightcoder.gitee.io/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" rel="tag">单例模式</a></li></ul>

    </div>
    
</article>

        </li>
    
        <li class="post-list-item fade">
            <article id="post-单例模式"
  class="article-card article-type-post" itemprop="blogPost">

    <div class="post-meta">
        <time class="post-time" title="2020-04-03 00:00:00" datetime="2020-04-02T16:00:00.000Z"  itemprop="datePublished">2020-04-03</time>

        
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="https://lastknightcoder.gitee.io/categories/%E5%89%91%E6%8C%87offer/">剑指offer</a></li></ul>



    </div>

    


  
    <h3 class="post-title" itemprop="name">
      <a class="post-title-link" href="https://lastknightcoder.gitee.io/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/">单例模式</a>
    </h3>
  




    <div class="post-content" id="post-content" itemprop="postContent">

    
        <blockquote>
<p>题目：设计一个类，我们只能生成该类的一个实例。</p>
</blockquote>
<p>如果只能生成一个实例，这意味着构造方法必须为私有的，该类实例的创建不能由用户创建，一个容易想到的版本如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test01</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Test01 instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Test01 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> Test01();</span><br><span class="line">        &#125; </span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Test01 one = Test01.getInstance();</span><br><span class="line">        Test01 two = Test01.getInstance();</span><br><span class="line">        System.out.println(one == two); <span class="comment">// true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们在类里面声明了一个instance变量，它是该类的一个实例，用户通过<code>getInstance()</code>来获得该类的实例，在该方法中，首先判断<code>instance</code>是不是为<code>null</code>，如果是<code>null</code>说明还没有创建过该实例，那么创建一个实例，如果不为<code>null</code>，说明已经创建过该实例，将之前创建过的实例返回，从而达到创建的始终是一个实例的效果。</p>
<p>但是使用上面的方法有一个缺点，那就是在多线程的情况下可能创建出多个实例，考虑这么一种情况，第一个线程执行<code>if (instance == null)</code>时，这时是成功的，会进入到<code>if</code>语句中，但是这个时候它失去了执行权，这个时候第二个线程执行<code>if (instance == null)</code>时，由于<code>instance</code>还没有赋值，它的值还为<code>null</code>，它也能够进入到<code>if</code>语句中，这个时候第一个线程和第二个线程都会使用<code>new</code>关键字创建出一个实例，它们是不同的。</p>
<p>简单的解决上面的问题就是加锁，上面会出现问题的语句为</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">    instance = <span class="keyword">new</span> Test01();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以我们为这个语句块加上锁就行，这就出现了第二个版本</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test02</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Test02 instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Test02</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Test02 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(Test02<span class="class">.<span class="keyword">class</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                instance = <span class="keyword">new</span> Test02();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Test02 one = Test02.getInstance();</span><br><span class="line">        Test02 two = Test02.getInstance();</span><br><span class="line">        System.out.println(one == two); <span class="comment">// true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是这个方法还有一个小的缺点，那就是每次我们获取实例的时候，都需要加锁，这意味着性能的损失，当<code>instance</code>不为<code>null</code>的时候，已经不会由于多线程而产生问题了，也就不用加锁了，所以再次修改<code>getInstance()</code>，产生了第三个版本</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test03</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Test03 instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Test03</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Test03 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(Test03<span class="class">.<span class="keyword">class</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> Test03();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Test03 one = Test03.getInstance();</span><br><span class="line">        Test03 two = Test03.getInstance();</span><br><span class="line">        System.out.println(one == two); <span class="comment">// true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个版本中，只有在<code>instance</code>为<code>null</code>的时候，我们才加锁。</p>
<p>上面的方法已经比较好了，这里再次推荐更好的办法，我们在<code>instance</code>声明的时候就为它赋值</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test04</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 在声明的时候就赋值</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Test04 instance = <span class="keyword">new</span> Test04();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Test04</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Test04 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Test04 one = Test04.getInstance();</span><br><span class="line">        Test04 two = Test04.getInstance();</span><br><span class="line">        System.out.println(one == two); <span class="comment">// true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是由于<code>instance</code>是静态变量，静态变量在类被主动使用时就会被初始化，而不是等我们需要创建类的实例时才被初始化，简单的说就是创建的时机过早，从而降低内存的使用效率，我们使用静态内部类来解决按需加载的问题</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test05</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Test05</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">InnerTest</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> Test05 instance = <span class="keyword">new</span> Test05();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Test05 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> InnerTest.instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Test05 one = Test05.getInstance();</span><br><span class="line">        Test05 two = Test05.getInstance();</span><br><span class="line">        System.out.println(one == two); <span class="comment">//true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个时候，只有我们需要用到类的实例时，才会初始化<code>instance</code>。</p>
<blockquote>
<p>在上面5种实现单例模式的方法中：</p>
<ul>
<li>第一种方法在多线程的环境下不能工作</li>
<li>第二种模式虽然能够在多线程的环境下工作，但是效率很低</li>
<li>第三种方法通过两次判断确保能够在多线程的情况下高效的工作</li>
<li>第四种方法在声明时就初始化，且只会被初始化一次，确保只创建一个实例</li>
<li>第五种方法利用内部类，做到只要在真正需要的时候才会创建实例，提高空间使用效率</li>
</ul>
</blockquote>

    

        <a href="https://lastknightcoder.gitee.io/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" class="post-more waves-effect waves-button">
            阅读全文…
        </a>
    </div>
    
    <div class="post-footer">
        
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="https://lastknightcoder.gitee.io/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" rel="tag">单例模式</a></li></ul>

    </div>
    
</article>

        </li>
    
    </ul>

    
<nav id="page-nav">
    <div class="inner">
    <span class="page-number current">1</span><a class="page-number" href="https://lastknightcoder.gitee.io/page/2/">2</a><a class="page-number" href="https://lastknightcoder.gitee.io/page/3/">3</a><a class="page-number" href="https://lastknightcoder.gitee.io/page/4/">4</a><a class="extend next" rel="next" href="https://lastknightcoder.gitee.io/page/2/">下一页</a>
    </div>
</nav>


</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="https://lastknightcoder.gitee.io/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>熊滔 &copy; 2019 - 2020</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://lastknightcoder.gitee.io/&title=Coder&pic=https://lastknightcoder.gitee.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://lastknightcoder.gitee.io/&title=Coder&source=人生天地间，忽如远行客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://lastknightcoder.gitee.io/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=Coder&url=https://lastknightcoder.gitee.io/&via=https://lastknightcoder.gitee.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://lastknightcoder.gitee.io/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACuCAAAAACKZ2kyAAABw0lEQVR42u3ay4qEMBAF0P7/n3ZgVgOD8VYqCTacrBq049FFqNfnE6/rd42v/l13V/M9WwsXF7fNvYbr/9Z3jxlDk/3H9+Di4p7njh/feYHkIMs/AS4u7tu4c4dU8gK4uLjfy63emQQ0uLi4b+ZWk5P+623P1XBxcRvcasF0x++N9V1cXNwi9yqu8b86R1X0dFxc3CPcccljVTpUDXEedsDFxT3I7Tc8Vo1ZlHM1XFzcpdwOdFWgUxjhwsXFPcLNj6e5smYSuFTTKlxc3N3cTlAy11itDmHcVnFwcXE3c/vjWZ2Wbd7ExcXFPcOdK1Xkzdfq0MayXjEuLm6bm7Q98uNmrk1SuB8XF/cIdy7hyR9TSG/y8AsXF3cbN29+VIOhahgUJWC4uLhHuMtKmcGRlBc+HvbExcXdzM1HKDpDGPmHePgEuLi4B7lzxZGN1dlOkxUXF3cRN1+djkZ+tEV2XFzcbdy5Yke1bLpqT1xc3JPcuYHLuZJK3rJ9mCbDxcU9wq3WWTtDmZ1mDC4u7tu4nVJI9cC6fT1cXNxXcucaJAmoNayJi4u7gbs2ZMmTonJzFxcX9wi3WjDNQ5ZVs2O4uLgHuT9WB+ceO0H5MQAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: 'https://lastknightcoder.gitee.io/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>



<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" async></script>




<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '死鬼去哪里了！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
