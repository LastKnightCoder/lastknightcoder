<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>使用React搭建一个基于富文本编辑器的博客系统 | Coder</title><meta name="description" content="介绍了从零搭建一个基于富文本编辑器的博客系统"><meta name="keywords" content="React antd React-Hooks"><meta name="author" content="熊滔"><meta name="copyright" content="熊滔"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://lastknightcoder.gitee.io/img/favicon.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="使用React搭建一个基于富文本编辑器的博客系统"><meta name="twitter:description" content="介绍了从零搭建一个基于富文本编辑器的博客系统"><meta name="twitter:image" content="https://gitee.com/lastknightcoder/blogimage/raw/master/img/bg73.png"><meta property="og:type" content="article"><meta property="og:title" content="使用React搭建一个基于富文本编辑器的博客系统"><meta property="og:url" content="https://lastknightcoder.gitee.io/%E4%BD%BF%E7%94%A8React%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%9F%BA%E4%BA%8E%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8%E7%9A%84%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/"><meta property="og:site_name" content="Coder"><meta property="og:description" content="介绍了从零搭建一个基于富文本编辑器的博客系统"><meta property="og:image" content="https://gitee.com/lastknightcoder/blogimage/raw/master/img/bg73.png"><meta property="article:published_time" content="2020-02-10T16:00:00.000Z"><meta property="article:modified_time" content="2020-02-10T16:00:00.000Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="https://lastknightcoder.gitee.io/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://lastknightcoder.gitee.io/%E4%BD%BF%E7%94%A8React%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%9F%BA%E4%BA%8E%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8%E7%9A%84%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/"><link rel="prev" title="MyBatis学习笔记" href="https://lastknightcoder.gitee.io/MyBatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><link rel="next" title="CSS3 新特性" href="https://lastknightcoder.gitee.io/CSS3/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5/js/md5.min.js"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: 'https://lastknightcoder.gitee.io/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://lastknightcoder.gitee.io/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: false,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  baiduPush: true,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="https://lastknightcoder.gitee.io/atom.xml" title="Coder" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><canvas class="fireworks"></canvas><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://lastknightcoder.gitee.io/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="https://lastknightcoder.gitee.io/archives/"><div class="headline">文章</div><div class="length_num">41</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="https://lastknightcoder.gitee.io/tags/"><div class="headline">标签</div><div class="length_num">44</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="https://lastknightcoder.gitee.io/categories/"><div class="headline">分类</div><div class="length_num">14</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="https://lastknightcoder.gitee.io/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="https://lastknightcoder.gitee.io/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="https://lastknightcoder.gitee.io/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="https://lastknightcoder.gitee.io/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="https://lastknightcoder.gitee.io/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="https://lastknightcoder.gitee.io/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#项目前的准备"><span class="toc-number">1.</span> <span class="toc-text">项目前的准备</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#React基础"><span class="toc-number">2.</span> <span class="toc-text">React基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#JSX语法"><span class="toc-number">2.1.</span> <span class="toc-text">JSX语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#组件"><span class="toc-number">2.2.</span> <span class="toc-text">组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#类组件"><span class="toc-number">2.2.1.</span> <span class="toc-text">类组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#props"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">props</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#state"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">state</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#生命周期函数"><span class="toc-number">2.2.1.3.</span> <span class="toc-text">生命周期函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#创建阶段"><span class="toc-number">2.2.1.3.1.</span> <span class="toc-text">创建阶段</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#constructor-props"><span class="toc-number">2.2.1.3.1.1.</span> <span class="toc-text">constructor(props)</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#static-getDerivedStateFromProps-nextProps-prevState"><span class="toc-number">2.2.1.3.1.2.</span> <span class="toc-text">static getDerivedStateFromProps(nextProps, prevState)</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#componentWillMount"><span class="toc-number">2.2.1.3.1.3.</span> <span class="toc-text">componentWillMount()</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#render"><span class="toc-number">2.2.1.3.1.4.</span> <span class="toc-text">render()</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#componentDidMount"><span class="toc-number">2.2.1.3.1.5.</span> <span class="toc-text">componentDidMount()</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#更新阶段"><span class="toc-number">2.2.1.3.2.</span> <span class="toc-text">更新阶段</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#componentWillReceiveProps"><span class="toc-number">2.2.1.3.2.1.</span> <span class="toc-text">componentWillReceiveProps()</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#static-getDerivedStateFromProps"><span class="toc-number">2.2.1.3.2.2.</span> <span class="toc-text">static getDerivedStateFromProps()</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#shouldComponentUpdate"><span class="toc-number">2.2.1.3.2.3.</span> <span class="toc-text">shouldComponentUpdate()</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#componentWillUpdate"><span class="toc-number">2.2.1.3.2.4.</span> <span class="toc-text">componentWillUpdate()</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#render-1"><span class="toc-number">2.2.1.3.2.5.</span> <span class="toc-text">render()</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#getSnapshotBeforeUpdate"><span class="toc-number">2.2.1.3.2.6.</span> <span class="toc-text">getSnapshotBeforeUpdate()</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#componentDidUpdate"><span class="toc-number">2.2.1.3.2.7.</span> <span class="toc-text">componentDidUpdate()</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#卸载阶段"><span class="toc-number">2.2.1.3.3.</span> <span class="toc-text">卸载阶段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#发生异常"><span class="toc-number">2.2.1.3.4.</span> <span class="toc-text">发生异常</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#函数式组件"><span class="toc-number">2.2.2.</span> <span class="toc-text">函数式组件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#组件分类"><span class="toc-number">2.3.</span> <span class="toc-text">组件分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#高阶组件"><span class="toc-number">2.4.</span> <span class="toc-text">高阶组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#render-props"><span class="toc-number">2.5.</span> <span class="toc-text">render props</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#React-Redux"><span class="toc-number">3.</span> <span class="toc-text">React Redux</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Context"><span class="toc-number">3.1.</span> <span class="toc-text">Context</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redux-React-Redux"><span class="toc-number">3.2.</span> <span class="toc-text">Redux + React Redux</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#React-Hooks"><span class="toc-number">4.</span> <span class="toc-text">React Hooks</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#useState"><span class="toc-number">4.1.</span> <span class="toc-text">useState</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#useEffect"><span class="toc-number">4.2.</span> <span class="toc-text">useEffect</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#useContext"><span class="toc-number">4.3.</span> <span class="toc-text">useContext</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#useReducer"><span class="toc-number">4.4.</span> <span class="toc-text">useReducer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#结合useContext和useReducer"><span class="toc-number">4.5.</span> <span class="toc-text">结合useContext和useReducer</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#富文本编辑器"><span class="toc-number">5.</span> <span class="toc-text">富文本编辑器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#页面布局"><span class="toc-number">6.</span> <span class="toc-text">页面布局</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Header"><span class="toc-number">6.1.</span> <span class="toc-text">Header</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BasicLayout"><span class="toc-number">6.2.</span> <span class="toc-text">BasicLayout</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LoginLayout"><span class="toc-number">6.3.</span> <span class="toc-text">LoginLayout</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#页面路由"><span class="toc-number">7.</span> <span class="toc-text">页面路由</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#页面编写"><span class="toc-number">8.</span> <span class="toc-text">页面编写</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#antd表单的使用"><span class="toc-number">8.1.</span> <span class="toc-text">antd表单的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#页面数据"><span class="toc-number">8.2.</span> <span class="toc-text">页面数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Home"><span class="toc-number">8.3.</span> <span class="toc-text">Home</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Display"><span class="toc-number">8.4.</span> <span class="toc-text">Display</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Edit"><span class="toc-number">8.5.</span> <span class="toc-text">Edit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Login"><span class="toc-number">8.6.</span> <span class="toc-text">Login</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#收尾"><span class="toc-number">8.7.</span> <span class="toc-text">收尾</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#登录权限控制"><span class="toc-number">9.</span> <span class="toc-text">登录权限控制</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考资料"><span class="toc-number">10.</span> <span class="toc-text">参考资料</span></a></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://gitee.com/lastknightcoder/blogimage/raw/master/img/bg73.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="https://lastknightcoder.gitee.io/">Coder</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="https://lastknightcoder.gitee.io/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="https://lastknightcoder.gitee.io/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="https://lastknightcoder.gitee.io/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="https://lastknightcoder.gitee.io/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="https://lastknightcoder.gitee.io/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="https://lastknightcoder.gitee.io/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">使用React搭建一个基于富文本编辑器的博客系统</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-02-11 00:00:00"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-02-11</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-02-11 00:00:00"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-02-11</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="https://lastknightcoder.gitee.io/categories/React/">React</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon far fa-comments" aria-hidden="true"></i><span>评论数:</span><a href="https://lastknightcoder.gitee.io/%E4%BD%BF%E7%94%A8React%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%9F%BA%E4%BA%8E%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8%E7%9A%84%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/#post-comment"><span class="gitalk-comment-count comment-count"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><p>本文将从0开始搭建一个基于富文本编辑器的博客系统，包括的内容有</p>
<ul>
<li><code>React</code>的基础知识</li>
<li>富文本编辑器组件<code>BraftEditor</code>的使用及扩展</li>
<li><code>React Hooks</code></li>
<li><code>Redux + React-Redux</code></li>
<li><code>antd</code>表单的介绍及使用</li>
<li>登录权限控制</li>
</ul>
<h1 id="项目前的准备"><a href="#项目前的准备" class="headerlink" title="项目前的准备"></a>项目前的准备</h1><p>首先需要下载<code>Node.js</code>和<code>npm</code>(下载<code>Node.js</code>自带<code>npm</code>)，下载完<code>Node.js</code>后，由于<code>npm</code>的速度较慢，可以考虑使用下面的命令下载<code>cnpm</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install cnpm -g</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>npm是什么，为什么会需要npm：</strong></p>
<p>想要知道npm是什么，那就要先从共享代码说起，程序员自古以来就有社区文化，加入社区最大的好处之一是，你可以使用别人贡献的代码，你也可以贡献代码给别人用。</p>
<p>前端是怎么共享代码的呢?</p>
<p>在 GitHub 还没有兴起的年代，前端是通过网址来共享代码，比如你想使用 jQuery，那么你点击 jQuery 网站上提供的链接就可以下载 jQuery，放到自己的网站上使用，GItHub 兴起之后，社区中也有人使用 GitHub 的下载功能。</p>
<p>当一个网站依赖的代码越来越多，程序员发现这是一件很麻烦的事情，比如你要下载BootStrap，你就必须下载jQuery，因为BootStrap依赖jQuery，所以你需要一个网站一个网站的去下代码。如果遇到依赖比较多的情况，这个库依赖另一个库，另一个库又依赖另一个库，如此当依赖关系十分复杂时，你根本不知道要下哪些库，这对程序员来说简直就是个灾难。</p>
<p>有些程序员就受不了了，一个程序员叫 Isaac Z. Schlueter(以下简称Isaaz)给出一个解决方案：用一个工具把这些代码集中到一起来管理吧!这个工具就是他用 JavaScript(运行在Node.js上)写的 npm，全称是 Node Package Manager。</p>
<p>NPM 的思路大概是这样的：</p>
<ol>
<li>买个服务器作为代码仓库(registry)，在里面放所有需要被共享的代码</li>
<li>发邮件通知 jQuery、Bootstrap、Underscore等作者使用npm publish 把代码提交到registry上，分别取名 jquery、bootstrap和underscore(注意大小写)</li>
<li>社区里的其他人如果想使用这些代码，就把jquery、bootstrap和underscore写到package.json里，然后运行 npm install，npm就会帮他们下载代码</li>
<li>下载完的代码出现在 node_modules 目录里，可以随意使用了。</li>
</ol>
<p>这些可以被使用的代码被叫做「包」(package)，这就是 NPM名字的由来：Node Package(包) Manager(管理器)。</p>
<p>但是npm叫别人这么干，别人不一定会这么干啊，所以npm是怎么火的呢?npm的发展是跟Node.js的发展相辅相成的。Node.js是由一个在德国工作的美国程序员Ryan Dahl写的。他写了Node.js，但是Node.js缺少一个包管理器，于是他和 npm的作者一拍即合、抱团取暖，最终Node.js内置了npm。</p>
<p>后来的事情大家都知道，Node.js火了。随着Node.js的火爆，大家开始用 npm来共享JS代码了，于是jQuery作者也将 jQuery发布到npm了。所以现在，你可以使用npm install jquery来下载jQuery代码。</p>
<p>现在用npm来分享代码已经成了前端的标配。</p>
</blockquote>
<p>接下来下载搭建<code>React</code>项目的脚手架<code>create-react-app</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cnpm install create-react-app -g</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>什么是脚手架：</strong><br>随着前端工程化的概念越来越深入人心，脚手架的出现就是为减少重复性工作而引入的命令行工具，摆脱ctrl + c, ctrl + v，此话zenjiang? 现在新建一个前端项目，已经不是在html头部引入css，尾部引入js那么简单的事了，css都是采用Sass或则Less编写，在js中引入，然后动态构建注入到html中；除了学习基本的js，css语法和热门框架，还需要学习构建工具webpack，babel这些怎么配置，怎么起前端服务，怎么热更新；为了在编写过程中让编辑器帮我们查错以及更加规范，我们还需要引入ESlint；甚至，有些项目还需要引入单元测试(Jest)。对于一个刚入门的人来说，这无疑会让人望而却步。而前端脚手架的出现，就让事情简单化，一键命令，新建一个工程，再执行两个npm命令，跑起一个项目。在入门时，无需关注配置什么的，只需要开心的写代码；另外，对于很多系统，他们的页面相似度非常高，所以就可以基于一套模板来搭建，虽然是不同的人开发，但用脚手架来搭建，相同的项目结构与代码书写规范，是很利于项目的后期维护的；以上就是为什么脚手架存在的意义， 让项目从”搭建-开发-部署”更加快速以及规范。</p>
</blockquote>
<p>接着使用create-react-app搭建一个React项目，这里的项目名称就命名为blog</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">create-react-app blog</span><br></pre></td></tr></table></figure>

<p>使用该命令会在本地生成一个文件夹blog，里面的内容如下</p>
<center>
<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/20200208002028.png"/>
</center>


<p>其中src就是我们开发的文件夹，其中index.js是入口文件，里面的内容为</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./index.css'</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> serviceWorker <span class="keyword">from</span> <span class="string">'./serviceWorker'</span>;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// If you want your app to work offline and load faster, you can change</span></span><br><span class="line"><span class="comment">// unregister() to register() below. Note this comes with some pitfalls.</span></span><br><span class="line"><span class="comment">// Learn more about service workers: https://bit.ly/CRA-PWA</span></span><br><span class="line">serviceWorker.unregister();</span><br></pre></td></tr></table></figure>

<p>现在我们将里面的内容改为</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello React<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>));</span><br></pre></td></tr></table></figure>

<p>然后npm start就可以看到下面的页面</p>
<center>
<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/20200208003524.png"/>
</center>


<p>这时可以将src下除index.js的文件全部都删掉了，因为没有用到他们。</p>
<h1 id="React基础"><a href="#React基础" class="headerlink" title="React基础"></a>React基础</h1><h2 id="JSX语法"><a href="#JSX语法" class="headerlink" title="JSX语法"></a>JSX语法</h2><p>可能现在你对上面的代码不太了解，特别是怎么在JavaScrpt里面写HTML</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello React<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>));</span><br></pre></td></tr></table></figure>

<p>这里的HTML就是JSX，JSX的全称是JavaScript XML，指的就是JavaScript中的XML。</p>
<p>上面这行语句的作用是什么呢? React会解析这个JSX语句为一个虚拟DOM，而ReactDOM会将这个虚拟DOM转变为真正的DOM，然后塞到页面某个特定的元素上面，这里是塞到一个id为root(该DOM元素在public/index.html中)的DOM对象中,我们查看index.html中的内容</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 省略head中的内容和所有注释 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">noscript</span>&gt;</span>You need to enable JavaScript to run this app.<span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>经过ReactDOM渲染后的index.html的页面应该为为</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 省略head中的内容和所有注释 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">noscript</span>&gt;</span>You need to enable JavaScript to run this app.<span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"root"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello React<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>为了验证这个想法，可以在刚才的页面中按下F12检查元素</p>
<center>
<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/20200208213722.png"/>
</center>


<p>所以页面显示出来的就是Hello React。</p>
<blockquote>
<p><strong>为什么需要虚拟DOM：</strong></p>
<p>原因很简单，那就是DOM很慢，我们先来看一下浏览器的渲染流程</p>
<ul>
<li>用HTML分析器，分析HTML元素，构建一颗DOM树</li>
<li>用CSS分析器，分析CSS文件和元素上的inline样式，生成页面的样式表</li>
<li>将上面的DOM树和样式表，关联起来，构建一颗Render树。这一过程又称为Attachment。每个DOM节点都有attach方法，接受样式信息，返回一个render对象（又名renderer）。这些render对象最终会被构建成一颗Render树</li>
<li>有了Render树后，浏览器开始布局，会为每个Render树上的节点确定一个在显示屏上出现的精确坐标值</li>
<li>Render数有了，节点显示的位置坐标也有了，最后就是调用每个节点的paint方法，让它们显示出来</li>
</ul>
<p>当你用传统的原生api或jQuery去操作DOM时，浏览器会从构建DOM树开始从头到尾执行一遍流程。比如当你在一次操作时，需要更新10个DOM节点，理想状态是一次性构建完DOM树，再执行后续操作。但浏览器没这么智能，收到第一个更新DOM请求后，并不知道后续还有9次更新操作，因此会马上执行流程，最终执行10次流程。显然例如计算DOM节点的坐标值等都是白白浪费性能，可能这次计算完，紧接着的下一个DOM更新请求，这个节点的坐标值就变了，前面的一次计算是无用功。</p>
<p>即使计算机硬件一直在更新迭代，操作DOM的代价仍旧是昂贵的，频繁操作还是会出现页面卡顿，影响用户的体验。</p>
<p>虚拟DOM就是为了解决这个浏览器性能问题而被设计出来的。例如前面的例子，假如一次操作中有10次更新DOM的动作，虚拟DOM不会立即操作DOM，而是将这10次更新的diff内容保存到本地的一个js对象中，最终将这个js对象一次性attach到DOM树上，通知浏览器去执行绘制工作，这样可以避免大量的无谓的计算量。</p>
</blockquote>
<p>我们知道React中的JSX会被解析为一个React对象(或者说JavaScript对象)，所以我们在写JSX的过程中，就可以把JSX看做是一个对象(记住JSX的本质就是对象，每当在JavaScript代码中看到这种JSX结构的时候，脑子里面就可以自动做转化，这样对你理解React.js的组件写法很有好处)。这就意味着JSX只能有一个根元素，如下面的写法是错误的</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;div&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;div&gt;&lt;/</span>div&gt;</span><br></pre></td></tr></table></figure>

<p>因为上面的代码并不能被解析为一个对象，正确的写法应该是</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;div&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;div&gt;&lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样的JSX才会被解析为一个对象。</p>
<p>现在我们在来说一下文件开头的两行语句</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br></pre></td></tr></table></figure>

<p>在React中，我们使用import来导入npm下载的包，这里我们引入了React和ReactDOM，这里你可能有疑问，我们并没有使用npm下载react和react-dom，为什么能够引入，这是因为create-react-app为我们做了这件事情，打开package.json我们可以发现已经帮我们添加了react和react-dom</p>
<center>
<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/20200208211434.png"/>
</center>


<p>那么引入的React是做什么事情的呢? 首先在JavaScript中是不能写JSX的，在React中的JSX会被解析为JavaScript对象，就是通过React来做到的，而ReactDOM是将React渲染的JSX对象(有时我们也称之为组件)转变为真正的DOM对象并塞到某个特定的元素里面。所以记住只要你写React.js组件，都必须要引入React。</p>
<h2 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h2><p>这里十分推荐<a href="http://huziketang.mangojuice.top/books/react/" target="_blank" rel="noopener">React.js 小书</a>，里面将React的内容讲的十分的深入浅出，每读一遍都有新的收获。</p>
<p>组件是什么? 如果你搭过积木的话，那么里面的积木就是组件，我们使用积木搭建出一个东西，在React中我们使用组件来搭建一个页面。组件的作用就是复用，这里的复用指的不仅仅是页面的复用，还有逻辑和样式；除此以外，有的组件并不是用来展现页面的，而是用来加载数据的，然后将数据传给子组件，这样会使得处理数据的逻辑和展示数据的逻辑分开，职责分明，逻辑清晰，以及便于后期的维护。另外，有的组件是做权限的认证，以决定展示某些页面与否。总而言之，有许多不同的组件，组件根据功能或写法或有无状态等等可以进行分类，在后面将详细讨论。</p>
<p>按照组件的写法可以分为函数组件和类组件。</p>
<h3 id="类组件"><a href="#类组件" class="headerlink" title="类组件"></a>类组件</h3><p>我们写一个类组件HelloReact</p>
<iframe height="302" style="width: 100%;" scrolling="no" title="React类组件使用" src="https://codepen.io/lastknightcoder/embed/LYVEeEE?height=302&theme-id=default&default-tab=html,result" frameborder="no" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href='https://codepen.io/lastknightcoder/pen/LYVEeEE' target="_blank" rel="noopener">React类组件使用</a> by LastKnightCoder
  (<a href='https://codepen.io/lastknightcoder' target="_blank" rel="noopener">@lastknightcoder</a>) on <a href='https://codepen.io' target="_blank" rel="noopener">CodePen</a>.
</iframe>

<p>使用类组件，里面必须有一个render函数，该方法是用来返回JSX代码。我们创建了一个HelloWorld组件</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">HelloReact</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>))</span><br></pre></td></tr></table></figure>

<p>并且我们通过<code>&lt;HelloReact /&gt;</code>的方式使用了组件，此时的<code>&lt;HelloReact /&gt;</code>就相当于render函数的返回值</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;div&gt;Hello React&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure>

<p>但<code>&lt;HelloReact /&gt;</code>不仅仅是HTML，虽然在这个组件中，我们并没有加上JavaScript的逻辑和CSS样式，但是我们知道一个组件是包括这些的，下面我们为这个类添加样式和点击函数</p>
<iframe height="265" style="width: 100%;" scrolling="no" title="abOzEWb" src="https://codepen.io/lastknightcoder/embed/abOzEWb?height=265&theme-id=default&default-tab=js,result" frameborder="no" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href='https://codepen.io/lastknightcoder/pen/abOzEWb' target="_blank" rel="noopener">abOzEWb</a> by LastKnightCoder
  (<a href='https://codepen.io/lastknightcoder' target="_blank" rel="noopener">@lastknightcoder</a>) on <a href='https://codepen.io' target="_blank" rel="noopener">CodePen</a>.
</iframe>

<p>两点说明：</p>
<ul>
<li>由于class在React中是关键字，所以类名要写成className</li>
<li>onClick={()=&gt; console.log(“click me”)}为div标签添加了点击事件，onClick={}并不是说onClick是一个对象，{}是React的插值语法，使用插值语法可以将组件的属性与变量(表达式)绑定起来，这样就不会写死，而是会根据变量取不同的值。这里就是将onClick这个React事件与{}里面的箭头函数绑定起来。<strong>在{}中的内容只能是JavaScript的表达式，不能是if，while等语句</strong></li>
</ul>
<blockquote>
<p><strong>React事件：</strong></p>
<p>使用原生的JS为DOM元素添加事件，主要有下面三种方法</p>
<ul>
<li>在HTML中直接事件绑定</li>
</ul>
</blockquote>
<blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&gt;<span class="tag">&lt;<span class="name">p</span> <span class="attr">onclick</span>=<span class="string">"console.log('click')"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>直接绑定</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&gt;<span class="keyword">let</span> divObj = <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>);</span><br><span class="line">&gt;divObj.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>对DOM对象进行事件监听处理,事件委托监听方式</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&gt;<span class="keyword">let</span> divObj = <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>);</span><br><span class="line">&gt;divObj.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;)</span><br></pre></td></tr></table></figure>

<p>至于这三种方法的优缺点与及什么时候使用，这里却不在讨论。那么React中的事件是如何绑定的呢?</p>
<p>在React中事件的绑定是直接写在JSX元素上的,不需要通过addEventListener事件委托的方式进行监听，写法上:</p>
</blockquote>
<blockquote>
<ul>
<li><p>在JSX元素上添加事件,通过on*EventType这种内联方式添加,命名采用小驼峰式(camelCase)的形式,而不是纯小写(原生HTML中对DOM元素绑定事件,事件类型是小写的),无需调用addEventListener进行事件监听,也无需考虑兼容性,React已经封装好了一些的事件类型属性(ps:onClick,onMouseMove,onChange,onFocus)等</p>
</li>
<li><p>使用JSX语法时,需要传入一个函数作为事件处理函数,而不是一个字符串,也就是props值应该是一个函数类型数据,事件函数方法外面得用一个双大括号包裹起来(也就是上面提到的插值语法)</p>
</li>
<li><p>on*EventType的事件类型属性,只能用作在普通的原生html标签上(例如:div,input,a,p等,例如:<code>&lt;div onClick={ 事件处理函数 }&gt;&lt;/div&gt;</code>),无法直接用在自定义组件标签上,也就是说下面这么写是没有作用的</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&gt;<span class="xml"><span class="tag">&lt;<span class="name">HelloReact</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span> console.log("click me")&#125;&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>不能通过返回false的方式阻止默认行为,必须显示使用preventDefault</li>
</ul>
<p>具体React事件有哪些，可以参照<a href="https://react-cn.github.io/react/docs/events.html" target="_blank" rel="noopener">事件系统|React</a>。</p>
</blockquote>
<h4 id="props"><a href="#props" class="headerlink" title="props"></a>props</h4><p>组件最常用的作用就是用来展示数据，那么作为可复用的组件，不同人拿到这个组件所展示的数据也不会相同，那么数据从哪里来? 使用组件的人怎么将数据传给组件，而组件又怎么拿到数据。这就要用到props了。</p>
<p>假如有下面的组件</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DisplayData</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;假设这里是要展示的数据&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<p>这个组件的作用就是展示数据，现在我要用DisplayData组件，我怎么把数据传过去，如下</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;DisplayData data=<span class="string">"数据"</span> /&gt;</span><br></pre></td></tr></table></figure>

<p>我们通过给DisplayData组件加上一个data属性，值是”数据”，就可以将数据传给DisplayData，现在怎么拿到数据呢? 每一个组件都有props属性，它是一个对象，通过上面方法传递给组件的属性都会以键值对的形式添加到props对象中，所以在DisplayData组件中，我们就可以通过this.props.data拿到数据</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DisplayData</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;&#123;<span class="keyword">this</span>.props.data&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<iframe height="265" style="width: 100%;" scrolling="no" title="React props父组件给子组件传递数据" src="https://codepen.io/lastknightcoder/embed/GRJgGvY?height=265&theme-id=default&default-tab=js,result" frameborder="no" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href='https://codepen.io/lastknightcoder/pen/GRJgGvY' target="_blank" rel="noopener">React props父组件给子组件传递数据</a> by LastKnightCoder
  (<a href='https://codepen.io/lastknightcoder' target="_blank" rel="noopener">@lastknightcoder</a>) on <a href='https://codepen.io' target="_blank" rel="noopener">CodePen</a>.
</iframe>

<p>以上我们把DisplayData称之为子组件，而使用DisplayData的组件称之为父组件，上面演示了如何将数据从父组件传给子组件，现在我们考虑一下，如何将子组件的数据传递到父组件呢? 完全是有这个需要的，比如子组件是一个登录组件，我们需要将用户输入的用户名和密码交由父组件进行处理(为什么要交给父组件处理，在子组件中处理不可以吗?如果你在子组件里面处理了数据，那么这个组件就与具体的业务相关了，就不能够被复用了，所以数据处理的工作需要交由父组件来做)。</p>
<p>其实也很简单，我们给子组件传递一个回调函数，那么在子组件的某个时刻(比如子组件的值改变了或者说点击提交)时调用此回调函数并传入数据，这样我们就可以在父组件中拿到数据了</p>
<iframe height="620" style="width: 100%;" scrolling="no" title="React子组件向父组件传递数据" src="https://codepen.io/lastknightcoder/embed/eYNmKMB?height=620&theme-id=dark&default-tab=js,result" frameborder="no" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href='https://codepen.io/lastknightcoder/pen/eYNmKMB' target="_blank" rel="noopener">React子组件向父组件传递数据</a> by LastKnightCoder
  (<a href='https://codepen.io/lastknightcoder' target="_blank" rel="noopener">@lastknightcoder</a>) on <a href='https://codepen.io' target="_blank" rel="noopener">CodePen</a>.
</iframe>

<p>上面的逻辑代码为当SonComponent中的input发生改变时(输入内容或删减内容等等)，会触发子组件中的handleValue回调函数(该回调函数bind了this，后面会进行解释)，在子组件的handleValue中，我们根据浏览器传入的event获得了input输入框的值，并且调用ParentComponent传入的handleValue回调函数将此值传入，这样就将子组件的数据传给了父组件，在父组件中，我们定义了这个回调函数接收这个值，并在控制台打印，你可以在上面的input中输入值并在控制台观察结果。</p>
<p><strong>JavaScript函数里面的this是什么：</strong></p>
<p>要想知道JavaScript函数里面的this是什么，就要知道函数调用的4种方式：</p>
<ul>
<li>定义在全局作用域中函数</li>
</ul>
<p>定义在全局作用域中的函数，根据是否是严格模式下，this的取值也不同，如果是在严格模式下，里面的this是undefined，如果是在非严格模式下，里面的this是window</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="meta">"use strict"</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>); </span><br><span class="line">&#125;</span><br><span class="line">test(); <span class="comment">//undefined</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>); </span><br><span class="line">&#125;</span><br><span class="line">test(); <span class="comment">//window</span></span><br></pre></td></tr></table></figure>

<ul>
<li>对象方法</li>
</ul>
<p>对象中方法中的this如果是对象.的形式调用的，那么对象方法中的this就是该对象</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    test: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.test(); <span class="comment">// obj</span></span><br></pre></td></tr></table></figure>

<p>如果以某种角度看的话，第一种情况的非严格模式下是第二种情况的特例，我们知道在全局作用域下声明的变量和函数都会成为window对象的属性，当我们在全局作用域下声明一个test函数，就相当于在window对象中添加了一个test方法(在对象中的函数我们一般称为方法)，而调用test()方法就相当于window.test()，按照第二种情况，test中的this就是应该指向window</p>
<ul>
<li>作为构造函数被调用</li>
</ul>
<p>当我们new一个方法的时候，里面的this是一个空对象</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dog</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> Dog(); <span class="comment">// &#123;&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>使用call, apply, bind方法改变函数的上下文(this)</li>
</ul>
<p>上面三者都可以改变函数执行时内部this的指向，下面来看一个例子</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">funtion printName(firstName, lastName) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.fullName)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;firstName&#125;</span> <span class="subst">$&#123;lastName&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果直接执行这个函数的话，那么this.fullName的结果就是undefined，因为window对象没有这个属性，但是如果有以下对象</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    fullName: <span class="string">"David"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面我们将printName函数执行时内部的this指向obj</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> firstName = <span class="string">"firstName"</span></span><br><span class="line"><span class="keyword">let</span> lastName = <span class="string">"lastName"</span></span><br><span class="line"><span class="comment">// 将printName内部this指向obj， 后面是printName需要的参数</span></span><br><span class="line">printName.apply(obj, firstName, lastName) </span><br><span class="line"><span class="comment">// 将printName内部this指向obj， 后面是printName需要的参数</span></span><br><span class="line">printName.call(obj, [firstName, lastName])</span><br></pre></td></tr></table></figure>

<p>这时this.fullName就是obj中的fullName了，因为apply和call方法改变了printName内的this指向。这里我们发现apply和call方法是极其的相似，除了传递参数时格式不一样；事实上也是如此，apply和call的功能是一样的。</p>
<p>说完apply和call，接下来讲一讲bind，bind与上面两者不同，上面改变函数内部的this指向时是立即执行这个函数的，而使用bind改变函数内部的this指向时，这个函数不会立即的执行，如</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">printName = printName.bind(obj)</span><br></pre></td></tr></table></figure>

<p>printNAme函数内部的this指向已经改变，当printName执行时，打印出的this.fullName就是obj里面的David。</p>
<p>了解完JavaScript中的this是什么，接下来就要解释</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;input type=<span class="string">"text"</span> placeholder=<span class="string">"Please Input"</span> onChange=&#123;<span class="keyword">this</span>.handleValue.bind(<span class="keyword">this</span>)&#125; /&gt;</span><br></pre></td></tr></table></figure>

<p>中onChange={this.handleValue.bind(this)}，首先我们来看handleValue中的代码</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">handleValue(event) &#123;</span><br><span class="line">    <span class="keyword">this</span>.props.handleValue(event.target.value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当input发生改变时便会执行这个函数，但是是谁执行这个函数呢? 是window，而React是运行在严格模式下的，所以这时的this就是undefined，所以我们拿不到我们想要的this，要使得我能拿到的使我们想拿到的this，就是改变函数执行时内部的this指向，考虑到这个函数是作为回调函数而不是立即执行，我们使用bind来绑定this。</p>
<p>机智的你已经发现，ParentComponent中的handleValue没有bind(this)，这是因为它在函数里面没有用到this啊，所以什么时候bind(this)是不是已经很清楚了呢!</p>
<p>到这里你有没有发现我们使用组件都是这样</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;HelloReact /&gt;</span><br></pre></td></tr></table></figure>

<p>居然不是一开一闭的格式，那想必你有疑问，可不可以这样使用</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;HelloReact&gt;&lt;<span class="regexp">/HelloReact&gt;</span></span><br></pre></td></tr></table></figure>

<p>答案是可以，那么问题来了? 二者又有什么不同? 使用后面的写法意味着可以在标签里面写子元素，如</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;HelloReact&gt;</span><br><span class="line">    &lt;div&gt;inner&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>HelloReact&gt;</span><br></pre></td></tr></table></figure>

<p>其实这也可以看做是一种传递数据的方式，标签里面的子元素会传给这个组件，传过去的数据会保存在props.children中，在HelloReact中可以通过this.props.children获得数据。</p>
<p>这两种写法都很常见，在写布局，路由，认证等组件时经常使用后面的写法，而在一些展示的组件中，通常只需要父组件传下来的数据，会使用前一种写法，当然这种情况下也可以使用第二种写法。</p>
<p>为了理解children的应用，我们来写简单的Layout组件。所谓的Layout，就是布局</p>
<center>
<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/20200209164423.png"/>
</center>


<p>我们简单的把页面上面三个部分，这就是一种布局，一个头部，一个侧边栏，一个内容区。很多时候我们发现一个网站的多个网页之间的布局是一样的，并且很有可能头部和侧边栏是相同，仅仅是内容区不同，作为一名优秀的程序员，当然要尽可能的抽离出这些重复的代码，我们把这个布局抽离为一个组件</p>
<iframe height="446" style="width: 100%;" scrolling="no" title="尝试Layout" src="https://codepen.io/lastknightcoder/embed/MWwYqEL?height=446&theme-id=dark&default-tab=js,result" frameborder="no" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href='https://codepen.io/lastknightcoder/pen/MWwYqEL' target="_blank" rel="noopener">尝试Layout</a> by LastKnightCoder
  (<a href='https://codepen.io/lastknightcoder' target="_blank" rel="noopener">@lastknightcoder</a>) on <a href='https://codepen.io' target="_blank" rel="noopener">CodePen</a>.
</iframe>

<p>首先希望不要关注样式，因为那不是重点，关注Layout的结构。注意我们将{this.props.children}放在了类名为content的div中，所以如果我们将Content内容区组件放到Layout里面，Content组件就会被放在Layout的内容区，放置不同的Content组件，就会得到多个布局一样，内容不同的页面，这就做到了复用。</p>
<p>整个网站当然不可能只会有一种布局，很多时候我们会写多个布局的组件，明白了布局组件的作用，这些对你来说应当不难。</p>
<h4 id="state"><a href="#state" class="headerlink" title="state"></a>state</h4><p>React中一个比较重要的思想就数据驱动视图，例如子组件根据props的内容进行展示，根据不同的props展示不同的内容，不同的props会展现不同的UI，所以可以认为是props决定了视图，每当props变化时，都会引起子组件的渲染，展现不同的视图，视图的改变完全在于数据，所以现在我们操作的重点不再是DOM，而是数据，我们通过操作数据来达到不同的UI效果。</p>
<p>但是仅仅靠props似乎是够的，因为props是只读的，它不能够更改。这意味着什么? 假设父组件传给子组件的props没有发生变化，那么子组件的视图就不会改变，因为数据没有改变。这意味着我们如何与这样一个组件进行交互呢?</p>
<p>这意味组件的内部需要数据来管理UI的变化，我们将组件内部的数据称之为state，state就是状态的意思。比如使用visible这个状态来控制某个对话框是否可见，用户通过改变visible这个状态从而影响组件UI的变化，每次state的变化都会引起组件UI的刷新，从而达到数据驱动视图的目的。从此，我们关心的再也不是DOM操作，而是props, state这些数据，我们操作这些数据来控制视图的更新。</p>
<p>定义一个合适的state，是正确创建组件的第一步。state必须能代表一个组件UI呈现的完整状态集，即组件的任何UI改变，都可以从state的变化中反映出来；同时，state还必须是代表一个组件UI呈现的最小状态集，即state中的所有状态都是用于反映组件UI的变化，没有任何多余的状态，也不需要通过其他状态计算而来的中间状态。</p>
<p>组件中用到的一个变量是不是应该作为组件state，可以通过下面的4条依据进行判断：</p>
<ul>
<li>这个变量是否是通过props从父组件中获取? 如果是，那么它不是一个状态。</li>
<li>这个变量是否在组件的整个<strong>生命周期</strong>(后面讲到)中都保持不变? 如果是，那么它不是一个状态。</li>
<li>这个变量是否可以通过其他状态(state)或者属性(props)计算得到?如果是，那么它不是一个状态。</li>
<li>这个变量是否在组件的render方法中使用? 如果不是，那么它不是一个状态(因为state是用来驱动视图的，如果这个变量没有在render方法中使用，意味着该状态的改变并不能使得视图发生变化)。这种情况下，这个变量更适合定义为组件的一个普通属性，例如组件中用到的定时器，就应该直接定义为this.timer，而不是this.state.timer。</li>
</ul>
<p>现在来写一个计数器，当点击按钮时页面上显示的数字+1，页面上的数字发生改变正是UI的改变，这个时候我们就要用state来管理页面上要展示的数据</p>
<iframe height="265" style="width: 100%;" scrolling="no" title="Counter演示state" src="https://codepen.io/lastknightcoder/embed/YzXPmjZ?height=265&theme-id=dark&default-tab=js,result" frameborder="no" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href='https://codepen.io/lastknightcoder/pen/YzXPmjZ' target="_blank" rel="noopener">Counter演示state</a> by LastKnightCoder
  (<a href='https://codepen.io/lastknightcoder' target="_blank" rel="noopener">@lastknightcoder</a>) on <a href='https://codepen.io' target="_blank" rel="noopener">CodePen</a>.
</iframe>

<p>我们在constructor构造函数中初始化state为</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.state = &#123;</span><br><span class="line">  number: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>state为一个对象，其中的number属性正是我们要展现的数据，我们将它初始化为0。当我们点击按钮时，触发状态的改变</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">increment() &#123;</span><br><span class="line">  <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">    number: ++<span class="keyword">this</span>.state.number</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意，状态的改变不能使用this.state.number = ++this.state.number使状态发生改变，要使得状态发生改变，必须使用setState()方法使状态发生改变。</p>
<p>上面的例子进一步验证了数据驱动视图的思想，在计数器的例子中，我们没有手动的更改视图(操作DOM)，而是通过改变state来使得视图得到刷新，因为每次state的改变都会引起render()方法的调用，从而使得视图得以刷新。</p>
<p>请务必牢记，并不是组件中用到的所有变量都是组件的状态! 当存在多个组件共同依赖一个状态时，一般的做法是状态上移，将这个状态放到这几个组件的公共父组件中。</p>
<p>所谓状态上移是怎么回事呢? 考虑下面这么一个评论组件</p>
<center>
<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/comments2.png"/>
</center>


<p>CommentInput用来输入评论，当提交之后会在CommentList中新增一个CommentItem来显示新增的评论，很明显我们需要一个comments数组，当CommentInput提交评论时，将comment添加到comments数组中，CommentList拿到comments数组，comments中的元素会交给其中的CommentItem显示。而作为关键的comments数组，它是多个组件都会用到的，所以它应该作为state保存在公共的父组件中，即Comment组件中。这就是状态上移，将多个组件都会用到的数据上移到共同父组件的state中，当更新父组件的state的时，会使得传到子组件的props相应的更新，从而达到视图 更新的目的。</p>
<center>
<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/comments4.png"/>
</center>


<h4 id="生命周期函数"><a href="#生命周期函数" class="headerlink" title="生命周期函数"></a>生命周期函数</h4><p>一个人从出生到死亡会经历一些人生节点，孩童、青年、中年、老年。而一个组件从创建到销毁也要经历特殊的节点，在这些节点中，我们可以做一些操作，每一个节点都对应一个函数，我们将它们称为生命周期函数。</p>
<p>那React有哪些生命周期函数，这些生命周期函数对应的节点是什么呢? 或者说这些生命周期函数在React从创建到销毁的哪一个过程会被执行呢? 这里我们将生命周期分为三个阶段：</p>
<ul>
<li>创建阶段</li>
<li>更新阶段</li>
<li>卸载阶段</li>
</ul>
<p>在每一个阶段都包含数个生命周期函数。</p>
<h5 id="创建阶段"><a href="#创建阶段" class="headerlink" title="创建阶段"></a>创建阶段</h5><h6 id="constructor-props"><a href="#constructor-props" class="headerlink" title="constructor(props)"></a>constructor(props)</h6><p>我们一般在构造函数中干两件事情：</p>
<ul>
<li>初始化状态</li>
<li>为事件处理函数绑定this</li>
</ul>
<blockquote>
<p><strong>注意：</strong> ES6子类的构造函数必须执行一次super()。React如果构造函数中要使用this.props，必须先执行super(props)。</p>
</blockquote>
<h6 id="static-getDerivedStateFromProps-nextProps-prevState"><a href="#static-getDerivedStateFromProps-nextProps-prevState" class="headerlink" title="static getDerivedStateFromProps(nextProps, prevState)"></a>static getDerivedStateFromProps(nextProps, prevState)</h6><p>当创建时、接收新的 props 时、setState时、forceUpdate时会执行这个方法。这是一个静态方法，参数nextProps是新接收的props，prevState是当前的state。返回值(对象)将用于更新state，如果不需要更新则需要返回null。</p>
<p>这个方法在建议尽量少用，只在必要的场景中使用，一般使用场景如下：</p>
<ul>
<li>无条件的根据props更新state</li>
<li>当props和state的不匹配情况更新state</li>
</ul>
<h6 id="componentWillMount"><a href="#componentWillMount" class="headerlink" title="componentWillMount()"></a>componentWillMount()</h6><p>这个方法已经不推荐使用。因为在未来异步渲染机制下，该方法可能会多次调用。它所行使的功能也可以由 componentDidMount() 和 constructor() 代替：</p>
<ul>
<li>之前有些人会把异步请求放在这个生命周期，其实大部分情况下都推荐把异步数据请求放在 componentDidMount() 中。</li>
<li>在服务端渲染时，通常使用 componentWillMount() 获取必要的同步数据，但是可以使用 constructor() 代替它。</li>
</ul>
<blockquote>
<p>有定义getDerivedStateFromProps时，会忽略componentWillMount()</p>
</blockquote>
<h6 id="render"><a href="#render" class="headerlink" title="render()"></a>render()</h6><p>每个类组件中，render() 唯一必须的方法。render() 正如其名，作为渲染用，可以返回下面几种类型：</p>
<ul>
<li>React 元素（React elements）</li>
<li>数组（Arrays）</li>
<li>片段（fragments）</li>
<li>插槽（Portals）</li>
<li>字符串或数字（String and numbers）</li>
<li>布尔值或 null（Booleans or null）</li>
</ul>
<p>里面不应该包含副作用，应该作为纯函数。<strong>不能使用 setState。</strong></p>
<h6 id="componentDidMount"><a href="#componentDidMount" class="headerlink" title="componentDidMount()"></a>componentDidMount()</h6><p>组件完成装载（已经插入 DOM 树）时，触发该方法。这个阶段已经获取到真实的 DOM。一般用于下面的场景：</p>
<ul>
<li>异步请求 ajax</li>
<li>添加事件绑定(注意在componentWillUnmount中取消，以免造成内存泄漏)</li>
</ul>
<h5 id="更新阶段"><a href="#更新阶段" class="headerlink" title="更新阶段"></a>更新阶段</h5><h6 id="componentWillReceiveProps"><a href="#componentWillReceiveProps" class="headerlink" title="componentWillReceiveProps()"></a>componentWillReceiveProps()</h6><p>这个方法在接收新的 props 时触发，即使 props 没有变化也会触发。一般用这个方法来判断 props 的前后变化来更新 state，如下面的例子：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExampleComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    isScrollingDown: <span class="literal">false</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"> </span><br><span class="line">  componentWillReceiveProps(nextProps) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.props.currentRow !== nextProps.currentRow) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        isScrollingDown:</span><br><span class="line">          nextProps.currentRow &gt; <span class="keyword">this</span>.props.currentRow,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个方法将被弃用，推荐使用 getDerivedStateFromProps 代替。</p>
<h6 id="static-getDerivedStateFromProps"><a href="#static-getDerivedStateFromProps" class="headerlink" title="static getDerivedStateFromProps()"></a>static getDerivedStateFromProps()</h6><p>见创建阶段的描述</p>
<h6 id="shouldComponentUpdate"><a href="#shouldComponentUpdate" class="headerlink" title="shouldComponentUpdate()"></a>shouldComponentUpdate()</h6><p>在接收新的 props 或新的 state 时，在渲染前会触发该方法。该方法通过返回 true 或者 false 来确定是否需要触发新的渲染。返回 false， 则不会触发后续的 componentWillUpdate()、render() 和 componentDidUpdate()（但是 state 变化还是可能引起子组件重新渲染）。</p>
<p>所以通常通过这个方法对 props 和 state 做比较，从而避免一些不必要的渲染。</p>
<h6 id="componentWillUpdate"><a href="#componentWillUpdate" class="headerlink" title="componentWillUpdate()"></a>componentWillUpdate()</h6><p>当接收到新的 props 或 state 时，在渲染前执行该方法。在以后异步渲染时，可能会出现某些组件暂缓更新，导致 componentWillUpdate 和 componentDidUpdate 之间的时间变长，这个过程中可能发生一些变化，比如用户行为导致 DOM 发生了新的变化，这时在 componentWillUpdate 获取的信息可能就不可靠了。这个方法将要弃用。</p>
<h6 id="render-1"><a href="#render-1" class="headerlink" title="render()"></a>render()</h6><p>见创建阶段的描述</p>
<h6 id="getSnapshotBeforeUpdate"><a href="#getSnapshotBeforeUpdate" class="headerlink" title="getSnapshotBeforeUpdate()"></a>getSnapshotBeforeUpdate()</h6><p>这个方法在 render() 之后，componentDidUpdate() 之前调用。两个参数 prevProps 表示更新前的 props，prevState 表示更新前的 state。返回值称为一个快照（snapshot），如果不需要 snapshot，则必须显示的返回 null —— 因为返回值将作为 componentDidUpdate() 的第三个参数使用。所以这个函数必须要配合 componentDidUpdate() 一起使用。</p>
<p>这个函数的作用是在真实 DOM 更新（componentDidUpdate）前，获取一些需要的信息（类似快照功能），然后作为参数传给 componentDidUpdate。例如：在 getSnapShotBeforeUpdate 中获取滚动位置，然后作为参数传给 componentDidUpdate，就可以直接在渲染真实的 DOM 时就滚动到需要的位置。</p>
<p>下面是官方文档给出的例子：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ScrollingList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.listRef = React.createRef();</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  getSnapshotBeforeUpdate(prevProps, prevState) &#123;</span><br><span class="line">    <span class="comment">// Are we adding new items to the list?</span></span><br><span class="line">    <span class="comment">// Capture the scroll position so we can adjust scroll later.</span></span><br><span class="line">    <span class="keyword">if</span> (prevProps.list.length &lt; <span class="keyword">this</span>.props.list.length) &#123;</span><br><span class="line">      <span class="keyword">const</span> list = <span class="keyword">this</span>.listRef.current;</span><br><span class="line">      <span class="keyword">return</span> list.scrollHeight - list.scrollTop;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  componentDidUpdate(prevProps, prevState, snapshot) &#123;</span><br><span class="line">    <span class="comment">// If we have a snapshot value, we've just added new items.</span></span><br><span class="line">    <span class="comment">// Adjust scroll so these new items don't push the old ones out of view.</span></span><br><span class="line">    <span class="comment">// (snapshot here is the value returned from getSnapshotBeforeUpdate)</span></span><br><span class="line">    <span class="keyword">if</span> (snapshot !== <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> list = <span class="keyword">this</span>.listRef.current;</span><br><span class="line">      list.scrollTop = list.scrollHeight - snapshot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div ref=&#123;<span class="keyword">this</span>.listRef&#125;&gt;&#123;<span class="comment">/* ...contents... */</span>&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<h6 id="componentDidUpdate"><a href="#componentDidUpdate" class="headerlink" title="componentDidUpdate()"></a>componentDidUpdate()</h6><p>这个方法是在更新完成之后调用，第三个参数 snapshot 就是 getSnapshotBeforeUpdate 的返回值。</p>
<p>正如前面所说，有 getSnapshotBeforeUpdate 时，必须要有 componentDidUpdate。所以这个方法的一个应用场景就是上面看到的例子，配合 getSnapshotBeforeUpdate 使用。</p>
<h5 id="卸载阶段"><a href="#卸载阶段" class="headerlink" title="卸载阶段"></a>卸载阶段</h5><p>componentWillUnmount()</p>
<p>在组件卸载或者销毁前调用。这个方法主要用来做一些清理工作，例如：</p>
<ul>
<li>取消定时器</li>
<li>取消事件绑定</li>
<li>取消网络请求</li>
</ul>
<p>上面三个阶段是正常的生命周期，但是如果发生了异常，就需要进行错误处理，所以React也提供了发生异常时的函数</p>
<h5 id="发生异常"><a href="#发生异常" class="headerlink" title="发生异常"></a>发生异常</h5><p>componentDidCatch(err, info)</p>
<p>任何子组件在渲染期间，生命周期方法中或者构造函数 constructor 发生错误时调用。</p>
<p>错误边界不会捕获下面的错误：</p>
<ul>
<li>事件处理(Event handlers)(因为事件处理不发生在 React 渲染时，报错不影响渲染)</li>
<li>异步代码(Asynchronous code)(e.g. setTimeout or requestAnimationFrame callbacks)</li>
<li>服务端渲染(Server side rendering)</li>
<li>错误边界本身(而不是子组件)抛出的错误</li>
</ul>
<p>下面我们来看一张<a href="http://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/" target="_blank" rel="noopener">生命周期函数图</a>来加深对上面描述的生命周期函数的理解</p>
<center>
<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/20200211010936.png"/>
</center>


<p>虽然React有做向下兼容，但是推荐尽量避免使用废弃的生命周期，而是拥抱未来，用新的生命周期替换它们。</p>
<h3 id="函数式组件"><a href="#函数式组件" class="headerlink" title="函数式组件"></a>函数式组件</h3><p>现在我们用函数式组件写一个HelloReact组件</p>
<iframe height="265" style="width: 100%;" scrolling="no" title="函数式组件示例" src="https://codepen.io/lastknightcoder/embed/RwPPBPE?height=265&theme-id=dark&default-tab=js,result" frameborder="no" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href='https://codepen.io/lastknightcoder/pen/RwPPBPE' target="_blank" rel="noopener">函数式组件示例</a> by LastKnightCoder
  (<a href='https://codepen.io/lastknightcoder' target="_blank" rel="noopener">@lastknightcoder</a>) on <a href='https://codepen.io' target="_blank" rel="noopener">CodePen</a>.
</iframe>

<p>其中函数式组件接收一个参数props，通我们在类组件中介绍的props相同。函数式组件与类组件不同的是，函数式组件没有state和生命周期函数，所以函数式组件又被称为无状态组件，从某种意义上说类组件具有更加强大的功能。</p>
<p>为了创建纯展示组件，这种组件只负责根据传入的props来展示，不涉及到要state状态的操作。其官方指出：在大部分React代码中，大多数组件被写成无状态的组件，通过简单组合可以构建成其他的组件等；这种通过多个简单然后合并成一个大应用的设计模式被提倡。</p>
<p>无状态组件的创建形式使代码的可读性更好，并且减少了大量冗余的代码，精简至只有一个render方法，大大的增强了编写一个组件的便利，除此之外无状态组件还有以下几个显著的特点：</p>
<ul>
<li>组件不会被实例化，整体渲染性能得到提升</li>
</ul>
<p>因为组件被精简成一个render方法的函数来实现的，由于是无状态组件，所以无状态组件就不会在有组件实例化的过程，无实例化过程也就不需要分配多余的内存，从而性能得到一定的提升。</p>
<ul>
<li>组件不能访问this对象</li>
</ul>
<p>无状态组件由于没有实例化过程，所以无法访问组件this中的对象，例如：this.ref、this.state等均不能访问。若想访问就不能使用这种形式来创建组件</p>
<ul>
<li>组件无法访问生命周期的方法</li>
</ul>
<p>因为无状态组件是不需要组件生命周期管理和状态管理，所以底层实现这种形式的组件时是不会实现组件的生命周期方法。所以无状态组件是不能参与组件的各个生命周期管理的。</p>
<ul>
<li>无状态组件只能访问输入的props，同样的props会得到同样的渲染结果，不会有副作用</li>
</ul>
<p>无状态组件被鼓励在大型项目中尽可能以简单的写法来分割原本庞大的组件，未来React也会这种面向无状态组件在譬如无意义的检查和内存分配领域进行一系列优化，所以只要有可能，尽量使用无状态组件。</p>
<h2 id="组件分类"><a href="#组件分类" class="headerlink" title="组件分类"></a>组件分类</h2><p>组件按写法分可以分为类组件和函数式组件，在上面已经详细介绍过。按照组件有无状态又可以将组价分为有状态组件和无状态组件。按照组件的功能分又可以将组件分为容器组件和展示组件，又或者称为Smart组件和Dumb组件。这里主要介绍容器组件和展示组件。</p>
<p>展示组件：</p>
<ul>
<li>只关注看起来怎么样</li>
<li>内部可能包含有展示组件或容器组件，并且通常有DOM标签和样式</li>
<li>不用指明数据是如何加载或者变化的</li>
<li>只通过props接收数据和回调函数</li>
<li>一般写为函数式组件，除非它们需要状态、生命周期函数或者性能优化</li>
</ul>
<p>容器组件：</p>
<ul>
<li>只关注如何工作的</li>
<li>内部也许包含展示组件或容器组件，但一般不会有DOM标签除非一个包装的div，不可能会有样式</li>
<li>为展示组件或其他容器组件提供数据和回调函数</li>
<li>一般是有状态的，被认为是数据源</li>
<li>一般是从高阶组件生成的</li>
</ul>
<p>通过将组件分为这两种，可以有以下优点：</p>
<ul>
<li>关注点更好的分离</li>
<li>更好的复用性</li>
</ul>
<h2 id="高阶组件"><a href="#高阶组件" class="headerlink" title="高阶组件"></a>高阶组件</h2><p>高阶组件指的不是组件，而是一个函数，它可以增强组件，它接收一个组件，返回一个新组件，这个新组件是接收组件的加强版。假设有这样三个组件</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App1</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123; <span class="attr">data</span>: <span class="literal">null</span> &#125;;</span><br><span class="line">  componnetDidMount() &#123;</span><br><span class="line">    <span class="keyword">const</span> data = localStorage.getItem(<span class="string">"data"</span>);</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      data</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;this.state.data&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App2</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123; <span class="attr">data</span>: <span class="literal">null</span> &#125;;</span><br><span class="line">  componnetDidMount() &#123;</span><br><span class="line">    <span class="keyword">const</span> data = localStorage.getItem(<span class="string">"data"</span>);</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      data</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;this.state.data&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App3</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123; <span class="attr">data</span>: <span class="literal">null</span> &#125;;</span><br><span class="line">  componnetDidMount() &#123;</span><br><span class="line">    <span class="keyword">const</span> data = localStorage.getItem(<span class="string">"data"</span>);</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      data</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;this.state.data&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>观察这三个组件，它们都有一个共同的特点，那就是它们在挂载后都要从localStorage中获取数据，可见这样的代码是重复了的，我们如果每次要从localStorage获取数据，都要写一遍这样的代码，那怎么可以让这样的逻辑复用呢? 这就是高阶组件的作用，考虑下面这样的一个函数</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getDataFromLocalStorage</span>(<span class="params">WrapComponent</span>) </span>&#123;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">NewComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    state = &#123; <span class="attr">data</span>: <span class="literal">null</span> &#125;;</span><br><span class="line">    componentDidComponent() &#123;</span><br><span class="line">      <span class="keyword">const</span> data = localStorage.getItem(<span class="string">"data"</span>);</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        data</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">WrapComponent</span> <span class="attr">data</span>=<span class="string">&#123;this.state.data&#125;</span> /&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> NewComponent</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该函数接收一个组件，返回一个新组件。这个新组件在挂载后会用localStorage读取数据，并注入到传入的组件的props.data中。而这个传入的组件会作为新组件render函数的返回值，所以当我们使用这个新组件时，与使用传入的组件一致，不过此时新组件的props中已经有了从localStorage读取的数据。我们可以将上面的三个组件都可以改造为</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App1</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;this.props.data&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">  App1 = getDataFromLocalStorage(App1)</span><br><span class="line">&#125;</span><br><span class="line">        </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App2</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;this.props.data&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">  App2 = getDataFromLocalStorage(App2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App3</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;this.props.data&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">  App3 = getDataFromLocalStorage(App3)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们使用高阶函数为三个组件的props.data中注入了数据，这样三个组件只要调用这个方法，就可以自动可以在props中获取到数据，从而达到了代码的复用。可能读到这里你还不能理解，没关系，多读几遍好好消化，或者写个几遍就习惯了。</p>
<h2 id="render-props"><a href="#render-props" class="headerlink" title="render props"></a>render props</h2><p>render props的目的同样也是进行代码的复用。再次考虑上面代码的复用，不过这次使用render props实现代码的复用</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GetDataFromLocalStorage</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;<span class="attr">data</span>: <span class="literal">null</span>&#125;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(localStorage.getItem(<span class="string">"data"</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="keyword">this</span>.props.render(<span class="keyword">this</span>.state)&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;GetDataFromLocalStorage </span><br><span class="line">        render = &#123;(&#123;data&#125;) =&gt; &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>data<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        &#125;&#125; </span><br><span class="line">      /&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>仔细阅读上面的代码，想必还是比较容易读懂的。Render Props的核心思想是，通过一个函数将class组件的state作为props传递给纯函数组件。</p>
<h1 id="React-Redux"><a href="#React-Redux" class="headerlink" title="React Redux"></a>React Redux</h1><p>假设有这么一棵组件树</p>
<center>
<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/20200215102614.png"/>
</center>


<p>Com4从App中获取数据，需要一层一层的传下来，有的中间组件可能只是用来传递数据用，同理，Com4向App传递数据，也要通过回调函数一层层往上传，再这样的情况下，代码实在是比较臃肿，不仅写出了很多不必要的代码，而且使得数据也比较难以理解。</p>
<p>假设有这么一个中央仓库，任何组件都可以直接存储和更改数据，而不需要一层层的传递</p>
<center>
<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/20200215103956.png"/>
</center>


<p>不管组件处于多深的层次，都可以从store中直接拿取数据。所以这个想法怎么做到呢?</p>
<h2 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h2><p>首先来介绍React中你可能永远不会用到的特性context。我们在父组件中它下面的子组件通过context的方式提供数据，其中的任意子组件均可以通过context访问数据，这就使得context相当于中央仓库，那怎么用呢(为了演示方便，就写父子两层)?</p>
<iframe height="400" style="width: 100%;" scrolling="no" title="Context的使用" src="https://codepen.io/lastknightcoder/embed/JjdGQgL?height=675&theme-id=dark&default-tab=js,result" frameborder="no" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href='https://codepen.io/lastknightcoder/pen/JjdGQgL' target="_blank" rel="noopener">Context的使用</a> by LastKnightCoder
  (<a href='https://codepen.io/lastknightcoder' target="_blank" rel="noopener">@lastknightcoder</a>) on <a href='https://codepen.io' target="_blank" rel="noopener">CodePen</a>.
</iframe>

<p>在上面用到了PropTypes，所以需要下载prop-types，使用npm下载</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cnpm install prop-types --save</span><br></pre></td></tr></table></figure>

<p>首先父组件提供context要声明提供的数据名称以及对应的类型</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> childContextTypes = &#123;</span><br><span class="line">    data: PropTypes.string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在getChildContext中返回数据</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">getChildContext () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      data: <span class="string">"data"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>而子组件要使用父组件提供的数据，首先要声明要使用的数据是什么以及类型</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> contextTypes = &#123;</span><br><span class="line">    data: PropTypes.string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>只有这样才可以通过this.context获取想要的数据</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;div&gt;Child中获取Context：&#123;<span class="keyword">this</span>.context.data&#125;&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure>

<p>context 打破了组件和组件之间通过 props 传递数据的规范，极大地增强了组件之间的耦合性。而且，就如全局变量一样，context 里面的数据能被随意接触就能被随意修改，每个组件都能够改 context 里面的内容会导致程序的运行不可预料。</p>
<p>但是这种机制对于前端应用状态管理来说是很有帮助的，因为毕竟很多状态都会在组件之间进行共享，context 会给我们带来很大的方便。一些第三方的前端应用状态管理的库（例如 Redux）就是充分地利用了这种机制给我们提供便利的状态管理服务。但我们一般不需要手动写 context，也不要用它，只需要用好这些第三方的应用状态管理库就行了。</p>
<h2 id="Redux-React-Redux"><a href="#Redux-React-Redux" class="headerlink" title="Redux + React Redux"></a>Redux + React Redux</h2><p>本来还想继续写Redux，React-Redux的，但是我发现<a href="http://huziketang.mangojuice.top/books/react/" target="_blank" rel="noopener">React.js 小书</a>写的实在是太好了，推荐仔细阅读其中的Redux和React-Redux的部分。</p>
<h1 id="React-Hooks"><a href="#React-Hooks" class="headerlink" title="React Hooks"></a>React Hooks</h1><p>使用React Hooks，使得在函数式组件可以有状态，也可以仿照生命周期函数，甚至可以替代React Redux。所谓的Hooks，就是指一些函数，通过这些函数可以在函数式组建中实现类组件的功能。</p>
<p>钩子函数一般是useXxx的形式，所有的钩子函数都只能写在函数式组件中。</p>
<h2 id="useState"><a href="#useState" class="headerlink" title="useState"></a>useState</h2><p>我们来看一下如何在函数式组件中使用state</p>
<iframe height="265" style="width: 100%;" scrolling="no" title="useState的使用" src="https://codepen.io/lastknightcoder/embed/WNvrVOo?height=265&theme-id=dark&default-tab=js,result" frameborder="no" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href='https://codepen.io/lastknightcoder/pen/WNvrVOo' target="_blank" rel="noopener">useState的使用</a> by LastKnightCoder
  (<a href='https://codepen.io/lastknightcoder' target="_blank" rel="noopener">@lastknightcoder</a>) on <a href='https://codepen.io' target="_blank" rel="noopener">CodePen</a>.
</iframe>

<p>通过useState来创建一个状态，接收一个参数，这个参数就是状态的初始值，返回一个数组，数组包含两个元素，第一个元素就是状态，第二个元素是一个方法，该方法用来设置状态的，如上面</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> [number, setNumber] = useState(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>其中number就是状态，初始值为0，而setNumber是用来设置number的(二者的名字可以随便起，什么changeNumber随意)，每当我们点击+1按钮，都会将当前的number加一。</p>
<h2 id="useEffect"><a href="#useEffect" class="headerlink" title="useEffect"></a>useEffect</h2><p>useEffect主要是用来执行一些副作用的代码，比如拿数据</p>
<iframe height="265" style="width: 100%;" scrolling="no" title="useEffect" src="https://codepen.io/lastknightcoder/embed/poJgMar?height=265&theme-id=dark&default-tab=js,result" frameborder="no" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href='https://codepen.io/lastknightcoder/pen/poJgMar' target="_blank" rel="noopener">useEffect</a> by LastKnightCoder
  (<a href='https://codepen.io/lastknightcoder' target="_blank" rel="noopener">@lastknightcoder</a>) on <a href='https://codepen.io' target="_blank" rel="noopener">CodePen</a>.
</iframe>

<p>useEffect接收两个参数，第一个参数是回调函数，第二个参数是一个数组，它会监视数组中的元素，当数组中的元素发生改变时，就会执行回调函数，所以当我们点击按钮改变data时，由于data发生改变，useEffect中的回调函数会被执行。如果希望是componentDidMount生命周期函数的特点，即只在组件挂载是执行一次，那么可以为第二个参数传入一个空数组。</p>
<h2 id="useContext"><a href="#useContext" class="headerlink" title="useContext"></a>useContext</h2><p>useContext的作用正如在React Redux中介绍的Context中一样，可以使得子组件无论在什么深度都可以直接访问父组件提供的Context，这个给个例子大家就可以明白</p>
<iframe height="265" style="width: 100%;" scrolling="no" title="useContext的使用" src="https://codepen.io/lastknightcoder/embed/vYOLorB?height=265&theme-id=dark&default-tab=js,result" frameborder="no" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href='https://codepen.io/lastknightcoder/pen/vYOLorB' target="_blank" rel="noopener">useContext的使用</a> by LastKnightCoder
  (<a href='https://codepen.io/lastknightcoder' target="_blank" rel="noopener">@lastknightcoder</a>) on <a href='https://codepen.io' target="_blank" rel="noopener">CodePen</a>.
</iframe>


<h2 id="useReducer"><a href="#useReducer" class="headerlink" title="useReducer"></a>useReducer</h2><p>如何仔细阅读过React.js小书，那么想必你已经理解了reducer的作用，useReducer接收一个reducer和初始状态initState，返回state和dispatch，如下</p>
<iframe height="265" style="width: 100%;" scrolling="no" title="useReducer" src="https://codepen.io/lastknightcoder/embed/BaNjXOL?height=265&theme-id=dark&default-tab=js,result" frameborder="no" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href='https://codepen.io/lastknightcoder/pen/BaNjXOL' target="_blank" rel="noopener">useReducer</a> by LastKnightCoder
  (<a href='https://codepen.io/lastknightcoder' target="_blank" rel="noopener">@lastknightcoder</a>) on <a href='https://codepen.io' target="_blank" rel="noopener">CodePen</a>.
</iframe>

<h2 id="结合useContext和useReducer"><a href="#结合useContext和useReducer" class="headerlink" title="结合useContext和useReducer"></a>结合useContext和useReducer</h2><p>我们可以将useContext和useReducer结合，来达到React-Redux的效果，具体就是将useReducer产生的state和dispatch作为Context传下去，如下</p>
<iframe height="959" style="width: 100%;" scrolling="no" title="useContext与useReducer结合" src="https://codepen.io/lastknightcoder/embed/BaNjXGQ?height=959&theme-id=dark&default-tab=js,result" frameborder="no" allowtransparency="true" allowfullscreen="true">
  See the Pen <a href='https://codepen.io/lastknightcoder/pen/BaNjXGQ' target="_blank" rel="noopener">useContext与useReducer结合</a> by LastKnightCoder
  (<a href='https://codepen.io/lastknightcoder' target="_blank" rel="noopener">@lastknightcoder</a>) on <a href='https://codepen.io' target="_blank" rel="noopener">CodePen</a>.
</iframe>

<h1 id="富文本编辑器"><a href="#富文本编辑器" class="headerlink" title="富文本编辑器"></a>富文本编辑器</h1><p>既然是搭建一个基于富文本编辑器的博客系统，那么就要用到富文本编辑器组件，这里我们选择<a href="https://braft.margox.cn/" target="_blank" rel="noopener">BraftEditor</a>。</p>
<p>使用npm安装到你的项目</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cnpm install braft-editor --save</span><br></pre></td></tr></table></figure>

<p>新建pages文件夹，并且在pages中新建文件夹RichText，在RichText中新建index.jsx，内容如下</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;useState&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> BraftEditor <span class="keyword">from</span> <span class="string">'braft-editor'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'braft-editor/dist/index.css'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">RichText</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> [editorState, setEditorState] = useState(BraftEditor.createEditorState(<span class="string">"&lt;p&gt;123&lt;/p&gt;"</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleEditorChange = <span class="function">(<span class="params">editorState</span>) =&gt;</span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleEditorSave = <span class="function">(<span class="params">editorState</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;BraftEditor</span><br><span class="line">            value=&#123;editorState&#125;</span><br><span class="line">            onChange=&#123;handleEditorChange&#125;</span><br><span class="line">            onSave=&#123;handleEditorSave&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> RichText</span><br></pre></td></tr></table></figure>

<p>我们在src下的index.js中引入该组件，并渲染到dom中</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> RichText <span class="keyword">from</span> <span class="string">'./pages/RichText'</span>;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">RichText</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>));</span><br></pre></td></tr></table></figure>

<p>这时你使用yarn start或者npm start启动项目，在端口3000看到的页面应该是这样的</p>
<center>
<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/20200214145449.png"/>
</center>


<p>现在我们来看BraftEditor组件接收的三个props，分别是</p>
<ul>
<li>value</li>
<li>onChange</li>
<li>onSave</li>
</ul>
<p>我们一个个来看。</p>
<p>首先看value，它是BraftEditor组件要显示的内容，它的值是一个editorState对象，我们可以通过BraftEditor.createEditorState()创建editorState对象，它接收html字符串或者一个raw对象(raw对象是它自定义的对象，一般我们保存富文本的内容就是保存raw对象)，也可以通过editorState实例转化为html字符串或者raw对象，如</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建edirorState对象</span></span><br><span class="line"><span class="keyword">const</span> editorState = BraftEditor.createEditor(<span class="string">"&lt;p&gt;123&lt;/p&gt;"</span>);</span><br><span class="line"><span class="keyword">const</span> htmlContent = editorState.toHTML();</span><br><span class="line"><span class="keyword">const</span> rawContent = editorState.toRAW();</span><br></pre></td></tr></table></figure>

<p>再者来看onChange，它是当BraftEditor发生改变时调用的回调函数，它会传入一个editorState对象，这个editorState对象代表的就是当前的文本内容。</p>
<p>最后看onSave，它是当按下Ctrl + S保存时会调用的方法，也会将代表当前文本内容的editorState传入。</p>
<p>我们来做一个简单的案例，当按下Ctrl + S时，将数据以raw对象的格式保存在localStorage中，当富文本加载时，从localStorage中读取数据</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;useState, useEffect&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> BraftEditor <span class="keyword">from</span> <span class="string">'braft-editor'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'braft-editor/dist/index.css'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">RichText</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> [editorState, setEditorState] = useState(BraftEditor.createEditorState(<span class="literal">null</span>))</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> rawContent = localStorage.getItem(<span class="string">"rawContent"</span>) || <span class="literal">null</span>;</span><br><span class="line">        setEditorState(BraftEditor.createEditorState(rawContent))</span><br><span class="line">    &#125;, [])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleEditorChange = <span class="function">(<span class="params">editorState</span>) =&gt;</span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleEditorSave = <span class="function">(<span class="params">editorState</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> rawContent = editorState.toRAW();</span><br><span class="line">        localStorage.setItem(<span class="string">"rawContent"</span>, rawContent)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;BraftEditor</span><br><span class="line">            value=&#123;editorState&#125;</span><br><span class="line">            onChange=&#123;handleEditorChange&#125;</span><br><span class="line">            onSave=&#123;handleEditorSave&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> RichText</span><br></pre></td></tr></table></figure>

<p>这里就增加了两个地方，第一个是增加了useEffect，作用是当组件挂载后从localStorage中读取数据(既然从localStorage初始化，那么原来的”&lt;p&gt;123&lt;/p&gt;“就换为了null)，第二个是更改了handleEditorSave，当保存时将数据保存在localStorage中，上面的代码都很容易理解，不再解释。如果成功了的话，在富文本编辑器中输入并按Ctrl + S保存，然后刷新，数据会原样的重现。</p>
<h1 id="页面布局"><a href="#页面布局" class="headerlink" title="页面布局"></a>页面布局</h1><p>我们来看一下项目的每个页面的布局</p>
<p>Home</p>
<center>
<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/20200214153650.png"/>
</center>


<p>Edit</p>
<center>
<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/20200214153119.png"/>
</center>


<p>Display</p>
<center>
<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/20200214153418.png"/>
</center>


<p>Login</p>
<center>
<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/20200214153540.png"/>
</center>


<p>其中Home, Display, Edit都是下面这样的布局</p>
<center>
<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/20200214154437.png" width="60%"/>
</center>


<p>而Login的布局是</p>
<center>
<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/20200214154823.png" width="60%" />
</center>


<p>所以我们抽离出布局组件，Home，Edit,Display三者的布局抽离为BasicLayout，而Login的布局抽离为LoginLayout组件，注意到他们的Heder都是相同的，所以我们把Header抽离为一个公共的组件。</p>
<h2 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h2><p>在src下新建components目录，在其中新建Header文件夹，在其中新建index.jsx和index.module.css。index.jsx的内容如下</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'./index.module.css'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Header</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> toEdit = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">        e.preventDefault()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> toHome = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">        e.preventDefault()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;div className=&#123;styles.header&#125;&gt;</span><br><span class="line">            &lt;div className=&#123;styles.nav&#125;&gt;</span><br><span class="line">                &lt;ul&gt;</span><br><span class="line">                    &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/home"</span> <span class="attr">onClick</span>=<span class="string">&#123;toHome&#125;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;li&gt;&lt;a href="/</span>edit<span class="string">" onClick=&#123;toEdit&#125;&gt;写博客&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">                &lt;/ul&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;div className=&#123;styles.desc&#125;&gt;</span></span><br><span class="line"><span class="string">                Coder</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default Header</span></span><br></pre></td></tr></table></figure>

<p>index.module.css中的内容为</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.nav</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav</span> <span class="selector-tag">ul</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav</span> <span class="selector-tag">ul</span> <span class="selector-tag">li</span> &#123;</span><br><span class="line">    <span class="attribute">list-style</span>: none;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">80px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">padding-top</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav</span> <span class="selector-tag">ul</span> <span class="selector-tag">li</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">text-decoration</span>: none;</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">    <span class="attribute">font-family</span>: Consolas, <span class="string">"楷体"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav</span> <span class="selector-tag">ul</span> <span class="selector-tag">li</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#FFF</span>;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">10px</span> <span class="number">#FFF</span> inset;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.desc</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">    <span class="attribute">font-family</span>: Consolas, <span class="string">"楷体"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的内容想必还是很容易理解的，其中Header中的两个a标签的点击事件均没有处理，这两个a标签是用于做路由跳转用的，等用到在回过头来补充。</p>
<h2 id="BasicLayout"><a href="#BasicLayout" class="headerlink" title="BasicLayout"></a>BasicLayout</h2><p>在src下新建layouts文件夹，在其中新建文件夹BasicLayout，在BasicLayout中新建index.jsx和index.module.css，其中index.jsx的内容为</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'./index.module.css'</span></span><br><span class="line"><span class="keyword">import</span> Header <span class="keyword">from</span> <span class="string">'./../../components/Header'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">BasicLayout</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; children &#125; = props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;div className=&#123;styles.box&#125;&gt;</span><br><span class="line">            &lt;div className=&#123;styles.container&#125;&gt;</span><br><span class="line">                &lt;Header /&gt;</span><br><span class="line">                &lt;div className=&#123;styles.main&#125;&gt;</span><br><span class="line">                    &lt;div className=&#123;styles.content&#125;&gt;</span><br><span class="line">                        &#123;children&#125;</span><br><span class="line">                    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;div className=&#123;styles.aside&#125;&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;/</span>div&gt;</span><br><span class="line">                &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default BasicLayout</span></span><br></pre></td></tr></table></figure>

<p>其中index.module.css中的内容为</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#d8e2eb</span> <span class="built_in">url</span>(./../../assets/img/bg.jpg) no-repeat top center;</span><br><span class="line">    <span class="attribute">min-height</span>: <span class="number">100vh</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">max-width</span>: <span class="number">1200px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.main</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.content</span> &#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">3</span>;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.aside</span> &#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里要用到背景图片，我们在src下新建assets文件夹，然后新建img，在其中放入背景图片，背景图片在这里</p>
<center>
<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/20200214163456bg.jpg"/>
</center>


<p>接在src下新建common.css，以消除内外边距，设置字体</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: Consolas, <span class="string">"楷体"</span>;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我们在src/index.js中引用该布局看看效果</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> RichText <span class="keyword">from</span> <span class="string">'./pages/RichText'</span>;</span><br><span class="line"><span class="keyword">import</span> BasicLayout <span class="keyword">from</span> <span class="string">'./layouts/BasicLayout'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./common.css'</span></span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">BasicLayout</span>&gt;</span></span></span><br><span class="line"><span class="xml">                  <span class="tag">&lt;<span class="name">RichText</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">BasicLayout</span>&gt;</span></span>, </span><br><span class="line">                <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>));</span><br></pre></td></tr></table></figure>

<p>如下：</p>
<center>
<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/20200214171622.png"/>
</center>


<h2 id="LoginLayout"><a href="#LoginLayout" class="headerlink" title="LoginLayout"></a>LoginLayout</h2><p>在layouts下新建LoginLayout文件夹，在LoginLayout中新建index.jsx和index.module.css。有了BasicLayout的经验，代码的内容不必解释，直接上代码。index.jsx</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'./index.module.css'</span></span><br><span class="line"><span class="keyword">import</span> Header <span class="keyword">from</span> <span class="string">'./../../components/Header'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">LoginLayout</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; children &#125; = props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;div className=&#123;styles.box&#125;&gt;</span><br><span class="line">            &lt;div className=&#123;styles.container&#125;&gt;</span><br><span class="line">                &lt;Header /&gt;</span><br><span class="line">                &lt;div className=&#123;styles.main&#125;&gt;</span><br><span class="line">                    &#123;children&#125;</span><br><span class="line">                &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default LoginLayout</span></span><br></pre></td></tr></table></figure>

<p>index.module.css</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#d8e2eb</span> <span class="built_in">url</span>(./../../assets/img/bg.jpg) no-repeat top center;</span><br><span class="line">    <span class="attribute">min-height</span>: <span class="number">100vh</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">max-width</span>: <span class="number">1200px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.main</span> &#123;</span><br><span class="line">    <span class="attribute">width </span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="页面路由"><a href="#页面路由" class="headerlink" title="页面路由"></a>页面路由</h1><p>为了使用路由，先下好react-router-dom</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cnpm install react-router-dom --save</span><br></pre></td></tr></table></figure>

<p>该blog项目总共有四个页面</p>
<ul>
<li>Home：页面主页</li>
<li>Display：阅读文章的页面</li>
<li>Edit：编辑文章的页面</li>
<li>Login：登录页面</li>
</ul>
<p>为了演示路由，在pages中分别新建Home, Display, Edit, Login四个文件夹，并在每个文件夹中新建index.jsx，同时在Edit文件夹了新建components文件夹，将RichText文件夹全部移入到这个文件夹中(因为RichText富文本编辑器属于编辑文章页面的一部分)，简单的在每个文件的index.jsx写下一些内容，具体的内容在后面添加。</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Home/index.jsx</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> BasicLayout <span class="keyword">from</span> <span class="string">'./../../layouts/BasicLayout'</span></span><br><span class="line"><span class="keyword">import</span> &#123;withRouter&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Home</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;BasicLayout&gt;</span><br><span class="line">            Home</span><br><span class="line">        &lt;<span class="regexp">/BasicLayout&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default withRouter(Home)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Display/index.jsx</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> BasicLayout <span class="keyword">from</span> <span class="string">'./../../layouts/BasicLayout'</span></span><br><span class="line"><span class="keyword">import</span> &#123;withRouter&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Display</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;BasicLayout&gt;</span><br><span class="line">            Display</span><br><span class="line">        &lt;<span class="regexp">/BasicLayout&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default withRouter(Display)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Edit/index.jsx</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> BasicLayout <span class="keyword">from</span> <span class="string">'./../../layouts/BasicLayout'</span></span><br><span class="line"><span class="keyword">import</span> &#123;withRouter&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"><span class="keyword">import</span> RichText <span class="keyword">from</span> <span class="string">'./components/RichText'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Edit</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;BasicLayout&gt;</span><br><span class="line">            &lt;RichText /&gt;</span><br><span class="line">        &lt;<span class="regexp">/BasicLayout&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default withRouter(Edit)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Login/index.jsx</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;withRouter&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"><span class="keyword">import</span> LoginLayout <span class="keyword">from</span> <span class="string">'./../../layouts/LoginLayout'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Login</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;LoginLayout&gt;</span><br><span class="line">            login</span><br><span class="line">        &lt;<span class="regexp">/LoginLayout&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default withRouter(Login)</span></span><br></pre></td></tr></table></figure>

<p>设计页面路由如下</p>
<table>
<thead>
<tr>
<th align="left">path</th>
<th align="left">component</th>
<th align="left">redirect</th>
</tr>
</thead>
<tbody><tr>
<td align="left">/home</td>
<td align="left">Home</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">/display/:id</td>
<td align="left">Display</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">/edit</td>
<td align="left">Edit</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">/edit:id</td>
<td align="left">Edit</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">/login</td>
<td align="left">Login</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">/</td>
<td align="left"></td>
<td align="left">/home</td>
</tr>
</tbody></table>
<p>注意到Edit组件对应两个路径，因为编辑文章有两种情况，第一种是添加文章，这时是/edit路径，第二种是编辑文章，这时需要传入文章的id，所以这时是/edit/:id路径。</p>
<p>在src下新建文件夹config，在config新建routes.js，里面设置路由信息，如下</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">'./../pages/Home/index'</span></span><br><span class="line"><span class="keyword">import</span> Display <span class="keyword">from</span> <span class="string">'./../pages/Display/index'</span></span><br><span class="line"><span class="keyword">import</span> Edit <span class="keyword">from</span> <span class="string">'./../pages/Edit/index'</span></span><br><span class="line"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">'./../pages/Login/index'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line">    &#123;</span><br><span class="line">        path: <span class="string">"/login"</span>,</span><br><span class="line">        component: Login</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        path: <span class="string">"/home"</span>,</span><br><span class="line">        component: Home</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        path: <span class="string">"/display/:id"</span>,</span><br><span class="line">        component: Display</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        path: <span class="string">"/edit"</span>,</span><br><span class="line">        component: Edit</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        path: <span class="string">"/edit/:id"</span>,</span><br><span class="line">        component: Edit</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        path: <span class="string">"/"</span>,</span><br><span class="line">        redirect: <span class="string">"/home"</span>,</span><br><span class="line">        exact: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>在src下新建router.js，用来渲染路由，内容如下</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> routes <span class="keyword">from</span> <span class="string">'./config/routes'</span></span><br><span class="line"><span class="keyword">import</span> &#123;Switch, BrowserRouter <span class="keyword">as</span> Router, Route, Redirect &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createBrowserHistory &#125; <span class="keyword">from</span> <span class="string">'history'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> history = createBrowserHistory();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回可能是Redirect 也可能是Route 所以使用RouteItem封装</span></span><br><span class="line"><span class="keyword">const</span> RouteItem = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; path, <span class="attr">component</span>: Component, redirect, key, exact &#125; = props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (redirect) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">from</span>=<span class="string">&#123;path&#125;</span> <span class="attr">to</span>=<span class="string">&#123;redirect&#125;</span> <span class="attr">key</span>=<span class="string">&#123;key&#125;</span> /&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;Route</span><br><span class="line">            key=&#123;key&#125;</span><br><span class="line">            exact=&#123;exact&#125;</span><br><span class="line">            path=&#123;path&#125;</span><br><span class="line">            render=&#123;componentProps =&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> (</span><br><span class="line">                    &lt;Component &#123;...componentProps&#125; /&gt;</span><br><span class="line">                )</span><br><span class="line">            &#125;&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;Router&gt;</span><br><span class="line">            &#123;<span class="comment">/* Switch 唯一匹配  */</span>&#125;</span><br><span class="line">            &lt;Switch&gt;</span><br><span class="line">                &#123;routes.map(<span class="function">(<span class="params">item, id</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> RouteItem(&#123; <span class="attr">key</span>: id, ...item &#125;)</span><br><span class="line">                &#125;)&#125;</span><br><span class="line">            &lt;<span class="regexp">/Switch&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>Router&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure>

<p>接着在src/index.js中渲染出来</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">'./router'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./common.css'</span>;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(router(), <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>));</span><br></pre></td></tr></table></figure>

<p>接着启动项目(npm start或yarn start)，改变浏览的url(如localhost:3000/display)看看页面是否能成功跳转(我这里是没有问题的，如果你不能的话，回过头仔细看看吧)。</p>
<h1 id="页面编写"><a href="#页面编写" class="headerlink" title="页面编写"></a>页面编写</h1><h2 id="antd表单的使用"><a href="#antd表单的使用" class="headerlink" title="antd表单的使用"></a>antd表单的使用</h2><p>要使用antd，先下载antd</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cnpm install antd --save</span><br></pre></td></tr></table></figure>

<p>首先看一个表单的例子，在src下新建一个test文件夹，新建TextAntdForm.jsx，内容如下(先不管看得懂看不懂，后面解释)</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;Form, Input, Button&#125; <span class="keyword">from</span> <span class="string">'antd'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TextAntdForm</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123;getFieldDecorator, validateFields&#125; = props.form</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleSubmit = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">        event.preventDefault();</span><br><span class="line">        validateFields(<span class="function">(<span class="params">error, values</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!error) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(values);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>(</span><br><span class="line">        &lt;div style=&#123;&#123;<span class="attr">width</span>: <span class="string">"300px"</span>, <span class="attr">margin</span>: <span class="string">"100px auto"</span>, <span class="attr">fontFamily</span>: <span class="string">"Consolas, '楷体'"</span>&#125;&#125;&gt;</span><br><span class="line">            &lt;Form onSubmit=&#123;handleSubmit&#125;&gt;</span><br><span class="line">                &lt;Form.Item label=<span class="string">"用户名"</span>&gt;</span><br><span class="line">                    &#123;getFieldDecorator(<span class="string">'title'</span>, &#123;</span><br><span class="line">                      rules: [&#123;</span><br><span class="line">                        required: <span class="literal">true</span>,</span><br><span class="line">                        message: <span class="string">'请输入用户名'</span>,</span><br><span class="line">                      &#125;],</span><br><span class="line">                    &#125;)(</span><br><span class="line">                      &lt;Input size=<span class="string">"large"</span> placeholder=<span class="string">"请输入用户名"</span>/&gt;</span><br><span class="line">                    )&#125;</span><br><span class="line">                &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">                &lt;Form.Item label="密码"&gt;</span></span><br><span class="line"><span class="regexp">                    &#123;getFieldDecorator('password', &#123;</span></span><br><span class="line"><span class="regexp">                      rules: [&#123;</span></span><br><span class="line"><span class="regexp">                        required: true,</span></span><br><span class="line"><span class="regexp">                        message: '请输入密码',</span></span><br><span class="line"><span class="regexp">                      &#125;],</span></span><br><span class="line"><span class="regexp">                    &#125;)(</span></span><br><span class="line"><span class="regexp">                      &lt;Input.Password size="large" placeholder="请输入密码"/</span>&gt;</span><br><span class="line">                    )&#125;</span><br><span class="line">                &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                &lt;Form.Item&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;Button size="large" type="primary" htmlType="submit"&gt;提交&lt;/</span>Button&gt;</span><br><span class="line">                &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>Form&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Form.create()(TextAntdForm)</span></span><br></pre></td></tr></table></figure>

<p>修改src/index.js渲染该组件(记得引入antd/dits/antd.css，否则antd组件没有样式)</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// import router from './router'</span></span><br><span class="line"><span class="keyword">import</span> TestAntdForm <span class="keyword">from</span> <span class="string">'./test/TestAntdForm'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'antd/dist/antd.css'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./common.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReactDOM.render(router(), document.getElementById("root"));</span></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">TestAntdForm</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>));</span><br></pre></td></tr></table></figure>

<center>
<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/20200214203708.png"/>
</center>


<p>现在来解释上面的代码，首先看最后一行</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">Form.create()(TextAntdForm)</span><br></pre></td></tr></table></figure>

<p>还记得高阶组件吗，Form.create()就是一个高阶组件，他会向组件的props中注入form，form提供了一些API，这里使用了两个：</p>
<ul>
<li>getFieldDecorator：用于和表单进行双向绑定</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">getFieldDecorator(<span class="string">'title'</span>, &#123;</span><br><span class="line">  rules: [&#123;</span><br><span class="line">    required: <span class="literal">true</span>,</span><br><span class="line">    message: <span class="string">'请输入用户名'</span>,</span><br><span class="line">  &#125;],</span><br><span class="line">&#125;)(</span><br><span class="line">  &lt;Input size=<span class="string">"large"</span> placeholder=<span class="string">"请输入用户名"</span>/&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>上面将Input与表单项进行了绑定，getFieldDecorator接收两个参数，第一个参数是id，根据它可以获取输入控件的值或者设置输入控件的值，是必填项；第二个参数是options，里面可以有很多属性，这里使用了rules，定义了校验的规则，required表示是否必填，message表示未填时显示的消息文字。</p>
<ul>
<li>validateFields：校验</li>
</ul>
<p>里面接受一个回调函数，回调函数接收两个参数，第一个参数为error，当不满足校验规则时error的值非空，第二个参数是values，会将绑定表单的值以对象的形式传给values，键就是在getFieldDecorator传入的id。</p>
<p>上面在提交表单后，会调用Form的onSubmit回调函数，在回调函数，我们对数据进行了校验，如果没有问题的话，我们可以将输入表单的键值对以对象的形式获取到values，并打印出来</p>
<center>
<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/20200214205410.png"/>
</center>


<h2 id="页面数据"><a href="#页面数据" class="headerlink" title="页面数据"></a>页面数据</h2><p>我们将数据设置为一个数组datas，它的格式如下</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">datas = [</span><br><span class="line">  &#123;<span class="attr">title</span>: , <span class="attr">brief</span>: , <span class="attr">isTop</span>: , <span class="attr">content</span>: &#125;</span><br><span class="line">  &#123;<span class="attr">title</span>: , <span class="attr">brief</span>: , <span class="attr">isTop</span>: , <span class="attr">content</span>: &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>Home组件根据datas展示数据，Edit和Display组件根据id和datas获取要展示的数据，由于多个组件都要用到数据，所以这里使用useContext和useReducer来分发数据。</p>
<p>在src下新建Provider.jsx，用来提供state和dispatch，内容如下</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;useReducer&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Context = React.createContext();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reducer = <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> tempDatas = state.datas</span><br><span class="line">    <span class="comment">// 按道理case后面跟的都是常量，我这里为了简单</span></span><br><span class="line">    <span class="keyword">switch</span>(action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'insertData'</span>:</span><br><span class="line">            tempDatas[tempDatas.length] = action.data;</span><br><span class="line">            <span class="keyword">return</span> &#123;...state, <span class="attr">datas</span>: tempDatas&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'updateData'</span>:</span><br><span class="line">            tempDatas[action.id] = action.data</span><br><span class="line">            <span class="keyword">return</span> &#123;...state, <span class="attr">datas</span>: tempDatas&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'deleteData'</span>:</span><br><span class="line">            tempDatas.splice(action.id, <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> &#123;...state, <span class="attr">datas</span>: tempDatas&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'changeOperation'</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;...state, <span class="attr">operation</span>: action.operation&#125;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initState = &#123;</span><br><span class="line">    <span class="comment">// 随便写的数据用来实验 随后会删掉</span></span><br><span class="line">    datas: [&#123;<span class="attr">title</span>: <span class="string">'aaa'</span>, <span class="attr">isTop</span>: <span class="literal">true</span>, <span class="attr">brief</span>: <span class="string">'hahah'</span>&#125;, <span class="attr">content</span>: <span class="string">'&lt;p&gt;123&lt;/p&gt;'</span>],</span><br><span class="line">    <span class="comment">// 用来判断是添加文章还是编辑文章</span></span><br><span class="line">    operation: <span class="string">'ADD'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Provider</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [state, dispatch] = useReducer(reducer, initState)</span><br><span class="line">    <span class="keyword">const</span> &#123;children&#125; = props</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;Context.Provider value=&#123;&#123;state, dispatch&#125;&#125;&gt;</span><br><span class="line">            &#123;children&#125;</span><br><span class="line">        &lt;<span class="regexp">/Context.Provider&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Provider</span></span><br></pre></td></tr></table></figure>

<p>更改router.js，在最上面加上Provider</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Provider <span class="keyword">from</span> <span class="string">'./Provider'</span></span><br><span class="line"><span class="comment">// 上面没有变化，除了import Provider，故此省略</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;Provider&gt;</span><br><span class="line">            &lt;Router history=&#123;history&#125;&gt;</span><br><span class="line">                &lt;Switch&gt;</span><br><span class="line">                    &#123;routes.map(<span class="function">(<span class="params">item, id</span>) =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> RouteItem(&#123; <span class="attr">key</span>: id, ...item, <span class="attr">history</span>: history &#125;)</span><br><span class="line">                    &#125;)&#125;</span><br><span class="line">                &lt;<span class="regexp">/Switch&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>Router&gt;</span><br><span class="line">        &lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default router</span></span><br></pre></td></tr></table></figure>

<h2 id="Home"><a href="#Home" class="headerlink" title="Home"></a>Home</h2><p>观察Home页面</p>
<center>
<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/20200214212726.png"/>
</center>


<p>发现Home是由这一个个Item组成，Item中的数据正是datas数组中每一个元素的内容，在Home中新建文件夹Item，并在Item中新建index.jsx和index.module.css。index.jsx:</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'./index.module.css'</span></span><br><span class="line"><span class="keyword">import</span> &#123;Modal&#125; <span class="keyword">from</span> <span class="string">'antd'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;confirm&#125;  = Modal</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Item</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; </span><br><span class="line">        data, </span><br><span class="line">        login, </span><br><span class="line">        handleDelete, </span><br><span class="line">        index, </span><br><span class="line">        handleToEdit, </span><br><span class="line">        handleToDisplay </span><br><span class="line">    &#125; = props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> toDisplay = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">        event.preventDefault();</span><br><span class="line">        handleToDisplay(index)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> toEdit = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">        event.preventDefault();</span><br><span class="line">        handleToEdit(index)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> toDelete = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">        event.preventDefault();</span><br><span class="line">        confirm(&#123;</span><br><span class="line">            title: <span class="string">`你确定要删除<span class="subst">$&#123;data.title&#125;</span>`</span>,</span><br><span class="line">            content: <span class="string">'删除后内容不可恢复'</span>,</span><br><span class="line">            onOk() &#123;</span><br><span class="line">                handleDelete(index)</span><br><span class="line">            &#125;,</span><br><span class="line">            onCancel() &#123;</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;); </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;div className=&#123;styles.item&#125;&gt;</span><br><span class="line">            &lt;h2&gt;<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#123;</span>`/<span class="attr">display</span>/$&#123;<span class="attr">data.id</span>&#125;`&#125; <span class="attr">onClick</span>=<span class="string">&#123;toDisplay&#125;</span>&gt;</span>&#123;data.title&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span>&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">            &lt;hr /</span>&gt;</span><br><span class="line">            &lt;div className=&#123;styles.abstract&#125;&gt;</span><br><span class="line">                &#123;data.brief&#125;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">            &lt;div className=&#123;styles.readmore&#125;&gt;</span></span><br><span class="line"><span class="regexp">                &lt;a href=&#123;`/</span>display/$&#123;data.id&#125;<span class="string">`&#125; onClick=&#123;toDisplay&#125;&gt;阅读更多&lt;/a&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &#123;/* 当登录失显示编辑本文和删除本文 */&#125;</span></span><br><span class="line"><span class="string">            &#123;login ? </span></span><br><span class="line"><span class="string">            &lt;div className=&#123;styles.edit&#125;&gt;</span></span><br><span class="line"><span class="string">                &lt;a href=&#123;`</span>/edit/$&#123;data.id&#125;<span class="string">`&#125; onClick=&#123;toEdit&#125;&gt;编辑本文&lt;/a&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt; : ""&#125; </span></span><br><span class="line"><span class="string">            &#123;login ? </span></span><br><span class="line"><span class="string">                &lt;div className=&#123;styles.delete&#125;&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href="/delete" onClick=&#123;toDelete&#125;&gt;删除本文&lt;/a&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;: ""&#125;</span></span><br><span class="line"><span class="string">            &#123;/* 当isTop为1时显示置顶图标 */&#125;</span></span><br><span class="line"><span class="string">            &#123;data.isTop ? </span></span><br><span class="line"><span class="string">            &lt;div className=&#123;styles.isTop&#125;&gt;</span></span><br><span class="line"><span class="string">                &lt;svg viewBox="0 0 1024 1024"&gt;</span></span><br><span class="line"><span class="string">                    &lt;path d="M0 0h1024v1024z" fill="#7ED321"&gt;&lt;/path&gt;</span></span><br><span class="line"><span class="string">                    &lt;path d="M571.733333 157.866667l17.066667-12.8-83.2-83.2L552.533333 14.933333l183.466667 183.466667-46.933333 46.933333-81.066667-81.066666-17.066667 12.8 100.266667 100.266666-14.933333 14.933334-102.4-102.4c-6.4 4.266667-10.666667 8.533333-17.066667 10.666666l72.533333 72.533334-110.933333 110.933333 36.266667 36.266667-14.933334 14.933333L313.6 209.066667l14.933333-14.933334 36.266667 36.266667 110.933333-110.933333 61.866667 61.866666c6.4-4.266667 10.666667-8.533333 17.066667-10.666666l-96-96 14.933333-14.933334 98.133333 98.133334z m-72.533333 209.066666l17.066667-17.066666-117.333334-117.333334-17.066666 17.066667 117.333333 117.333333z m27.733333-29.866666l14.933334-14.933334L426.666667 204.8l-14.933334 14.933333 115.2 117.333334z m27.733334-27.733334l17.066666-14.933333-117.333333-117.333333-17.066667 14.933333 117.333334 117.333333z m27.733333-25.6l14.933333-14.933333L482.133333 149.333333l-14.933333 14.933334 115.2 119.466666z m10.666667-202.666666L554.666667 44.8l-21.333334 21.333333 38.4 38.4 21.333334-23.466666z m57.6 57.6l-40.533334-40.533334-21.333333 21.333334 40.533333 40.533333 21.333334-21.333333zM704 192l-38.4-38.4-21.333333 21.333333L682.666667 213.333333l21.333333-21.333333zM571.733333 471.466667l12.8-21.333334c8.533333 10.666667 17.066667 19.2 25.6 27.733334 6.4 6.4 12.8 6.4 21.333334-2.133334l172.8-172.8-38.4-38.4 17.066666-17.066666 87.466667 87.466666-17.066667 17.066667-29.866666-29.866667-177.066667 177.066667c-14.933333 14.933333-29.866667 14.933333-44.8 0l-29.866667-27.733333z m302.933334 21.333333l-44.8 44.8c-27.733333 25.6-55.466667 40.533333-83.2 44.8-27.733333 2.133333-59.733333-6.4-96-25.6l6.4-25.6c34.133333 19.2 64 27.733333 87.466666 25.6 23.466667-4.266667 46.933333-14.933333 68.266667-36.266667l44.8-44.8 17.066667 17.066667z m132.266666-21.333333l-17.066666 19.2-55.466667-55.466667c-10.666667 8.533333-19.2 17.066667-29.866667 23.466667l51.2 51.2-119.466666 119.466666-17.066667-17.066666 102.4-102.4-76.8-76.8-104.533333 100.266666-17.066667-17.066666 121.6-121.6 42.666667 42.666666c10.666667-6.4 19.2-14.933333 29.866666-23.466666L861.866667 362.666667l17.066666-17.066667 128 125.866667zM802.133333 682.666667h-25.6c2.133333-25.6 2.133333-55.466667-2.133333-89.6h23.466667c4.266667 34.133333 4.266667 64 4.266666 89.6z" fill="#FFFFFF"&gt;&lt;/path&gt;</span></span><br><span class="line"><span class="string">                &lt;/svg&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt; : ""&#125;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default Item</span></span><br></pre></td></tr></table></figure>

<p>注意到Item为展示组件，只负责数据的展示，而不负责数据的处理、获取，Item的数据、数据的操作都是从props中获取的，这些操作都由Item的容器组件Home来完成。</p>
<p>我们会将login保存在sessionStorage，login是一个布尔值，保存了是否登录的信息，true表示登录，false表示未登录，根据是否登录，决定是否将删除和编辑的操作暴露出来。同时我们也将根据data的isTop是否为true来显示是否置顶的svg图样(该图样来自CSDN的置顶图样)。</p>
<p>index.module.css</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">150px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: white;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">padding-left</span>: <span class="number">25px</span>;</span><br><span class="line">    <span class="attribute">padding-right</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">padding-top</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">box-shadow</span>:<span class="number">0px</span> <span class="number">0px</span> <span class="number">6px</span> <span class="number">6px</span> <span class="number">#FFF</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">text-decoration</span>: none;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#40759b</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.item</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">text-decoration</span>: underline;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.abstract</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">padding-top</span>: <span class="number">30px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.readmore</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.edit</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">75px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.delete</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">140px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.isTop</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在进入Home组件，修改Home/index.jsx如下</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useContext &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> BasicLayout <span class="keyword">from</span> <span class="string">'./../../layouts/BasicLayout'</span></span><br><span class="line"><span class="keyword">import</span> Item <span class="keyword">from</span> <span class="string">'./components/Item'</span></span><br><span class="line"><span class="keyword">import</span> &#123;withRouter&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"><span class="keyword">import</span> &#123;Context&#125; <span class="keyword">from</span> <span class="string">'./../../router'</span></span><br><span class="line"><span class="keyword">import</span> &#123; message &#125; <span class="keyword">from</span> <span class="string">'antd'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Home</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123;history&#125; = props</span><br><span class="line">    <span class="comment">// 使用useContext获取Provider提供的数据</span></span><br><span class="line">    <span class="keyword">const</span> &#123;state, dispatch&#125; = useContext(Context);</span><br><span class="line">    <span class="keyword">const</span> login = sessionStorage.getItem(<span class="string">"login"</span>);</span><br><span class="line">    <span class="keyword">const</span> datas = state.datas;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleDelete = <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">        dispatch(&#123;<span class="attr">type</span>: <span class="string">"deleteData"</span>, id&#125;);</span><br><span class="line">        message.success(<span class="string">'删除成功'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleToEdit = <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">        dispatch(&#123;<span class="attr">type</span>: <span class="string">"changeOperation"</span>, <span class="attr">operation</span>: <span class="string">"EDIT"</span>&#125;)      </span><br><span class="line">        history.push(<span class="string">`/edit/<span class="subst">$&#123;id&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleToDisplay = <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">        history.push(<span class="string">`display/<span class="subst">$&#123;id&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;BasicLayout&gt;</span><br><span class="line">                &#123;datas.map(<span class="function">(<span class="params">data, index</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Item</span> </span></span></span><br><span class="line"><span class="xml">                        index=&#123;index&#125; </span></span><br><span class="line"><span class="xml">                        data=&#123;data&#125; </span></span><br><span class="line"><span class="xml">                        key=&#123;index&#125; </span></span><br><span class="line"><span class="xml">                        login=&#123;login&#125;</span></span><br><span class="line"><span class="xml">                        handleDelete=&#123;handleDelete&#125;</span></span><br><span class="line"><span class="xml">                        handleToEdit=&#123;handleToEdit&#125;</span></span><br><span class="line"><span class="xml">                        handleToDisplay=&#123;handleToDisplay&#125;</span></span><br><span class="line"><span class="xml">                        /&gt;</span></span><br><span class="line">                &#125;)&#125;</span><br><span class="line">            &lt;<span class="regexp">/BasicLayout&gt;</span></span><br><span class="line"><span class="regexp">            </span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> withRouter(Home)</span><br></pre></td></tr></table></figure>

<p>现在启动项目(npm start)，观察到页面如下</p>
<center>
<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/20200214224320.png"/>
</center>


<p>说明Home页面已经成功了(由于在sessionStorage中没有login，所以删除本文和编辑本文均显示不出来，当点击阅读更多时，会跳转到Display的页面)。</p>
<h2 id="Display"><a href="#Display" class="headerlink" title="Display"></a>Display</h2><p>我们来观察Display的页面</p>
<center>
<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/20200214225458.png"/>
</center>


<p>发现Display页面有一个背景为白色的内容区和一个按钮，这个按钮根据是否有登录来决定是否暴露出来，所以我们在Display中新建一个components文件夹，在里面新建一个Content文件夹，在Content文件夹中新建index.jsx和index.module.css。首先Content是一个展示组件，所以它的数据全部都由Display提供，所有的数据操作也由Display传入回调函数进行处理。</p>
<p>index.jsx如下</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Button &#125; <span class="keyword">from</span> <span class="string">'antd'</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'./index.module.css'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Content</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;login, htmlContent, handleToEdit&#125; = props</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> toEdit = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        handleToEdit();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>(</span><br><span class="line">        &lt;div className=&#123;styles.display&#125;&gt;</span><br><span class="line">            &lt;div className=<span class="string">"braft-output-content"</span>  style=&#123;&#123;<span class="attr">minHeight</span>: <span class="string">"425px"</span>, <span class="attr">backgroundColor</span>: <span class="string">"#FFF"</span>, <span class="attr">padding</span>: <span class="string">"50px 25px"</span>, <span class="attr">fontSize</span>: <span class="string">"16px"</span>, <span class="attr">maxWidth</span>: <span class="string">"850px"</span>&#125;&#125; dangerouslySetInnerHTML=&#123;&#123;<span class="attr">__html</span>: htmlContent&#125;&#125; &gt;</span><br><span class="line"></span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">            &#123;login &amp;&amp; </span></span><br><span class="line"><span class="regexp">                &lt;div className=&#123;styles.edit&#125;&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;Button type="primary" onClick=&#123;toEdit&#125;&gt;编辑文章&lt;/</span>Button&gt;</span><br><span class="line">                &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">            &#125;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Content</span><br></pre></td></tr></table></figure>

<p>想必上面的代码还是比较容易理解的，index.module.css的内容如下</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.display</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.display</span> <span class="selector-tag">ul</span>, <span class="selector-class">.display</span> <span class="selector-tag">ol</span> &#123;</span><br><span class="line">    <span class="attribute">padding-left</span>: <span class="number">30px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.edit</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以Display中的内容如下</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;useContext&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> BasicLayout <span class="keyword">from</span> <span class="string">'./../../layouts/BasicLayout'</span></span><br><span class="line"><span class="keyword">import</span> &#123;withRouter&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"><span class="keyword">import</span> Content <span class="keyword">from</span> <span class="string">'./components/Content'</span></span><br><span class="line"><span class="keyword">import</span> &#123;Context&#125; <span class="keyword">from</span> <span class="string">'./../../Provider'</span></span><br><span class="line"><span class="keyword">import</span> BraftEditor <span class="keyword">from</span> <span class="string">'braft-editor'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Display</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;history&#125; = props</span><br><span class="line">    <span class="comment">// 获取传过来的id</span></span><br><span class="line">    <span class="keyword">const</span> index = <span class="built_in">Number</span>(history.location.pathname.split(<span class="string">"/"</span>)[<span class="number">2</span>])</span><br><span class="line">    <span class="keyword">const</span> &#123;state, dispatch&#125; = useContext(Context)</span><br><span class="line">    <span class="keyword">const</span> htmlContent = BraftEditor.createEditorState(state.datas[index].content).toHTML()</span><br><span class="line">    <span class="keyword">const</span> login = sessionStorage.getItem(<span class="string">"login"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleToEdit = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        dispatch(&#123;<span class="attr">type</span>: <span class="string">"changeOperation"</span>, <span class="attr">operation</span>: <span class="string">"EDIT"</span>&#125;);</span><br><span class="line">        history.push(<span class="string">`/edit/<span class="subst">$&#123;index&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;BasicLayout&gt;</span><br><span class="line">            &lt;Content</span><br><span class="line">                htmlContent=&#123;htmlContent&#125;</span><br><span class="line">                login = &#123;login&#125;</span><br><span class="line">                handleToEdit = &#123;handleToEdit&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">        &lt;<span class="regexp">/BasicLayout&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default withRouter(Display)</span></span><br></pre></td></tr></table></figure>

<p>至此Display页面设计完毕。</p>
<h2 id="Edit"><a href="#Edit" class="headerlink" title="Edit"></a>Edit</h2><p>在写Edit页面之前，来改造一下RichText组件，我们要将RichText做成展示组件，所有的数据都由Edit提供，所有的数据处理也由Edit处理，修改如下</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> BraftEditor <span class="keyword">from</span> <span class="string">'braft-editor'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'braft-editor/dist/index.css'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">RichText</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123;value, onChange&#125; = props</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleEditorChange = <span class="function">(<span class="params">editorState</span>) =&gt;</span> &#123;</span><br><span class="line">        onChange(editorState)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;BraftEditor</span><br><span class="line">            value=&#123;value&#125;</span><br><span class="line">            onChange=&#123;handleEditorChange&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> RichText</span><br></pre></td></tr></table></figure>

<p>现在我们来看一下Edit页面的结构</p>
<center>
<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/20200215000232.png"/>
</center>


<p>我们使用antd的表单来做成这件事情，在前面已经介绍过antd表单的使用，所以这里不多加介绍，直接上代码</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;useEffect, useContext&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> RichText <span class="keyword">from</span> <span class="string">'./components/RichText'</span></span><br><span class="line"><span class="keyword">import</span> &#123; withRouter &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Form, Input, Button, message, Checkbox &#125; <span class="keyword">from</span> <span class="string">'antd'</span></span><br><span class="line"><span class="keyword">import</span> BasicLayout <span class="keyword">from</span> <span class="string">'./../../layouts/BasicLayout'</span></span><br><span class="line"><span class="keyword">import</span> BraftEditor <span class="keyword">from</span> <span class="string">'braft-editor'</span></span><br><span class="line"><span class="keyword">import</span> &#123;Context&#125; <span class="keyword">from</span> <span class="string">'./../../Provider'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Edit</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123;history&#125; = props</span><br><span class="line">  <span class="keyword">const</span> FormItem = Form.Item;</span><br><span class="line">  <span class="keyword">const</span> &#123; getFieldDecorator, validateFieldsAndScroll &#125; = props.form;</span><br><span class="line">  <span class="keyword">const</span> &#123;state, dispatch&#125; = useContext(Context)</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 当组件加载后 如果是编辑文章 根据id获取数据 然后显示 </span></span><br><span class="line">    <span class="comment">// 如果是添加操作，则不加载数据 直接显示空白内容</span></span><br><span class="line">    <span class="keyword">if</span>(state.operation === <span class="string">'EDIT'</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> index = <span class="built_in">Number</span>(history.location.pathname.split(<span class="string">"/"</span>)[<span class="number">2</span>]) </span><br><span class="line">        <span class="keyword">const</span> data = state.datas[index]</span><br><span class="line">        <span class="comment">// setFieldsValue为表单设置内容</span></span><br><span class="line">        props.form.setFieldsValue(&#123;</span><br><span class="line">          ...data, </span><br><span class="line">          content: BraftEditor.createEditorState(data.content)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleSubmit = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">    event.preventDefault();</span><br><span class="line">    </span><br><span class="line">    validateFieldsAndScroll(<span class="function">(<span class="params">err, values</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(!err) &#123;</span><br><span class="line">        <span class="comment">// 如果是通过添加按钮进来的 那么拿到数据保存 然后跳转到home页面</span></span><br><span class="line">        <span class="keyword">if</span>(state.operation === <span class="string">'ADD'</span>) &#123;</span><br><span class="line">            dispatch(&#123;<span class="attr">type</span>: <span class="string">'insertData'</span>, <span class="attr">data</span>: &#123;</span><br><span class="line">                ...values,</span><br><span class="line">                content: values.content.toRAW()</span><br><span class="line">            &#125;&#125;);</span><br><span class="line">            message.success(<span class="string">"添加成功"</span>);</span><br><span class="line">            history.push(<span class="string">"/home"</span>);</span><br><span class="line">            <span class="comment">//如果是编辑文章进来的，更新数据 然后跳转到home</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (state.operation === <span class="string">"EDIT"</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> id = <span class="built_in">Number</span>(history.location.pathname.split(<span class="string">"/"</span>)[<span class="number">2</span>]);</span><br><span class="line">            dispatch(&#123;<span class="attr">type</span>: <span class="string">"updateData"</span>, id, <span class="attr">data</span>: &#123;</span><br><span class="line">                ...values, </span><br><span class="line">                content: values.content.toRAW(),</span><br><span class="line">            &#125;&#125;);</span><br><span class="line">            message.success(<span class="string">"更新成功"</span>);</span><br><span class="line">            history.push(<span class="string">"/home"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">      &lt;BasicLayout&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;Form onSubmit=&#123;handleSubmit&#125;&gt;</span><br><span class="line">            &lt;FormItem labelAlign=<span class="string">"left"</span> label=<span class="string">"文章标题"</span>&gt;</span><br><span class="line">                &#123;getFieldDecorator(<span class="string">'title'</span>, &#123;</span><br><span class="line">                  rules: [&#123;</span><br><span class="line">                    required: <span class="literal">true</span>,</span><br><span class="line">                    message: <span class="string">'请输入标题'</span>,</span><br><span class="line">                  &#125;],</span><br><span class="line">                &#125;)(</span><br><span class="line">                  &lt;Input size=<span class="string">"large"</span> placeholder=<span class="string">"请输入标题"</span>/&gt;</span><br><span class="line">                )&#125;</span><br><span class="line">              &lt;<span class="regexp">/FormItem&gt;</span></span><br><span class="line"><span class="regexp">            &lt;FormItem size="large" label="文章摘要"&gt;</span></span><br><span class="line"><span class="regexp">                &#123;getFieldDecorator('brief', &#123;</span></span><br><span class="line"><span class="regexp">                  rules: [&#123;</span></span><br><span class="line"><span class="regexp">                    required: true,</span></span><br><span class="line"><span class="regexp">                    message: '请输入摘要',</span></span><br><span class="line"><span class="regexp">                  &#125;],</span></span><br><span class="line"><span class="regexp">                &#125;)(</span></span><br><span class="line"><span class="regexp">                  &lt;Input.TextArea style=&#123;&#123;fontSize: "16px"&#125;&#125; placeholder="请输入摘要"/</span>&gt;</span><br><span class="line">                )&#125;</span><br><span class="line">              &lt;<span class="regexp">/FormItem&gt;</span></span><br><span class="line"><span class="regexp">            &lt;FormItem&gt;</span></span><br><span class="line"><span class="regexp">                &#123;getFieldDecorator('isTop', &#123;</span></span><br><span class="line"><span class="regexp">                  valuePropName: 'checked',</span></span><br><span class="line"><span class="regexp">                &#125;)(</span></span><br><span class="line"><span class="regexp">                  &lt;Checkbox&gt;</span></span><br><span class="line"><span class="regexp">                    是否置顶</span></span><br><span class="line"><span class="regexp">                  &lt;/</span>Checkbox&gt;,</span><br><span class="line">                )&#125;</span><br><span class="line">              &lt;<span class="regexp">/FormItem&gt;</span></span><br><span class="line"><span class="regexp">            &lt;FormItem label="文章正文"&gt;</span></span><br><span class="line"><span class="regexp">                &#123;getFieldDecorator('content', &#123;</span></span><br><span class="line"><span class="regexp">                  validateTrigger: 'onBlur',</span></span><br><span class="line"><span class="regexp">                  rules: [&#123;</span></span><br><span class="line"><span class="regexp">                    required: true,</span></span><br><span class="line"><span class="regexp">                    message: "请输入正文"</span></span><br><span class="line"><span class="regexp">                  &#125;],</span></span><br><span class="line"><span class="regexp">                &#125;)(</span></span><br><span class="line"><span class="regexp">                  &lt;RichText /</span>&gt;</span><br><span class="line">                )&#125;</span><br><span class="line">              &lt;<span class="regexp">/FormItem&gt;</span></span><br><span class="line"><span class="regexp">            &lt;FormItem&gt;</span></span><br><span class="line"><span class="regexp">                &lt;Button size="large" type="primary" htmlType="submit"&gt;提交&lt;/</span>Button&gt;</span><br><span class="line">              &lt;<span class="regexp">/FormItem&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>Form&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>BasicLayout&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为Edit注入form</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> withRouter(Form.create()(Edit))</span><br></pre></td></tr></table></figure>

<p>上面的代码虽然有点长，但是都是比较容易理解的。注意，虽然我们没有为RichText传入value和onChange，但是由于RichText和表单项进行了双向绑定，所以表单会注入value和onChange。</p>
<h2 id="Login"><a href="#Login" class="headerlink" title="Login"></a>Login</h2><p>Login页面应该是最简单的，只要用我们在前面antd表单示例里面的表单就可以完成，所以直接上代码如下</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;withRouter&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"><span class="keyword">import</span> &#123;Form, Button, Input, message &#125; <span class="keyword">from</span> <span class="string">'antd'</span></span><br><span class="line"><span class="keyword">import</span> LoginLayout <span class="keyword">from</span> <span class="string">'./../../layouts/LoginLayout'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Login</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; form, history &#125; = props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> FormItem = Form.Item;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123;getFieldDecorator, validateFields&#125; = form</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> handleSubmit = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">        event.preventDefault();</span><br><span class="line">        validateFields(<span class="function">(<span class="params">err, values</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">                <span class="keyword">if</span> (values.adminId === <span class="string">"123"</span> &amp;&amp; values.password === <span class="string">"123"</span>) &#123;</span><br><span class="line">                    sessionStorage.setItem(<span class="string">"login"</span>, <span class="literal">true</span>);</span><br><span class="line">                    message.success(<span class="string">"登录成功"</span>);</span><br><span class="line">                    history.push(<span class="string">"/home"</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    message.error(<span class="string">"用户名或密码错误"</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;LoginLayout&gt;</span><br><span class="line">          &lt;Form onSubmit=&#123;handleSubmit&#125;&gt;</span><br><span class="line">            &lt;FormItem labelAlign=<span class="string">"left"</span> label=<span class="string">"用户名"</span>&gt;</span><br><span class="line">                &#123;getFieldDecorator(<span class="string">'adminId'</span>, &#123;</span><br><span class="line">                  rules: [&#123;</span><br><span class="line">                    required: <span class="literal">true</span>,</span><br><span class="line">                    message: <span class="string">'请输入用户名'</span>,</span><br><span class="line">                  &#125;],</span><br><span class="line">                &#125;)(</span><br><span class="line">                  &lt;Input size=<span class="string">"large"</span> placeholder=<span class="string">"请输入用户名"</span>/&gt;</span><br><span class="line">                )&#125;</span><br><span class="line">            &lt;<span class="regexp">/FormItem&gt;</span></span><br><span class="line"><span class="regexp">            &lt;FormItem size="large" label="密码"&gt;</span></span><br><span class="line"><span class="regexp">                &#123;getFieldDecorator('password', &#123;</span></span><br><span class="line"><span class="regexp">                  rules: [&#123;</span></span><br><span class="line"><span class="regexp">                    required: true,</span></span><br><span class="line"><span class="regexp">                    message: '请输入密码',</span></span><br><span class="line"><span class="regexp">                  &#125;],</span></span><br><span class="line"><span class="regexp">                &#125;)(</span></span><br><span class="line"><span class="regexp">                  &lt;Input.Password size="large" placeholder="请输入密码"/</span>&gt;</span><br><span class="line">                )&#125;</span><br><span class="line">            &lt;<span class="regexp">/FormItem&gt;</span></span><br><span class="line"><span class="regexp">            </span></span><br><span class="line"><span class="regexp">            &lt;FormItem&gt;</span></span><br><span class="line"><span class="regexp">                &lt;Button size="large" type="primary" htmlType="submit"&gt;提交&lt;/</span>Button&gt;</span><br><span class="line">            &lt;<span class="regexp">/FormItem&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>Form&gt;</span><br><span class="line">        &lt;<span class="regexp">/LoginLayout&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default withRouter(Form.create()(Login))</span></span><br></pre></td></tr></table></figure>

<h2 id="收尾"><a href="#收尾" class="headerlink" title="收尾"></a>收尾</h2><p>在这里还有一个小地方没有处理，那就是Header，里面的a标签的点击事件没有处理，并且我们希望在登录的情况下显示”写博客”，以及在登录的情况下显示”退出登录”，在未登录的情况下显示”登录”，所以修改Header如下(由于要用到history，所以要在Layout里给Header传入history，但是Layout也没有history，所以要在Home, Edit, Display, Login中给用到的Layout传入history，这里的代码就不贴出了，想必这样的事情对现在的你应该已经很简单了)</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;useContext&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'./index.module.css'</span></span><br><span class="line"><span class="keyword">import</span> &#123;Context&#125; <span class="keyword">from</span> <span class="string">'./../../Provider'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Header</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123;history&#125; = props;</span><br><span class="line">    <span class="keyword">const</span> &#123;dispatch&#125; = useContext(Context);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> login = sessionStorage.getItem(<span class="string">"login"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> toEdit = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">        e.preventDefault();</span><br><span class="line">        dispatch(&#123;<span class="attr">type</span>: <span class="string">"changeOperation"</span>, <span class="attr">operation</span>: <span class="string">"ADD"</span>&#125;);</span><br><span class="line">        history.push(<span class="string">"/edit"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> toHome = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">        e.preventDefault()</span><br><span class="line">        history.push(<span class="string">"/home"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> logout = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">        e.preventDefault()</span><br><span class="line">        sessionStorage.removeItem(<span class="string">"login"</span>);</span><br><span class="line">        history.push(<span class="string">"/login"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> login_ = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">        e.preventDefault()</span><br><span class="line">        history.push(<span class="string">"/login"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;div className=&#123;styles.header&#125;&gt;</span><br><span class="line">            &lt;div className=&#123;styles.nav&#125;&gt;</span><br><span class="line">                &lt;ul&gt;</span><br><span class="line">                    &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/home"</span> <span class="attr">onClick</span>=<span class="string">&#123;toHome&#125;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">                    &#123;login &amp;&amp; &lt;li&gt;&lt;a href="/</span>edit<span class="string">" onClick=&#123;toEdit&#125;&gt;写博客&lt;/a&gt;&lt;/li&gt;&#125;</span></span><br><span class="line"><span class="string">                    &#123;login ? &lt;li&gt;&lt;a href="</span>/login<span class="string">" onClick=&#123;logout&#125;&gt;退出登录&lt;/a&gt;&lt;/li&gt; : &lt;li&gt;&lt;a href="</span>/login<span class="string">" onClick=&#123;login_&#125;&gt;登录&lt;/a&gt;&lt;/li&gt;&#125;</span></span><br><span class="line"><span class="string">                &lt;/ul&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;div className=&#123;styles.desc&#125;&gt;</span></span><br><span class="line"><span class="string">                Coder</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default Header</span></span><br></pre></td></tr></table></figure>

<p>接下来就是数据的持久化，我们希望将数据能够保存到localStorage，这样当页面刷新，关闭页面、浏览器,关机数据都能够保存。修改Provider.jsx</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;useReducer&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Context = React.createContext();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> saveData = <span class="function">(<span class="params">datas</span>) =&gt;</span> &#123;</span><br><span class="line">    localStorage.setItem(<span class="string">"datas"</span>,<span class="built_in">JSON</span>.stringify(datas) || [])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> loadData = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 如果datas没有内容，则为空数组，因为后面用到datas.map，放止报错</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(localStorage.getItem(<span class="string">"datas"</span>)) || []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reducer = <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> tempDatas = state.datas</span><br><span class="line">    <span class="comment">// 每次对数据进行操作后都保存数据</span></span><br><span class="line">    <span class="keyword">switch</span>(action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'insertData'</span>:</span><br><span class="line">            tempDatas[tempDatas.length] = action.data;</span><br><span class="line">            saveData(tempDatas)</span><br><span class="line">            <span class="keyword">return</span> &#123;...state, <span class="attr">datas</span>: tempDatas&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'updateData'</span>:</span><br><span class="line">            tempDatas[action.id] = action.data</span><br><span class="line">            saveData(tempDatas)</span><br><span class="line">            <span class="keyword">return</span> &#123;...state, <span class="attr">datas</span>: tempDatas&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'deleteData'</span>:</span><br><span class="line">            tempDatas.splice(action.id, <span class="number">1</span>)</span><br><span class="line">            saveData(tempDatas)</span><br><span class="line">            <span class="keyword">return</span> &#123;...state, <span class="attr">datas</span>: tempDatas&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'changeOperation'</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;...state, <span class="attr">operation</span>: action.operation&#125;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initState = &#123;</span><br><span class="line">    <span class="comment">// 初始化从localStorage中读取数据</span></span><br><span class="line">    datas: loadData(),</span><br><span class="line">    operation: <span class="string">'ADD'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Provider</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [state, dispatch] = useReducer(reducer, initState)</span><br><span class="line">    <span class="keyword">const</span> &#123;children&#125; = props</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;Context.Provider value=&#123;&#123;state, dispatch&#125;&#125;&gt;</span><br><span class="line">            &#123;children&#125;</span><br><span class="line">        &lt;<span class="regexp">/Context.Provider&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Provider</span></span><br></pre></td></tr></table></figure>

<h1 id="登录权限控制"><a href="#登录权限控制" class="headerlink" title="登录权限控制"></a>登录权限控制</h1><p>如果用户没有登录的话，是没有权利访问某些页面的，比如编辑页面，它不能够添加文章，也不能够编辑文章(虽然我们在未登录的情况下没有暴露这样的途径，如Display页面未登录没有编辑文章的按钮，Header未登录没有写文章的连接，但是可以通过url直接访问)，所以我们要做一些权限控制。</p>
<p>所以在访问路由时，我们要做权限的检查，修改router.js中的RouteItem方法，不能直接的返回Route，而是要给Route加一层验证，以决定是否返回，如下</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Auth <span class="keyword">from</span> <span class="string">'./components/Auth'</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">const</span> RouteItem = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; path, <span class="attr">component</span>: Component, redirect, key, exact &#125; = props;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (redirect) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">from</span>=<span class="string">&#123;path&#125;</span> <span class="attr">to</span>=<span class="string">&#123;redirect&#125;</span> <span class="attr">key</span>=<span class="string">&#123;key&#125;</span> /&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;Route</span><br><span class="line">            key=&#123;key&#125;</span><br><span class="line">            exact=&#123;exact&#125;</span><br><span class="line">            path=&#123;path&#125;</span><br><span class="line">            render=&#123;componentProps =&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> (</span><br><span class="line">                    <span class="comment">// 对Component加以验证</span></span><br><span class="line">                    &lt;Auth history=&#123;history&#125;&gt;</span><br><span class="line">                        &lt;Component &#123;...componentProps&#125; /&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Auth&gt;</span></span><br><span class="line"><span class="regexp">                )</span></span><br><span class="line"><span class="regexp">            &#125;&#125;</span></span><br><span class="line"><span class="regexp">        /</span>&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>Auth组件正是用来做权限控制的，在src/components下新建Auth文件夹，并在其中新建index.jsx，如下</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Auth</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;children, history&#125; = props</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> login = sessionStorage.getItem(<span class="string">"login"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Edit页面不能直接访问 需要登录</span></span><br><span class="line">    <span class="keyword">if</span> (children.type.WrappedComponent.name !== <span class="string">"Edit"</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> children</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (login) &#123;</span><br><span class="line">            <span class="keyword">return</span> children</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        history.replace(<span class="string">"/login"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Auth</span><br></pre></td></tr></table></figure>

<p>验证的逻辑也是十分的简单，如果不是Edit组件，则可以访问直接返回，如果是，则进一步判断是否登录，如果登录，则可以访问，否则来到登录页面。</p>
<p>至此，整个项目的工作已经大致完成了，可能有的地方还需要美化，比如富文本编辑器的代码美化，或者将数据保存在后台服务器等等。这一路走来可能你会感到有点不轻松，那么恭喜你，你获得了进步，如果你十分的轻松，那么这个项目对你来说还是有点容易。不过不管怎么样，希望你能够完全靠自己做一遍，也许你跟着我一路走来十分的顺利，这是因为一些坑我给你跳过去了，说实话，在我第一次做时，遇到到许许多多的坑，有很多不明白的点，有的地方明明十分的简单，可是我能卡几个小时甚至一两天，虽然辛苦，但是收获十分的巨大。所以我希望你能够独立的完成，去遇到一些坑，然后去找解决办法，在这个过程你会收获巨大，索性你已经完成了这个项目，所以对于这个项目要做出什么样的效果以及功能已经有了把握，所以在做一遍会简单很多，总之，加油。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="https://zhuanlan.zhihu.com/p/24357770" target="_blank" rel="noopener">npm是干什么的?</a></li>
<li><a href="https://segmentfault.com/a/1190000016915868" target="_blank" rel="noopener">前端脚手架，听起来玄乎，实际呢?</a></li>
<li><a href="https://juejin.im/entry/5b1496656fb9a01e28621ef0" target="_blank" rel="noopener">虚拟DOM介绍</a></li>
<li><a href="http://huziketang.mangojuice.top/books/react/" target="_blank" rel="noopener">React.js 小书</a></li>
<li><a href="https://juejin.im/post/5d613dfcf265da03a53a41dc" target="_blank" rel="noopener">React中的事件处理</a></li>
<li><a href="https://www.jianshu.com/p/c6257cbef1b1" target="_blank" rel="noopener">深入理解React组件状态(State)</a></li>
<li><a href="https://juejin.im/entry/5ba3013fe51d453eb93d53e5" target="_blank" rel="noopener">重新认识生命周期函数</a></li>
<li><a href="https://segmentfault.com/a/1190000020353236" target="_blank" rel="noopener">React中类组件和函数式组件</a></li>
<li><a href="https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0#.kuvqndiqq" target="_blank" rel="noopener">Presentational and Container Components</a></li>
<li><a href="https://juejin.im/post/5a3087746fb9a0450c4963a5" target="_blank" rel="noopener">使用Render Props吧</a></li>
<li><a href="https://zh-hans.reactjs.org/docs/hooks-intro.html" target="_blank" rel="noopener">Hook</a></li>
<li><a href="https://braft.margox.cn/" target="_blank" rel="noopener">BraftEditor</a></li>
</ul>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">熊滔</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://lastknightcoder.gitee.io/%E4%BD%BF%E7%94%A8React%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%9F%BA%E4%BA%8E%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8%E7%9A%84%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/">https://lastknightcoder.gitee.io/%E4%BD%BF%E7%94%A8React%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%9F%BA%E4%BA%8E%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8%E7%9A%84%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://lastknightcoder.gitee.io" target="_blank">Coder</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="https://lastknightcoder.gitee.io/tags/React-antd-React-Hooks/">React antd React-Hooks</a></div><div class="post_share"><div class="social-share" data-image="https://gitee.com/lastknightcoder/blogimage/raw/master/img/20200530002017.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="https://lastknightcoder.gitee.io/img/wechatpay.png" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="https://lastknightcoder.gitee.io/img/alipay.png" alt="支付宝"/><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="https://lastknightcoder.gitee.io/MyBatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><img class="prev_cover" data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/bg58.jpg" onerror="onerror=null;src='https://lastknightcoder.gitee.io/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MyBatis学习笔记</div></div></a></div><div class="next-post pull_right"><a href="https://lastknightcoder.gitee.io/CSS3/"><img class="next_cover" data-src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/bg29.jpg" onerror="onerror=null;src='https://lastknightcoder.gitee.io/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">CSS3 新特性</div></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: 'be3279b05a3d99c8e41f',
  clientSecret: '5a2f84ce9033ebf48f72253dc06940844f8dfa13',
  repo: 'lastknightcoder.github.io',
  owner: 'LastKnightCoder',
  admin: ['LastKnightCoder'],
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN',
  perPage: 100,
  distractionFreeMode: false,
  pagerDirection: 'last',
  createIssueManually: false,
  updateCountCallback: commentCount
})
gitalk.render('gitalk-container')

function commentCount(n){
  try {
    document.getElementsByClassName('gitalk-comment-count')[0].innerHTML= n
  } catch (e) {
    return false
  }
}</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By 熊滔</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">简</a><i class="darkmode far fa-moon" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://lastknightcoder.gitee.io/js/utils.js"></script><script src="https://lastknightcoder.gitee.io/js/main.js"></script><script src="https://lastknightcoder.gitee.io/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://lastknightcoder.gitee.io/js/third-party/fireworks.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="ribbon_piao" mobile="false" src="https://lastknightcoder.gitee.io/js/third-party/piao.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js"></script><script>document.addEventListener('DOMContentLoaded', function() {
      pangu.spacingElementById('content-inner')
})</script><script src="https://lastknightcoder.gitee.io/js/search/local-search.js"></script><script>if (document.getElementsByClassName('mermaid').length) {
  loadScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js',function () {
    mermaid.initialize({
      theme: 'default',
  })
})
}</script><script>var endLoading = function () {
  document.body.style.overflow = 'auto';
  document.getElementById('loading-box').classList.add("loaded")
}
window.addEventListener('load',endLoading)</script></body></html>