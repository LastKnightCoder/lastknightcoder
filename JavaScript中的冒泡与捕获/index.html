<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="熊滔"><meta name="description" content="人生天地间，忽如远行客"><link rel="alternative" href="/atom.xml" title="Coder" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>JavaScript中的冒泡与捕获 - Coder</title>
<link rel="stylesheet" href="https://lastknightcoder.gitee.io/css/main.css">

<link rel="stylesheet" href="https://lastknightcoder.gitee.io/js/fancybox/jquery.fancybox.min.css">
<!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]-->
<script src="https://lastknightcoder.gitee.io/js/jquery-3.1.1.min.js"></script>

<script src="https://lastknightcoder.gitee.io/js/fancybox/jquery.fancybox.min.js"></script>
<meta name="generator" content="Hexo 4.2.0"></head><body style="opacity:0"><header class="head"><h1 class="head-title u-fl"><a href="https://lastknightcoder.gitee.io/">Coder</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="https://lastknightcoder.gitee.io/tags">标签</a></li><li class="head-nav__item"><a class="head-nav__link" href="https://lastknightcoder.gitee.io/archives">目录</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time class="post__time" datetime="2020-03-16T16:00:00.000Z">2020-03-17 00:00:00</time><h1 class="post__title"><a href="https://lastknightcoder.gitee.io/JavaScript%E4%B8%AD%E7%9A%84%E5%86%92%E6%B3%A1%E4%B8%8E%E6%8D%95%E8%8E%B7/">JavaScript中的冒泡与捕获</a></h1><div class="post__main echo"><h2 id="JavaScript中的冒泡与捕获"><a href="#JavaScript中的冒泡与捕获" class="headerlink" title="JavaScript中的冒泡与捕获"></a>JavaScript中的冒泡与捕获</h2><p>首先来看一个例子来明白什么是冒泡和捕获，来看下面的一个html结构</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.outer</span> &#123;</span></span><br><span class="line">            width: 200px;</span><br><span class="line">            height: 200px;</span><br><span class="line">            background-color: black;</span><br><span class="line">            margin: 100px auto;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.inner</span> &#123;</span></span><br><span class="line">            width: 100px;</span><br><span class="line">            height: 100px;</span><br><span class="line">            background-color: greenyellow;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"outer"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inner"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>就是一个大盒子里面套着一个小盒子，为两个盒子设置了背景颜色以作区分，如下</p>
<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/2020-03-17_150014.png"/>
</center>

<p>现在为二者都添加一个点击方法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">let</span> outer = <span class="built_in">document</span>.querySelector(<span class="string">'.outer'</span>);</span><br><span class="line">    <span class="keyword">let</span> inner = <span class="built_in">document</span>.querySelector(<span class="string">'.inner'</span>);</span><br><span class="line">    outer.addEventListener(<span class="string">'click'</span>, (e) =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'outer被点击了'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    inner.addEventListener(<span class="string">'click'</span>, (e) =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'inner被点击了'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<p>现在如果点击里面的盒子<code>inner</code>，那么<code>outer</code>的点击事件会不会触发，因为按道理也算是点击了<code>outer</code>的区域，所以<code>outer</code>的点击事件应该被触发。现在问题又来了，是先触发<code>inner</code>还是先触发<code>outer</code>的点击事件呢? 按照二者触发顺序的不同分为捕获和冒泡。</p>
<p>现在点击绿色的小盒子，看看输出是什么</p>
<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/2020-03-17-15-09.gif"/>
</center>

<p>当我们点击里面的盒子即 <code>inner</code> 时，触发了它的点击事件，随后触发了 <code>outer</code> 的点击事件，这样触发子元素事件之后触发父元素事件的行为就叫做冒泡；捕获就是随之相反了，先处理 <code>outer</code>，然后处理 <code>inner</code> 的事件。</p>
<p>要实现捕获的效果，首先我们为 <code>addEventListener</code> 方法的第三个参数设置为 <code>true</code>，如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">outer.addEventListener(<span class="string">'click'</span>, (e) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'outer被点击了'</span>);</span><br><span class="line">&#125;, <span class="literal">true</span>);</span><br><span class="line">inner.addEventListener(<span class="string">'click'</span>, (e) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'inner被点击了'</span>);</span><br><span class="line">&#125;, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<p>这时我们在点击里面的盒子</p>
<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/2020-03-17-15-17.gif"/>
</center>

<p>这时是<code>outer</code>的点击事件先被执行，然后是<code>inner</code>的点击事件被执行。</p>
<p>冒泡和捕获的出现是因为以前的两大浏览器厂商 <code>Netscape</code> 和 <code>Microsoft</code> 对事件模型处理方法，<code>Microsoft</code> 采取的从目标元素(比如点击 <code>inner</code>，<code>inner</code> 就是目标元素)开始，按 <code>DOM</code> 树向上冒泡；而 <code>Netscape</code> 采取的是相反的原则，即从顶部元素开始，直到事件目标元素。通过上面的例子可以知道，可以通过设置 <code>addEventListener</code> 方法的第三个参数可以设置是冒泡还是捕获，当设置为 <code>true</code> 时，是捕获，当设置为 <code>false</code> 时，是冒泡，默认是 <code>false</code>。</p>
<p>现在考虑一个比较复杂的 <code>DOM</code> 结构，如下</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.one</span> &#123;</span></span><br><span class="line">            width: 200px;</span><br><span class="line">            height: 200px;</span><br><span class="line">            background-color: black;</span><br><span class="line">            margin: 100px auto;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-class">.two</span> &#123;</span></span><br><span class="line">            width: 150px;</span><br><span class="line">            height: 150px;</span><br><span class="line">            background-color: aliceblue;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-class">.three</span> &#123;</span></span><br><span class="line">            width: 100px;</span><br><span class="line">            height: 100px;</span><br><span class="line">            background-color: greenyellow;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-class">.four</span> &#123;</span></span><br><span class="line">            width: 50px;</span><br><span class="line">            height: 50px;</span><br><span class="line">            background-color: blueviolet;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"one"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"two"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"three"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"four"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> one = <span class="built_in">document</span>.querySelector(<span class="string">'.one'</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> two = <span class="built_in">document</span>.querySelector(<span class="string">'.two'</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> three = <span class="built_in">document</span>.querySelector(<span class="string">'.three'</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> four = <span class="built_in">document</span>.querySelector(<span class="string">'.four'</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        one.addEventListener(<span class="string">'click'</span>, (e) =&gt; &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'one被点击了'</span>);</span></span><br><span class="line"><span class="actionscript">        &#125;, <span class="literal">true</span>);</span></span><br><span class="line"><span class="actionscript">        two.addEventListener(<span class="string">'click'</span>, (e) =&gt; &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'two被点击了'</span>);</span></span><br><span class="line"><span class="actionscript">        &#125;, <span class="literal">false</span>);</span></span><br><span class="line"><span class="actionscript">        three.addEventListener(<span class="string">'click'</span>, (e) =&gt; &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'three被点击了'</span>);</span></span><br><span class="line"><span class="actionscript">        &#125;, <span class="literal">true</span>);</span></span><br><span class="line"><span class="actionscript">        four.addEventListener(<span class="string">'click'</span>, (e) =&gt; &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'four被点击了'</span>);</span></span><br><span class="line"><span class="actionscript">        &#125;, <span class="literal">false</span>);</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面四个盒子套在一起，我们为<code>one</code>和<code>three</code>设定为捕获模式，为<code>two</code>和<code>four</code>设定为冒泡模式，如果我们点击<code>four</code>，这时的输出会是什么呢?</p>
<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/2020-03-17-15-50.gif"/>
</center>

<p>我们观察到输出的顺序为<code>one -&gt; three -&gt; four -&gt; two</code>，代码是怎么执行的呢? 首先事件处理器会从顶部开始即 <code>one</code>(严格的说是从 <code>window</code>)，一直到目标元素，在这个路径中，如果遇到设置为捕获模式的则执行，碰到冒泡模式的则跳过，达到目标元素后，开始转换为冒泡模式，向上冒泡到<code>one</code>，在这个路径中，如果碰到设置为冒泡模式的则执行，否则跳过。</p>
<p>现在我们来看看上面的执行流程：</p>
<ul>
<li>首先从<code>one</code>开始向下捕获，<code>one</code>设置为捕获模式，执行</li>
<li>遇到<code>two</code>，<code>two</code>设置为冒泡模式，不执行跳过</li>
<li>遇到<code>three</code>，<code>three</code>设置为捕获模式，执行</li>
<li>遇到<code>four</code>，到达目标元素，执行(此时不管four是冒泡还是捕获都没有关系，都会执行的)</li>
<li>接着转变为冒泡模式，遇到<code>three</code>，<code>three</code>为捕获模式，跳过</li>
<li>遇到<code>two</code>，<code>two</code>为冒泡模式，执行</li>
<li>遇到<code>one</code>，<code>one</code>为捕获模式，不执行，此时已经到达顶部，结束</li>
</ul>
<p>通过上面的流程，不难知道输出的顺序为什么是<code>one -&gt; three -&gt; four -&gt; two</code>。</p>
<h2 id="在父元素上代理事件"><a href="#在父元素上代理事件" class="headerlink" title="在父元素上代理事件"></a>在父元素上代理事件</h2><p>我们来看一个运用冒泡的小例子，假设有这个一个DOM结构</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">    &lt;li&gt;元素&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">    &lt;li&gt;元素&lt;/</span>li&gt;</span><br><span class="line">    &lt;li&gt;元素&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">    &lt;li&gt;元素&lt;/</span>li&gt;</span><br><span class="line">    &lt;li&gt;元素&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">    &lt;li&gt;元素&lt;/</span>li&gt;</span><br><span class="line">    &lt;li&gt;元素&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">    &lt;li&gt;元素&lt;/</span>li&gt;</span><br><span class="line">    &lt;li&gt;元素&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">    &lt;li&gt;元素&lt;/</span>li&gt;</span><br><span class="line">&lt;<span class="regexp">/ul&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们希望当点击 <code>li</code> 标签时，将 <code>li</code> 标签里面的文字变为红色，所以很有可能你会写出这样的代码</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.querySelectorAll(<span class="string">"ul li"</span>).forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    item.addEventListener(<span class="string">'click'</span>, (e) =&gt; &#123;</span><br><span class="line">        e.target.style.color = <span class="string">'red'</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这样写当然能达到效果，但是如果 <code>ul</code> 下面有成千上万个 <code>li</code>，这样写未免性能太低，我们可以利用冒泡的特性，为 <code>ul</code> 绑定点击事件，如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">'ul'</span>).addEventListener(<span class="string">'click'</span>, (e) =&gt; &#123;</span><br><span class="line">    e.target.style.color = <span class="string">'red'</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这样不管 <code>ul</code> 下面有多少个 <code>li</code> 都没有关系。</p>
<blockquote>
<p>解释：</p>
<p>这里可能有人不太懂 <code>e.target</code> 是什么，<code>e.target</code> 是指触发点击事件的元素，而不是 <code>ul</code>，因为我们点击的是 <code>li</code> 标签，所以这里的 <code>e.target</code> 是被点击的 <code>li</code> 元素。如果想在 <code>addEventListener</code> 里面访问 <code>ul</code> 元素，可以使用 <code>this</code>。</p>
</blockquote>
<h2 id="阻止事件冒泡"><a href="#阻止事件冒泡" class="headerlink" title="阻止事件冒泡"></a>阻止事件冒泡</h2><p>有的时候我们不希望事件有冒泡操作，我们可以通过 <code>event</code> 对象的 <code>stopPropagation</code> 方法来阻止事件冒泡，以文章开头的 <code>inner</code> 和 <code>outer</code> 为例(<code>outer</code> 和 <code>inner</code> 都设置为冒泡模式)，我们给 <code>inner</code> 的 <code>addEventListener</code> 修改为</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">inner.addEventListener(<span class="string">'click'</span>, (e) =&gt; &#123;</span><br><span class="line">    e.stopPropagation();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'inner被点击了'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这时我们点击<code>inner</code>，这时只有<code>inner</code>的点击事件被执行了</p>
<center>
    <img src="https://gitee.com/lastknightcoder/blogimage/raw/master/img/2020-03-17-16-22.gif"/>
</center>

</div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="https://lastknightcoder.gitee.io/tags/JavaScript-%E5%86%92%E6%B3%A1%E4%B8%8E%E6%8D%95%E8%8E%B7/">JavaScript 冒泡与捕获</a></li></ul></footer></article><section class="reward"><a class="btn-reward" href="#">打赏</a><div class="reward-wrapper clearfix"><img src="https://lastknightcoder.gitee.io/img/wechatpay.png" title="微信"><img src="https://lastknightcoder.gitee.io/img/alipay.png" title="支付宝"></div></section></main><footer class="foot"><div class="foot-copy">&copy; 2019 - 2020 熊滔</div></footer>
<script src="https://lastknightcoder.gitee.io/js/scroller.js"></script>

<script src="https://lastknightcoder.gitee.io/js/main.js"></script>
</body></html>