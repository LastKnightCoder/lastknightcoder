<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>Node.js 之模块系统 | Coder</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="模块,npm,循环引用">
    <meta name="description" content="Node.js 提出的背景背景Node.js 于 2009 年由 Ryan Dahl 提出，它提出 Node.js 是为了解决当时的并发连接问题。以往的编程语言对于请求的处理方式是，来一个请求就新建一个线程来处理这个请求，假设一个线程需要消耗 2MB 的内存资源，那么对于一个 8GB 的内存系统，它最多同时处理 4000 个请求。如果需要处理更多的请求的话，就需要增加更多的服务器，另外由于用户的每">
<meta property="og:type" content="article">
<meta property="og:title" content="Node.js 之模块系统">
<meta property="og:url" content="https://lastknightcoder.github.io/lastknightcoder/Node.js%20%E4%B9%8B%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F/">
<meta property="og:site_name" content="Coder">
<meta property="og:description" content="Node.js 提出的背景背景Node.js 于 2009 年由 Ryan Dahl 提出，它提出 Node.js 是为了解决当时的并发连接问题。以往的编程语言对于请求的处理方式是，来一个请求就新建一个线程来处理这个请求，假设一个线程需要消耗 2MB 的内存资源，那么对于一个 8GB 的内存系统，它最多同时处理 4000 个请求。如果需要处理更多的请求的话，就需要增加更多的服务器，另外由于用户的每">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://user-images.githubusercontent.com/29890094/106893281-493cb480-6728-11eb-9746-bf2438cce57c.gif">
<meta property="og:image" content="https://user-images.githubusercontent.com/29890094/106990677-ad568b80-67af-11eb-94e6-df5030160cf1.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/29890094/107120136-cc940c80-68c6-11eb-8b0a-94c0a634df9d.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/29890094/107135256-0b13e080-6934-11eb-9f41-ae7d18ce6097.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/29890094/107135518-63e47880-6936-11eb-9957-5923a11da34f.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/29890094/107135564-c0479800-6936-11eb-9d37-1423a1cb00de.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/29890094/107135659-83c86c00-6937-11eb-8939-a678f976a99d.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/29890094/107135698-cc802500-6937-11eb-8bf4-1d12be1a1365.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/29890094/107135951-fcc8c300-6939-11eb-8bdf-a6d7c6311d43.png">
<meta property="article:published_time" content="2021-02-08T10:17:00.000Z">
<meta property="article:modified_time" content="2021-02-08T10:17:00.000Z">
<meta property="article:author" content="熊滔">
<meta property="article:tag" content="模块">
<meta property="article:tag" content="npm">
<meta property="article:tag" content="循环引用">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://user-images.githubusercontent.com/29890094/106893281-493cb480-6728-11eb-9746-bf2438cce57c.gif">
    
        <link rel="alternate" type="application/atom+xml" title="Coder" href="https://lastknightcoder.github.io/lastknightcoder/atom.xml">
    
    <link rel="shortcut icon" href="https://lastknightcoder.github.io/lastknightcoder/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(https://lastknightcoder.github.io/lastknightcoder/img/brand.jpg)">
      <div class="brand">
        <a href="https://lastknightcoder.github.io/lastknightcoder/" class="avatar waves-effect waves-circle waves-light">
          <img src="https://lastknightcoder.github.io/lastknightcoder/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">熊滔</h5>
          <a href="mailto:2223106858@qq.com" title="2223106858@qq.com" class="mail">2223106858@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="https://lastknightcoder.github.io/lastknightcoder/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://lastknightcoder.github.io/lastknightcoder/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://lastknightcoder.github.io/lastknightcoder/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://lastknightcoder.github.io/lastknightcoder/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://gitee.com/LastKnightCoder" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Node.js 之模块系统</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Node.js 之模块系统</h1>
        <h5 class="subtitle">
            
                <time datetime="2021-02-08T10:17:00.000Z" itemprop="datePublished" class="page-time">
  2021-02-08
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="https://lastknightcoder.github.io/lastknightcoder/categories/Node/">Node</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Node-js-提出的背景"><span class="post-toc-number">1.</span> <span class="post-toc-text">Node.js 提出的背景</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#背景"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">背景</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#应用"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">应用</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#模块"><span class="post-toc-number">2.</span> <span class="post-toc-text">模块</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#概念"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">概念</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#导出"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">导出</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#导入"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">导入</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#npm"><span class="post-toc-number">3.</span> <span class="post-toc-text">npm</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#npm-init"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">npm init</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#npm-install"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">npm install</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#全局安装"><span class="post-toc-number">3.2.1.</span> <span class="post-toc-text">全局安装</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#本地安装"><span class="post-toc-number">3.2.2.</span> <span class="post-toc-text">本地安装</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#npm-scripts"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">npm  scripts</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#深入模块"><span class="post-toc-number">4.</span> <span class="post-toc-text">深入模块</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#导入路径"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">导入路径</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#缓存"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">缓存</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#主程序"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">主程序</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#循环引用"><span class="post-toc-number">4.4.</span> <span class="post-toc-text">循环引用</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#参考链接"><span class="post-toc-number">5.</span> <span class="post-toc-text">参考链接</span></a></li></ol>
        </nav>
    </aside>


<article id="post-Node.js 之模块系统"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Node.js 之模块系统</h1>
        <div class="post-meta">
            <time class="post-time" title="2021-02-08 18:17:00" datetime="2021-02-08T10:17:00.000Z"  itemprop="datePublished">2021-02-08</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="https://lastknightcoder.github.io/lastknightcoder/categories/Node/">Node</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h2 id="Node-js-提出的背景"><a href="#Node-js-提出的背景" class="headerlink" title="Node.js 提出的背景"></a>Node.js 提出的背景</h2><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>Node.js 于 2009 年由 Ryan Dahl 提出，它提出 Node.js 是为了解决当时的并发连接问题。以往的编程语言对于请求的处理方式是，来一个请求就新建一个线程来处理这个请求，假设一个线程需要消耗 2MB 的内存资源，那么对于一个 8GB 的内存系统，它最多同时处理 4000 个请求。如果需要处理更多的请求的话，就需要增加更多的服务器，另外由于用户的每个请求可能访问不同的服务器，所以所有的资源都需要在服务器之间共享。这种 Web 架构下瓶颈就在于服务器能够处理的并发连接的最大数量。</p>
<p>Node.js 提出另一种方法来解决这种问题，那就是事件绑定。每次来到一个请求，并不是为该请求新建一个线程，而是为该请求绑定一个事件，并且添加到<strong>事件队列</strong>，而最终达到的效果是，使用 Node.js 的服务器能够同时处理数万个并发连接。</p>
<p>如果将服务器比作是一个饭店，而一个请求就是一个客人。对于使用多线程的方式的服务器，来一个客人就派一个服务生去服务客人，直至客人离开。而 Node.js 则是只有一位服务员，这位服务员不会从头到尾都服务客人，每来一个客人，在了解完客人的需求后，并记录下来，就请客人去座位上等待，会有专门的人员去处理记录的需求。</p>
<p>所以 Node.js 也有其适应的场景，它适合于 IO 密集型的任务，而不适合 CPU 密集型的任务。所谓的 IO 密集型任务指的就是像上面所提及的大量的并发请求，而 CPU 密集型任务指的是需要做复杂耗时长的计算的任务。</p>
<h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><p>Node.js 自 2009 年提出发展至今已有十余年的时间，虽然 Node.js 当初的想法是为了解决大并发的问题，但是随着十几年的发展，Node.js 也催生出了其他的应用：</p>
<ul>
<li>Web 服务器：自 Node.js 诞生，提出了很多得 Web 框架，我们可以使用它方便的写出 Web 程序<ul>
<li>Express</li>
<li>Koa2</li>
<li>Egg</li>
</ul>
</li>
<li>前端工程化：Node.js 的提出，使得前端也产生一次质的飞跃，使用 Node.js 编写的前端工具使得开发前端项目变得简单<ul>
<li>Babel</li>
<li>Webpack</li>
<li>Eslint</li>
<li>Jest</li>
</ul>
</li>
<li>桌面项目：Node.js 提供了具有访问操作系统 API 的能力，使得使用 Node.js 也可以开发出桌面项目<ul>
<li>Electron</li>
</ul>
</li>
<li>脚手架工具：使用 Node.js 编写的脚手架工具，让我们可以很快的开始一个前端项目<ul>
<li>creat-react-app</li>
<li>vue-cli</li>
</ul>
</li>
<li>服务端渲染：<ul>
<li>next.js</li>
<li>nuxt.js</li>
</ul>
</li>
<li>Serverless</li>
<li>…</li>
</ul>
<h2 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>现在的程序越来越复杂，已经不可能将所有的程序写在一个文件里面了，一个是难以阅读，二个是不利于多人协作，所以有必要将代码分割在不同的部分，这些部分就叫做模块。</p>
<p>将代码分割为不同的模块以后，可以有如下好处：</p>
<ul>
<li>不同的模块负责不同的功能，使得代码阅读起来更加清晰，并且维护起来也会比较简单</li>
<li>不同的模块有各自的作用域，可以避免全局变量发生冲突</li>
<li>利于多人协作，每个人开发属于自己的模块，最后组合为一个大的程序</li>
<li>代码复用，可以将一些与业务无关的工具函数抽离出来，在别的项目中进行复用</li>
</ul>
<p>将代码进行分割以后，还需要将代码组合起来，让它们协作得以工作。</p>
<p>要使得模块能够互相协作，就需要模块能够暴露给其他模块访问该模块内部的一些变量，将这些变量暴露给其他函数的行为就是导出；而导入与导出相对，将其他模块暴露出的变量引入到本模块，使得本模块能够访问其他模块暴露出的变量，这个行为就是导入。</p>
<h3 id="导出"><a href="#导出" class="headerlink" title="导出"></a>导出</h3><p>在 Node.js 中，一个 .js 文件就是一个模块，在每个模块中，都有一个 <code>module</code> 对象，<code>module</code> 对象有一个 <code>exports</code> 属性，该属性会被作为该模块的导出内容</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// alice.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    name: <span class="string">"Alice"</span>,</span><br><span class="line">    age: <span class="number">18</span>,</span><br><span class="line">    gender: <span class="string">"female"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>例如在上面，我们设置 <code>module.exports</code> 为一个对象，这个对象就是对外暴露的内容，可以在其他模块中导入这个对象并使用。</p>
<p>在每一个模块中，还有一个名为 <code>exports</code> 的变量，它是 <code>module.exports</code> 的引用，你可以看做在每个模块的开头都有这么一行代码</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> exports = <span class="built_in">module</span>.exports;</span><br></pre></td></tr></table></figure>

<p>它的提出是为了简写方便</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bob.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">"Bob"</span>;</span><br><span class="line"><span class="keyword">const</span> age = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">const</span> gender = <span class="string">"male"</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports.name = name;</span><br><span class="line"><span class="built_in">module</span>.exports.age = age;</span><br><span class="line"><span class="built_in">module</span>.exports.gender = gender;</span><br></pre></td></tr></table></figure>

<p>上面我们通过为 <code>module.exports</code> 的属性赋值，从而将本模块内的几个变量暴露出来给其他模块访问，上面的 <code>module.exports</code> 通通可以替换为 <code>exports</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bob.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">"Bob"</span>;</span><br><span class="line"><span class="keyword">const</span> age = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">const</span> gender = <span class="string">"male"</span>;</span><br><span class="line"></span><br><span class="line">exports.name = name;</span><br><span class="line">exports.age = age;</span><br><span class="line">exports.gender = gender;</span><br></pre></td></tr></table></figure>

<p>但是经常有新手有如下错误的写法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bob.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">"Bob"</span>;</span><br><span class="line"><span class="keyword">const</span> age = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">const</span> gender = <span class="string">"male"</span>;</span><br><span class="line"></span><br><span class="line">exports = &#123;</span><br><span class="line">    name: name,</span><br><span class="line">    age: age,</span><br><span class="line">    gender: gender</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面通过给 <code>exports</code> 变量赋值为一个对象，希望将本模块的一些变量导出，但是在其他模块中导入该模块时，发现导入的只是一个空对象，这往往让新手百思不得其解，其实稍加分析就可以知道为什么。</p>
<p>要明白上面的写法为什么是错误的，我先再次强调，<strong>模块导出的是 <code>module.exports</code> 这个变量</strong>，而 <code>exports</code> 只是一个引用，指向 <code>module.exports</code>。所以当我们通过 <code>exports.xxx</code> 的方式添加属性时，也就是相当于为 <code>module.exports</code> 这个对象添加属性，所以被添加的属性可以被导出；但是当我们为 <code>exports</code> 赋予一个新的值的时候，<code>exports</code> 不在是 <code>module.exports</code> 的引用，并且 <code>module.exports</code> 并不会发生任何的改变，导出的内容也不会如预期那般。</p>
<img src="https://user-images.githubusercontent.com/29890094/106893281-493cb480-6728-11eb-9746-bf2438cce57c.gif" style="zoom: 25%;" />

<p>如果想直接导出一个对象，请直接使用 <code>module.exports</code>，或者通过 <code>exports.xxx</code> 的方式一个个的添加属性。</p>
<blockquote>
<p>如果实在搞不懂 <code>exports</code>，那么请忘了它，影响不大。</p>
</blockquote>
<h3 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h3><p>我们使用 require 这个函数来导入其他模块暴露出来的变量</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> alice = <span class="built_in">require</span>(<span class="string">'./alice.js'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(alice.name); <span class="comment">// Alice</span></span><br></pre></td></tr></table></figure>

<p>上面我们通过 require 导入了 alice.js 这个模块，其实导入的内容就是 alice.js 中的 module.exports，我们使用变量 alice 进行接收。如果我们并不需要导入模块的所有内容，只是需要其中的某个属性，例如上面我们只是需要 name 这个属性，我们可以使使用 ES6 的解构语法获得需要的属性</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; name &#125; = <span class="built_in">require</span>(<span class="string">'./alice.js'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(name); <span class="comment">// Alice</span></span><br></pre></td></tr></table></figure>

<p>当我们导入一个模块的时候，首先会先执行这个模块</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"a.js"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//b.js</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'./a'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"b.js"</span>);</span><br></pre></td></tr></table></figure>

<p>输出为</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">a.js</span><br><span class="line">b.js</span><br></pre></td></tr></table></figure>

<p>注意到，我们可以省略后缀名，当我们省略后缀名时，它将根据下面的顺序查找文件</p>
<ol>
<li>是否有 a.js 文件，是否有 a.json 文件，是否有 a.node 文件</li>
<li>是否有一个名字为 a 的文件夹，下面有一个 package.json 文件并且有 main 字段，如果有则根据 main 字段指明的路径去加载文件</li>
<li>是否有一个名字为 a 的文件夹，下面有一个 index.js</li>
</ol>
<p>如果按照以上顺序都没有找到文件，那么会抛出一个错误。</p>
<h2 id="npm"><a href="#npm" class="headerlink" title="npm"></a>npm</h2><p>我们在手机上下载软件时，一般都是从应用商店下载软件，不会去某个软件的官网去下载，大家都把软件放在应用商店中，大家只要去商店里面下载即可了。同样，当我们需要用到其他人编写的第三方模块时，我们也希望有一个商店让我们去下载，我们不要去每个官网一个个的下载。</p>
<p>并且程序比软件下载更加的复杂，体现在包的依赖关系。本着不造轮子的原则，很多的程序都是直接使用别人已经写好的代码，所以代码之间可以说有非常复杂的依赖关系。我们可能需要一个 a 包帮我们做事情，但是 a 包又依赖于 b 这个包，b 包又依赖于 c 包，等等。所以为了使得我们的 a 包能够工作，我们还需要下载好 b 包、c 包等等这些被依赖的包。这就会带来问题，例如我们不知道 a 包依赖于什么包，以及即使我们知道 a 包依赖于这些包，一个个的下载这些包是否是一件极其无聊的工作。</p>
<p>基于以上几点，我们迫切需要一个包管理工具帮助我们。在 Node 中，Node Package Manager (npm) 正是用来做到这一点的，我们不仅可以通过它下载需要的包，并且它还会根据包的依赖关系，自动的帮我们下载好其他被依赖的包。</p>
<p>那么包是什么? 比较正式的定义：<strong>包是一个由 <code>package.json</code> 定义的文件或目录</strong>。假设有一天，你写了一个有用的工具，希望分享给大家，这个程序肯定不只是一个文件的代码，是多个模块的组合，即你分享的不是一个文件，而是一个文件夹，其中包括了这些模块。</p>
<p>那么 <code>package.json</code> 又是什么呢? 你可以把它看做是一个配置文件，其中记录了该工具的信息，例如版本，名称，作者等等内容，最重要的是，它记录了你写的工具依赖了哪些其他的第三方模块，这样当别人下载你的包时会根据 <code>package.json</code> 标注的依赖下载所依赖的包。</p>
<p>那么在 Node.js 中可以直接引入一个文件夹吗? 答案是可以的，Node.js 中的模块可以是如下三种：</p>
<ul>
<li>一个文件(.js, .json, .node)</li>
<li>一个包含 <code>package.json</code> 文件并且定义了 <code>main</code> 字段的文件夹</li>
<li>一个包含 <code>index.js</code> 的文件夹</li>
</ul>
<p>所以，我们可以直接使用 require 导入一个包，它会根据 main 字段指明的地址去加载 .js 文件。</p>
<h3 id="npm-init"><a href="#npm-init" class="headerlink" title="npm init"></a>npm init</h3><p>下载介绍 <code>npm</code> 在命令行中的使用，当我们下载好了 Node.js，一般都是会自动安装好 <code>npm</code> 的，我们可以在命令行通过 <code>npm --version</code> 查看 <code>npm</code> 的版本号</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">λ npm --version</span><br><span class="line">6.14.8</span><br></pre></td></tr></table></figure>



<p>我们写一个项目，就肯定需要准备一个 <code>package.json</code> 文件，你可以手动创建该文件，或者通过 <code>npm init</code> 命令创建一个模板，一般情况下我们都会使用 <code>npm init</code> 来创建一个 <code>package.json</code> 文件</p>
<img src="https://user-images.githubusercontent.com/29890094/106990677-ad568b80-67af-11eb-94e6-df5030160cf1.png" style="zoom:50%;" />

<p>在我们输入 <code>npm init</code> 后，它会引导我们创建一个 <code>package.json</code> 文件，填写一些常见的信息，例如包名、版本、作者等等，当这些都执行完毕后，在目录下回出现一个 <code>package.json</code> 文件，其内容如下</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"demo"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">"Node Demo"</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">"XT"</span>,</span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"MIT"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这些内容都是我们在命令行中填写的内容。如果希望快速创建一个 <code>package.json</code> 文件，所以配置项采用默认配置，我们可以使用 <code>npm init -y</code>，传入 <code>-y</code> 表示所有的配置项采用默认配置。</p>
<h3 id="npm-install"><a href="#npm-install" class="headerlink" title="npm install"></a>npm install</h3><p>使用 <code>npm install</code> 可以下载包，下载的包分为三种：</p>
<ul>
<li>全局安装</li>
<li>本地安装<ul>
<li>本地依赖</li>
<li>开发依赖</li>
</ul>
</li>
</ul>
<p>不同依赖的包在下载时需要传入不同的参数。</p>
<h4 id="全局安装"><a href="#全局安装" class="headerlink" title="全局安装"></a>全局安装</h4><p>全局安装的包可以在命令行直接执行，对于需要全局依赖的包，我们要传入 <code>--global</code> 参数或者 <code>-g</code> 参数，例如我们下载一个 <code>nrm</code> 的包，这个包是用来设置镜像源的，因为 <code>npm</code> 的服务器在国外，下载速度很慢，所以我们需要设置 <code>npm</code> 下载的镜像源</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install -g nrm</span><br></pre></td></tr></table></figure>

<img src="https://user-images.githubusercontent.com/29890094/107120136-cc940c80-68c6-11eb-8b0a-94c0a634df9d.png" style="zoom:50%;" />

<p>它会将这个包下载到 <code>C:\Users\username\AppData\Roaming\npm\node_modules</code> 这个文件夹下面，并且会在 <code>C:\Users\username\AppData\Roaming\npm\</code> 生成对应的 .cmd 文件，例如当我们全局安装 nrm 之后就会在 npm 文件夹下生成 nrm.cmd 文件</p>
<img src="https://user-images.githubusercontent.com/29890094/107135256-0b13e080-6934-11eb-9f41-ae7d18ce6097.png" style="zoom:50%;" />

<p>因为 <code>C:\Users\username\AppData\Roaming\npm\</code> 这个文件夹在安装 <code>npm</code> 的时候就会被自动的添加到环境变量中，当我们在命令行输入 <code>nrm</code> 的时候，它就会在这个路径搜索 <code>nrm</code> 命令，然后执行，这就是全局安装的包能够在命令行直接执行的原因。</p>
<p>我们在命令行输入</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nrm ls</span><br></pre></td></tr></table></figure>

<p>它会显示出有哪些可用的镜像源</p>
<img src="https://user-images.githubusercontent.com/29890094/107135518-63e47880-6936-11eb-9957-5923a11da34f.png" style="zoom:50%;" />

<p>我们一般选择 taobao 或者 cnpm 镜像源，通过 <code>nrm use 镜像源 </code>的方式选择镜像源</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nrm use taobao</span><br></pre></td></tr></table></figure>

<img src="https://user-images.githubusercontent.com/29890094/107135564-c0479800-6936-11eb-9d37-1423a1cb00de.png" style="zoom:50%;" />

<blockquote>
<p>这里讲述我遇到的一个坑，我之前是下载好 <code>nrm</code> 的，为了演示我把之前下载好的 <code>nrm</code> 卸载掉，然后重新装了一遍，装了一遍之后发现 <code>nrm</code> 不好使了，开始报错</p>
<img src="https://user-images.githubusercontent.com/29890094/107135659-83c86c00-6937-11eb-8939-a678f976a99d.png" style="zoom:50%;" />

<p>咱也不知道为啥，错误提示也看不懂，就去上网搜，说要改变 cli.js(<code>C:\Users\username\AppData\Roaming\npm\node_modules\nrm\cli.js</code>) 的第 17 行</p>
<img src="https://user-images.githubusercontent.com/29890094/107135698-cc802500-6937-11eb-8bf4-1d12be1a1365.png" style="zoom:50%;" />

<p>上面的一行是原来第 17 行的内容，后面一行是修改后的内容，贴在下面</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> NRMRC = path.join(process.env[(process.platform == <span class="string">'win32'</span>) ? <span class="string">'USERPROFILE'</span> : <span class="string">'HOME'</span>], <span class="string">'.nrmrc'</span>);</span><br></pre></td></tr></table></figure>

<p>如果你也遇到了这个问题，按照上面的方法改吧，亲测有效。</p>
</blockquote>
<h4 id="本地安装"><a href="#本地安装" class="headerlink" title="本地安装"></a>本地安装</h4><p>通过上面的分类我们可以看到，本地安装也分为两类，一种是开发依赖，意思就是仅仅在开发的时候才依赖的包，上线之后这个包就不需要了。例如压缩文件，这个包在编译的时候需要，但是在生产环境下，我们就使用这个压缩好的文件，就不需要压缩文件了，所以这个压缩文件的包只在开发(编译)时需要。另一种本地依赖的包是只在本地开发时以及上线后都需要依赖的包，比如在程序中依赖的一些库。</p>
<p>当我们下载开发时依赖的包时，需要传入 <code>--save-dev</code> 或者 <code>-D</code> 参数，当我们下载本地依赖的包时，传入 <code>--save</code> 或者 <code>-S</code> 参数，也可以不传，不传的情况下默认是本地依赖。</p>
<p>我们随便下载两个包</p>
<img src="https://user-images.githubusercontent.com/29890094/107135951-fcc8c300-6939-11eb-8bdf-a6d7c6311d43.png" style="zoom:50%;" />

<p>我们再查看 <code>package.json</code> 文件</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"demo"</span>,</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="string">"description"</span>: <span class="string">"Node Demo"</span>,</span><br><span class="line">  <span class="string">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"author"</span>: <span class="string">"XT"</span>,</span><br><span class="line">  <span class="string">"license"</span>: <span class="string">"MIT"</span>,</span><br><span class="line">  <span class="string">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"webpack"</span>: <span class="string">"^5.21.1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"ora"</span>: <span class="string">"^5.3.0"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发现多了 <code>dependencies</code> 以及 <code>devDependencies</code> 两个属性，<code>dependencies</code> 中的属性是本地依赖的包，以及对于的版本号，而 <code>devDependencies</code> 中的属性是开发时依赖的包，以及对应的版本号。</p>
<blockquote>
<p>细心的话，还会发现多了一个 <code>package-lock.json</code> 文件，里面不仅给定了当前项目的依赖，例如上面安装的 webpack 以及 ora，还给定了依赖的依赖以及它们的版本号，就是 webpack 以及 ora 它们所依赖的包。</p>
<p>所以为什么需要 <code>package-lock.json</code> 文件? 要明白为什么需要这个文件，就需要明白它的作用是什么。它的作用是为了锁定版本号的，例如上面我们安装 webpack 对于的版本号为 <code>^5.21.1</code>，其中 <code>^</code> 表示向后兼容，所以如果没有 <code>package-lock.json</code>，实际安装的版本号可能是最新的版本，比 <code>5.21.1</code> 的版本要高，这就可能会因为版本的不一致导致各种问题(我遇到过很多次)，所以需要一个 <code>package-lock.json</code> 来记录具体的版本号。</p>
</blockquote>
<p>这时我们甚至可以将 node_modules 这个文件夹给删掉，然后运行 <code>npm install</code> 即可将所依赖的包给安装回来，所以很多时候我们从 Github 上下载项目时，会发现没有 node_modules 文件夹，它要你在本地先运行 <code>npm install</code> 命令，将 <code>package.json</code> 中描述所依赖的包下载下来，然后在启动项目。</p>
<blockquote>
<p><code>npm install</code> 是根据 <code>package.json</code> 文件还是 <code>package-lock.json</code> 文件进行安装包的呢? 这个问题你在网上搜可能会得到不同的结论，这是因为安装策略有过三次调整：</p>
<ol>
<li><p>npm 5.0.x 版本，<code>npm install</code> 根据 <code>package-lock.json</code> 文件下载</p>
<ul>
<li>然后被控诉为什么改了 <code>package.json</code> 文件，为啥不给我升级包</li>
</ul>
</li>
<li><p>npm 5.1.0 版本后，忽略 <code>package-lock.json</code> 文件，只根据 <code>package.json</code> 文件下载</p>
<ul>
<li>那 <code>package-lock.json</code> 文件有什么用</li>
</ul>
</li>
<li><p>npm 5.4.2 版本后</p>
<ul>
<li><p>如果 <code>package-lock.json</code> 与 <code>package.json</code> 描述的版本号不同(为什么会不同，因为手动改了 <code>package.json</code> 文件)，那么根据 <code>package.json</code> 版本进行下载，并且更新 <code>package-lock.json</code> 文件</p>
</li>
<li><p>如果相同，那么根据 <code>package-lock.json</code> 进行下载，不必理会 <code>package.json</code> 中依赖的包是否有更新</p>
</li>
</ul>
</li>
</ol>
</blockquote>
<p>与 <code>npm install</code> 相对的是 <code>npm uninstall</code> 命令，是用来卸载包的，例如</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm uninstall webpack --save</span><br></pre></td></tr></table></figure>

<h3 id="npm-scripts"><a href="#npm-scripts" class="headerlink" title="npm  scripts"></a>npm  scripts</h3><p>在 package.json 中有一个 scripts 字段，它是一个对象，它的每一个属性都对应一个脚本</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"build"</span>: <span class="string">"node build.js"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当我们在当前项目的下输入</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>

<p>就相当于运行了</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">node build.js</span><br></pre></td></tr></table></figure>

<p>这些定义在 package.json 里面的脚本，我们称之为 npm scripts。</p>
<p>使用 npm scripts 有如下优点：</p>
<ul>
<li>项目中的脚本集中放置在一处</li>
<li>不同的项目可能有不同的构建命令，但是可以通过 npm scripts 向外提供统一的接口，如 <code>npm run build</code></li>
</ul>
<h2 id="深入模块"><a href="#深入模块" class="headerlink" title="深入模块"></a>深入模块</h2><h3 id="导入路径"><a href="#导入路径" class="headerlink" title="导入路径"></a>导入路径</h3><p>当我们导入其他模块时，可以指定模块的具体路径，例如 <code>./a.js</code>，通过相对路径或者绝对路径均可，但是如果我们没有指定路径，如 <code>require(&#39;a&#39;)</code>，会以何种方式去搜寻该包。</p>
<p>我们可以通过 module.paths 这个属性查看搜索的路径</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// D:\Desktop\node-demo\a.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>.paths);</span><br></pre></td></tr></table></figure>

<p>输出为</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">[</span><br><span class="line">  <span class="string">'d:\\Desktop\\node-demo\\node_modules'</span>,</span><br><span class="line">  <span class="string">'d:\\Desktop\\node_modules'</span>,</span><br><span class="line">  <span class="string">'d:\\node_modules'</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>可见它会先搜索文件所在目录下的 node_modules 文件夹，如果搜索不到则搜索上级目录的 node_modules 文件夹，直至根目录的 node_modules 文件夹，如果在这些路径都没有找到指定的包，那么就会抛出一个错误。</p>
<h3 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h3><p>在导入部分我们说过，当我们导入一个模块时，首先会执行这个模块，在实际的项目中肯定会有多个模块依赖于一个模块的情形，这是不是说每次导入这个模块时，这个模块都会被执行一次? 明显这样不对，所以其实这个模块只会执行一次，然后它的 module.exports 属性就会被缓存，如果第二次、第三次导入这个模块时，直接将缓存的 module.exports 属性返回即可，不必再次执行一次这个模块。</p>
<p>通过 require.cache 这个属性可以知道有哪些 module 对象被缓存起来了，require.cache 是一个对象，其键值是模块的绝对地址，值为 module 对象，在我们 require 模块的时候，如果在 require.cache 对象发现这个模块已经被加载过，那么直接返回这个模块即可，而不必再次执行这个模块。</p>
<h3 id="主程序"><a href="#主程序" class="headerlink" title="主程序"></a>主程序</h3><p>一个模块被执行有两种情况：</p>
<ul>
<li>通过 node 命令直接执行该模块</li>
<li>被其他模块导入</li>
</ul>
<p>通过 node 命令执行的模块我们称之为主模块，有时候我们希望根据模块是否是主模块来表现不同的行为，所以我们需要一种方法来分辨该模块是不是主模块，我们可以通过 require.main 属性来判断一个模块是不是主模块，如果 require.main 的值与当前模块的 module 对象相同，就说明当前模块时主模块</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">require</span>.main === <span class="built_in">module</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"主模块"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"非主模块"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="循环引用"><a href="#循环引用" class="headerlink" title="循环引用"></a>循环引用</h3><p>最后我们要探讨一下，Node.js 对模块的循环引用如何解决，所谓的循环引用就是指二者互相引用</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'./b.js'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//b.js</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">"./a.js"</span>)</span><br></pre></td></tr></table></figure>

<p>如上 <code>a.js</code> 与 <code>b.js</code> 互相引用，我们称之为循环引用，那这样会不会形成死循环，程序如何能执行下去。</p>
<p>解释这个问题很简单，只需要牢牢的抓住缓存即可，因为有缓存的存在，并不会无限的去执行文件导入，而是直接去缓存中的值。假设有如下的程序</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line">exports.done = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">const</span> b = <span class="built_in">require</span>(<span class="string">'./b.js'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"b.done: "</span>, b.done); <span class="comment">// true</span></span><br><span class="line">exports.done = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// b.js</span></span><br><span class="line">exports.done = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">const</span> a = <span class="built_in">require</span>(<span class="string">"./a.js"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"a.done: "</span>, a.done); <span class="comment">// false</span></span><br><span class="line">exports.done = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> a = <span class="built_in">require</span>(<span class="string">"./a.js"</span>);</span><br><span class="line"><span class="keyword">const</span> b = <span class="built_in">require</span>(<span class="string">"./b.js"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"a.done: "</span>, a.done); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"b.done: "</span>, b.done); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>我们执行 index.js，执行过程如下：</p>
<ol>
<li>执行 index.js，导入 a.js<ol>
<li>执行 a.js，并缓存 a.js 的 module.exports</li>
<li>设置 exports.done 为 false</li>
<li>导入 b.js<ol>
<li>执行 b.js，并缓存 b.js 模块</li>
<li>在 b.js 中导入 a.js，<strong>此时因为 a.js 这个模块已经被缓存，所以取缓存即可</strong></li>
<li>因为 a.js 模块此时的 done 属性为 fasle，所以打印的结果为 false</li>
</ol>
</li>
<li>回到 a.js，取到 b.js 模块导出的module.exports，这个对象的 done 属性为 true，因此打印结果为 true</li>
</ol>
</li>
<li>回到 index.js，导入 b.js 模块，该模块已经被缓存，直接取缓存结果</li>
<li>此时 a.js 与 b.js 中的 exports.done 属性均为 true，打印结果均为true</li>
</ol>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li><a href="https://developer.ibm.com/zh/articles/os-nodejs/" target="_blank" rel="noopener">Node.js 究竟是什么</a></li>
<li><a href="https://loveky.github.io/2019/02/12/nodejs-module-system/" target="_blank" rel="noopener">Node.js 的模块系统</a></li>
<li><a href="https://itbilu.com/nodejs/npm/N1hHQ2xk-.html" target="_blank" rel="noopener">Node.js 中的包和模块</a></li>
<li><a href="https://ithelp.ithome.com.tw/articles/10191783" target="_blank" rel="noopener">npm install 到底做了什么</a></li>
<li><a href="https://segmentfault.com/a/1190000015218126" target="_blank" rel="noopener">通过 npm 制作命令行工具的原理</a></li>
<li><a href="https://blog.csdn.net/S_aitama/article/details/113706339" target="_blank" rel="noopener">nrm 报错 [ERR_INVALID_ARG_TYPE] 解决方法</a></li>
<li><a href="https://www.zhihu.com/question/62331583" target="_blank" rel="noopener">npm install 生成的 package-lock.json 是什么文件? 有什么用?</a></li>
<li><a href="https://www.ruanyifeng.com/blog/2016/10/npm_scripts.html" target="_blank" rel="noopener">npm scripts 使用指南</a></li>
</ul>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2021-02-08T10:17:00.000Z" itemprop="dateUpdated">2021-02-08 18:17:00</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="https://lastknightcoder.github.io/lastknightcoder">
            <img src="https://lastknightcoder.github.io/lastknightcoder/img/avatar.jpg" alt="熊滔">
            熊滔
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="https://lastknightcoder.github.io/lastknightcoder/tags/npm/" rel="tag">npm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="https://lastknightcoder.github.io/lastknightcoder/tags/%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8/" rel="tag">循环引用</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="https://lastknightcoder.github.io/lastknightcoder/tags/%E6%A8%A1%E5%9D%97/" rel="tag">模块</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://lastknightcoder.github.io/lastknightcoder/Node.js%20%E4%B9%8B%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F/&title=《Node.js 之模块系统》 — Coder&pic=https://lastknightcoder.github.io/lastknightcoder/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://lastknightcoder.github.io/lastknightcoder/Node.js%20%E4%B9%8B%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F/&title=《Node.js 之模块系统》 — Coder&source=人生天地间，忽如远行客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://lastknightcoder.github.io/lastknightcoder/Node.js%20%E4%B9%8B%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Node.js 之模块系统》 — Coder&url=https://lastknightcoder.github.io/lastknightcoder/Node.js%20%E4%B9%8B%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F/&via=https://lastknightcoder.github.io/lastknightcoder" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://lastknightcoder.github.io/lastknightcoder/Node.js%20%E4%B9%8B%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="https://lastknightcoder.github.io/lastknightcoder/ES6%EF%BC%9ASet%E9%9B%86%E5%90%88%E4%B8%8EMap%E9%9B%86%E5%90%88/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">ES6：Set集合与Map集合</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="https://lastknightcoder.github.io/lastknightcoder/ES6%EF%BC%9ASymbol%20%E5%92%8C%20Symbol%20%E5%B1%9E%E6%80%A7/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">ES6：Symbol 和 Symbol 属性</h4>
      </a>
    </div>
  
</nav>



    


<section class="comments" id="comments">
    <div id="disqus_thread"></div>
    <script>
    var disqus_shortname = 'lastknightcoder';
    lazyScripts.push('//' + disqus_shortname + '.disqus.com/embed.js')
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
</section>



















</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="https://lastknightcoder.github.io/lastknightcoder/img/wechatpay.png" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="https://lastknightcoder.github.io/lastknightcoder/img/wechatpay.png" data-alipay="https://lastknightcoder.github.io/lastknightcoder/img/alipay.png">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="https://lastknightcoder.github.io/lastknightcoder/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>熊滔 &copy; 2019 - 2021</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://lastknightcoder.github.io/lastknightcoder/Node.js%20%E4%B9%8B%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F/&title=《Node.js 之模块系统》 — Coder&pic=https://lastknightcoder.github.io/lastknightcoder/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://lastknightcoder.github.io/lastknightcoder/Node.js%20%E4%B9%8B%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F/&title=《Node.js 之模块系统》 — Coder&source=人生天地间，忽如远行客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://lastknightcoder.github.io/lastknightcoder/Node.js%20%E4%B9%8B%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Node.js 之模块系统》 — Coder&url=https://lastknightcoder.github.io/lastknightcoder/Node.js%20%E4%B9%8B%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F/&via=https://lastknightcoder.github.io/lastknightcoder" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://lastknightcoder.github.io/lastknightcoder/Node.js%20%E4%B9%8B%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPYAAAD2CAAAAADAeSUUAAADKElEQVR42u3a0Y7iMAwFUP7/pxlpXoH22smwW/f0CYnS5BgJYzuPR3w9f6/X18n9x09I7ny9Xt99/MWFjY2NfRH28/DaSz3e6PEeju/MLdjY2NhT2UnSOoblW09g1WDlFmxsbOw7s/NCIk8qSbLMA4eNjY2NnSew9cZQnsaqIcbGxsa+J7vXiK82nqrjh73JEhsbG3sq+y+29a9ef2m+jY2Njf3fsJ/Fa1dbJ0k8u/b85snY2NjYg9h5O35vmz4pHqo5qNpmwsbGxp7BzhtJu47g5MFaSY3R94yNjY19G3Y+WK1uK09v1dR1ktiwsbGxx7Grh2z29t57R3aqjadCxsPGxsa+LLu6ZG8cm7/bWyt6DjY2NvY49norP1k+KSp6Y4k8fZ58GBsbG/uy7LzFv9JUqg4VekGJAoSNjY09lN1LM3l6ywOap8lE8eYJ2NjY2IPYvd/zauMpL05WQnCcCN+siI2NjT2CvVIG9MauSXB7oU9GEdjY2Njz2Pkf913lQa9dtYLHxsbGns1e/9OfpKX1dn8SxELQsbGxsW/Drh7iqW4rX7darkQnSbGxsbFHsPN2fH6sp3p0Mq+ZqkE5+RQ2Njb2IHaVVN3cyiAhH13kDSlsbGzsSexki9XWz/eLkOqK2NjY2JPY+T/z/EHrbabeGKBXJmFjY2NPYiet/0Jl0zoAVG7xx60lbGxs7KnsXlraOzaohiBPmR/fxcbGxr4Bu/q4vaVLAdD6wrCxsbFns3vlSl6o5KT1cHxcHRsbG3s0u1oe5EdwdpUcSZhOVsTGxsYexE5Gp+sprdeQyscJeSLExsbGnsdOGvrVYUA+JMjHxr0208c7sbGxscexe+lqZfSbD5J7I+TCiR5sbGzsEezqknm7p5qiVhpbheYXNjY29iB2L9VVW1HVMUC1sEnC0cRjY2NjX4S9kjBWmj4rg97j5BeFDBsbG3scO0kMeavoOwPjbR01bGxs7Nuwq8mmx9g1eD4JEzY2NvaN2StHZ1ZKoOpgYFspgo2NjX0Rdn4Ep5dOeqkubx6VhxPY2NjYg9grHZjqaDYfJPSO4FSDjo2NjX1x9g/obPOH8mwXqwAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: 'https://lastknightcoder.github.io/lastknightcoder/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>



<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" async></script>




<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '死鬼去哪里了！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
